# Pitfalls Research: EDA Visual Encyclopedia

**Domain:** Adding a 90+ page interactive statistics education pillar (EDA Visual Encyclopedia) to an existing Astro 5 static portfolio site
**Researched:** 2026-02-24
**Confidence:** HIGH (verified against Astro GitHub issues, KaTeX/D3 official docs, Lighthouse audit rules, NIST Handbook source, existing codebase architecture, and real-world case studies from large Astro sites)

**Context:** This is a SUBSEQUENT milestone pitfalls document. The existing site has 857 pages, Lighthouse 90+, deployed to GitHub Pages via Astro 5 static build. The EDA Visual Encyclopedia adds 90+ pages with build-time SVG plots (generated by Python/matplotlib), KaTeX formulas, Python code blocks, and D3 interactive distribution visualizations. A 3-tier interactivity model is planned: static SVG (70%), SVG swap (20%), D3 dynamic (10%). Source material is the NIST/SEMATECH e-Handbook of Statistical Methods (public domain).

**Key differences from existing content:**
- Math rendering (KaTeX) -- not used anywhere in the existing site
- Build-time SVG generation from Python -- existing OG images use Satori/Sharp, but this adds matplotlib
- D3.js interactive components -- new client-side library not in the current stack
- 90+ pages sharing near-identical template structure -- existing blog posts have varied content
- Statistics accuracy requirements -- existing blog content is opinion/tutorial, not peer-reviewed reference material

---

## Critical Pitfalls

### Pitfall 1: Build Time Explosion from OG Image + SVG Generation at Scale

**What goes wrong:**
The existing site builds 857 pages. Adding 90+ EDA pages means 90+ new OG images via Satori/Sharp (each taking 100-300ms) plus potentially invoking Python for SVG plot generation during build. OG images alone add 9-27 seconds. If Python SVG generation runs per-page during build (even at 500ms each for 63+ static SVGs), that adds another 30+ seconds. Combined with MDX/KaTeX rendering overhead, builds could grow significantly -- and if the Python pipeline has issues (retries, font loading, matplotlib import time ~2s on cold start), builds risk hitting GitHub Pages' 10-minute deployment timeout.

**Why it happens:**
The existing OG image generation pattern (`src/pages/open-graph/[...slug].png.ts`) runs Satori + Sharp for every page during `getStaticPaths()`. This pattern scales linearly. At 950+ total pages (existing 857 + 90 new), the OG generation step becomes a dominant build cost. Adding a Python subprocess layer multiplies the risk -- Python cold-start, matplotlib import time, and font discovery all contribute. The `withastro/action@v3` used in the current GitHub Actions workflow does not include Python/matplotlib, so running Python in CI means adding `setup-python`, `pip install matplotlib numpy`, and managing virtual environments.

**How to avoid:**
1. **Cache OG images between builds.** Implement file-based caching: hash the page title + description, check if the cached PNG already exists, skip regeneration if so. This reduces OG generation to only new/changed pages. Reference pattern: [astro-ogp-build-cache](https://ainoya.dev/posts/astro-ogp-build-cache/).
2. **Pre-generate all SVGs offline, not at build time.** Run the Python SVG pipeline as a separate `npm run generate:svgs` script that outputs to `src/assets/eda-plots/`. Commit the SVGs to git. Astro build simply imports them as static assets -- zero Python dependency at build time.
3. **Never invoke Python during `astro build`.** The GitHub Actions `withastro/action@v3` does not include Python. Running Python in the build pipeline means modifying the CI workflow significantly. Instead, treat SVGs as source assets that are generated locally and committed.
4. **Measure build time after every 10 pages added.** Set a budget: build should not regress more than 20% from current baseline. Track with a simple `time npm run build` in CI logs.

**Warning signs:**
- Local build time increases by more than 5 seconds per batch of 10 EDA pages
- CI build time doubles from baseline after first batch of EDA pages
- `withastro/action@v3` step shows Python-related errors or warnings
- OG image generation time exceeds total page rendering time in build output

**Phase to address:**
Phase 1 (Foundation/Infrastructure) -- establish the SVG pre-generation pipeline and OG caching strategy before any content pages are created.

---

### Pitfall 2: KaTeX + MDX Formula Parsing Breaks on Complex LaTeX

**What goes wrong:**
When using `remark-math` and `rehype-katex` in Astro MDX files, complex or multiline LaTeX expressions fail to parse. The error is typically `"Cannot read properties of undefined (reading 'mathFlowInside')"`. This is a known Astro issue ([#8650](https://github.com/withastro/astro/issues/8650)) caused by version incompatibilities between Astro's internal remark/rehype dependency tree and newer math plugin versions. Additionally, MDX treats curly braces `{}` as JSX expressions, so LaTeX containing `\frac{}{}`, `\sum_{}^{}`, or any `{}` pairs can cause MDX parse failures or silent rendering errors.

**Why it happens:**
Astro 5 pins specific versions of `remark` and `rehype` internally. The latest `remark-math` v6+ requires newer versions of these dependencies than Astro provides. MDX's JSX parser also conflicts with LaTeX syntax because both use `{}` for different purposes. The EDA content heavily uses statistical formulas (standard deviation, chi-squared, probability density functions) that all contain complex nested braces.

**How to avoid:**
1. **Pin exact compatible versions:** Use `remark-math@5.1.1` and `rehype-katex@6.0.3`. These are the last versions confirmed compatible with Astro 5's dependency tree per the GitHub issue discussion.
2. **Create a custom `<Math>` Astro component** for complex formulas instead of relying on `$...$` MDX syntax. The component accepts a `formula` string prop, calls `katex.renderToString()` at build time, and outputs pre-rendered HTML via `set:html`. This completely bypasses the remark-math/MDX parser conflict for problematic formulas.
3. **Use `.md` files (not `.mdx`) for pages that are primarily content + formulas** and only use `.mdx` for pages requiring interactive D3 island components. Remark-math works more reliably in pure Markdown than in MDX because there is no JSX parser to conflict with.
4. **Test every LaTeX formula category in isolation** before embedding in content. Create a test page `/eda/test-formulas/` during development that renders all formula patterns used across the pillar: inline math, display math, multi-line aligned equations, fractions, summations, integrals, matrices.

**Warning signs:**
- Build fails with `mathFlowInside` errors
- Formulas render as raw LaTeX text instead of formatted math
- Some formulas render but others on the same page do not (partial rendering)
- MDX files with many `{}` in formulas produce JSX parse errors during build
- KaTeX output appears as raw HTML tags instead of rendered math (CSS loading issue)

**Phase to address:**
Phase 1 (Foundation) -- validate the KaTeX integration with a representative sample of 10+ real formulas from the NIST Handbook, including the most complex ones, before writing any content pages.

---

### Pitfall 3: D3.js Bundle Ships to All 90+ Pages, Destroying Lighthouse Scores

**What goes wrong:**
The D3.js full bundle is ~240KB minified (~80KB gzipped). If D3 is imported in a shared component or layout used by all EDA pages, every single page downloads the full D3 bundle -- even the 70% of pages that only have static SVGs. The existing site relies on minimal JS (GSAP ~50KB gzipped + Lenis ~4KB). Adding D3 globally would nearly triple the JS payload and drop Lighthouse performance from 90+ to the 70s or worse on mobile (Lighthouse simulates mid-tier phone on 4G). Worse, if D3 loads eagerly, it blocks first paint and destroys LCP.

**Why it happens:**
Developers commonly create a shared `EDALayout.astro` that includes D3 "just in case" or import the full `d3` package instead of specific sub-modules. Astro's island architecture is specifically designed to prevent this, but you have to use it correctly -- D3 must be isolated in client-side island components (React/Preact/Svelte) with `client:visible` or `client:idle`, not imported in the Astro template or layout.

**How to avoid:**
1. **Only ~10% of pages (roughly 9 pages) need D3.** Create D3 interactive elements as isolated island components loaded with `client:visible`. They only hydrate when scrolled into the viewport, and only on the specific pages that use them.
2. **Import D3 sub-modules, never the full package.** Use `import { scaleLinear } from 'd3-scale'` and `import { line } from 'd3-shape'` instead of `import * as d3 from 'd3'`. This enables tree-shaking and can reduce the D3 payload by 50% or more for typical statistical visualizations.
3. **Define three component tiers explicitly in code:**
   - **Tier 1 (70% of pages):** Static SVG via `<img>` tag. Zero additional client JS.
   - **Tier 2 (20% of pages):** SVG swap. Minimal vanilla JS (~2KB) that swaps `src` attribute on button click. No D3.
   - **Tier 3 (10% of pages):** D3 interactive. Full island component with `client:visible`.
4. **Set a per-page JS budget:** Tier 1/2 pages should add 0-5KB JS beyond the existing base. Tier 3 pages can add up to 50KB (D3 sub-modules only).
5. **Verify with bundle analysis** after implementing each tier. Inspect Vite chunk output to confirm D3 is not in shared chunks.

**Warning signs:**
- Lighthouse performance drops below 85 on any EDA page
- Bundle analyzer shows D3 modules in chunks loaded by Tier 1 or Tier 2 pages
- Total Blocking Time (TBT) increases on EDA pages vs existing blog pages
- `client:load` used instead of `client:visible` for D3 island components

**Phase to address:**
Phase 1 (Foundation) -- define the 3-tier component architecture and implement one working example of each tier as proof-of-concept. Phase 2 (Content) validates the pattern holds as pages are added.

---

### Pitfall 4: DOM Size Explosion from Inline SVGs Triggering Lighthouse Warnings

**What goes wrong:**
Lighthouse flags "Avoid an excessive DOM size" when the body has more than ~800 nodes (warning) or ~1,400 nodes (error). Statistical SVG plots are complex -- a single histogram with 20 bars, axes, labels, tick marks, and gridlines can contain 80-150+ SVG DOM elements (`<rect>`, `<line>`, `<text>`, `<g>`, `<path>`, `<tspan>`). A page showing 3-4 inline SVG plots could easily add 400-600 DOM nodes on top of the existing page structure, pushing past the warning threshold. Lighthouse specifically counts SVG child nodes in its DOM audit ([Lighthouse issue #6807](https://github.com/GoogleChrome/lighthouse/issues/6807)).

**Why it happens:**
The natural approach for styling and animation is to inline SVGs directly in the HTML. But statistical plots are far more complex than typical web icons -- each plot is a full data visualization with dozens of elements for axes, data points, labels, and decorations. Multiply by multiple plots per page and the DOM bloats quickly. Developers coming from data science backgrounds are accustomed to notebooks where DOM size is irrelevant.

**How to avoid:**
1. **Use `<img>` tags for Tier 1 static SVG plots, not inline SVG.** `<img src="/eda-plots/histogram.svg">` keeps SVG nodes entirely out of the page DOM. The SVG renders as a single replaced element. You lose CSS styling of SVG internals but gain major DOM performance.
2. **For Tier 2 (SVG swap) pages:** Load the default SVG via `<img>`, and swap only the `src` attribute on interaction. SVG content never enters the DOM.
3. **For Tier 3 (D3 interactive) pages:** D3 renders into a single `<svg>` container that IS in the DOM, but limit to one D3 chart per page. Any additional plots on the same page should use `<img>` tags.
4. **Pre-optimize SVG output from Python.** Run `svgo` on all generated SVGs to strip metadata, merge paths, remove editor artifacts, and reduce node count. Well-optimized SVGs can have 30-50% fewer nodes than raw matplotlib output.
5. **Target: under 600 additional DOM nodes per EDA page** from content (leaving headroom below the 800-node warning, accounting for existing layout/header/footer nodes).

**Warning signs:**
- Lighthouse "Avoid an excessive DOM size" warning on any EDA page
- Page paint time exceeds 200ms on Lighthouse mobile simulation
- CLS shifts when SVGs load after initial paint (if using lazy-loaded `<img>`)
- Scrolling jank on pages with many inline SVG elements (on low-end devices)

**Phase to address:**
Phase 1 (Foundation) -- establish the `<img>` pattern for Tier 1 pages and verify DOM node counts. Test with a page containing 4+ SVG plots before proceeding with batch content creation.

---

### Pitfall 5: Content Accuracy Drift When Modernizing NIST Handbook Material

**What goes wrong:**
The NIST/SEMATECH e-Handbook of Statistical Methods is a rigorously peer-reviewed reference from a U.S. federal standards organization (originally published 2002, updated from Handbook 91 from 1963). When "modernizing" its content for web presentation, subtle accuracy errors creep in: statistical definitions get simplified incorrectly, formula variables are renamed in ways that change meaning, examples use different data that invalidates the statistical conclusions, or modern terminology replaces precise NIST terminology in ways that alter technical meaning. This creates a resource that looks authoritative but contains errors -- destroying credibility with the target audience (engineers, data scientists, researchers).

**Why it happens:**
The temptation to "improve" the source material is strong. Writers simplify prose for readability, update examples with "modern" datasets, or paraphrase definitions. Unlike a blog post where opinions are expected, statistics has objective truth -- a chi-squared test has specific assumptions that cannot be loosely paraphrased. LLM-assisted content generation amplifies this risk because language models produce plausible-sounding but subtly wrong statistical explanations with high confidence.

**How to avoid:**
1. **Establish a content accuracy policy before any content creation:** All formulas must be verified character-by-character against the NIST source. All statistical definitions must faithfully represent the NIST Handbook text. Cite the specific NIST handbook section for every technique page (e.g., "Source: NIST/SEMATECH e-Handbook, Section 1.3.3.14").
2. **Use a review checklist per page:** (a) Does every formula match the NIST source exactly? (b) Are variable names consistent with NIST conventions? (c) Does the example use the same dataset or one that produces the same statistical conclusion? (d) Would a practicing statistician find any claim misleading?
3. **Never ship LLM-generated statistical content without manual verification.** Flag every formula, definition, and statistical claim for human review. "Close enough" is not acceptable for reference material.
4. **Include NIST source references on every page** as both attribution and a verifiable audit trail. Readers should be able to cross-check any claim.
5. **Distinguish between faithful presentation and editorial addition.** If the EDA page adds modern context (e.g., "This technique is commonly used in machine learning feature analysis"), clearly separate that from the NIST-sourced material.

**Warning signs:**
- Any formula that differs between the NIST source and the EDA page
- Examples that produce different statistical conclusions than the NIST original
- Statistical terminology used loosely (e.g., "correlation" where NIST says "association")
- Pages that lack NIST section references
- Reviewer cannot trace a statistical claim back to a specific NIST source section

**Phase to address:**
Phase 2 (Content Creation) -- but the accuracy policy and review checklist must be defined in Phase 1. Every content batch must include an accuracy review before merge.

---

### Pitfall 6: SEO Damage from Publishing 90+ Template-Similar Pages Simultaneously

**What goes wrong:**
Adding 90+ pages at once to an 857-page site (a ~10% increase concentrated in a single subdirectory) can trigger Google's SpamBrain pattern detection. If the pages share the same template structure and look algorithmically similar (same layout, similar word patterns, template-generated meta descriptions), Google may classify them as programmatic/thin content and suppress the entire `/eda/` subdirectory from search results. Worse, SpamBrain's 2025 update stitches patterns across pages -- a cluster of perceived-thin pages within a single site can drag down rankings for unrelated pages (existing blog posts, projects).

**Why it happens:**
Google's 2025 spam update specifically targets mass-produced content with similar structure. Thirty technique pages that all follow the same "Definition / Formula / Example / Visualization" template will look algorithmically identical to spam detectors, even if each page's content is genuinely unique and valuable. The risk is amplified when all pages are published simultaneously rather than gradually, and when meta descriptions are generated from a template rather than hand-written.

**How to avoid:**
1. **Stagger publication: publish 10-15 pages per week over 6-8 weeks**, not all 90 at once. This mimics natural content growth and gives time for indexing and engagement signals to accumulate.
2. **Ensure substantial unique content per page.** Each technique page must have: a unique plain-English explanation (200+ words), a unique worked example with real data, a unique visualization, and unique context about practical applications -- not just a formula + boilerplate template text.
3. **Write unique, specific meta descriptions** for every single page. Never auto-generate from a template pattern. Each description should name the specific technique, its domain of application, and what the reader will learn.
4. **Build the content silo structure with proper internal linking:** Hub page (`/eda/`) links to category pages (`/eda/distributions/`, `/eda/hypothesis-testing/`, etc.), which link to individual technique pages. Each technique page links back to its category hub and to 2-3 related techniques. This signals topical depth and organization to search engines.
5. **Submit the updated sitemap to Google Search Console** after each batch publication. Monitor the "Coverage" and "Indexing" reports for "Discovered but not indexed" patterns or "Duplicate without user-selected canonical" warnings.
6. **Add structured data (JSON-LD)** to EDA pages: use `TechArticle` or `LearningResource` schema with proper `about`, `educationalLevel`, and `teaches` properties to signal educational intent.

**Warning signs:**
- Google Search Console shows "Discovered - currently not indexed" for many EDA URLs after 2+ weeks
- Existing page rankings drop after EDA pages are published (collateral damage)
- EDA pages show zero impressions in Search Console weeks after publication
- Google classifies EDA pages as "Duplicate, Google chose different canonical than user"

**Phase to address:**
Phase 3 (SEO + Publication Strategy) -- but the URL structure, content silo architecture, and internal linking plan must be designed in Phase 1, and content uniqueness must be enforced in Phase 2.

---

### Pitfall 7: GSAP View Transition Conflicts When Adding New Page Category

**What goes wrong:**
The existing site uses GSAP ScrollTrigger with Astro view transitions, managed via `window.__*` globals and lifecycle hooks (`astro:page-load`, `astro:before-swap`). The animation lifecycle is documented as fragile in the codebase CONCERNS.md. Adding 90+ new pages in a new content pillar (`/eda/`) introduces pages with different animation needs. If EDA pages include D3 interactive components alongside the existing GSAP animations, the two systems compete for scroll events and DOM control. ScrollTrigger instances from the previous page can leak into EDA pages (or vice versa), causing broken animations, memory leaks, and visual glitches.

**Why it happens:**
The existing animation lifecycle (`src/lib/animation-lifecycle.ts`) was designed when all pages shared similar GSAP animation patterns. EDA pages introduce a fundamentally different interaction model: some pages have D3 charts that manage their own scroll/resize listeners, which can conflict with GSAP ScrollTrigger. The `window.__*` global state pattern (ParticleCanvas, CustomCursor, TimelineDrawLine, TiltCard) is fragile -- adding new animation consumers without understanding the cleanup chain causes leaks. Bundled scripts run only once when View Transitions are enabled, so D3 components need careful re-initialization logic.

**How to avoid:**
1. **EDA pages should NOT use GSAP ScrollTrigger for content-area animations.** Use CSS animations, `IntersectionObserver`, or CSS `scroll-driven-animations` for reveal effects within EDA content. GSAP should only apply to shared Layout elements (header, footer, cursor) that already have lifecycle management.
2. **D3 island components must manage their own lifecycle completely.** Each D3 component sets up and tears down its own resize/scroll listeners within its island scope. Do not hook into the GSAP lifecycle system. D3 components must check for existing content before rendering (prevent duplicate charts after view transition navigation).
3. **Create a dedicated `EDALayout.astro`** that extends the base `Layout.astro` but overrides or omits content-area scroll animation initialization. Header/footer GSAP effects carry over from the base layout.
4. **Test the critical navigation sequences:** Home -> EDA page -> Blog post -> EDA page -> Home -> EDA page. After 5+ navigations, check DevTools Performance tab for ScrollTrigger instance count (should stay stable) and heap snapshot for memory growth (should be negligible).

**Warning signs:**
- Console errors about ScrollTrigger or GSAP on EDA pages
- Animations play incorrectly after navigating from EDA to non-EDA pages (or vice versa)
- Memory usage grows with each navigation cycle (DevTools heap snapshot)
- D3 charts render as duplicate/overlapping elements after view transition navigation

**Phase to address:**
Phase 1 (Foundation) -- the EDA layout and animation isolation strategy must be established before any content pages are created. Test the navigation cycle on the first 2-3 EDA pages.

---

## Technical Debt Patterns

Shortcuts that seem reasonable but create long-term problems.

| Shortcut | Immediate Benefit | Long-term Cost | When Acceptable |
|----------|-------------------|----------------|-----------------|
| Inline all SVG plots directly in MDX | Full CSS styling, animation access | DOM bloat triggers Lighthouse warnings, slower page loads at scale | Never for statistical plots (too many nodes); only for small decorative SVGs (<10 nodes) |
| Import full `d3` package | Simpler imports, faster initial development | 240KB bundle on every page that uses it, terrible mobile performance | Never -- always use sub-module imports (`d3-scale`, `d3-shape`, etc.) |
| Generate SVGs at Astro build time via Python subprocess | SVGs always reflect latest data/config, no manual step | CI requires Python setup, build time grows linearly, flaky builds from matplotlib font discovery | Never for this project -- SVGs are reference material that rarely changes. Pre-generate and commit. |
| Reuse existing `blog` content collection for EDA pages | No schema changes needed, faster initial setup | EDA pages constrained to blog schema (no technique-specific metadata), queries return mixed blog+EDA results, routing conflicts | Never -- EDA needs its own content collection with dedicated Zod schema and route |
| Auto-generate meta descriptions from template | Fast content creation at scale | Google classifies as programmatic/thin content, hurts SEO for entire site | Never -- each page needs a hand-written unique description |
| Skip SVGO optimization on Python-generated SVGs | Faster development pipeline, fewer tools to manage | SVG files 2-3x larger than necessary, more DOM nodes if ever inlined, larger git repo | Only during initial development; must optimize before merging any content batch |
| Use `client:load` for D3 components | D3 available immediately on page load, simpler debugging | Blocks rendering, kills LCP score, JS parses before user even scrolls to chart | Never -- use `client:visible` for below-fold charts or `client:idle` for above-fold |
| Self-host KaTeX CSS via CDN link | Quick initial setup, always latest version | External HTTP request blocks rendering, CDN downtime breaks math display, CORS issues possible | During development only; production must self-host KaTeX CSS and fonts |
| Put all 90+ EDA pages in a flat directory | Simple organization, easy glob pattern | No category hierarchy, makes internal linking harder, URL structure has no topical signals for SEO | Never -- use subdirectories per category (distributions, hypothesis-testing, etc.) |

## Integration Gotchas

Common mistakes when connecting the EDA pillar to existing site systems.

| Integration | Common Mistake | Correct Approach |
|-------------|----------------|------------------|
| KaTeX CSS + existing CSP plans | KaTeX requires `style-src 'unsafe-inline'` for its inline style attributes ([KaTeX issue #4096](https://github.com/KaTeX/KaTeX/issues/4096)). If the site later adds CSP headers (noted as a concern in CONCERNS.md), KaTeX rendering silently breaks. | Self-host KaTeX CSS and fonts. Document the `'unsafe-inline'` style-src dependency. If CSP is implemented, add `'unsafe-inline'` for `style-src` and note why. |
| New `eda` content collection + existing `blog` collection | Putting EDA content in the existing `blog` collection with a `type: 'eda'` discriminator field. Breaks existing blog queries, pollutes blog listing, and constrains EDA to blog frontmatter schema. | Create a separate `eda` content collection in `src/content.config.ts` with its own Zod schema (including `category`, `nistSection`, `difficulty`, `prerequisites`, `relatedTechniques`). EDA pages get their own `src/pages/eda/[...slug].astro` dynamic route. |
| Python SVG pipeline + GitHub Actions CI | Assuming `withastro/action@v3` includes Python runtime. It does not -- it is a Node.js-based action. Build fails in CI with "python: command not found". | Pre-generate SVGs locally, commit to repo as source assets. If CI automation is needed later, add a separate job with `actions/setup-python@v5` before the Astro build job. |
| D3 island components + Astro view transitions | D3 component renders chart on mount but does not account for view transitions re-mounting. Navigating away and back triggers `client:visible` again, creating duplicate SVG elements in the same container. | D3 component must check if container already has content before rendering (check `data-initialized` attribute or clear container on every mount). Handle the `astro:page-load` event for re-initialization. |
| EDA pages in sitemap + existing sitemap config | All 90+ EDA pages appear in sitemap with default priority, diluting crawl budget signal for high-value pages (homepage, blog posts, projects). | Use `@astrojs/sitemap` filter function to manage EDA URL inclusion. Consider separate sitemap for EDA content, or assign lower `changefreq` to technique pages vs dynamic blog content. |
| KaTeX fonts + self-hosting path | KaTeX requires specific WOFF2 font files (KaTeX_Main, KaTeX_Math, KaTeX_Size, etc.). If self-hosted but the font path in CSS doesn't match the actual file location, math renders in browser fallback font with wrong spacing, broken symbols. | Copy KaTeX font files to `public/fonts/katex/`. Override the `katex.min.css` font-face `src` URLs to point to `/fonts/katex/`. Verify every glyph category renders (Greek letters, operators, sizing brackets). |
| EDA navigation + existing Header component | Adding EDA to main nav requires dropdown/mega-menu that doesn't exist in the current flat nav. Adding all 6+ categories to the header makes it overwhelming, especially on mobile. | Add a single "EDA Encyclopedia" nav link pointing to `/eda/`. The hub page at `/eda/` handles all sub-navigation. Do not add category links to the main site header. |
| RSS feed accidentally including EDA pages | If EDA uses the same content collection patterns as blog, the RSS feed generator (`src/pages/rss.xml.ts`) may pick up EDA pages and include them in the blog feed. | EDA uses a separate content collection. Verify RSS feed generation query only pulls from `blog` collection. Add a build-time check: RSS item count should match blog post count. |
| EDA pages + existing `llms.txt` | The `src/pages/llms.txt.ts` generates an LLM context file. Adding 90+ EDA pages without updating this file means LLM crawlers miss the new content, or worse, the file becomes unwieldy. | Update `llms.txt.ts` to include a concise EDA section (hub page + category descriptions). Do not list all 90+ individual technique pages -- link to the hub page. |

## Performance Traps

Patterns that work at small scale but fail as the EDA pillar grows.

| Trap | Symptoms | Prevention | When It Breaks |
|------|----------|------------|----------------|
| Loading KaTeX CSS globally (in base `Layout.astro`) | 28KB+ extra CSS downloaded on every page including blog/projects that have no math | Load KaTeX CSS only in `EDALayout.astro`, not in the base layout | Immediately -- affects ALL existing pages the moment KaTeX CSS is added globally |
| Python-generated SVGs without SVGO optimization | SVG files 50-200KB each, raw matplotlib output includes redundant precision, metadata, editor-specific attributes | Run `svgo` (with careful config to preserve text and viewBox) on all generated SVGs; target under 20KB per plot | At 20+ unoptimized SVGs on a single page load (e.g., category listing), page weight exceeds reasonable limits |
| Single OG template for all 90+ EDA pages without caching | 90+ Satori+Sharp renders every build, 100-300ms each = 9-27 extra seconds per build | Cache OG images by content hash. Consider sharing a single generic "EDA Visual Encyclopedia" OG image across all technique pages (only unique OG for hub and category pages) | At 50+ uncached OG images, build time noticeably regresses |
| KaTeX client-side rendering (via auto-render script) instead of build-time | Flash of un-styled LaTeX on page load, CLS shifts as formulas resize into final dimensions, extra JS bundle for KaTeX runtime | Use `rehype-katex` for server-side/build-time rendering. All formulas are pre-rendered as HTML in the static output -- zero KaTeX JS needed at runtime | Immediately -- CLS is terrible on any page with formulas, especially mobile |
| Loading all technique page data in memory during `getStaticPaths()` | Memory pressure during build; risk of Node.js heap overflow on CI runners with limited RAM | Use Astro 5's Content Layer API with caching. Process pages incrementally. Keep frontmatter lean (don't embed large data objects in frontmatter). | At 500+ pages with heavy frontmatter, or on CI runners with <2GB RAM |
| Not using `loading="lazy"` on below-fold SVG `<img>` tags | All SVG images download immediately on page load even if below viewport, increasing Time to Interactive | Add `loading="lazy"` to all SVG `<img>` tags except the first/hero visualization | At 4+ SVG images per page without lazy loading |

## Security Mistakes

Domain-specific security issues for this educational content pillar.

| Mistake | Risk | Prevention |
|---------|------|------------|
| Loading KaTeX or D3 from CDN without Subresource Integrity (SRI) hashes | CDN compromise injects malicious code into all pages that load the library | Self-host both KaTeX CSS/fonts and D3.js modules. If CDN is used during development, add `integrity` and `crossorigin="anonymous"` attributes. |
| Using `set:html` to render KaTeX output without understanding the trust boundary | For this static site with author-controlled content, risk is minimal. But if the content pipeline ever accepts external contributions, KaTeX input could contain XSS payloads. | Use `katex.renderToString()` with `throwOnError: true` and `strict: true` to reject invalid or suspicious LaTeX input at build time. |
| Committing Python SVG generation scripts with hardcoded absolute file paths | Scripts break on different OS, CI environments, or contributor machines. Potential path traversal if scripts are later parameterized to accept user input. | Use relative paths resolved from `__dirname`. Validate all file path parameters. Add `.gitattributes` for line ending consistency (Python scripts on Windows). |
| Exposing internal file structure via SVG metadata | matplotlib embeds creator info, file paths, and timestamps in SVG metadata by default | Configure matplotlib to strip metadata: `plt.savefig(..., metadata={})`. Run SVGO with `removeMetadata: true` plugin. |

## UX Pitfalls

Common user experience mistakes in educational statistics content.

| Pitfall | User Impact | Better Approach |
|---------|-------------|-----------------|
| Formula-first presentation without plain-English context | Users without strong stats background bounce immediately; even technical users prefer context before notation | Lead every technique page with 1-2 sentences: what this technique does, when to use it, what question it answers. THEN show the formula. THEN the visualization. |
| Non-responsive SVG plots that overflow on mobile | Horizontal scroll, cropped axis labels, unreadable text at small sizes | Generate SVGs with `viewBox` attribute and NO fixed `width`/`height`. CSS: `width: 100%; height: auto`. Test at 320px viewport width. |
| Interactive D3 charts requiring mouse hover (no touch support) | 50-60% of educational content consumers browse on mobile/tablet; hover interactions are invisible to them | Use pointer events API (not mouse-specific events). Add tap-to-reveal as alternative to hover tooltips. Show key data labels by default (don't hide behind hover). |
| No visual distinction between static and interactive plots | Users tap/click static SVGs expecting interaction; confusion leads to "this site is broken" perception | Add a subtle visual indicator (small "Interactive" chip or play icon overlay) on Tier 2/3 visualizations. Static plots get no indicator -- they look like what they are. |
| Walls of formulas without visual breaks | Statistics fatigue; users give up before reaching the practical example | Alternate rhythm: Explanation (text) -> Formula (math) -> Visualization (SVG) -> Example (code). Never stack 3+ formulas consecutively without a non-math element between them. |
| Code examples without copy functionality | Users manually type or try to select Python code from the page, introducing errors | Leverage the existing `astro-expressive-code` integration for all Python code blocks (copy button is built in). Ensure Python syntax highlighting is configured. |
| Missing "Why should I care?" framing | Pages answer "what" and "how" but not "why", reducing engagement and perceived practical value | Every technique page should open with a concrete use case: "Use this when you need to verify whether your manufacturing process has drifted from specification" or "This tells you whether two variables in your dataset are truly related or the pattern is due to chance." |
| No indication of prerequisite knowledge | Users land on an advanced technique page and are lost because they haven't read the fundamentals | Include a "Prerequisites" section or badge on each page (e.g., "Assumes familiarity with: Normal Distribution, Hypothesis Testing"). Link to the prerequisite pages. |

## "Looks Done But Isn't" Checklist

Things that appear complete but are missing critical pieces.

- [ ] **KaTeX integration:** Often missing font files -- verify math renders correctly in BOTH light and dark themes (KaTeX default CSS assumes light background; operators and symbols may be invisible in dark mode)
- [ ] **SVG plots:** Often missing dark mode variants -- verify all plots are legible in dark mode (black axes/text on dark background are invisible). Either generate separate dark-mode SVGs or use CSS `filter: invert()` with careful color management.
- [ ] **D3 interactive charts:** Often missing resize handler -- verify chart redraws correctly when browser window resizes (not just on initial render)
- [ ] **D3 interactive charts:** Often missing view transition cleanup -- verify navigating away and back does not create duplicate chart instances or orphaned event listeners
- [ ] **Content collection schema:** Often missing EDA-specific fields -- verify `eda` schema includes: `category`, `nistSection`, `difficulty`, `prerequisites` (array of slugs), `relatedTechniques` (array of slugs), `tier` (1/2/3)
- [ ] **Internal linking:** Often incomplete cross-references -- verify every technique page links to its category hub page AND to 2-3 related technique pages (not just "back to EDA")
- [ ] **Sitemap:** Often missing or incorrectly including EDA pages -- verify sitemap contains all EDA URLs and that they are in a logical grouping
- [ ] **RSS feed:** Often accidentally includes EDA pages -- verify RSS only contains blog posts. EDA is reference content, not time-stamped blog content.
- [ ] **Mobile rendering:** Often skipped viewport testing -- verify all SVG plots render at 320px viewport width without horizontal scroll or cropped labels
- [ ] **Performance per tier:** Often only testing one page type -- verify Lighthouse 90+ on at least one page from EACH tier (Tier 1 static, Tier 2 swap, Tier 3 interactive)
- [ ] **Accessibility:** Often missing alt text for visualizations -- verify every `<img>` with SVG src has descriptive `alt` text explaining what the chart shows and its key takeaway (not just "histogram")
- [ ] **SEO structured data:** Often missing on EDA pages -- verify at least hub and category pages have `TechArticle` or `LearningResource` JSON-LD
- [ ] **Navigation integration:** Often forgotten -- verify EDA hub appears in main nav, breadcrumbs work on all EDA pages, and "back to category" link is present
- [ ] **llms.txt update:** Often overlooked -- verify `llms.txt` has been updated to reference the EDA pillar
- [ ] **Build time regression:** Often not measured -- verify build time has not regressed more than 20% from pre-EDA baseline

## Recovery Strategies

When pitfalls occur despite prevention, how to recover.

| Pitfall | Recovery Cost | Recovery Steps |
|---------|---------------|----------------|
| Build time explosion | LOW | Enable OG caching, remove Python from build, switch to `<img>` tags for SVGs. Can be done in a single PR within hours. |
| KaTeX formula parsing breaks | MEDIUM | Switch broken formulas from `$...$` syntax to custom `<Math>` component with string props. Each formula fix is ~5 min but there could be 50+ formulas. Batch with grep/replace for common patterns. |
| D3 bundle on all pages | LOW | Move D3 imports into isolated island components with `client:visible`. Straightforward refactor if component boundaries were designed correctly upfront. |
| DOM size Lighthouse warnings | MEDIUM | Convert inline SVGs to `<img>` tags across all affected MDX files. Effort scales with number of pages already published. Doing this at 5 pages is easy; at 90 pages requires systematic find/replace. |
| Content accuracy errors | HIGH | Requires page-by-page statistical review by someone who understands the source material. Cannot be automated. Prevention is 10x cheaper than remediation. Errors in published reference content also damage long-term credibility. |
| SEO penalty from bulk publish | HIGH | Recovery takes 3-6 months. Must improve thin pages, request recrawl, and wait for Google to re-evaluate. May need to de-index and republish in batches. Much harder to recover than to prevent. |
| GSAP/D3 animation conflicts | MEDIUM | Isolate EDA pages into separate layout without GSAP content animations. Refactoring is straightforward for the layout; the harder part is testing all navigation paths. Effort grows linearly with number of EDA pages. |
| KaTeX dark mode invisible | LOW | Add CSS overrides for KaTeX colors in dark mode theme. Single CSS file change, affects all KaTeX content at once. |
| Python SVG font rendering inconsistencies | LOW | Re-generate affected SVGs with `svg.fonttype = "path"` in matplotlib config (converts text to paths for guaranteed cross-platform rendering). Re-run SVGO. Commit updated SVGs. |

## Pitfall-to-Phase Mapping

How roadmap phases should address these pitfalls.

| Pitfall | Prevention Phase | Verification |
|---------|------------------|--------------|
| Build time explosion | Phase 1: Infrastructure | Build completes within 20% of pre-EDA baseline after adding 10 test pages; OG caching confirmed working |
| KaTeX formula parsing | Phase 1: Infrastructure | 10+ representative NIST formulas (including complex multi-line, fractions, summations, matrices) render correctly in test page in both light and dark mode |
| D3 bundle size | Phase 1: Infrastructure | Bundle analyzer confirms D3 only appears in chunks loaded by Tier 3 pages; Tier 1/2 pages have zero additional JS from D3 |
| DOM size explosion | Phase 1: Infrastructure | Lighthouse DOM size audit passes on a test page with 4+ SVG plots loaded via `<img>` tags; node count stays under 800 |
| Content accuracy | Phase 2: Content Creation | Each content batch includes NIST source cross-reference review; checklist completed for every page before merge |
| SEO penalty risk | Phase 3: Publication | Pages published in batches of 10-15/week; Google Search Console monitored weekly for indexing anomalies |
| GSAP/D3 conflicts | Phase 1: Infrastructure | Navigate Home->EDA->Blog->EDA->Home 5+ times; DevTools heap snapshot shows stable memory; no console errors |
| KaTeX + CSP dependency | Phase 1: Infrastructure | Documented in architecture decision record; KaTeX CSS self-hosted; if CSP exists, `unsafe-inline` present for style-src |
| Python SVG pipeline reliability | Phase 1: Infrastructure | SVG generation script runs on fresh clone with documented Python version; all SVGs committed; build has zero Python dependency |
| OG image caching | Phase 1: Infrastructure | Second consecutive build with no content changes shows near-zero time for OG step |
| Dark mode SVG/KaTeX | Phase 2: Content Creation | All SVG plots and KaTeX formulas verified legible in both light and dark themes on first content batch |
| Mobile SVG responsiveness | Phase 2: Content Creation | All plots verified at 320px viewport width without overflow on first content batch |
| RSS feed isolation | Phase 1: Infrastructure | RSS feed generation confirmed to query only `blog` collection; EDA pages do not appear in RSS output |
| Sitemap management | Phase 1: Infrastructure | Sitemap includes EDA pages with appropriate priority; existing page priorities unchanged |
| Navigation integration | Phase 1: Infrastructure | EDA hub link in main nav; breadcrumbs render on test EDA page; mobile menu not overcrowded |

## Sources

- [Astro GitHub Issue #8650: remark-math multiline error](https://github.com/withastro/astro/issues/8650) -- Version incompatibility with mathFlowInside, confirmed fix: pin remark-math@5.1.1 and rehype-katex@6.0.3
- [Astro GitHub Issue #5697: KaTeX rendering in MDX](https://github.com/withastro/astro/issues/5697) -- CSS loading order critical (stylesheet, not preload)
- [KaTeX GitHub Issue #4096: CSP incompatibility](https://github.com/KaTeX/KaTeX/issues/4096) -- Server-side KaTeX rendering requires `style-src 'unsafe-inline'`
- [KaTeX GitHub Issue #1968: auto-render CSP conflict](https://github.com/KaTeX/KaTeX/issues/1968) -- Client-side auto-render has same CSP issue
- [Lighthouse GitHub Issue #6807: SVG DOM node counting](https://github.com/GoogleChrome/lighthouse/issues/6807) -- Inline SVGs and SVG sprites both count toward DOM size audit
- [MDX Discussion #1329: Complex KaTeX formulas break MDX](https://github.com/orgs/mdx-js/discussions/1329) -- Custom component workaround for JSX/LaTeX brace conflicts
- [Astro OGP Build Cache](https://ainoya.dev/posts/astro-ogp-build-cache/) -- Caching pattern to skip unchanged OG image regeneration
- [GitHub Pages Limits](https://docs.github.com/en/pages/getting-started-with-github-pages/github-pages-limits) -- 10-minute build timeout, 1GB site size limit, 100GB/month bandwidth, 10 builds/hour
- [D3 GitHub Issue #3076: Tree-shaking with Rollup](https://github.com/d3/d3/issues/3076) -- Sub-module imports required for effective tree-shaking
- [Astro Build Speed Optimization](https://www.bitdoze.com/astro-ssg-build-optimization/) -- Real-world optimization from 35 to 127 pages/second
- [AntStack: Astro Build Time Reduction](https://medium.com/@antstack/how-we-cut-astro-build-time-from-30-minutes-to-5-minutes-83-faster-d7da73cde481) -- Large Astro site build optimization case study
- [Astro Content Layer Deep Dive](https://astro.build/blog/content-layer-deep-dive/) -- Content caching between builds, suitable for tens of thousands of entries
- [Programmatic SEO at Scale](https://guptadeepak.com/the-programmatic-seo-paradox-why-your-fear-of-creating-thousands-of-pages-is-both-valid-and-obsolete/) -- Gradual publication strategy, SpamBrain pattern detection
- [Google 2025 Spam Update Impact](https://news.designrush.com/google-2025-spam-update-complete-seo-penalties) -- Cross-page pattern stitching by SpamBrain
- [GSAP + Astro View Transitions](https://www.launchfa.st/blog/gsap-astro-view-transitions) -- Lifecycle cleanup patterns, Context API usage
- [GSAP Forum: Astro ViewTransitions breaks ScrollTrigger](https://gsap.com/community/forums/topic/41197-astro-viewtransitions-breaks-scrolltrigger-the-second-time-i-enter-a-page/) -- Duplicate trigger instances on re-navigation
- [Matplotlib SVG Font Handling](https://matplotlib.org/stable/users/explain/text/fonts.html) -- `svg.fonttype` options: 'none', 'path', 'svgfont' for cross-platform consistency
- [CSS-Tricks: SVG Performance](https://css-tricks.com/too-many-svgs-clogging-up-your-markup-try-use/) -- `<use>` pattern, img vs inline performance tradeoffs
- [Astro Sitemap Integration Docs](https://docs.astro.build/en/guides/integrations-guide/sitemap/) -- Custom filter function for controlling sitemap output
- [NIST/SEMATECH e-Handbook of Statistical Methods](https://www.itl.nist.gov/div898/handbook/) -- Source material; public domain; last updated from Handbook 91 (1963)
- [Astro Content Collections Docs](https://docs.astro.build/en/guides/content-collections/) -- glob() loader, nested subdirectories, schema validation
- Existing codebase: `.planning/codebase/CONCERNS.md` -- Animation lifecycle fragility, `window.__*` globals, blog collection schema change risks
- Existing codebase: `.planning/codebase/STACK.md` -- Current dependencies (Astro 5.3.0, GSAP 3.14.2, Satori 0.19.2, Sharp 0.34.5)
- Existing codebase: `.planning/codebase/ARCHITECTURE.md` -- Island architecture, content collection flow, animation lifecycle hooks

---
*Pitfalls research for: EDA Visual Encyclopedia pillar addition to existing Astro 5 portfolio site (857 pages)*
*Researched: 2026-02-24*
