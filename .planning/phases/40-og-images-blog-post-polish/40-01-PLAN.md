---
phase: 40-og-images-blog-post-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/og-image.ts
  - src/pages/open-graph/tools/compose-validator.png.ts
  - src/pages/tools/compose-validator/index.astro
autonomous: true
requirements: [SITE-07]

must_haves:
  truths:
    - "The compose-validator tool page HTML contains an og:image meta tag pointing to /open-graph/tools/compose-validator.png (not the generic default.png)"
    - "Visiting /open-graph/tools/compose-validator.png returns a valid PNG image with Content-Type image/png"
    - "The OG image is 1200x630 pixels with Compose Validator title, description, category pills, and YAML code panel"
  artifacts:
    - path: "src/lib/og-image.ts"
      provides: "generateComposeValidatorOgImage() function"
      contains: "generateComposeValidatorOgImage"
    - path: "src/pages/open-graph/tools/compose-validator.png.ts"
      provides: "Static API route serving OG image PNG"
      exports: ["GET"]
    - path: "src/pages/tools/compose-validator/index.astro"
      provides: "Tool page with ogImage prop wired to custom OG image"
      contains: "open-graph/tools/compose-validator.png"
  key_links:
    - from: "src/pages/open-graph/tools/compose-validator.png.ts"
      to: "src/lib/og-image.ts"
      via: "import generateComposeValidatorOgImage"
      pattern: "import.*generateComposeValidatorOgImage.*from.*og-image"
    - from: "src/pages/tools/compose-validator/index.astro"
      to: "/open-graph/tools/compose-validator.png"
      via: "ogImage prop on Layout component"
      pattern: "ogImage.*open-graph/tools/compose-validator\\.png"
---

<objective>
Create a build-time OG image for the Docker Compose Validator tool page so that sharing the URL on social media displays a branded preview with title, description, category pills, and a YAML code panel -- matching the established Dockerfile Analyzer OG image pattern.

Purpose: Social media sharing of the Compose Validator URL currently shows the generic default OG image. A custom OG image increases click-through rates and reinforces the tool's brand.
Output: generateComposeValidatorOgImage() function, PNG API route, and ogImage prop wired on the tool page.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-og-images-blog-post-polish/40-RESEARCH.md

# Pattern references -- read these for exact implementation patterns
@src/lib/og-image.ts
@src/pages/open-graph/tools/dockerfile-analyzer.png.ts
@src/pages/tools/compose-validator/index.astro
@src/pages/tools/dockerfile-analyzer/index.astro
@src/components/SEOHead.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add generateComposeValidatorOgImage to og-image.ts and create API route</name>
  <files>
    src/lib/og-image.ts
    src/pages/open-graph/tools/compose-validator.png.ts
  </files>
  <action>
1. Read `src/lib/og-image.ts` and study `generateDockerfileAnalyzerOgImage()` -- this is the exact pattern to follow.

2. Add `generateComposeValidatorOgImage()` to `src/lib/og-image.ts` as a new exported async function. Follow the two-column layout pattern from the Dockerfile Analyzer:
   - **Left column:** Title "Docker Compose Validator", description "Free browser-based Docker Compose linter with 52 rules across schema, security, semantic, best-practice, and style categories", and 5 category pills: Schema, Security, Semantic, Best Practice, Style.
   - **Right column:** Stylized YAML code panel with decorative Docker Compose lines. Use short lines like `services:`, `  web:`, `    image: nginx:latest`, `    ports: "80:80"`, `    privileged: true`. Add warning/error markers on security-relevant lines (same marker pattern as Dockerfile Analyzer code panel). Use Inter font (proportional is fine -- lines are decorative, not meant to be exact).
   - **Accent bar:** Use `accentBar()` helper at top.
   - **Branding row:** Use `brandingRow()` helper at bottom.
   - **Colors:** Category pill accent color `#c44b20` with `rgba(196,75,32,0.1)` background (matches existing site accent). YAML keywords in blue `#7aa2f7`, values in light gray `#a9b1d6`, error/warning markers with red/amber dots.
   - **Size:** 1200x630 standard OG dimensions.
   - Call `renderOgPng(layout)` to produce the PNG buffer.

3. Create `src/pages/open-graph/tools/compose-validator.png.ts` as a static API route (no getStaticPaths needed -- single page). Pattern: import `generateComposeValidatorOgImage` from `../../../lib/og-image`, export a `GET: APIRoute` that calls the generator and returns `new Response(png, { headers: { 'Content-Type': 'image/png', 'Cache-Control': 'public, max-age=31536000, immutable' } })`. Mirror the existing `dockerfile-analyzer.png.ts` file exactly in structure.
  </action>
  <verify>
Run `npm run build` and confirm:
- Build succeeds without errors
- The file `dist/open-graph/tools/compose-validator.png` exists in the build output
- The PNG file is a valid image (non-zero size, > 10KB)
  </verify>
  <done>
generateComposeValidatorOgImage() is exported from og-image.ts, the API route at /open-graph/tools/compose-validator.png serves a valid 1200x630 PNG with Compose Validator branding, categories, and YAML code panel.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire ogImage prop on the Compose Validator tool page</name>
  <files>
    src/pages/tools/compose-validator/index.astro
  </files>
  <action>
1. Read `src/pages/tools/compose-validator/index.astro` and `src/pages/tools/dockerfile-analyzer/index.astro` (to see the ogImage prop pattern).

2. Update the Layout component call in `compose-validator/index.astro` to pass:
   - `ogImage={new URL('/open-graph/tools/compose-validator.png', Astro.site).toString()}`
   - `ogImageAlt="Docker Compose Validator -- browser-based compose file linter with 52 rules across schema, security, semantic, best-practice, and style categories"`

3. Verify the Layout component already accepts ogImage and ogImageAlt props (it does per research -- SEOHead.astro handles og:image and twitter:image:alt). Do NOT modify Layout or SEOHead -- just pass the props.
  </action>
  <verify>
Run `npm run build` and then check the generated HTML:
- Open `dist/tools/compose-validator/index.html` and search for `og:image` -- it should contain `/open-graph/tools/compose-validator.png` (not `default.png`)
- Confirm `og:image:alt` and `twitter:image:alt` contain the Compose Validator description
  </verify>
  <done>
The compose-validator tool page HTML includes og:image pointing to the custom OG image route, and og:image:alt provides an accessible description. Sharing the URL on social media will display the branded Compose Validator preview.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `dist/open-graph/tools/compose-validator.png` exists and is a valid PNG (> 10KB)
3. `dist/tools/compose-validator/index.html` contains `og:image` with `/open-graph/tools/compose-validator.png`
4. `dist/tools/compose-validator/index.html` contains `og:image:alt` with Compose Validator description
5. No regression: `dist/open-graph/tools/dockerfile-analyzer.png` still exists (existing OG image not broken)
</verification>

<success_criteria>
- The Compose Validator tool page has a custom OG image instead of the generic default
- The OG image is generated at build time via the existing Satori + Sharp pipeline
- Social media platforms will display the branded Compose Validator preview when the URL is shared
</success_criteria>

<output>
After completion, create `.planning/phases/40-og-images-blog-post-polish/40-01-SUMMARY.md`
</output>
