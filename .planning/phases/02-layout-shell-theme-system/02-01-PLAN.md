---
phase: 02-layout-shell-theme-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - astro.config.mjs
  - tailwind.config.mjs
  - src/styles/global.css
  - src/layouts/Layout.astro
autonomous: true

must_haves:
  truths:
    - "Site renders with Space Grotesk headings, Inter body text, and JetBrains Mono code blocks"
    - "Site loads in user's OS-preferred color scheme (dark or light) with no flash of wrong theme"
    - "Dark and light mode each have distinct, high-contrast color palettes defined as CSS custom properties"
    - "Tailwind utility classes work throughout the project"
  artifacts:
    - path: "tailwind.config.mjs"
      provides: "Tailwind configuration with custom color tokens referencing CSS variables"
      contains: "fontFamily"
    - path: "src/styles/global.css"
      provides: "CSS custom properties for dark/light themes, font-face declarations, base typography styles"
      contains: "@tailwind"
    - path: "src/layouts/Layout.astro"
      provides: "Base HTML layout with font preloading, inline theme-detection script, Tailwind classes"
      contains: "data-theme"
  key_links:
    - from: "src/layouts/Layout.astro"
      to: "src/styles/global.css"
      via: "import in frontmatter"
      pattern: "import.*global\\.css"
    - from: "src/layouts/Layout.astro"
      to: "inline script"
      via: "script in head blocking render"
      pattern: "script.*is:inline"
    - from: "tailwind.config.mjs"
      to: "src/styles/global.css"
      via: "CSS custom properties referenced in Tailwind theme"
      pattern: "var\\(--"
---

<objective>
Install Tailwind CSS, configure the dark/light theme system with CSS custom properties, set up futuristic typography (Space Grotesk, Inter, JetBrains Mono), and add a FOUC-prevention inline script to Layout.astro.

Purpose: Establish the visual foundation that all components and pages will build upon. The theme system and typography are prerequisites for every subsequent UI task.
Output: Tailwind configured, global CSS with theme variables, Layout.astro updated with font loading and theme detection.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/layouts/Layout.astro
@astro.config.mjs
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Tailwind CSS and configure with theme tokens and typography</name>
  <files>
    package.json
    astro.config.mjs
    tailwind.config.mjs
    src/styles/global.css
  </files>
  <action>
    Install @astrojs/tailwind and tailwindcss as dependencies:
    ```
    npm install @astrojs/tailwind tailwindcss
    ```

    Update astro.config.mjs to add the Tailwind integration:
    ```js
    import { defineConfig } from 'astro/config';
    import tailwind from '@astrojs/tailwind';

    export default defineConfig({
      site: 'https://patrykgolabek.dev',
      output: 'static',
      integrations: [tailwind()],
    });
    ```

    Create tailwind.config.mjs with:
    - darkMode: 'class' (theme toggled via class on html element, NOT media query, because we need manual toggle)
    - content paths: ['./src/**/*.{astro,html,js,jsx,md,mdx,svelte,ts,tsx,vue}']
    - Custom fontFamily extending theme:
      - sans: ['Inter', ...defaultTheme.fontFamily.sans]
      - heading: ['Space Grotesk', ...defaultTheme.fontFamily.sans]
      - mono: ['JetBrains Mono', ...defaultTheme.fontFamily.mono]
    - Extended colors using CSS custom properties for theme-aware colors:
      - surface: 'var(--color-surface)'
      - surface-alt: 'var(--color-surface-alt)'
      - text-primary: 'var(--color-text-primary)'
      - text-secondary: 'var(--color-text-secondary)'
      - accent: 'var(--color-accent)'
      - accent-hover: 'var(--color-accent-hover)'
      - border: 'var(--color-border)'

    Create src/styles/global.css with:

    1. Tailwind directives at top:
       ```
       @tailwind base;
       @tailwind components;
       @tailwind utilities;
       ```

    2. @font-face declarations for all three font families loaded from Google Fonts CDN (use font-display: swap for performance):
       - Actually, do NOT use @font-face with local files. Instead, use Google Fonts via <link> tags in Layout.astro (see Task 2). In global.css, just set the CSS custom properties and base styles.

    3. Light theme (default, on :root):
       ```css
       :root {
         --color-surface: #ffffff;
         --color-surface-alt: #f8f9fc;
         --color-text-primary: #1a1a2e;
         --color-text-secondary: #4a4a68;
         --color-accent: #6c63ff;
         --color-accent-hover: #5a52e0;
         --color-border: #e2e4e9;
       }
       ```

    4. Dark theme (on :root.dark):
       ```css
       :root.dark {
         --color-surface: #0a0a1a;
         --color-surface-alt: #12122a;
         --color-text-primary: #e8e8f0;
         --color-text-secondary: #9898b8;
         --color-accent: #7c73ff;
         --color-accent-hover: #9a93ff;
         --color-border: #2a2a4a;
       }
       ```

    5. Base layer styles for typography:
       ```css
       @layer base {
         body {
           @apply font-sans text-[var(--color-text-primary)] bg-[var(--color-surface)] antialiased;
         }
         h1, h2, h3, h4, h5, h6 {
           @apply font-heading font-bold;
         }
         code, pre {
           @apply font-mono;
         }
       }
       ```

    Color rationale: The accent purple (#6c63ff on white / #7c73ff on dark) meets WCAG AA contrast minimums for large text. Body text colors (#1a1a2e on white = 15.4:1, #e8e8f0 on #0a0a1a = 14.8:1) exceed AAA. The futuristic dark palette uses deep navy-black tones consistent with the "Quantum Explorer" space aesthetic.
  </action>
  <verify>
    Run `npm run build` -- build must succeed with zero errors.
    Verify tailwind.config.mjs exists and contains fontFamily configuration.
    Verify src/styles/global.css exists and contains both :root and :root.dark color definitions.
    Verify astro.config.mjs includes tailwind() in integrations array.
  </verify>
  <done>
    Tailwind CSS installed and integrated with Astro. CSS custom properties define distinct dark and light color palettes. Font families configured in Tailwind theme (Space Grotesk heading, Inter sans, JetBrains Mono mono). Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Layout.astro with font loading, theme detection, and base structure</name>
  <files>
    src/layouts/Layout.astro
  </files>
  <action>
    Update src/layouts/Layout.astro to include:

    1. **Props interface** -- expand to accept optional description:
       ```typescript
       interface Props {
         title: string;
         description?: string;
       }
       const { title, description = 'Patryk Golabek â€” Cloud-Native Software Architect' } = Astro.props;
       ```

    2. **Import global CSS** in the frontmatter:
       ```
       import '../styles/global.css';
       ```

    3. **Google Fonts preconnect + preload** in head (before any other link tags):
       ```html
       <link rel="preconnect" href="https://fonts.googleapis.com" />
       <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
       <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
       ```

    4. **Inline theme-detection script** in head BEFORE any stylesheets to prevent FOUC. This MUST be an inline script (is:inline in Astro) so it runs synchronously before first paint:
       ```html
       <script is:inline>
         (function() {
           const stored = localStorage.getItem('theme');
           if (stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
             document.documentElement.classList.add('dark');
           } else {
             document.documentElement.classList.remove('dark');
           }
         })();
       </script>
       ```
       This script:
       - Checks localStorage for saved preference first (THEME-01: persisted preference)
       - Falls back to OS prefers-color-scheme (THEME-02: OS default)
       - Runs before paint so user never sees wrong theme (THEME-03: no FOUC)

    5. **Meta tags** in head:
       ```html
       <meta name="description" content={description} />
       <meta name="generator" content={Astro.generator} />
       ```

    6. **Body structure** with semantic HTML:
       ```html
       <body class="min-h-screen flex flex-col">
         <slot />
       </body>
       ```
       Note: Header and Footer components will be added in Plan 02. For now, the body just wraps the slot with flex-col layout so future header/main/footer stacking works immediately.

    7. **HTML element** should NOT have a hardcoded class="dark" -- the inline script handles this dynamically. Keep `<html lang="en">`.

    The full Layout.astro should be a clean HTML5 document with: charset, viewport, description, generator, font preconnect, font stylesheet, inline theme script, global CSS import, and semantic body with flex column.
  </action>
  <verify>
    Run `npm run build` -- build must succeed.
    Run `npm run dev` and verify in browser:
    1. Page loads with Inter font for body text (inspect computed font-family)
    2. h1 renders in Space Grotesk (inspect computed font-family)
    3. If OS is set to dark mode, page loads with dark background (#0a0a1a) -- no flash of white
    4. If OS is set to light mode, page loads with light background (#ffffff) -- no flash of dark
    5. View page source: inline script appears BEFORE stylesheet links in head
  </verify>
  <done>
    Layout.astro loads Google Fonts (Space Grotesk, Inter, JetBrains Mono) with preconnect for fast loading. Inline theme-detection script prevents FOUC by applying dark class before first paint based on localStorage or OS preference. Global CSS imported. Body uses flex-col for future header/main/footer layout. Build succeeds and fonts render correctly.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with no errors
- Tailwind classes compile (check dist/ CSS contains utility classes)
- CSS custom properties for both light and dark themes present in output CSS
- Google Fonts load successfully (no 404s in network tab)
- Theme detection works: dark OS preference -> dark theme on load, light -> light
- No FOUC: theme applied before first paint (inline script in head)
</verification>

<success_criteria>
1. `npm run build` exits 0
2. Tailwind utilities work in .astro files
3. Three font families render: Space Grotesk (headings), Inter (body), JetBrains Mono (code)
4. Dark/light CSS custom properties produce visually distinct color schemes
5. Page loads in correct theme without any flash of wrong colors
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-shell-theme-system/02-01-SUMMARY.md`
</output>
