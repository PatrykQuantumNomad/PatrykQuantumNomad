---
phase: 02-layout-shell-theme-system
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/Header.astro
  - src/components/Footer.astro
  - src/components/ThemeToggle.astro
  - src/layouts/Layout.astro
  - src/pages/index.astro
autonomous: false

must_haves:
  truths:
    - "User can navigate between pages via a persistent header visible on all screen sizes"
    - "User can toggle between dark and light mode by clicking a button in the header"
    - "Theme preference persists after closing and reopening the browser"
    - "All interactive elements (nav links, theme toggle, skip-to-content) are keyboard-navigable"
    - "Color contrast ratios meet WCAG 2.1 AA minimums across both themes"
  artifacts:
    - path: "src/components/Header.astro"
      provides: "Responsive header with nav items and mobile menu"
      min_lines: 40
    - path: "src/components/Footer.astro"
      provides: "Site footer with copyright, social links"
      min_lines: 15
    - path: "src/components/ThemeToggle.astro"
      provides: "Dark/light mode toggle button with localStorage persistence"
      contains: "localStorage"
    - path: "src/layouts/Layout.astro"
      provides: "Complete layout shell with Header, main slot, Footer"
      contains: "Header"
  key_links:
    - from: "src/layouts/Layout.astro"
      to: "src/components/Header.astro"
      via: "Astro component import"
      pattern: "import Header"
    - from: "src/layouts/Layout.astro"
      to: "src/components/Footer.astro"
      via: "Astro component import"
      pattern: "import Footer"
    - from: "src/components/Header.astro"
      to: "src/components/ThemeToggle.astro"
      via: "Astro component import"
      pattern: "import ThemeToggle"
    - from: "src/components/ThemeToggle.astro"
      to: "localStorage"
      via: "client-side script setting theme"
      pattern: "localStorage\\.setItem.*theme"
    - from: "src/components/ThemeToggle.astro"
      to: "document.documentElement"
      via: "toggling dark class on html"
      pattern: "classList\\.(add|remove|toggle).*dark"
---

<objective>
Create Header (with responsive nav and theme toggle), Footer, and ThemeToggle components. Wire them into Layout.astro to complete the layout shell. Ensure accessibility fundamentals: skip-to-content link, semantic landmarks, keyboard navigation, ARIA labels.

Purpose: Deliver the complete layout shell that every page will use. After this plan, the site has persistent navigation, working dark/light toggle, and meets accessibility standards.
Output: Three new components, updated Layout.astro, visual verification of complete layout.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-layout-shell-theme-system/02-01-SUMMARY.md
@src/layouts/Layout.astro
@src/styles/global.css
@tailwind.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemeToggle, Header, and Footer components</name>
  <files>
    src/components/ThemeToggle.astro
    src/components/Header.astro
    src/components/Footer.astro
  </files>
  <action>
    **ThemeToggle.astro:**
    Create a button component that toggles dark/light mode:
    - Render a button with `aria-label="Toggle dark mode"` (update dynamically via JS)
    - Display a sun icon (SVG) in dark mode and moon icon (SVG) in light mode
    - Use simple inline SVGs (no icon library needed -- 2 small SVGs):
      - Sun: circle + rays (for dark mode, meaning "switch to light")
      - Moon: crescent path (for light mode, meaning "switch to dark")
    - Style: w-10 h-10, flex items-center justify-center, rounded-lg, hover:bg-[var(--color-surface-alt)], transition-colors, cursor-pointer, border-none, bg-transparent, text-[var(--color-text-primary)]
    - Client-side script (NOT is:inline -- this one can be deferred since layout script already handles initial state):
      ```html
      <script>
        const toggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('theme-icon-sun');
        const moonIcon = document.getElementById('theme-icon-moon');

        function updateIcons() {
          const isDark = document.documentElement.classList.contains('dark');
          sunIcon?.classList.toggle('hidden', !isDark);
          moonIcon?.classList.toggle('hidden', isDark);
          toggle?.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
        }

        toggle?.addEventListener('click', () => {
          document.documentElement.classList.toggle('dark');
          const isDark = document.documentElement.classList.contains('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          updateIcons();
        });

        // Initial icon state
        updateIcons();
      </script>
      ```
    - Both icons should be present in HTML; show/hide with `hidden` class based on current theme
    - Button must be focusable and respond to Enter/Space (native button behavior)

    **Header.astro:**
    Create a responsive header component:
    - Semantic `<header>` element with `role="banner"`
    - Inner container: max-w-6xl mx-auto px-4 sm:px-6 lg:px-8
    - Flex layout: justify-between items-center h-16
    - Left side: Site name/logo link -- `<a href="/" class="font-heading text-xl font-bold text-[var(--color-text-primary)] hover:text-[var(--color-accent)] transition-colors">PG</a>` (initials as logo, will be replaced with proper branding later)
    - Desktop nav (hidden on mobile, shown md+): `<nav aria-label="Main navigation">` containing links:
      - Home (/)
      - Blog (/blog/)
      - Projects (/projects/)
      - About (/about/)
      - Contact (/contact/)
      Each link: `font-medium text-[var(--color-text-secondary)] hover:text-[var(--color-accent)] transition-colors`
      Active link detection: compare `Astro.url.pathname` against each href, add `text-[var(--color-accent)]` class and `aria-current="page"` when active
    - Right side: ThemeToggle component + mobile menu button (visible md:hidden)
    - Mobile menu button: hamburger icon (3 lines SVG), `aria-label="Open menu"`, `aria-expanded="false"`
    - Mobile nav panel: hidden by default, toggles on hamburger click
      - Full-width panel below header with nav links stacked vertically
      - Same links as desktop, styled as py-3 block elements for easy tap targets
      - Close when a link is clicked (navigate away)
      - Update aria-expanded on hamburger when toggling
    - Mobile menu script: Use a small client-side script to toggle visibility
      ```html
      <script>
        const menuBtn = document.getElementById('mobile-menu-btn');
        const mobileNav = document.getElementById('mobile-nav');

        menuBtn?.addEventListener('click', () => {
          const isOpen = mobileNav?.classList.toggle('hidden') === false;
          menuBtn?.setAttribute('aria-expanded', String(isOpen));
          menuBtn?.setAttribute('aria-label', isOpen ? 'Close menu' : 'Open menu');
        });
      </script>
      ```
    - Border bottom: `border-b border-[var(--color-border)]`
    - Background: `bg-[var(--color-surface)]` to ensure header is opaque over content

    **Footer.astro:**
    Create a simple footer:
    - Semantic `<footer>` element with `role="contentinfo"`
    - Inner container: max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8
    - Border top: `border-t border-[var(--color-border)]`
    - Layout: flex flex-col sm:flex-row justify-between items-center gap-4
    - Left: Copyright text -- `<p class="text-sm text-[var(--color-text-secondary)]">&copy; {new Date().getFullYear()} Patryk Golabek. All rights reserved.</p>`
    - Right: Social links (small icon links):
      - GitHub: https://github.com/PatrykQuantumNomad
      - LinkedIn: https://linkedin.com/in/patryk-golabek-65b94617b
      - Blog (Translucent Computing): https://translucentcomputing.com/blog/
      Each link: `text-[var(--color-text-secondary)] hover:text-[var(--color-accent)] transition-colors` with `aria-label="GitHub profile"` (etc.), `target="_blank"`, `rel="noopener noreferrer"`
      Use simple inline SVG icons for GitHub and LinkedIn (standard paths), and a link icon for the blog
  </action>
  <verify>
    All three files exist:
    - src/components/ThemeToggle.astro
    - src/components/Header.astro
    - src/components/Footer.astro

    Each file contains semantic HTML elements (button, header, footer).
    Header contains nav with 5 link items.
    ThemeToggle contains localStorage.setItem and classList.toggle.
    Footer contains copyright and social links.

    Run `npm run build` -- build must succeed (components are valid Astro files even if not yet imported into Layout).
  </verify>
  <done>
    Three components created: ThemeToggle (dark/light toggle with localStorage persistence and ARIA labels), Header (responsive nav with 5 items, mobile hamburger menu, active link detection), Footer (copyright + social links). All use semantic HTML and theme-aware CSS custom properties.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire components into Layout.astro and add accessibility foundations</name>
  <files>
    src/layouts/Layout.astro
    src/pages/index.astro
  </files>
  <action>
    **Update Layout.astro:**

    1. Add imports in frontmatter:
       ```typescript
       import Header from '../components/Header.astro';
       import Footer from '../components/Footer.astro';
       ```

    2. Add skip-to-content link as FIRST element inside body (accessibility best practice):
       ```html
       <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-[var(--color-accent)] focus:text-white focus:rounded-lg focus:outline-none">
         Skip to main content
       </a>
       ```
       This link is visually hidden (sr-only) but becomes visible and positioned when focused via Tab key (THEME-10: keyboard navigation).

    3. Update body structure to full layout shell:
       ```html
       <body class="min-h-screen flex flex-col bg-[var(--color-surface)] text-[var(--color-text-primary)] transition-colors">
         <a href="#main-content" class="...skip link styles...">Skip to main content</a>
         <Header />
         <main id="main-content" class="flex-1">
           <slot />
         </main>
         <Footer />
       </body>
       ```
       - `flex-1` on main pushes footer to bottom even on short pages
       - `id="main-content"` is the skip link target
       - `transition-colors` on body for smooth theme switching

    **Update index.astro:**

    Update the homepage to use the layout shell properly and demonstrate typography:
    ```astro
    ---
    import Layout from '../layouts/Layout.astro';
    ---

    <Layout title="Patryk Golabek — Cloud-Native Software Architect">
      <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <h1 class="text-4xl sm:text-5xl font-heading font-bold mb-4">
          Patryk Golabek
        </h1>
        <p class="text-xl text-[var(--color-text-secondary)] mb-8">
          Cloud-Native Software Architect &middot; 17+ Years
        </p>
        <p class="text-lg max-w-2xl">
          Portfolio coming soon. Built with Astro, deployed on GitHub Pages.
        </p>
        <div class="mt-8 p-4 rounded-lg bg-[var(--color-surface-alt)] border border-[var(--color-border)]">
          <p class="text-sm text-[var(--color-text-secondary)] mb-2">Typography preview:</p>
          <p class="font-heading text-lg">Space Grotesk — Heading font</p>
          <p class="font-sans">Inter — Body text font</p>
          <p class="font-mono text-sm">JetBrains Mono — Code font</p>
        </div>
      </section>
    </Layout>
    ```
    This verifies all three fonts render, theme colors work, and the layout shell (header + content + footer) displays correctly.

    **Accessibility checklist to verify in implementation:**
    - [ ] Skip-to-content link is first focusable element
    - [ ] Header uses `<header>` with `role="banner"`
    - [ ] Nav uses `<nav>` with `aria-label="Main navigation"`
    - [ ] Footer uses `<footer>` with `role="contentinfo"`
    - [ ] Main content area uses `<main>` with `id="main-content"`
    - [ ] Theme toggle button has dynamic `aria-label`
    - [ ] Mobile menu button has `aria-expanded` and `aria-label`
    - [ ] Active nav link has `aria-current="page"`
    - [ ] All external links have descriptive `aria-label`
    - [ ] Tab order flows: skip link -> logo -> nav links -> theme toggle -> main content -> footer links
  </action>
  <verify>
    Run `npm run build` -- build must succeed with no errors.

    Run `npm run dev` and verify:
    1. Header appears at top with nav links and theme toggle
    2. Footer appears at bottom with copyright and social links
    3. Clicking theme toggle switches between dark and light mode
    4. Refresh page -- theme persists (localStorage)
    5. Close and reopen browser tab -- theme still persists
    6. On mobile viewport (< 768px): hamburger menu visible, desktop nav hidden
    7. Click hamburger: mobile nav panel appears with all links
    8. Tab key: skip-to-content link appears, then cycles through header links, toggle, content, footer
    9. All three fonts visible in typography preview section
    10. Contrast: dark text on light bg and light text on dark bg are easily readable
  </verify>
  <done>
    Layout.astro wires Header, main content area, and Footer into a complete layout shell. Skip-to-content link is first focusable element. All semantic landmarks present (header, nav, main, footer). Theme toggle persists preference in localStorage and syncs with OS preference on first visit. Mobile responsive: hamburger menu on small screens. Typography preview confirms all three font families render.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of layout shell and theme system</name>
  <what-built>
    Complete layout shell with:
    - Responsive header with 5 nav items (Home, Blog, Projects, About, Contact)
    - Dark/light mode toggle with localStorage persistence
    - Footer with copyright and social links
    - Space Grotesk headings, Inter body, JetBrains Mono code
    - Skip-to-content accessibility link
    - FOUC-free theme loading
  </what-built>
  <how-to-verify>
    1. Run `npm run dev` and open http://localhost:4321
    2. Verify header shows at top with nav links and theme toggle button
    3. Click the theme toggle -- should switch between dark and light mode smoothly
    4. Refresh the page -- theme should persist (no flash to wrong theme)
    5. Resize browser to mobile width (< 768px) -- hamburger menu should appear
    6. Click hamburger -- nav links appear in vertical panel
    7. Check typography: heading should be Space Grotesk (geometric, no serifs), body should be Inter (clean sans), code preview should be JetBrains Mono (monospaced)
    8. Tab through the page: skip-to-content link should appear first, then navigation items
    9. Footer should appear at bottom with copyright and social links
    10. Open browser DevTools -> delete localStorage 'theme' -> reload with OS in dark mode -> page should load dark
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` exits 0
- Header renders with 5 nav links on all pages
- Theme toggle switches between dark and light, persists in localStorage
- OS preference respected on first visit (no stored preference)
- No FOUC: page never flashes wrong theme
- Three font families render correctly (check via DevTools computed styles)
- Mobile: hamburger menu works, nav links accessible
- Skip-to-content link works via Tab key
- All landmarks present: header[role=banner], nav[aria-label], main, footer[role=contentinfo]
- Color contrast passes WCAG AA (text-primary on surface in both themes)
</verification>

<success_criteria>
1. User can navigate between pages via persistent header with 5 nav items visible on all screen sizes (SITE-02)
2. User can toggle dark/light mode; preference persists across browser sessions (THEME-01)
3. Site loads in OS-preferred color scheme with no FOUC (THEME-02, THEME-03)
4. Three font families render: Space Grotesk headings, Inter body, JetBrains Mono code (THEME-09)
5. Semantic HTML, keyboard navigation, skip link, ARIA labels present (THEME-10)
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-shell-theme-system/02-02-SUMMARY.md`
</output>
