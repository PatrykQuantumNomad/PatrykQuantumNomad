---
phase: 51-graphical-technique-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/eda/PlotVariantSwap.astro
  - src/lib/eda/technique-renderer.ts
autonomous: true
requirements: [GRAPH-01, GRAPH-02, GRAPH-03, GRAPH-04, GRAPH-05, GRAPH-06, GRAPH-07, GRAPH-08, GRAPH-09, GRAPH-10, GRAPH-11, GRAPH-12, GRAPH-13, GRAPH-14, GRAPH-15, GRAPH-16, GRAPH-17, GRAPH-18, GRAPH-19, GRAPH-20, GRAPH-21, GRAPH-22, GRAPH-23, GRAPH-24, GRAPH-25, GRAPH-26, GRAPH-27, GRAPH-28, GRAPH-29, GRAPH-30]

must_haves:
  truths:
    - "PlotVariantSwap.astro renders tab buttons and toggles SVG panels with vanilla JS"
    - "technique-renderer.ts maps all 29 graphical slugs to SVG generator calls"
    - "Tier B variant datasets produce visually distinct patterns for each variant"
    - "11 composition techniques (bihistogram, bootstrap, etc.) produce valid SVGs using existing generators"
  artifacts:
    - path: "src/components/eda/PlotVariantSwap.astro"
      provides: "Tab-switching component for Tier B pages"
      contains: "role=\"tab\""
    - path: "src/lib/eda/technique-renderer.ts"
      provides: "Centralized slug-to-generator mapping and variant rendering"
      exports: ["renderTechniquePlot", "renderVariants"]
  key_links:
    - from: "src/lib/eda/technique-renderer.ts"
      to: "src/lib/eda/svg-generators/index.ts"
      via: "import all 13 generators"
      pattern: "from.*svg-generators"
    - from: "src/lib/eda/technique-renderer.ts"
      to: "src/data/eda/datasets.ts"
      via: "import sample data for renderer calls"
      pattern: "from.*datasets"
    - from: "src/components/eda/PlotVariantSwap.astro"
      to: "vanilla JS script"
      via: "inline <script> with aria-selected tab toggling"
      pattern: "aria-selected"
---

<objective>
Create the PlotVariantSwap component and technique-renderer mapping module -- the two core building blocks that the dynamic route file (Plan 03) will consume.

Purpose: These modules decouple SVG generation logic and interactive tab switching from the route file, keeping [slug].astro clean (~100 lines) while supporting all 29 techniques including 6 Tier B interactive pages and 11 composition-based techniques.

Output: PlotVariantSwap.astro (Tier B tab switching) and technique-renderer.ts (29-entry slug-to-generator map with Tier B variant datasets and composition helpers)
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/51-graphical-technique-pages/51-RESEARCH.md
@src/lib/eda/svg-generators/index.ts
@src/lib/eda/svg-generators/plot-base.ts
@src/lib/eda/svg-generators/composite-plot.ts
@src/data/eda/datasets.ts
@src/lib/eda/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlotVariantSwap.astro tab-switching component</name>
  <files>src/components/eda/PlotVariantSwap.astro</files>
  <action>
Create an Astro component at `src/components/eda/PlotVariantSwap.astro` for Tier B interactive SVG variant switching.

**Props interface:**
```typescript
interface Variant {
  label: string;
  svg: string;
}
interface Props {
  variants: Variant[];
  defaultLabel?: string;
}
```

The `variants` array includes the default variant as the first entry. No separate `defaultSvg` prop -- the first variant is shown by default.

**Template structure:**
- Outer wrapper `<div class="plot-variant-swap mt-8 mb-10">` with a unique `id` (use `pvs-${crypto-or-random}`)
- Tab bar: `<div role="tablist" aria-label="Plot variants">` containing `<button role="tab">` elements
- Panel area: `<div>` containing `<div role="tabpanel" data-panel="variant-{i}">` elements, each with `set:html={v.svg}`
- First tab gets `aria-selected="true"`, all others `aria-selected="false"`
- First panel is visible, all others have `class="hidden"`
- Each tab connects to its panel via `aria-controls` pointing to the panel id
- Each panel has `id` matching its tab's `aria-controls`

**Styling — use CSS attribute selectors, NOT Tailwind classList toggling (JIT purge issue per research):**
```css
.plot-variant-swap [role="tab"] {
  padding: 0.375rem 0.75rem;
  font-size: 0.875rem;
  border-radius: 9999px;
  color: var(--color-text-secondary);
  cursor: pointer;
  border: none;
  background: transparent;
  transition: background-color 0.15s, color 0.15s;
}
.plot-variant-swap [role="tab"]:hover {
  background-color: color-mix(in srgb, var(--color-accent) 10%, transparent);
}
.plot-variant-swap [role="tab"][aria-selected="true"] {
  background-color: color-mix(in srgb, var(--color-accent) 10%, transparent);
  color: var(--color-accent);
}
```

**Script — inline `<script>` tag with vanilla JS (~20-30 lines):**
- Query all `.plot-variant-swap` containers (supports multiple instances on a page)
- For each container, attach click listeners to all `[role="tab"]` buttons
- On click: update `aria-selected` on all tabs, toggle `hidden` class on panels to show only the matching `data-panel`
- Use `data-variant` attribute on tabs to map to `data-panel` on panels
- Must be View Transition safe: use `document.querySelectorAll` on each click, not cached references

**Target size:** ~3KB inline JS (no framework, no hydration). The component must work with zero client-side framework code.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro check 2>&1 | tail -5</automated>
    <manual>Verify PlotVariantSwap.astro exists with role="tab", aria-selected, inline script, and CSS style block</manual>
  </verify>
  <done>PlotVariantSwap.astro exists with Props interface, CSS attribute selectors for tab styling, inline vanilla JS script for tab switching, and proper ARIA attributes (role=tab, role=tabpanel, aria-selected, aria-controls)</done>
</task>

<task type="auto">
  <name>Task 2: Create technique-renderer.ts with 29 slug-to-generator mappings and Tier B variant datasets</name>
  <files>src/lib/eda/technique-renderer.ts</files>
  <action>
Create `src/lib/eda/technique-renderer.ts` that centralizes all SVG generation logic for the 29 graphical techniques.

**Exports:**
```typescript
export function renderTechniquePlot(slug: string): string
export function renderVariants(slug: string): Array<{ label: string; svg: string }>
```

**Import all generators from barrel export:**
```typescript
import {
  generateHistogram, generateBoxPlot, generateScatterPlot,
  generateLinePlot, generateLagPlot, generateProbabilityPlot,
  generateSpectralPlot, generateStarPlot, generateContourPlot,
  generateBarPlot, generate4Plot, generate6Plot, PALETTE,
} from './svg-generators';
```

**Import datasets:**
```typescript
import {
  normalRandom, uniformRandom, scatterData, timeSeries,
  doeFactors, boxPlotData, responseSurface,
} from '../../data/eda/datasets';
```

**Primary renderer map (TECHNIQUE_RENDERERS: Record<string, () => string>):**

18 techniques with direct generator calls (these have dedicated generators):
- `histogram` -> `generateHistogram({ data: normalRandom, showKDE: true, title: 'Histogram', xLabel: 'Value', yLabel: 'Frequency' })`
- `box-plot` -> `generateBoxPlot({ groups: boxPlotData, title: 'Box Plot', yLabel: 'Transmittance' })`
- `scatter-plot` -> `generateScatterPlot({ data: scatterData, showRegression: true, showConfidenceBand: true, title: 'Scatter Plot', xLabel: 'Load (kN)', yLabel: 'Deflection (mm)' })`
- `run-sequence-plot` -> `generateLinePlot({ data: timeSeries, mode: 'run-sequence', title: 'Run Sequence Plot', yLabel: 'Response (mV)' })`
- `lag-plot` -> `generateLagPlot({ data: timeSeries, lag: 1, title: 'Lag 1 Plot' })`
- `autocorrelation-plot` -> `generateLinePlot({ data: timeSeries, mode: 'autocorrelation', title: 'Autocorrelation Plot' })`
- `4-plot` -> `generate4Plot(timeSeries)`
- `6-plot` -> `generate6Plot(timeSeries)`
- `normal-probability-plot` -> `generateProbabilityPlot({ data: normalRandom, type: 'normal', title: 'Normal Probability Plot' })`
- `probability-plot` -> `generateProbabilityPlot({ data: normalRandom, type: 'normal', title: 'Probability Plot' })`
- `qq-plot` -> `generateProbabilityPlot({ data: normalRandom, type: 'qq', title: 'Q-Q Plot' })`
- `spectral-plot` -> `generateSpectralPlot({ data: timeSeries, title: 'Spectral Plot' })`
- `contour-plot` -> `generateContourPlot({ grid: responseSurface, title: 'Contour Plot', xLabel: 'Temperature', yLabel: 'Pressure' })`
- `star-plot` -> `generateStarPlot({ axes: [{label:'Location',value:8},{label:'Scale',value:6},{label:'Skewness',value:3},{label:'Kurtosis',value:5},{label:'Randomness',value:9}], title: 'Star Plot' })`
- `weibull-plot` -> `generateProbabilityPlot({ data: normalRandom.map(v => Math.exp(v)), type: 'weibull', title: 'Weibull Probability Plot' })`
- `ppcc-plot` -> `generateProbabilityPlot({ data: normalRandom, type: 'ppcc', title: 'PPCC Plot' })`
- `mean-plot` -> `generateBarPlot({ categories: [{label:'Temp Low',value:73.3,group:'Temperature'},{label:'Temp High',value:85.9,group:'Temperature'},{label:'Press Low',value:76.5,group:'Pressure'},{label:'Press High',value:82.7,group:'Pressure'}], title: 'Mean Plot', yLabel: 'Mean Response' })`
- `std-deviation-plot` -> `generateBarPlot({ categories: [{label:'Temp Low',value:4.2,group:'Temperature'},{label:'Temp High',value:5.1,group:'Temperature'},{label:'Press Low',value:3.8,group:'Pressure'},{label:'Press High',value:4.5,group:'Pressure'}], title: 'Standard Deviation Plot', yLabel: 'Std Dev' })`

**11 composition-based techniques** (use `stripSvgWrapper` + `<g transform>` pattern from composite-plot.ts):

Import or recreate the `stripSvgWrapper` helper (`svg.replace(/<svg[^>]*>/, '').replace(/<\/svg>$/, '')`), and the `svgOpen` function from plot-base.ts (or construct SVG open tag manually with viewBox).

- `bihistogram` -> Compose two histograms sharing X axis. Top histogram normal orientation, bottom histogram reflected via `<g transform="translate(0,h/2) scale(1,-1)">`. Use normalRandom for group A, uniformRandom for group B. Share a single `<svg viewBox>`.
- `block-plot` -> `generateBarPlot` with block-grouped DOE data. Rearrange doeFactors into block means format.
- `bootstrap-plot` -> Generate 200 bootstrap resampled means from normalRandom (simple loop: sample 100 values with replacement, take mean). Plot resulting distribution with `generateHistogram`.
- `box-cox-linearity` -> Sweep lambda values [-2, -1, -0.5, 0, 0.5, 1, 2], for each compute correlation of Box-Cox transformed Y with X from scatterData. Plot lambda vs. correlation using `generateLinePlot` in time-series mode (or `generateScatterPlot` with the lambda-correlation pairs).
- `box-cox-normality` -> Sweep lambda values, compute PPCC-like normality correlation for Box-Cox transformed normalRandom. Plot lambda vs. normality measure using `generateLinePlot`.
- `complex-demodulation` -> Two-panel layout: amplitude envelope and phase angle over time. Use `generateLinePlot` twice, compose via stripSvgWrapper into a 2-row layout.
- `youden-plot` -> `generateScatterPlot` with lab-to-lab paired measurements. Add horizontal and vertical median reference lines via manual SVG `<line>` elements appended to the scatter SVG (insert before `</svg>`).
- `linear-plots` -> 4-panel composite: correlation plot, intercept plot, slope plot, residual SD plot. Use `generateScatterPlot` and `generateLinePlot` calls composed via stripSvgWrapper like generate4Plot does.
- `doe-plots` -> 3-panel composite: scatter of response vs run, mean plot, SD plot. Use `generateScatterPlot` + `generateBarPlot` composed via stripSvgWrapper.
- `scatterplot-matrix` -> Generate a 4x4 grid of scatter plots for 4 variables derived from normalRandom (e.g., x1=normalRandom, x2=shift, x3=scale, x4=square). Each cell is a small (150x150) scatter plot. Compose via stripSvgWrapper into grid layout. Limit to 4 variables to avoid bloat.
- `conditioning-plot` -> Split scatterData into 3 bins by X value (low/mid/high), plot separate scatter plots for each bin, compose into 3-panel horizontal layout.

**Tier B variant datasets (VARIANT_RENDERERS: Record<string, Array<{label: string; render: () => string}>>):**

- `histogram` (8 variants): Symmetric (normalRandom), Right Skewed (exp transform), Left Skewed (negate + shift), Bimodal (two shifted clusters), Uniform (uniformRandom), Heavy Tailed (cube transform), Peaked (narrow scale), With Outlier (inject outlier at 8.5). Each calls `generateHistogram` with the transformed data.
- `scatter-plot` (12 variants): Strong Positive (scatterData), Strong Negative (negate Y), Weak Positive (add noise), No Correlation (shuffle Y), Quadratic (x^2 relationship), Exponential (exp Y), Heteroscedastic (increasing variance), Clustered (3 groups), With Outliers (inject extreme point), Fan-shaped (wedge pattern), Sinusoidal (sin relationship), Step Function (discrete steps). Each calls `generateScatterPlot`.
- `normal-probability-plot` (4 variants): Normal (normalRandom), Right Skewed (exp), Heavy Tailed (t-like), Bimodal (two clusters). Each calls `generateProbabilityPlot({type:'normal'})`.
- `lag-plot` (4 variants): Random (normalRandom), Autoregressive (AR(1) with phi=0.9), Seasonal (sin + noise), Trend (linear drift). Each calls `generateLagPlot`.
- `autocorrelation-plot` (4 variants): White Noise (normalRandom), AR(1) (phi=0.9), MA(1), Seasonal. Each calls `generateLinePlot({mode:'autocorrelation'})`.
- `spectral-plot` (3 variants): Single Frequency (sin + noise), Multiple Frequencies (sum of sines), White Noise (normalRandom). Each calls `generateSpectralPlot`.

**`renderVariants` function:**
```typescript
export function renderVariants(slug: string): Array<{ label: string; svg: string }> {
  const variants = VARIANT_RENDERERS[slug];
  if (!variants) return [];
  return variants.map(v => ({ label: v.label, svg: v.render() }));
}
```

Note: The first entry in each variant array IS the default variant. The `renderTechniquePlot` call returns the same default plot. The PlotVariantSwap component receives all variants (including default as first entry).

**Code style:** Follow project conventions -- 2-space indent, single quotes, camelCase functions, SCREAMING_SNAKE for const maps, named exports, explicit return types.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro check 2>&1 | tail -10</automated>
    <manual>Verify technique-renderer.ts exports renderTechniquePlot and renderVariants, has 29 entries in TECHNIQUE_RENDERERS, and 6 entries in VARIANT_RENDERERS</manual>
  </verify>
  <done>technique-renderer.ts exists with: (1) renderTechniquePlot mapping all 29 graphical slugs to generator calls, (2) 11 composition-based techniques producing valid SVGs via stripSvgWrapper pattern, (3) renderVariants returning labeled variant arrays for all 6 Tier B techniques with distinct statistical patterns, (4) TypeScript compiles without errors</done>
</task>

</tasks>

<verification>
1. `npx astro check` passes with no type errors in new files
2. PlotVariantSwap.astro contains `role="tab"`, `aria-selected`, CSS `[aria-selected="true"]` selector, and inline `<script>` tag
3. technique-renderer.ts exports `renderTechniquePlot` and `renderVariants` functions
4. `renderTechniquePlot('histogram')` returns a non-empty SVG string
5. `renderVariants('histogram')` returns 8 entries with distinct SVG strings
6. All 29 graphical slugs from techniques.json have entries in TECHNIQUE_RENDERERS
</verification>

<success_criteria>
- PlotVariantSwap.astro is a complete, standalone Astro component with vanilla JS tab switching (~3KB), CSS attribute selectors, and proper ARIA attributes
- technique-renderer.ts maps all 29 graphical slugs to SVG output, with 11 composition techniques using the stripSvgWrapper pattern and 6 Tier B techniques providing variant datasets with visually distinct statistical patterns
- Both files pass TypeScript type checking via `npx astro check`
</success_criteria>

<output>
After completion, create `.planning/phases/51-graphical-technique-pages/51-01-SUMMARY.md`
</output>
