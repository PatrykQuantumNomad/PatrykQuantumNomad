---
phase: 51-graphical-technique-pages
plan: 03
type: execute
wave: 2
depends_on: ["51-01", "51-02"]
files_modified:
  - src/pages/eda/techniques/[slug].astro
  - src/lib/eda/thumbnail.ts
  - src/components/eda/TechniquePage.astro
autonomous: true
requirements: [GRAPH-01, GRAPH-02, GRAPH-03, GRAPH-04, GRAPH-05, GRAPH-06, GRAPH-07, GRAPH-08, GRAPH-09, GRAPH-10, GRAPH-11, GRAPH-12, GRAPH-13, GRAPH-14, GRAPH-15, GRAPH-16, GRAPH-17, GRAPH-18, GRAPH-19, GRAPH-20, GRAPH-21, GRAPH-22, GRAPH-23, GRAPH-24, GRAPH-25, GRAPH-26, GRAPH-27, GRAPH-28, GRAPH-29, GRAPH-30, LAND-05]

must_haves:
  truths:
    - "All 29 graphical technique pages render at /eda/techniques/{slug}/ with SVG plots and prose"
    - "Tier B pages show tab-based SVG variant switching"
    - "Every page displays breadcrumb navigation and links to related techniques"
    - "Related technique links use correct category-aware URLs for cross-category references"
    - "Build-time SVG thumbnails are available for landing page technique cards"
  artifacts:
    - path: "src/pages/eda/techniques/[slug].astro"
      provides: "Dynamic route generating all 29 graphical technique pages"
      contains: "getStaticPaths"
    - path: "src/lib/eda/thumbnail.ts"
      provides: "Build-time SVG thumbnail generation for technique cards"
      exports: ["generateThumbnail"]
    - path: "src/components/eda/TechniquePage.astro"
      provides: "Updated technique page layout with category-aware related links"
      contains: "techniqueUrl"
  key_links:
    - from: "src/pages/eda/techniques/[slug].astro"
      to: "src/lib/eda/technique-renderer.ts"
      via: "import renderTechniquePlot and renderVariants"
      pattern: "from.*technique-renderer"
    - from: "src/pages/eda/techniques/[slug].astro"
      to: "src/lib/eda/technique-content.ts"
      via: "import getTechniqueContent"
      pattern: "from.*technique-content"
    - from: "src/pages/eda/techniques/[slug].astro"
      to: "src/components/eda/PlotVariantSwap.astro"
      via: "conditional import for Tier B pages"
      pattern: "PlotVariantSwap"
    - from: "src/pages/eda/techniques/[slug].astro"
      to: "src/components/eda/TechniquePage.astro"
      via: "layout wrapper with named slots"
      pattern: "TechniquePage"
    - from: "src/pages/eda/techniques/[slug].astro"
      to: "astro:content edaTechniques collection"
      via: "getStaticPaths from collection"
      pattern: "getCollection.*edaTechniques"
    - from: "src/lib/eda/thumbnail.ts"
      to: "src/lib/eda/technique-renderer.ts"
      via: "calls renderTechniquePlot with thumbnail config"
      pattern: "technique-renderer"
---

<objective>
Create the [slug].astro dynamic route file that wires together technique-renderer.ts, technique-content.ts, and PlotVariantSwap.astro to produce all 29 graphical technique pages. Also create thumbnail.ts for landing page SVG thumbnails and fix TechniquePage.astro related technique links to use category-aware URLs.

Purpose: This is the final assembly step that produces the actual 29 pages at /eda/techniques/{slug}/. It follows the established getStaticPaths + collection pattern (like db-compass/[slug].astro) and composes all building blocks from Plans 01 and 02.

Output: 29 live technique pages at build time, plus thumbnail generation utility for Phase 54 landing page
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/51-graphical-technique-pages/51-RESEARCH.md
@.planning/phases/51-graphical-technique-pages/51-01-SUMMARY.md
@.planning/phases/51-graphical-technique-pages/51-02-SUMMARY.md
@src/pages/db-compass/[slug].astro
@src/components/eda/TechniquePage.astro
@src/lib/eda/routes.ts
@src/content.config.ts
@src/lib/eda/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix TechniquePage.astro related links to use category-aware URLs and create [slug].astro dynamic route</name>
  <files>src/components/eda/TechniquePage.astro, src/pages/eda/techniques/[slug].astro</files>
  <action>
**Part A: Fix TechniquePage.astro related technique links**

The current TechniquePage.astro hardcodes related technique links to `/eda/techniques/{slug}/`. This is wrong for cross-category references (e.g., a graphical technique linking to a quantitative technique like "autocorrelation"). Update the component:

1. Add `url` to the relatedTechniques prop type:
```typescript
relatedTechniques?: Array<{ slug: string; name: string; url: string }>;
```

2. Change the related techniques link from:
```astro
<a href={`/eda/techniques/${t.slug}/`}>
```
to:
```astro
<a href={t.url}>
```

This way the route file passes pre-computed URLs using `techniqueUrl()` from routes.ts, which handles graphical vs. quantitative routing correctly.

**Part B: Create src/pages/eda/techniques/[slug].astro**

Create the dynamic route file following the established `getStaticPaths` + collection pattern (reference: `src/pages/db-compass/[slug].astro`).

**Frontmatter script:**

```typescript
import { getCollection } from 'astro:content';
import TechniquePage from '../../../components/eda/TechniquePage.astro';
import PlotVariantSwap from '../../../components/eda/PlotVariantSwap.astro';
import { renderTechniquePlot, renderVariants } from '../../../lib/eda/technique-renderer';
import { getTechniqueContent } from '../../../lib/eda/technique-content';
import { techniqueUrl } from '../../../lib/eda/routes';

export async function getStaticPaths() {
  const allTechniques = await getCollection('edaTechniques');
  const allTechMap = new Map(allTechniques.map(t => [t.data.slug, t.data]));
  const graphical = allTechniques
    .filter(t => t.data.category === 'graphical')
    .map(t => t.data);

  return graphical.map(technique => ({
    params: { slug: technique.slug },
    props: {
      technique,
      relatedTechniques: technique.relatedTechniques
        .filter(slug => allTechMap.has(slug))
        .map(slug => {
          const related = allTechMap.get(slug)!;
          return {
            slug,
            name: related.title,
            url: techniqueUrl(slug, related.category),
          };
        }),
    },
  }));
}

const { technique, relatedTechniques } = Astro.props;
const plotSvg = renderTechniquePlot(technique.slug);
const content = getTechniqueContent(technique.slug);
const isTierB = technique.tier === 'B';
const variants = isTierB ? renderVariants(technique.slug) : [];
```

**Template:**
```astro
<TechniquePage
  title={technique.title}
  description={technique.description}
  category="Graphical Techniques"
  nistSection={technique.nistSection}
  relatedTechniques={relatedTechniques}
>
  <Fragment slot="plot">
    {isTierB ? (
      <PlotVariantSwap variants={variants} />
    ) : (
      <div class="mt-8 mb-10" set:html={plotSvg} />
    )}
  </Fragment>

  {content && (
    <Fragment slot="description">
      <section class="prose-section mt-8 space-y-6">
        <div>
          <h2 class="text-xl font-heading font-bold mb-3">What It Is</h2>
          <p class="text-[var(--color-text-secondary)] leading-relaxed">{content.definition}</p>
        </div>
        <div>
          <h2 class="text-xl font-heading font-bold mb-3">When to Use It</h2>
          <p class="text-[var(--color-text-secondary)] leading-relaxed">{content.purpose}</p>
        </div>
        <div>
          <h2 class="text-xl font-heading font-bold mb-3">How to Interpret</h2>
          <p class="text-[var(--color-text-secondary)] leading-relaxed">{content.interpretation}</p>
        </div>
        <div>
          <h2 class="text-xl font-heading font-bold mb-3">Assumptions and Limitations</h2>
          <p class="text-[var(--color-text-secondary)] leading-relaxed">{content.assumptions}</p>
        </div>
        <p class="text-sm text-[var(--color-text-secondary)] italic mt-4">
          Reference: {content.nistReference}
        </p>
      </section>
    </Fragment>
  )}
</TechniquePage>
```

**Key details:**
- The `allTechMap` includes BOTH graphical AND quantitative techniques so that `relatedTechniques` can cross-reference to quantitative slugs
- `techniqueUrl(slug, related.category)` generates `/eda/techniques/{slug}/` for graphical and `/eda/quantitative/{slug}/` for quantitative
- Tier B pages use `<PlotVariantSwap variants={variants} />` where variants is the full array including default as first entry
- Tier A pages render SVG directly via `set:html={plotSvg}`
- Content sections use consistent heading styles matching the TechniquePage layout
- Route file should be under ~120 lines total -- all heavy logic is in technique-renderer.ts and technique-content.ts
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro build 2>&1 | tail -20</automated>
    <manual>Check that build output shows 29 new pages under /eda/techniques/ and total page count increased by 29</manual>
  </verify>
  <done>All 29 graphical technique pages build successfully at /eda/techniques/{slug}/, with Tier A pages showing static SVG plots and Tier B pages showing PlotVariantSwap with tab-based variant switching. Related technique links use category-aware URLs. Build completes without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Create thumbnail.ts for build-time SVG thumbnails on technique cards</name>
  <files>src/lib/eda/thumbnail.ts</files>
  <action>
Create `src/lib/eda/thumbnail.ts` that generates simplified, smaller SVG thumbnails for technique cards on the landing page grid (LAND-05).

**Approach:** Reuse the existing technique-renderer but with a smaller config. The SVG generators accept optional config overrides for dimensions and margins.

**Export:**
```typescript
export function generateThumbnail(slug: string): string
```

**Implementation:**
1. Import `renderTechniquePlot` from `./technique-renderer` (or directly call generators with thumbnail config)
2. Define `THUMBNAIL_CONFIG` with smaller dimensions:
   - width: 200, height: 140
   - margin: { top: 8, right: 8, bottom: 8, left: 8 }
3. For each slug, call the appropriate generator with the thumbnail config
4. Strip axis labels, titles, and tick marks to keep only the data visualization (the "shape" of the plot)
5. Add `role="img"` and `aria-label="{technique title} thumbnail"` to the SVG for accessibility

**Simplified approach if direct config override is too complex:**
- Call `renderTechniquePlot(slug)` to get the full SVG
- Post-process: replace the `viewBox` dimensions with 200x140, which will cause the SVG to scale down naturally since all generators use viewBox (confirmed by SVG-12 requirement)
- This works because all SVGs use `viewBox` without fixed width/height, so scaling is automatic

**Even simpler approach (recommended):**
- Export `THUMBNAIL_VIEWBOX = '0 0 200 140'` constant
- The `generateThumbnail` function calls `renderTechniquePlot(slug)` and wraps the result: replace the viewBox attribute value with the thumbnail viewBox
- Actually, since all SVGs scale with viewBox, the thumbnail just needs to be RENDERED at a small size on the page via CSS/HTML `width="200" height="140"` -- the SVG content scales automatically
- So the simplest approach: `generateThumbnail(slug)` returns `renderTechniquePlot(slug)` but with `width="200" height="140"` attributes added to the `<svg>` tag, and `aria-label` added for accessibility

Choose the simplest approach that produces clean, small thumbnails. The landing page (Phase 54) will render these in card grids.

**Code style:** 2-space indent, single quotes, named exports.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro check 2>&1 | tail -5</automated>
    <manual>Verify thumbnail.ts exists and exports generateThumbnail function</manual>
  </verify>
  <done>thumbnail.ts exports generateThumbnail(slug) that produces accessibility-annotated SVG thumbnails sized for technique cards, reusing existing SVG generator output with scaled dimensions for the landing page grid (LAND-05)</done>
</task>

</tasks>

<verification>
1. `npx astro build` completes successfully with 29 new pages under /eda/techniques/
2. Total page count increased by 29 from previous build baseline
3. A Tier B page (e.g., /eda/techniques/histogram/) includes PlotVariantSwap with tab buttons
4. A Tier A page (e.g., /eda/techniques/box-plot/) shows inline SVG without tabs
5. Related technique links on each page use correct URLs (graphical -> /eda/techniques/, quantitative -> /eda/quantitative/)
6. Every page has breadcrumb navigation (EDA > Graphical Techniques > [Name])
7. Every page has prose sections (What It Is, When to Use It, How to Interpret, Assumptions)
8. thumbnail.ts exports generateThumbnail and produces SVG strings
</verification>

<success_criteria>
- All 29 graphical technique pages render at their defined URLs with build-time SVG plots, 200+ words of prose, and NIST section citations
- Tier B pages (histogram, scatter, normal-probability, lag, autocorrelation, spectral) display tab-based SVG variant switching via PlotVariantSwap
- Every technique page displays breadcrumb navigation and links to related techniques with category-aware URLs
- Build-time SVG thumbnails are available via thumbnail.ts for the Phase 54 landing page
- Build completes without errors and page count increases by 29
</success_criteria>

<output>
After completion, create `.planning/phases/51-graphical-technique-pages/51-03-SUMMARY.md`
</output>
