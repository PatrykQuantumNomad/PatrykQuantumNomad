---
phase: 25-content-rule-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/tools/dockerfile-analyzer/rules/related.ts
  - src/pages/tools/dockerfile-analyzer/rules/[code].astro
autonomous: true
requirements: [DOCS-01, DOCS-02]

must_haves:
  truths:
    - "Visiting /tools/dockerfile-analyzer/rules/dl3006/ shows a full documentation page for that rule"
    - "Each of the 39 rules has its own page at /tools/dockerfile-analyzer/rules/{id}/"
    - "Every rule page shows explanation, severity, category, before/after code, and related rules"
    - "Rule pages link back to the tool page and to the blog post"
    - "Related rules section shows same-category rules with links"
  artifacts:
    - path: "src/lib/tools/dockerfile-analyzer/rules/related.ts"
      provides: "getRelatedRules utility function"
      exports: ["getRelatedRules"]
    - path: "src/pages/tools/dockerfile-analyzer/rules/[code].astro"
      provides: "Dynamic route template generating 39 rule documentation pages"
      contains: "getStaticPaths"
  key_links:
    - from: "src/pages/tools/dockerfile-analyzer/rules/[code].astro"
      to: "src/lib/tools/dockerfile-analyzer/rules/index.ts"
      via: "import allRules for getStaticPaths"
      pattern: "import.*allRules.*from"
    - from: "src/pages/tools/dockerfile-analyzer/rules/[code].astro"
      to: "src/lib/tools/dockerfile-analyzer/rules/related.ts"
      via: "import getRelatedRules for related rules section"
      pattern: "import.*getRelatedRules.*from"
    - from: "src/pages/tools/dockerfile-analyzer/rules/[code].astro"
      to: "/tools/dockerfile-analyzer/"
      via: "back-link in template"
      pattern: "href=.*/tools/dockerfile-analyzer/"
---

<objective>
Create 39 rule documentation pages via a single Astro dynamic route template, plus a related-rules utility.

Purpose: Each lint rule gets its own SEO-valuable documentation page at /tools/dockerfile-analyzer/rules/{code}/ with explanation, fix suggestions, before/after code examples, severity/category metadata, related rules, and back-links. These 39 pages are the SEO backbone of the Dockerfile Analyzer feature.

Output: 39 static HTML pages generated at build time from the existing TypeScript rule registry.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-content-rule-documentation/25-RESEARCH.md
@src/lib/tools/dockerfile-analyzer/types.ts
@src/lib/tools/dockerfile-analyzer/rules/index.ts
@src/lib/tools/dockerfile-analyzer/rules/security/DL3006-tag-version.ts
@src/pages/tools/dockerfile-analyzer/index.astro
@src/components/BreadcrumbJsonLd.astro
@src/layouts/Layout.astro
@src/content.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create related-rules utility and rule documentation dynamic route</name>
  <files>
    src/lib/tools/dockerfile-analyzer/rules/related.ts
    src/pages/tools/dockerfile-analyzer/rules/[code].astro
  </files>
  <action>
**Step 1: Create `src/lib/tools/dockerfile-analyzer/rules/related.ts`**

Export a `getRelatedRules(ruleId: string, limit?: number): LintRule[]` function that:
- Imports `allRules` from `./index` and `LintRule` type from `../types`
- Finds the rule by ID, returns empty array if not found
- Filters `allRules` for same category, excluding self
- Sorts by severity priority (error first, then warning, then info) using a `SEVERITY_ORDER` record
- Slices to `limit` (default 5)

**Step 2: Create `src/pages/tools/dockerfile-analyzer/rules/[code].astro`**

This single file generates 39 static pages. Structure:

**Frontmatter:**
- Import `allRules` from rules index, `getRelatedRules` from related.ts
- Import `Layout` from layouts, `BreadcrumbJsonLd` from components
- Import `Code` from `'astro:components'` for syntax-highlighted before/after code blocks
- Import `LintRule` type from types

- `getStaticPaths()` maps over `allRules`, returns `{ params: { code: rule.id.toLowerCase() }, props: { rule } }`
- Extract `rule` from `Astro.props`, compute `relatedRules = getRelatedRules(rule.id)`
- Define label maps: `severityLabel` (error/warning/info -> Error/Warning/Info), `categoryLabel` (security -> Security, etc.), `severityColor` (error -> red, warning -> amber, info -> blue)
- Compute `pageTitle = "${rule.id}: ${rule.title} -- Dockerfile Analyzer"`, `pageDesc` from truncated explanation (first 155 chars + "..."), `pageUrl`

**Template (inside `<Layout>`):**

Use `max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-16` container matching blog post pattern.

1. **Visual breadcrumb nav** (matching Phase 21 pattern): Home > Tools > Dockerfile Analyzer > Rules > {rule.id}. Use `nav` with `aria-label="Breadcrumb"`, links separated by `/` or chevron, last item has `aria-current="page"`.

2. **Header section:** h1 with rule ID and title (e.g., "DL3006: Always tag the version of an image explicitly"). Below: severity badge pill and category badge pill using `class:list` pattern from research (bg-red-100/text-red-700 for error, bg-amber-100/text-amber-700 for warning, bg-blue-100/text-blue-700 for info). Category badge uses accent color.

3. **Explanation section:** h2 "Why This Matters", followed by the `rule.explanation` text in a `prose` paragraph. This is the main SEO content. Wrap in a `<div class="prose max-w-none">` for typography.

4. **How to Fix section:** h2 "How to Fix", followed by `rule.fix.description` paragraph. Then before/after code blocks using Astro's built-in `<Code code={rule.fix.beforeCode} lang="dockerfile" />` and `<Code code={rule.fix.afterCode} lang="dockerfile" />`. Label them with h3 "Before (incorrect)" and h3 "After (correct)". Use a responsive grid: `grid grid-cols-1 sm:grid-cols-2 gap-4` for side-by-side on desktop.

5. **Rule Details section:** h2 "Rule Details" with a definition list (`dl`) showing: Rule Code (rule.id), Severity (severityLabel), Category (categoryLabel), each in `dt`/`dd` pairs.

6. **Related Rules section:** Only render if `relatedRules.length > 0`. h2 "Related Rules". Render as a list of links: each shows rule ID, title, and severity badge. Link to `/tools/dockerfile-analyzer/rules/{relatedRule.id.toLowerCase()}/`. Use the card-like link styling from the blog related posts pattern: `block p-4 rounded-lg border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-colors`.

7. **Back-links footer:** A section with two links:
   - "Try the Dockerfile Analyzer" linking to `/tools/dockerfile-analyzer/`
   - "Read the best practices guide" linking to `/blog/dockerfile-best-practices/`
   Use accent color for links.

8. **BreadcrumbJsonLd** component at bottom with crumbs: Home, Tools, Dockerfile Analyzer, {rule.id}.

**SEO considerations:**
- Pass `title={pageTitle}` and `description={pageDesc}` to Layout
- All internal links use trailing slashes
- Use lowercase rule IDs in all URLs
- Minimum 300+ words of visible content per page (explanation + fix description + related rules descriptions ensure this)
  </action>
  <verify>
Run `npx astro build 2>&1 | tail -20` and confirm:
- Build succeeds with no errors
- Output includes 39 rule pages at /tools/dockerfile-analyzer/rules/

Also verify a sample page has content: `cat dist/tools/dockerfile-analyzer/rules/dl3006/index.html | head -50` shows rule title, explanation, and code blocks.
  </verify>
  <done>
39 rule documentation pages build successfully. Each page contains: rule explanation, severity/category badges, before/after code blocks with Dockerfile syntax highlighting, related rules with links, back-links to tool page and blog post, breadcrumb JSON-LD, and visual breadcrumb navigation. URLs are lowercase (e.g., /tools/dockerfile-analyzer/rules/dl3006/).
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` succeeds without errors
2. `ls dist/tools/dockerfile-analyzer/rules/ | wc -l` shows 39 directories
3. A sample rule page (dl3006) contains: h1 with rule title, severity badge, category badge, explanation paragraph, before/after code blocks, related rules links, back-links
4. Related rules on dl3006 page link to other security rules (dl3007, dl3008, etc.)
5. All rule page URLs are lowercase
</verification>

<success_criteria>
- 39 rule documentation pages generated at /tools/dockerfile-analyzer/rules/{code}/
- Each page has 300+ words of SEO-relevant content
- Related rules section shows same-category rules with working links
- Back-links to tool page and blog post present on every rule page
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-content-rule-documentation/25-01-SUMMARY.md`
</output>
