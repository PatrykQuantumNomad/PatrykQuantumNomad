---
phase: 32-og-images-site-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/og-image.ts
  - src/pages/open-graph/tools/db-compass.png.ts
  - src/pages/open-graph/tools/db-compass/[slug].png.ts
  - src/pages/tools/db-compass/index.astro
  - src/pages/tools/db-compass/[slug].astro
  - src/pages/index.astro
  - src/pages/tools/index.astro
autonomous: true
requirements: [SEO-04, SEO-05, SEO-07, INTEG-01, INTEG-02]

must_haves:
  truths:
    - "Sharing the overview page URL on social media shows a custom OG image with a spectrum miniature"
    - "Sharing any detail page URL on social media shows a custom OG image with that model's radar chart"
    - "All Database Compass URLs appear in the sitemap after build"
    - "The homepage has a Database Compass callout card linking to /tools/db-compass/"
    - "The tools listing page shows a Database Compass card instead of 'Coming Soon' placeholder"
  artifacts:
    - path: "src/lib/og-image.ts"
      provides: "generateCompassOverviewOgImage and generateCompassModelOgImage functions"
      contains: "generateCompassOverviewOgImage"
    - path: "src/pages/open-graph/tools/db-compass.png.ts"
      provides: "Overview OG image API route"
      exports: ["GET"]
    - path: "src/pages/open-graph/tools/db-compass/[slug].png.ts"
      provides: "Per-model OG image API routes (12 via getStaticPaths)"
      exports: ["getStaticPaths", "GET"]
    - path: "src/pages/tools/db-compass/index.astro"
      provides: "Overview page with ogImage prop wired"
      contains: "ogImage"
    - path: "src/pages/tools/db-compass/[slug].astro"
      provides: "Detail pages with ogImage prop wired"
      contains: "ogImage"
    - path: "src/pages/index.astro"
      provides: "Homepage with Database Compass callout card"
      contains: "Database Compass"
    - path: "src/pages/tools/index.astro"
      provides: "Tools page with Database Compass card replacing placeholder"
      contains: "db-compass"
  key_links:
    - from: "src/pages/open-graph/tools/db-compass.png.ts"
      to: "src/lib/og-image.ts"
      via: "import generateCompassOverviewOgImage"
      pattern: "generateCompassOverviewOgImage"
    - from: "src/pages/open-graph/tools/db-compass/[slug].png.ts"
      to: "src/lib/og-image.ts"
      via: "import generateCompassModelOgImage"
      pattern: "generateCompassModelOgImage"
    - from: "src/pages/tools/db-compass/index.astro"
      to: "src/pages/open-graph/tools/db-compass.png"
      via: "ogImage prop URL"
      pattern: "open-graph/tools/db-compass\\.png"
    - from: "src/pages/tools/db-compass/[slug].astro"
      to: "src/pages/open-graph/tools/db-compass/[slug].png"
      via: "ogImage prop URL"
      pattern: "open-graph/tools/db-compass/"
    - from: "src/pages/index.astro"
      to: "/tools/db-compass/"
      via: "anchor href"
      pattern: "href=\"/tools/db-compass/\""
    - from: "src/pages/tools/index.astro"
      to: "/tools/db-compass/"
      via: "anchor href replacing Coming Soon"
      pattern: "href=\"/tools/db-compass/\""
---

<objective>
Build-time OG images for the Database Compass overview and all 12 detail pages, wire ogImage props on both page types, add homepage callout card, and replace the tools listing page "Coming Soon" placeholder with a real Database Compass card.

Purpose: Social sharing shows branded, content-rich OG images instead of generic fallback. Homepage and tools page surface the Database Compass feature for discoverability.
Output: 13 OG PNG images at build time, ogImage meta tags on all DB Compass pages, homepage callout card, tools page card.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-og-images-site-integration/32-RESEARCH.md
@.planning/phases/18-og-images-shareability/18-01-SUMMARY.md
@src/lib/og-image.ts
@src/lib/db-compass/spectrum-math.ts
@src/lib/db-compass/dimensions.ts
@src/lib/db-compass/schema.ts
@src/lib/beauty-index/radar-math.ts
@src/pages/open-graph/beauty-index/[slug].png.ts
@src/pages/open-graph/beauty-index.png.ts
@src/pages/tools/db-compass/index.astro
@src/pages/tools/db-compass/[slug].astro
@src/pages/index.astro
@src/pages/tools/index.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Database Compass OG image generators to og-image.ts</name>
  <files>src/lib/og-image.ts</files>
  <action>
Add two new exported functions and one private helper to `src/lib/og-image.ts`:

1. **Private helper `generateSpectrumMiniatureSvg()`**: Builds a simplified spectrum SVG string for OG image embedding. Parameters: `width: number, height: number, models: { id: string; name: string; slug: string; complexityPosition: number }[]`. Uses `computeSpectrumPositions()` from `./db-compass/spectrum-math` and `MODEL_SHORT_LABELS` from the same file. Renders a horizontal axis line, 12 positioned dots at `#c44b20`, and abbreviated text labels. Use compact 600x100 viewport. See RESEARCH.md "Spectrum Miniature SVG Generator" code example for exact implementation.

2. **`generateCompassOverviewOgImage()`**: Accepts `models: { id: string; name: string; slug: string; complexityPosition: number }[]`. Two-column 1200x630 layout on `#faf8f5` background: left column has "Database Compass" title (Space Grotesk 52px), "Compare 12 database models across 8 dimensions" subtitle, and 8 dimension name pills (Scalability, Performance, Reliability, Ops Complexity, Query Flexibility, Schema Flexibility, Ecosystem, Learning Curve) in `#c44b20` with `rgba(196,75,32,0.1)` background. Right column has the spectrum miniature SVG embedded as base64 data URI `<img>`. Bottom-left branding via `brandingRow()`. Left accent bar via `accentBar()`. Follow `generateOverviewOgImage()` pattern exactly.

3. **`generateCompassModelOgImage()`**: Accepts a `DbModel` type. Two-column 1200x630 layout: left column has "Database Compass" label (18px, `#c44b20`), model name title (Space Grotesk 52px), score row (`totalScore(model)/80` + CAP classification pill), and truncated characterSketch (120 chars). Right column has 8-axis radar chart embedded as base64 data URI via `generateRadarSvgString(300, scores, '#c44b20', 0.35, labels, labelColors)` from `./beauty-index/radar-math`. Use `DIMENSIONS` from `./db-compass/dimensions` for labels (`d.symbol + ' ' + d.shortName`) and `DIMENSION_COLORS` for label colors. Use `dimensionScores()` and `totalScore()` from `./db-compass/schema`. Bottom-left branding. Left accent bar. Follow `generateLanguageOgImage()` pattern exactly.

Add imports at the top:
- `import { computeSpectrumPositions, MODEL_SHORT_LABELS } from './db-compass/spectrum-math';`
- `import { DIMENSIONS as COMPASS_DIMENSIONS, DIMENSION_COLORS as COMPASS_DIMENSION_COLORS } from './db-compass/dimensions';`
- `import { dimensionScores as compassDimensionScores, totalScore as compassTotalScore, type DbModel } from './db-compass/schema';`

Use aliased imports to avoid conflicts with existing Beauty Index imports of DIMENSIONS and dimensionScores.
  </action>
  <verify>Run `npx astro build` -- build succeeds with no TypeScript errors in og-image.ts. The new functions will be exercised in Task 2 when API routes call them.</verify>
  <done>og-image.ts exports generateCompassOverviewOgImage and generateCompassModelOgImage; both produce 1200x630 PNG buffers when called with appropriate data.</done>
</task>

<task type="auto">
  <name>Task 2: Create OG image API routes and wire ogImage props on DB Compass pages</name>
  <files>
    src/pages/open-graph/tools/db-compass.png.ts
    src/pages/open-graph/tools/db-compass/[slug].png.ts
    src/pages/tools/db-compass/index.astro
    src/pages/tools/db-compass/[slug].astro
  </files>
  <action>
1. **Create `src/pages/open-graph/tools/db-compass.png.ts`** (overview OG image route):
   - Import `getCollection` from `astro:content` and `generateCompassOverviewOgImage` from og-image.ts
   - Export `GET` APIRoute that fetches all dbModels, maps to `{ id: entry.data.id, name: entry.data.name, slug: entry.data.slug, complexityPosition: entry.data.complexityPosition }`, calls `generateCompassOverviewOgImage(models)`, returns `Response(png, { headers: { 'Content-Type': 'image/png', 'Cache-Control': 'public, max-age=31536000, immutable' } })`
   - No getStaticPaths needed (single static route)

2. **Create `src/pages/open-graph/tools/db-compass/[slug].png.ts`** (per-model OG routes):
   - Import `getCollection` from `astro:content`, `generateCompassModelOgImage` from og-image.ts
   - Export `getStaticPaths` returning all dbModels mapped to `{ params: { slug: entry.data.slug }, props: { model: entry.data } }`
   - Export `GET` APIRoute that calls `generateCompassModelOgImage(props.model)`, returns Response with image/png headers
   - Follow `src/pages/open-graph/beauty-index/[slug].png.ts` pattern exactly

3. **Wire `ogImage` on overview page** (`src/pages/tools/db-compass/index.astro`):
   - Add in frontmatter: `const ogImageURL = new URL('/open-graph/tools/db-compass.png', Astro.site).toString();`
   - Pass `ogImage={ogImageURL}` and `ogImageAlt="Database Compass -- Compare 12 database models across 8 dimensions"` to Layout

4. **Wire `ogImage` on detail pages** (`src/pages/tools/db-compass/[slug].astro`):
   - Add in frontmatter: `const ogImageURL = new URL(\`/open-graph/tools/db-compass/${model.slug}.png\`, Astro.site).toString();`
   - Pass `ogImage={ogImageURL}` and `ogImageAlt={\`${model.name} -- Database Compass radar chart\`}` to Layout
  </action>
  <verify>
Run `npx astro build`. Verify:
1. Build succeeds with no errors
2. `dist/open-graph/tools/db-compass.png` exists (overview OG image)
3. `ls dist/open-graph/tools/db-compass/ | wc -l` shows 12 per-model PNG files
4. `grep -l 'og:image.*db-compass' dist/tools/db-compass/index.html` finds the overview meta tag
5. `grep -l 'og:image.*db-compass' dist/tools/db-compass/relational/index.html` finds a detail meta tag
6. Sitemap: `grep 'db-compass' dist/sitemap-0.xml | wc -l` shows 13+ URLs (overview + 12 detail pages)
  </verify>
  <done>13 OG PNG images generated at build time; og:image meta tags present on overview and all 12 detail pages; all DB Compass URLs appear in sitemap.</done>
</task>

<task type="auto">
  <name>Task 3: Add homepage callout card and replace tools page Coming Soon placeholder</name>
  <files>
    src/pages/index.astro
    src/pages/tools/index.astro
  </files>
  <action>
1. **Homepage callout** (`src/pages/index.astro`):
   Add a Database Compass callout section immediately after the Dockerfile Analyzer callout (after line 182, before the gradient-divider). Follow the exact pattern of the existing callout cards:
   ```
   {/* Database Compass Callout */}
   <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mb-8 pt-2" data-reveal>
     <a href="/tools/db-compass/" class="block card-hover p-6 rounded-lg border border-[var(--color-border)] no-underline" data-tilt>
       <article>
         <h3 class="text-lg font-heading font-bold text-[var(--color-text-primary)]">Database Compass</h3>
         <p class="meta-mono mt-2">2026 Edition</p>
         <p class="text-sm text-[var(--color-text-secondary)] mt-2">
           Compare 12 database models across 8 dimensions. From key-value simplicity to multi-model complexity -- find the right database for your use case.
         </p>
       </article>
     </a>
   </section>
   ```
   Use `mb-8 pt-2` (no `mt-8`) to match Dockerfile Analyzer callout spacing (per Phase 26 decision).

2. **Tools listing page** (`src/pages/tools/index.astro`):
   Replace the entire "Coming Soon" placeholder `<div>` (lines 48-64, the dashed-border div with opacity-50) with a Database Compass link card:
   ```
   <a
     href="/tools/db-compass/"
     class="block card-hover p-6 rounded-lg border border-[var(--color-border)] no-underline group"
     data-reveal
     data-tilt
   >
     <div class="mb-4 text-[var(--color-accent)]">
       <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
         <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
       </svg>
     </div>
     <h2 class="text-lg font-heading font-bold text-[var(--color-text-primary)] group-hover:text-[var(--color-accent)] transition-colors">
       Database Compass
     </h2>
     <p class="meta-mono mt-1">2026 Edition</p>
     <p class="text-sm text-[var(--color-text-secondary)] mt-3">
       Compare 12 database models across 8 dimensions -- scalability, performance, reliability, query flexibility,
       and more. Radar charts, scoring tables, and interactive filtering.
     </p>
     <ul class="mt-4 flex flex-wrap gap-2">
       <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">12 models</li>
       <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">8 dimensions</li>
       <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">Radar charts</li>
       <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">Interactive filter</li>
     </ul>
   </a>
   ```
   Match the Dockerfile Analyzer card structure exactly (icon, title with group-hover, meta-mono subtitle, description, pill tags).
  </action>
  <verify>
Run `npx astro build`. Verify:
1. `grep 'Database Compass' dist/index.html` finds the homepage callout
2. `grep 'db-compass' dist/tools/index.html` finds the tools page card
3. No "Coming Soon" text remains in `dist/tools/index.html`
  </verify>
  <done>Homepage shows Database Compass callout between Dockerfile Analyzer callout and Latest Writing. Tools listing page shows Database Compass card alongside Dockerfile Analyzer card with no "Coming Soon" placeholder.</done>
</task>

</tasks>

<verification>
1. `npx astro build` succeeds with zero errors
2. 13 OG PNG files exist under `dist/open-graph/tools/db-compass/`
3. `og:image` meta tags present in overview and all 12 detail page HTML
4. All DB Compass URLs in sitemap (`grep 'db-compass' dist/sitemap-0.xml`)
5. Homepage has Database Compass callout (`grep 'Database Compass' dist/index.html`)
6. Tools page has DB Compass card, no "Coming Soon" (`grep -c 'Coming Soon' dist/tools/index.html` returns 0)
</verification>

<success_criteria>
- 13 build-time OG PNG images generated (1 overview + 12 detail)
- og:image meta tags wired on all 13 DB Compass pages
- All DB Compass pages appear in sitemap automatically
- Homepage callout card links to /tools/db-compass/
- Tools page card replaces "Coming Soon" placeholder
- Build completes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-og-images-site-integration/32-01-SUMMARY.md`
</output>
