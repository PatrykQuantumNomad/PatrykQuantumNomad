# Phase 32: OG Images & Site Integration - Research

**Researched:** 2026-02-22
**Domain:** Satori OG image generation, Astro sitemap integration, blog content creation, site cross-linking
**Confidence:** HIGH

## Summary

Phase 32 is the final phase of the Database Compass milestone (v1.5). It requires five distinct deliverables: (1) build-time OG images for the overview page and all 12 detail pages using the existing Satori + Sharp pipeline, (2) sitemap inclusion for all new URLs, (3) a homepage callout card, (4) replacing the tools listing page "Coming Soon" placeholder with a real Database Compass card, and (5) a companion blog post "How to Choose a Database in 2026" with bidirectional cross-links.

The project has a battle-tested OG image pipeline in `src/lib/og-image.ts` that uses Satori (HTML/CSS object trees to SVG) + Sharp (SVG to PNG). The Beauty Index OG images (Phase 18) established every pattern needed: overview images with a visual element, per-item detail images with embedded radar chart SVGs, the `renderOgPng()` helper, `accentBar()`, `brandingRow()`, and the `getStaticPaths` + API route pattern at `src/pages/open-graph/`. The Database Compass adapts this directly -- `radar-math.ts::generateRadarSvgString()` is already pure TypeScript with zero imports (designed for Satori dual-use), and `spectrum-math.ts::computeSpectrumPositions()` was similarly designed with zero imports for the overview OG spectrum miniature.

The sitemap is handled automatically by `@astrojs/sitemap` -- all static pages generated by Astro are included without configuration. The 12 detail pages, overview page, and blog post will appear in the sitemap simply by existing as built pages. No configuration changes to `astro.config.mjs` are needed.

The homepage already has a pattern of callout cards (Beauty Index and Dockerfile Analyzer) that the Database Compass card will follow. The tools listing page (`src/pages/tools/index.astro`) has an explicit "Coming Soon" placeholder `<div>` that gets replaced with a real link card matching the Dockerfile Analyzer card pattern. The overview page already links to `/blog/database-compass/` which does not yet exist -- the companion blog post will fill this link.

**Primary recommendation:** Follow the Beauty Index OG image pattern exactly -- add `generateCompassOverviewOgImage()` and `generateCompassModelOgImage()` to `src/lib/og-image.ts`, create API routes at `src/pages/open-graph/tools/db-compass.png.ts` and `src/pages/open-graph/tools/db-compass/[slug].png.ts`, wire `ogImage` props into the Layout on overview and detail pages, add the homepage/tools-page cards, and create the blog post as an MDX file at `src/data/blog/database-compass.mdx`.

<phase_requirements>
## Phase Requirements

| ID | Description | Research Support |
|----|-------------|-----------------|
| SEO-04 | Build-time OG image for overview page (spectrum miniature) | Existing Satori+Sharp pipeline in `og-image.ts`; `spectrum-math.ts` zero-import design enables Satori dual-use; `computeSpectrumPositions()` provides positions |
| SEO-05 | Build-time OG images for each of 12 detail pages (radar chart) | `radar-math.ts::generateRadarSvgString()` already proven for Satori embedding (Beauty Index Phase 18); `dimensionScores()` and `DIMENSION_COLORS` available |
| SEO-07 | All pages included in sitemap | `@astrojs/sitemap` auto-includes all static pages; no config changes needed; verified by examining existing sitemap output |
| INTEG-01 | Homepage callout card linking to /tools/db-compass/ | Existing Beauty Index and Dockerfile Analyzer callout cards on `index.astro` provide exact pattern to follow |
| INTEG-02 | Tools listing page card replacing "Coming Soon" placeholder | `src/pages/tools/index.astro` has explicit placeholder `<div>` at line 48-64; replace with `<a>` card matching Dockerfile Analyzer pattern |
| INTEG-03 | Companion blog post -- "How to Choose a Database in 2026" with bidirectional cross-links | Blog content collection uses glob loader for `src/data/blog/*.mdx`; existing blog posts provide frontmatter and MDX component patterns |
| INTEG-04 | Blog post cross-links to overview and selected detail pages | Overview page already links to `/blog/database-compass/` (line 51); blog post links back to overview and key detail pages |
</phase_requirements>

## Standard Stack

### Core (Already Installed -- Zero New Dependencies)
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| Satori | 0.19.2 | HTML/CSS object trees to SVG for OG images | Already proven in `og-image.ts`; generates Beauty Index + blog + Dockerfile Analyzer OG images |
| Sharp | 0.34.5 | SVG to PNG rasterization | Already proven, pipeline established |
| Astro | ^5.3.0 | API routes, `getStaticPaths`, static page generation | Framework for the entire site |
| @astrojs/sitemap | (installed) | Automatic sitemap generation from all static pages | Already configured in `astro.config.mjs` |
| @astrojs/mdx | (installed) | MDX blog posts with component imports | Already used for all original blog posts |

### Project Libraries (Zero External Imports)
| Library | Purpose | Where Used |
|---------|---------|------------|
| `src/lib/og-image.ts` | `renderOgPng()`, `accentBar()`, `brandingRow()`, font loading | All OG image generation |
| `src/lib/beauty-index/radar-math.ts` | `generateRadarSvgString()` for 8-axis octagonal chart | Detail page OG images (embeds SVG as base64 data URI in Satori layout) |
| `src/lib/db-compass/spectrum-math.ts` | `computeSpectrumPositions()`, `detectClusters()` | Overview OG image (renders miniature spectrum) |
| `src/lib/db-compass/dimensions.ts` | `DIMENSIONS`, `DIMENSION_COLORS` | Radar chart labels and colors for OG images |
| `src/lib/db-compass/schema.ts` | `DbModel`, `dimensionScores()`, `totalScore()` | OG image data access |

### Fonts Available for Satori
| Font | Weight | File | Usage |
|------|--------|------|-------|
| Inter | 400 | `src/assets/fonts/Inter-Regular.woff` | Body text in OG images |
| Space Grotesk | 700 | `src/assets/fonts/SpaceGrotesk-Bold.woff` | Headings in OG images |

**NOTE:** The site uses DM Sans + Noto Sans for on-page rendering (Google Fonts), but OG images use Inter + Space Grotesk (local woff files loaded by Satori). This is an established pattern -- the OG images have a slightly different font stack than the site, and that is intentional.

**Installation:**
```bash
# No new packages needed. All tools are already installed.
# Prior decision [v1.5]: Zero new npm dependencies.
```

## Architecture Patterns

### Recommended Project Structure
```
src/
  lib/
    og-image.ts                          # [MODIFY] Add DB Compass OG generators
    db-compass/
      spectrum-math.ts                  # [EXISTS] computeSpectrumPositions() for OG
      dimensions.ts                     # [EXISTS] DIMENSIONS, DIMENSION_COLORS
      schema.ts                         # [EXISTS] DbModel, dimensionScores(), totalScore()
    beauty-index/
      radar-math.ts                     # [EXISTS] generateRadarSvgString() for OG
  pages/
    open-graph/
      tools/
        db-compass.png.ts              # [NEW] Overview OG image API route
        db-compass/
          [slug].png.ts                # [NEW] Per-model OG images (12 pages)
    tools/
      db-compass/
        index.astro                    # [MODIFY] Add ogImage prop to Layout
        [slug].astro                   # [MODIFY] Add ogImage prop to Layout
      index.astro                      # [MODIFY] Replace "Coming Soon" with DB Compass card
    index.astro                        # [MODIFY] Add Database Compass callout card
  data/
    blog/
      database-compass.mdx             # [NEW] Companion blog post
```

### Pattern 1: OG Image API Route (getStaticPaths + GET)
**What:** Each OG image is an Astro API route that uses `getStaticPaths` for dynamic routes and a `GET` handler returning a PNG buffer.
**When to use:** For every build-time OG image.
**Example:**
```typescript
// Source: src/pages/open-graph/beauty-index/[slug].png.ts (existing pattern)
import type { APIRoute, GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import { generateCompassModelOgImage } from '../../../../lib/og-image';

export const getStaticPaths: GetStaticPaths = async () => {
  const dbModels = await getCollection('dbModels');
  return dbModels.map((entry) => ({
    params: { slug: entry.data.slug },
    props: { model: entry.data },
  }));
};

export const GET: APIRoute = async ({ props }) => {
  const { model } = props as { model: Parameters<typeof generateCompassModelOgImage>[0] };
  const png = await generateCompassModelOgImage(model);
  return new Response(png, {
    headers: {
      'Content-Type': 'image/png',
      'Cache-Control': 'public, max-age=31536000, immutable',
    },
  });
};
```

### Pattern 2: Radar Chart SVG Embedding in Satori
**What:** Generate a standalone SVG string using `generateRadarSvgString()`, convert to base64 data URI, and embed as an `<img>` in the Satori object tree.
**When to use:** For detail page OG images that need a radar chart visualization.
**Example:**
```typescript
// Source: src/lib/og-image.ts generateLanguageOgImage() (existing pattern)
import { generateRadarSvgString } from './beauty-index/radar-math';
import { DIMENSIONS, DIMENSION_COLORS } from '../db-compass/dimensions';
import { dimensionScores, type DbModel } from '../db-compass/schema';

const scores = dimensionScores(model);
const labels = DIMENSIONS.map((d) => d.symbol + ' ' + d.shortName);
const labelColors = DIMENSIONS.map((d) => DIMENSION_COLORS[d.key] ?? '#666');
const accentColor = '#c44b20';
const radarSvg = generateRadarSvgString(300, scores, accentColor, 0.35, labels, labelColors);
const radarDataUri = `data:image/svg+xml;base64,${Buffer.from(radarSvg).toString('base64')}`;

// Then embed in Satori layout:
{ type: 'img', props: { src: radarDataUri, width: 360, height: 360 } }
```

### Pattern 3: Spectrum Miniature SVG for Overview OG
**What:** Generate a simplified complexity spectrum SVG string using `computeSpectrumPositions()` for the overview OG image. This renders a horizontal axis with dots positioned along it.
**When to use:** For the overview page OG image (SEO-04).
**Approach:** Build the SVG string manually (like `generateRadarSvgString()` does) using `computeSpectrumPositions()` output, then embed as base64 data URI in the Satori layout. The SVG includes: horizontal axis line, 12 positioned dots at `#c44b20`, and abbreviated labels. Use a compact 600x120 viewport for the miniature.

### Pattern 4: ogImage Prop Wiring
**What:** Each page constructs the OG image URL and passes it to the Layout component via the `ogImage` prop.
**When to use:** On every page that has a custom OG image.
**Example:**
```typescript
// Source: src/pages/beauty-index/index.astro (existing pattern)
const ogImageURL = new URL('/open-graph/tools/db-compass.png', Astro.site).toString();

<Layout
  title="..."
  description="..."
  ogImage={ogImageURL}
  ogImageAlt="Database Compass -- Compare 12 database models across 8 dimensions"
>
```

### Pattern 5: Homepage Callout Card
**What:** A linked card section on the homepage, following the existing Beauty Index and Dockerfile Analyzer callout pattern.
**When to use:** INTEG-01.
**Example:**
```html
<!-- Source: src/pages/index.astro existing pattern (Beauty Index callout at line 159-169) -->
<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mb-8 pt-2" data-reveal>
  <a href="/tools/db-compass/" class="block card-hover p-6 rounded-lg border border-[var(--color-border)] no-underline" data-tilt>
    <article>
      <h3 class="text-lg font-heading font-bold text-[var(--color-text-primary)]">Database Compass</h3>
      <p class="meta-mono mt-2">2026 Edition</p>
      <p class="text-sm text-[var(--color-text-secondary)] mt-2">
        Compare 12 database models across 8 dimensions. From key-value simplicity to multi-model complexity.
      </p>
    </article>
  </a>
</section>
```

### Pattern 6: Blog Post MDX Frontmatter
**What:** Standard blog frontmatter matching the content collection schema, plus MDX component imports.
**When to use:** INTEG-03 companion blog post.
**Example:**
```yaml
---
title: "How to Choose a Database in 2026"
description: "A practical framework for choosing the right database model. 12 models scored across 8 dimensions -- scalability, performance, reliability, and more."
publishedDate: 2026-02-22
tags: ["databases", "database-compass", "cloud-native", "architecture"]
draft: false
---
```

### Anti-Patterns to Avoid
- **Satori SVG elements:** Satori cannot render SVG elements directly -- it only accepts HTML elements with CSS flexbox. Always embed SVGs as `<img>` with base64 data URIs.
- **Font mismatch:** Do not try to use DM Sans or Noto Sans in Satori OG images -- only Inter and Space Grotesk woff files are available for Satori. The OG images intentionally use a different font stack.
- **Missing ogImage prop:** If the `ogImage` prop is not passed to Layout, the default OG image (`/open-graph/default.png`) is used. Always explicitly set `ogImage` on pages with custom OG images.
- **Absolute URLs for OG images:** OG image URLs must be absolute (starting with `https://`). Use `new URL(path, Astro.site).toString()` to construct them. Relative URLs will not work for social media crawlers.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| SVG to PNG conversion | Custom canvas-based conversion | Sharp (`sharp(Buffer.from(svg)).png().toBuffer()`) | Already proven, handles edge cases |
| HTML to SVG for OG | Template string HTML | Satori with plain object VNode trees | Established pattern, handles layout/fonts |
| Sitemap generation | Manual XML generation | @astrojs/sitemap (auto-includes all static pages) | Zero configuration needed; just build the pages |
| Radar chart SVG | New SVG generator for OG | `generateRadarSvgString()` from radar-math.ts | Already axis-count agnostic, pure TS, Satori-tested |
| Blog OG image | Custom blog post OG generator | Existing `generateOgImage()` in og-image.ts | Already handles title, description, tags, coverImage |

**Key insight:** Every component needed for this phase already exists in the codebase. The work is wiring, not building.

## Common Pitfalls

### Pitfall 1: Satori Rendering Differences from Browser
**What goes wrong:** Layouts that look correct in the browser render differently in Satori (font metrics, flexbox edge cases, SVG embedding).
**Why it happens:** Satori is not a browser -- it interprets a subset of CSS flexbox and renders using yoga-layout.
**How to avoid:** Follow established OG image patterns exactly (from Beauty Index). Use explicit pixel widths, not percentages. Test by running `astro build` and inspecting generated PNG files in `dist/open-graph/`.
**Warning signs:** Text overflow, misaligned elements, missing SVG content in the generated PNGs.

### Pitfall 2: Unicode Symbols in Satori
**What goes wrong:** Unicode dimension symbols (arrows, anchors, stars, etc.) from `DIMENSIONS` may not render in Satori because the loaded fonts may not include those glyphs.
**Why it happens:** Inter and Space Grotesk may not have complete Unicode coverage. The site uses Noto Sans as a fallback for these symbols, but Noto Sans is not loaded in Satori.
**How to avoid:** For OG images, use text shortNames (`Scale`, `Perf`, `Rely`, etc.) instead of Unicode symbols for labels. The existing `generateRadarSvgString()` accepts `labels` parameter -- pass `DIMENSIONS.map(d => d.symbol + ' ' + d.shortName)` which renders as text inside the SVG (using the SVG's own `font-family` attribute, not Satori's font stack). Since the radar SVG is embedded as a base64 `<img>`, its internal font rendering is separate from Satori.
**Warning signs:** Missing glyphs appearing as boxes or blank spaces in OG images.

### Pitfall 3: Spectrum Miniature Sizing for OG
**What goes wrong:** The full-width spectrum (800x160 default) looks too small or too cluttered when embedded in a 1200x630 OG image.
**Why it happens:** The spectrum was designed for page display, not thumbnail display in OG images.
**How to avoid:** Generate a dedicated miniature spectrum SVG sized for the OG image context. Use wider model spacing, larger dot radius, and consider omitting labels or using only shortLabels. Target approximately 600x100 pixels within the OG image.
**Warning signs:** Overlapping labels, unreadable text, dots appearing too close together.

### Pitfall 4: Blog Post Slug Mismatch
**What goes wrong:** The overview page already links to `/blog/database-compass/` (line 51 of overview index.astro). If the blog post file is named differently, the link breaks.
**Why it happens:** Blog slugs in this project are derived from the filename (Astro glob loader uses the filename without extension as the entry ID).
**How to avoid:** Name the blog post file exactly `database-compass.mdx` to produce the slug `database-compass` and URL `/blog/database-compass/`.
**Warning signs:** 404 on the "Read the methodology" link from the overview page.

### Pitfall 5: Sitemap Automatic Inclusion of open-graph Routes
**What goes wrong:** The `@astrojs/sitemap` integration may include `/open-graph/*.png` routes in the sitemap.
**Why it happens:** Sitemap includes all static routes by default.
**How to avoid:** Check the existing sitemap output -- the current build does NOT include open-graph routes (verified: `dist/sitemap-0.xml` has no `/open-graph/` URLs). This is because `.png.ts` API routes that return binary responses are not treated as pages by the sitemap integration. No action needed.
**Warning signs:** Open-graph URLs appearing in the sitemap (would be unusual given existing behavior).

## Code Examples

### Overview OG Image Generator
```typescript
// New function to add to src/lib/og-image.ts
// Follows generateOverviewOgImage() pattern from Beauty Index
export async function generateCompassOverviewOgImage(
  models: { id: string; name: string; slug: string; complexityPosition: number }[]
): Promise<Buffer> {
  // Generate a miniature spectrum SVG
  const spectrumSvg = generateSpectrumMiniatureSvg(600, 100, models);
  const spectrumDataUri = `data:image/svg+xml;base64,${Buffer.from(spectrumSvg).toString('base64')}`;

  const dimensionNames = ['Scalability', 'Performance', 'Reliability', 'Ops', 'Query', 'Schema', 'Ecosystem', 'Learning'];

  const dimensionPills = {
    type: 'div',
    props: {
      style: { display: 'flex', flexWrap: 'wrap' as const, gap: '8px' },
      children: dimensionNames.map((name) => ({
        type: 'div',
        props: {
          style: {
            fontSize: '14px',
            color: '#c44b20',
            backgroundColor: 'rgba(196,75,32,0.1)',
            borderRadius: '20px',
            padding: '4px 14px',
          },
          children: name,
        },
      })),
    },
  };

  const layout = {
    type: 'div',
    props: {
      style: {
        width: '1200px', height: '630px',
        display: 'flex', flexDirection: 'row' as const,
        backgroundColor: '#faf8f5',
        position: 'relative' as const, fontFamily: 'Inter',
      },
      children: [
        accentBar(),
        // Left column: text
        {
          type: 'div',
          props: {
            style: {
              display: 'flex', flexDirection: 'column' as const,
              justifyContent: 'center', width: '620px',
              padding: '40px 0px 60px 56px', gap: '20px',
            },
            children: [
              { type: 'div', props: { style: { fontFamily: 'Space Grotesk', fontWeight: 700, fontSize: '52px', color: '#1a1a2e', lineHeight: 1.15 }, children: 'Database Compass' } },
              { type: 'div', props: { style: { fontSize: '22px', color: '#555566', lineHeight: 1.5 }, children: 'Compare 12 database models across 8 dimensions' } },
              dimensionPills,
            ],
          },
        },
        // Right column: spectrum miniature
        {
          type: 'div',
          props: {
            style: { display: 'flex', alignItems: 'center', justifyContent: 'center', width: '580px', height: '630px' },
            children: [{ type: 'img', props: { src: spectrumDataUri, width: 540, height: 100 } }],
          },
        },
        // Bottom-left branding
        {
          type: 'div',
          props: {
            style: { position: 'absolute' as const, bottom: '24px', left: '60px', display: 'flex', alignItems: 'center', gap: '10px' },
            children: brandingRow().props.children,
          },
        },
      ],
    },
  };

  return renderOgPng(layout);
}
```

### Spectrum Miniature SVG Generator
```typescript
// New helper function in src/lib/og-image.ts
// Generates a simplified spectrum SVG string for OG image embedding
import { computeSpectrumPositions, MODEL_SHORT_LABELS } from './db-compass/spectrum-math';

function generateSpectrumMiniatureSvg(
  width: number,
  height: number,
  models: { id: string; name: string; slug: string; complexityPosition: number }[]
): string {
  const sorted = [...models].sort((a, b) => a.complexityPosition - b.complexityPosition);
  const padding = 40;
  const baselineY = height / 2;
  const points = computeSpectrumPositions(width, sorted, padding, baselineY);

  const dots = points.map((p) =>
    `<circle cx="${p.x.toFixed(1)}" cy="${baselineY}" r="5" fill="#c44b20"/>`
  ).join('\n  ');

  const labels = points.map((p) => {
    const label = MODEL_SHORT_LABELS[p.id] ?? p.id.slice(0, 3);
    return `<text x="${p.x.toFixed(1)}" y="${baselineY - 14}" text-anchor="middle" font-size="9" fill="#5a5a5a" font-family="sans-serif" font-weight="500">${label}</text>`;
  }).join('\n  ');

  return `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
  <line x1="${padding}" y1="${baselineY}" x2="${width - padding}" y2="${baselineY}" stroke="#e5ddd5" stroke-width="2"/>
  <text x="${padding}" y="${baselineY + 20}" text-anchor="middle" font-size="10" fill="#5a5a5a" font-family="sans-serif" font-weight="600">Simple</text>
  <text x="${width - padding}" y="${baselineY + 20}" text-anchor="middle" font-size="10" fill="#5a5a5a" font-family="sans-serif" font-weight="600">Complex</text>
  ${dots}
  ${labels}
</svg>`;
}
```

### Detail Page OG Image Generator
```typescript
// New function to add to src/lib/og-image.ts
// Follows generateLanguageOgImage() pattern -- two-column with radar on right
import { generateRadarSvgString } from './beauty-index/radar-math';
import { DIMENSIONS, DIMENSION_COLORS } from './db-compass/dimensions';
import { dimensionScores, totalScore, type DbModel } from './db-compass/schema';

export async function generateCompassModelOgImage(model: DbModel): Promise<Buffer> {
  const scores = dimensionScores(model);
  const total = totalScore(model);
  const labels = DIMENSIONS.map((d) => d.symbol + ' ' + d.shortName);
  const labelColors = DIMENSIONS.map((d) => DIMENSION_COLORS[d.key] ?? '#666');
  const accentColor = '#c44b20';
  const radarSvg = generateRadarSvgString(300, scores, accentColor, 0.35, labels, labelColors);
  const radarDataUri = `data:image/svg+xml;base64,${Buffer.from(radarSvg).toString('base64')}`;
  const capLabel = model.capTheorem.classification;
  const sketch = truncate(model.characterSketch, 120);

  const layout = {
    type: 'div',
    props: {
      style: { width: '1200px', height: '630px', display: 'flex', flexDirection: 'row' as const, backgroundColor: '#faf8f5', position: 'relative' as const, fontFamily: 'Inter' },
      children: [
        accentBar(),
        // Left column (text)
        {
          type: 'div',
          props: {
            style: { display: 'flex', flexDirection: 'column' as const, justifyContent: 'center', width: '700px', padding: '40px 0px 60px 56px', gap: '16px' },
            children: [
              { type: 'div', props: { style: { fontSize: '18px', color: '#c44b20', fontWeight: 600 }, children: 'Database Compass' } },
              { type: 'div', props: { style: { fontFamily: 'Space Grotesk', fontWeight: 700, fontSize: '52px', color: '#1a1a2e', lineHeight: 1.15 }, children: model.name } },
              // Score + CAP row
              {
                type: 'div', props: {
                  style: { display: 'flex', alignItems: 'center', gap: '16px' },
                  children: [
                    { type: 'div', props: { style: { fontFamily: 'Space Grotesk', fontWeight: 700, fontSize: '32px', color: accentColor }, children: `${total}/80` } },
                    { type: 'div', props: { style: { fontSize: '16px', color: '#ffffff', backgroundColor: accentColor, borderRadius: '20px', padding: '4px 16px', fontWeight: 600 }, children: capLabel } },
                  ],
                },
              },
              { type: 'div', props: { style: { fontSize: '18px', color: '#555566', lineHeight: 1.5 }, children: sketch } },
            ],
          },
        },
        // Right column (radar chart)
        {
          type: 'div', props: {
            style: { display: 'flex', alignItems: 'center', justifyContent: 'center', width: '500px', height: '630px' },
            children: [{ type: 'img', props: { src: radarDataUri, width: 360, height: 360 } }],
          },
        },
        // Bottom-left branding
        {
          type: 'div', props: {
            style: { position: 'absolute' as const, bottom: '24px', left: '60px', display: 'flex', alignItems: 'center', gap: '10px' },
            children: brandingRow().props.children,
          },
        },
      ],
    },
  };

  return renderOgPng(layout);
}
```

### Tools Page Card (Replacing "Coming Soon")
```html
<!-- Replace the "Coming Soon" placeholder div with a real link card -->
<a
  href="/tools/db-compass/"
  class="block card-hover p-6 rounded-lg border border-[var(--color-border)] no-underline group"
  data-reveal
  data-tilt
>
  <div class="mb-4 text-[var(--color-accent)]">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
    </svg>
  </div>
  <h2 class="text-lg font-heading font-bold text-[var(--color-text-primary)] group-hover:text-[var(--color-accent)] transition-colors">
    Database Compass
  </h2>
  <p class="meta-mono mt-1">2026 Edition</p>
  <p class="text-sm text-[var(--color-text-secondary)] mt-3">
    Compare 12 database models across 8 dimensions -- scalability, performance, reliability, query flexibility,
    and more. Radar charts, scoring tables, and interactive filtering.
  </p>
  <ul class="mt-4 flex flex-wrap gap-2">
    <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">12 models</li>
    <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">8 dimensions</li>
    <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">Radar charts</li>
    <li class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">Interactive filter</li>
  </ul>
</a>
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| No OG images for DB Compass pages | Satori+Sharp build-time OG images with radar/spectrum visuals | This phase | Social sharing shows branded images instead of generic fallback |
| "Coming Soon" placeholder on tools page | Real Database Compass card with description and pill tags | This phase | Tools page properly showcases the new feature |
| No blog post for Database Compass | Companion "How to Choose a Database in 2026" post | This phase | SEO content, bidirectional cross-links, fills existing dead link |

**Established precedents from earlier phases:**
- Phase 18 (Beauty Index OG): Proved the Satori+Sharp pipeline, embedded radar SVGs, `getStaticPaths` API route pattern
- Phase 20 (Blog Content): Proved the companion blog post pattern with cross-links to tool pages
- Phase 21 (SEO Launch): Proved sitemap auto-inclusion works without configuration for new pages

## Open Questions

1. **Spectrum miniature label collisions in OG**
   - What we know: The full-width spectrum uses staggering to avoid label overlap. In a miniature 600x100 SVG, labels may still collide.
   - What's unclear: Whether all 12 abbreviated labels will fit cleanly at the miniature size.
   - Recommendation: Start with labels, test the build output. If collisions occur, either (a) omit labels and show only dots, or (b) show labels for only the first, middle, and last models.

2. **Blog post content depth**
   - What we know: The blog post needs to be substantive enough for SEO value and must link to both the overview and selected detail pages. The existing Beauty Index blog post is 3000+ words.
   - What's unclear: Exact word count and which specific detail pages to cross-link.
   - Recommendation: Target 1500-2500 words. Cross-link to at least 4-5 representative models (key-value, relational, document, graph, vector) that span the complexity spectrum.

3. **Blog post OG image**
   - What we know: Blog posts automatically get OG images via the existing `[...slug].png.ts` catch-all route in `src/pages/open-graph/`. The blog schema supports a `coverImage` field.
   - What's unclear: Whether to create a dedicated cover image for the blog post or rely on the auto-generated title+description OG image.
   - Recommendation: The auto-generated blog OG image (title + description + tag pills) is sufficient. No custom cover image needed -- this keeps the blog post focused on content.

## Sources

### Primary (HIGH confidence)
- `src/lib/og-image.ts` -- Full OG image pipeline including `renderOgPng()`, `accentBar()`, `brandingRow()`, `generateLanguageOgImage()`, `generateOverviewOgImage()`, and 5 other generators. All patterns verified by reading source code.
- `src/pages/open-graph/beauty-index/[slug].png.ts` -- Existing `getStaticPaths` API route for per-language OG images. Pattern to be replicated for DB Compass.
- `src/lib/beauty-index/radar-math.ts` -- `generateRadarSvgString()` function, verified axis-count agnostic (uses `values.length` for axes), confirmed pure TypeScript with zero imports.
- `src/lib/db-compass/spectrum-math.ts` -- `computeSpectrumPositions()` function, verified zero imports, confirmed pure TypeScript.
- `src/lib/db-compass/dimensions.ts` -- DIMENSIONS array (8 entries) and DIMENSION_COLORS record.
- `src/lib/db-compass/schema.ts` -- DbModel type, `dimensionScores()`, `totalScore()`.
- `src/content.config.ts` -- Blog collection schema (glob loader, `src/data/blog/*.{md,mdx}`), dbModels collection.
- `src/components/SEOHead.astro` -- `ogImage` prop wiring to `<meta property="og:image">`.
- `src/layouts/Layout.astro` -- Default `ogImage` falls back to `/open-graph/default.png`. Props interface accepts ogImage string.
- `src/pages/index.astro` -- Existing Beauty Index and Dockerfile Analyzer callout cards (lines 159-182).
- `src/pages/tools/index.astro` -- "Coming Soon" placeholder div (lines 48-64).
- `src/pages/tools/db-compass/index.astro` -- Existing link to `/blog/database-compass/` (line 51).
- `astro.config.mjs` -- `@astrojs/sitemap` integration, `site` set to `https://patrykgolabek.dev`.
- `dist/sitemap-0.xml` -- Verified sitemap includes DB Compass pages automatically, does NOT include `/open-graph/` routes.

### Secondary (MEDIUM confidence)
- Phase 18 research (`18-RESEARCH.md`) -- Established OG image patterns, Satori limitations, font handling approach. Verified by cross-checking with current `og-image.ts` source.

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH -- All tools already installed and proven in production. Zero new dependencies.
- Architecture: HIGH -- Every pattern has been implemented before for Beauty Index. This is a direct replication with DB Compass data.
- Pitfalls: HIGH -- Satori limitations documented from Phase 18 experience. Font handling, SVG embedding, and URL construction all have established patterns.
- Blog post: MEDIUM -- Content structure is well-defined but exact content depth and cross-link targets require editorial judgment during implementation.

**Research date:** 2026-02-22
**Valid until:** 2026-03-22 (stable -- all dependencies are project-internal; no external API changes expected)
