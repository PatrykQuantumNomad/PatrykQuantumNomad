---
phase: 59-uniform-random-numbers-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/eda/svg-generators/histogram.ts
  - src/components/eda/UniformRandomPlots.astro
autonomous: true
requirements: [URN-03]

must_haves:
  truths:
    - "Histogram for the Uniform Random Numbers case study displays a horizontal dashed overlay line at the expected uniform frequency level instead of a KDE curve"
    - "The overlay line spans exactly the [0, 1] range (the theoretical U(0,1) support) and does not extend beyond"
    - "The overlay height matches the expected frequency: n * binWidth / (rangeMax - rangeMin)"
  artifacts:
    - path: "src/lib/eda/svg-generators/histogram.ts"
      provides: "showUniformPDF and uniformRange options in HistogramOptions, uniform PDF overlay SVG generation"
      contains: "showUniformPDF"
    - path: "src/components/eda/UniformRandomPlots.astro"
      provides: "Histogram case using showUniformPDF: true with uniformRange [0, 1]"
      contains: "showUniformPDF: true"
  key_links:
    - from: "src/components/eda/UniformRandomPlots.astro"
      to: "src/lib/eda/svg-generators/histogram.ts"
      via: "generateHistogram({ showUniformPDF: true, uniformRange: [0, 1] })"
      pattern: "showUniformPDF.*true"
---

<objective>
Add a uniform PDF overlay option to the histogram SVG generator and switch the Uniform Random Numbers case study histogram from the misleading KDE overlay to a correct uniform PDF overlay.

Purpose: The current KDE overlay applies Gaussian kernel smoothing to rectangular data, which is scientifically misleading. A horizontal line at the expected uniform frequency is the correct distributional comparison for data suspected to follow U(0,1). This fulfills URN-03.

Output: Modified histogram.ts with `showUniformPDF` option, updated UniformRandomPlots.astro using the new option with updated caption.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/59-uniform-random-numbers-enhancement/59-RESEARCH.md

@src/lib/eda/svg-generators/histogram.ts
@src/lib/eda/svg-generators/plot-base.ts
@src/components/eda/UniformRandomPlots.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add uniform PDF overlay option to histogram generator</name>
  <files>src/lib/eda/svg-generators/histogram.ts</files>
  <action>
Add two new optional properties to the `HistogramOptions` interface:
- `showUniformPDF?: boolean` -- when true, draws a horizontal line at the expected uniform frequency
- `uniformRange?: [number, number]` -- optional [a,b] for U(a,b); defaults to [domainMin, domainMax] if not provided

In the `generateHistogram` function, after the KDE overlay block (around line 100) and before the "Assemble" section, add a new block that generates the uniform PDF overlay SVG when `showUniformPDF` is true:

1. Destructure `showUniformPDF = false` and `uniformRange` from options (alongside the existing `showKDE` destructure on line 32)
2. After the KDE overlay block, add:
   ```
   let uniformOverlay = '';
   if (showUniformPDF) {
     const [rangeMin, rangeMax] = uniformRange ?? [domainMin, domainMax];
     const rangeWidth = rangeMax - rangeMin;
     // Expected frequency per bin: n * binWidth / range
     const binWidth = bins.length > 0 ? (bins[0].x1! - bins[0].x0!) : (domainMax - domainMin) / thresholds;
     const expectedFreq = (data.length * binWidth) / rangeWidth;
     const y = yScale(expectedFreq);
     const x1 = xScale(rangeMin);
     const x2 = xScale(rangeMax);
     uniformOverlay = `<line x1="${x1.toFixed(2)}" y1="${y.toFixed(2)}" x2="${x2.toFixed(2)}" y2="${y.toFixed(2)}" stroke="${PALETTE.dataSecondary}" stroke-width="2" stroke-dasharray="6,4" />`;
   }
   ```
3. In the assemble section (the return statement around line 106), add `uniformOverlay` after the `kdeOverlay` line (after `'\n' + kdeOverlay + '\n'`), adding: `uniformOverlay + '\n' +`

Important notes:
- Do NOT remove the existing KDE overlay functionality -- it is used by other case studies. Only ADD the new uniform PDF overlay as an alternative.
- Use `PALETTE.dataSecondary` for the line color (consistent with overlay styling throughout the codebase).
- Use `stroke-dasharray="6,4"` for a dashed line that visually distinguishes it from histogram bars.
- The overlay line must be clipped to [rangeMin, rangeMax] -- the uniform PDF is zero outside its support.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro check 2>&1 | tail -20</automated>
  </verify>
  <done>histogram.ts exports HistogramOptions with showUniformPDF and uniformRange fields. generateHistogram renders a dashed horizontal line at the correct expected frequency when showUniformPDF is true. No TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Switch UniformRandomPlots histogram to uniform PDF overlay</name>
  <files>src/components/eda/UniformRandomPlots.astro</files>
  <action>
In UniformRandomPlots.astro, make two changes:

1. **Update the histogram case** (around line 67-75): Replace `showKDE: true` with `showUniformPDF: true` and add `uniformRange: [0, 1]` (the theoretical U(0,1) support):
   ```typescript
   case 'histogram':
     svg = generateHistogram({
       data: uniformRandom,
       showUniformPDF: true,
       uniformRange: [0, 1],
       config: singleConfig,
       title: 'Histogram',
       xLabel: 'Value',
       yLabel: 'Frequency',
     });
     break;
   ```

2. **Update the default histogram caption** (around line 115): Change from:
   `'Histogram with KDE overlay showing the flat, rectangular shape characteristic of a uniform distribution.'`
   To:
   `'Histogram with uniform PDF overlay showing the expected frequency under U(0,1) against the observed data. The flat histogram shape matches the uniform distribution.'`

Do NOT change any other plot type cases or captions -- only the histogram entry.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro check 2>&1 | tail -20 && npx astro build 2>&1 | tail -20</automated>
  </verify>
  <done>UniformRandomPlots.astro histogram case uses showUniformPDF: true with uniformRange [0, 1]. The default histogram caption describes the uniform PDF overlay. The site builds successfully with no errors.</done>
</task>

</tasks>

<verification>
1. `npx astro check` reports 0 errors -- TypeScript types are correct
2. `npx astro build` succeeds -- the histogram renders at build time without runtime errors
3. The generated histogram SVG for uniform-random-numbers contains a `<line>` element with `stroke-dasharray="6,4"` (the uniform PDF overlay) instead of a `<path>` element with KDE area fill
</verification>

<success_criteria>
- histogram.ts has showUniformPDF and uniformRange in HistogramOptions interface
- generateHistogram produces a dashed horizontal overlay line at the expected uniform frequency when showUniformPDF is true
- UniformRandomPlots.astro histogram case uses showUniformPDF: true, uniformRange: [0, 1]
- Default histogram caption references "uniform PDF overlay"
- Site builds successfully with npx astro build
</success_criteria>

<output>
After completion, create `.planning/phases/59-uniform-random-numbers-enhancement/59-01-SUMMARY.md`
</output>
