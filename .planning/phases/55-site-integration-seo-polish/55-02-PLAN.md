---
phase: 55-site-integration-seo-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/og-image.ts
  - src/pages/open-graph/eda/overview.png.ts
  - src/pages/open-graph/eda/techniques.png.ts
  - src/pages/open-graph/eda/distributions.png.ts
  - src/pages/open-graph/eda/case-studies.png.ts
  - src/data/blog/eda-visual-encyclopedia.mdx
  - src/pages/eda/index.astro
autonomous: true
requirements: [SITE-07, SITE-08, SITE-09]

must_haves:
  truths:
    - "Build-time OG images generate for EDA overview and key section pages (6-8 images total)"
    - "A companion blog post about EDA methodology is published and visible on the blog listing page"
    - "The blog post links to EDA pages and the EDA landing page links back to the blog post"
  artifacts:
    - path: "src/lib/og-image.ts"
      provides: "generateEdaOverviewOgImage and generateEdaSectionOgImage functions"
      contains: "generateEdaOverviewOgImage"
    - path: "src/pages/open-graph/eda/overview.png.ts"
      provides: "OG image endpoint for /eda/ landing page"
      contains: "GET"
    - path: "src/data/blog/eda-visual-encyclopedia.mdx"
      provides: "Companion blog post with 2000-3000 words and 10+ cross-links"
      contains: "EDA Visual Encyclopedia"
    - path: "src/pages/eda/index.astro"
      provides: "Blog post cross-link on landing page"
      contains: "eda-visual-encyclopedia"
  key_links:
    - from: "src/pages/open-graph/eda/overview.png.ts"
      to: "src/lib/og-image.ts"
      via: "import generateEdaOverviewOgImage"
      pattern: "generateEdaOverviewOgImage"
    - from: "src/data/blog/eda-visual-encyclopedia.mdx"
      to: "/eda/"
      via: "inline markdown links in blog post body"
      pattern: "/eda/"
    - from: "src/pages/eda/index.astro"
      to: "/blog/eda-visual-encyclopedia/"
      via: "link in landing page companion blog section"
      pattern: "eda-visual-encyclopedia"
---

<objective>
Generate build-time OG images for the EDA section and publish a companion blog post with bidirectional cross-links.

Purpose: OG images ensure EDA pages display rich previews when shared on social media. The companion blog post provides long-form narrative context that search engines favor for ranking, while cross-links strengthen the internal link graph for SEO.

Output: generateEdaOverviewOgImage/generateEdaSectionOgImage functions in og-image.ts, 4-5 OG image endpoints in src/pages/open-graph/eda/, companion blog post MDX file, bidirectional cross-links.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-site-integration-seo-polish/55-RESEARCH.md

@src/lib/og-image.ts
@src/lib/eda/og-cache.ts
@src/pages/open-graph/beauty-index.png.ts
@src/pages/open-graph/db-compass.png.ts
@src/layouts/EDALayout.astro
@src/pages/eda/index.astro
@src/data/blog/database-compass.mdx

<interfaces>
<!-- Key types and contracts the executor needs. -->

From src/lib/og-image.ts (existing export pattern):
```typescript
// Each tool/section has its own generate function. Follow this pattern:
export async function generateComposeValidatorOgImage(): Promise<Buffer> { ... }
export async function generateDockerfileAnalyzerOgImage(): Promise<Buffer> { ... }
export async function generateK8sAnalyzerOgImage(): Promise<Buffer> { ... }
export async function generateCompassOverviewOgImage(...): Promise<Buffer> { ... }
// ADD: generateEdaOverviewOgImage and generateEdaSectionOgImage
```

From src/lib/og-image.ts (shared helpers -- already available):
```typescript
async function loadFonts() { ... }  // Space Grotesk + Inter
function truncate(text: string, maxLength: number): string { ... }
async function renderOgPng(layout: Record<string, unknown>): Promise<Buffer> { ... }
function brandingRow() { ... }  // "patrykgolabek.dev" branding at bottom
function accentBar() { ... }  // Decorative accent bar
```

From src/lib/eda/og-cache.ts:
```typescript
export function computeOgHash(title: string, description: string): string;
export async function getCachedOgImage(hash: string): Promise<Buffer | null>;
export async function cacheOgImage(hash: string, png: Buffer): Promise<void>;
export async function getOrGenerateOgImage(
  title: string,
  description: string,
  generateFn: () => Promise<Buffer>,
): Promise<Buffer>;
```

From src/pages/open-graph/beauty-index.png.ts (endpoint pattern):
```typescript
import type { APIRoute } from 'astro';
export const GET: APIRoute = async () => {
  const png = await generateOverviewOgImage();
  return new Response(png, {
    headers: {
      'Content-Type': 'image/png',
      'Cache-Control': 'public, max-age=31536000, immutable',
    },
  });
};
```

From src/layouts/EDALayout.astro:
```typescript
interface Props {
  title: string;
  description?: string;
  ogImage?: string;      // Pass OG image URL here
  ogImageAlt?: string;
  useKatex?: boolean;
}
```

Blog post frontmatter schema (from src/content.config.ts):
```typescript
{
  title: string;
  description: string;
  publishedDate: Date;      // YAML: 2026-02-25
  updatedDate?: Date;
  tags: string[];
  draft: boolean;
  coverImage?: string;
  externalUrl?: string;
  source?: string;
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EDA OG image generators and endpoints</name>
  <files>
    src/lib/og-image.ts
    src/pages/open-graph/eda/overview.png.ts
    src/pages/open-graph/eda/techniques.png.ts
    src/pages/open-graph/eda/distributions.png.ts
    src/pages/open-graph/eda/case-studies.png.ts
  </files>
  <action>
    **Add to src/lib/og-image.ts:**

    1. `generateEdaOverviewOgImage(): Promise<Buffer>` -- OG image for /eda/ landing page.
       - Layout: 1200x630 satori template following existing tool OG patterns
       - Left side: Title "EDA Visual Encyclopedia" in Space Grotesk bold, subtitle "Interactive visual reference for Exploratory Data Analysis" in Inter, "90+ Pages" pill badge
       - Right side: A composite of 4 mini chart silhouettes (histogram bars, scatter dots, bell curve, box plot whiskers) rendered as simple satori divs/shapes using the Quantum Explorer accent colors. Keep it simple -- rectangles for histogram bars, a curved div for bell curve, etc. These are decorative, not functional charts.
       - Bottom: brandingRow() + accentBar()
       - Colors: Use the same CSS-to-satori color mapping as other OG generators (dark background, accent colors for charts)

    2. `generateEdaSectionOgImage(sectionTitle: string, sectionDescription: string, pageCount: string): Promise<Buffer>` -- Generic section OG image for techniques/distributions/case-studies pages.
       - Layout: Similar to overview but with section-specific title and description
       - Left side: sectionTitle in large font, sectionDescription below, pageCount pill
       - Right side: Simple decorative element (chart icon or abstract lines)
       - Bottom: brandingRow() + accentBar()

    **Create OG image endpoints:**
    Following the `src/pages/open-graph/beauty-index.png.ts` pattern exactly:

    - `src/pages/open-graph/eda/overview.png.ts` -- Calls `getOrGenerateOgImage("EDA Visual Encyclopedia", description, () => generateEdaOverviewOgImage())`
    - `src/pages/open-graph/eda/techniques.png.ts` -- Calls `getOrGenerateOgImage("EDA Techniques", ..., () => generateEdaSectionOgImage("Graphical & Quantitative Techniques", "47 statistical techniques...", "47 Techniques"))`
    - `src/pages/open-graph/eda/distributions.png.ts` -- Calls with distribution section info
    - `src/pages/open-graph/eda/case-studies.png.ts` -- Calls with case studies section info

    That's 4 OG images -- overview + 3 key sections. Individual technique/distribution pages will fall back to the overview or section OG image via the ogImage prop in EDALayout.

    **Wire OG images to pages:**
    - In `src/pages/eda/index.astro`: Pass `ogImage="/open-graph/eda/overview.png"` and `ogImageAlt="EDA Visual Encyclopedia - 90+ interactive statistical technique pages"` to EDALayout.
    - NOTE: Technique and distribution template components already accept ogImage from their parent page routes. The section-level OG images can be wired from the dynamic route files (e.g., techniques/[slug].astro can pass `ogImage="/open-graph/eda/techniques.png"`). If the route files don't currently pass ogImage, add it.

    IMPORTANT: Use the og-cache.ts `getOrGenerateOgImage` wrapper for all endpoints -- this ensures caching works and first-build doesn't re-generate on subsequent builds.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro build 2>&1 | tail -10 && test -f dist/open-graph/eda/overview.png && echo "OG overview exists" || echo "OG overview MISSING"</automated>
  </verify>
  <done>
    - generateEdaOverviewOgImage and generateEdaSectionOgImage functions exist in og-image.ts
    - 4 OG image endpoints exist under src/pages/open-graph/eda/
    - Build produces PNG files at dist/open-graph/eda/*.png
    - EDA landing page passes ogImage to EDALayout
  </done>
</task>

<task type="auto">
  <name>Task 2: Write companion blog post and add bidirectional cross-links</name>
  <files>
    src/data/blog/eda-visual-encyclopedia.mdx
    src/pages/eda/index.astro
  </files>
  <action>
    **Blog post (SITE-08):**
    Create `src/data/blog/eda-visual-encyclopedia.mdx` following the existing companion blog post pattern (see database-compass.mdx and the-beauty-index.mdx as references).

    Frontmatter:
    ```yaml
    ---
    title: "Exploratory Data Analysis: A Visual Encyclopedia"
    description: "A comprehensive interactive reference for Exploratory Data Analysis based on the NIST/SEMATECH Engineering Statistics Handbook. 90+ pages covering graphical techniques, quantitative methods, probability distributions, and case studies."
    publishedDate: 2026-02-25
    tags: ["eda", "statistics", "data-analysis", "nist", "data-science", "data-visualization"]
    draft: false
    ---
    ```

    Body structure (target 2000-3000 words):

    1. **Introduction** (~300 words): What is EDA, why it matters, NIST source material origin, link to /eda/
    2. **What's Inside the Encyclopedia** (~400 words): Overview of the 6 content categories -- graphical techniques (29 pages), quantitative techniques (18 pages), probability distributions (19 pages), case studies (9 pages), foundations (6 pages), reference (4 pages). Link to each category section on the landing page.
    3. **Graphical Techniques** (~400 words): Highlight 4-5 key techniques (histogram, scatter plot, box plot, normal probability plot, autocorrelation). Include inline links like `[histogram](/eda/techniques/histogram/)`. Explain Tier A (static SVG) vs Tier B (SVG variant swap) interactivity.
    4. **Quantitative Methods** (~300 words): Highlight key techniques (mean, standard deviation, t-test, chi-square test). Mention KaTeX formula rendering and Python code examples. Include inline links.
    5. **Probability Distributions** (~300 words): Highlight normal, chi-square, exponential. Mention D3 interactive parameter explorers. Include inline links like `[normal distribution](/eda/distributions/normal/)`.
    6. **Case Studies** (~300 words): Describe the NIST case study approach -- sequential application of EDA techniques to real datasets. Link to 2-3 case studies.
    7. **Technical Implementation** (~300 words): Brief on build-time SVG generation (TypeScript generators, not Python), D3 micro-bundle isolation, KaTeX for formulas, Astro static site. This is interesting to developer readers and positions Patryk as technically skilled.
    8. **Conclusion** (~100 words): CTA to explore the encyclopedia with link to /eda/.

    Include at least 10 cross-links to specific EDA pages throughout the post. Use standard MDX inline links.

    **Bidirectional cross-links (SITE-09):**
    The blog post already links TO EDA pages via inline links.
    For the reverse link, add a "Companion Blog Post" section or link on `src/pages/eda/index.astro`:
    - Add a small callout below the hero/intro section of the landing page, before the filter grid. Something like:
    ```html
    <div class="mb-8 p-4 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
      <p class="text-sm text-[var(--color-text-secondary)]">
        <strong>New:</strong> Read the companion article
        <a href="/blog/eda-visual-encyclopedia/" class="text-[var(--color-accent)] hover:underline">
          Exploratory Data Analysis: A Visual Encyclopedia
        </a>
        for a guided tour of the encyclopedia and the methodology behind it.
      </p>
    </div>
    ```
    This creates the bidirectional cross-link. The blog post body links to EDA pages; the EDA landing page links back to the blog post.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro build 2>&1 | tail -5 && test -f dist/blog/eda-visual-encyclopedia/index.html && echo "Blog post exists" && grep -c "/eda/" dist/blog/eda-visual-encyclopedia/index.html && grep -c "eda-visual-encyclopedia" dist/eda/index.html</automated>
  </verify>
  <done>
    - Blog post at /blog/eda-visual-encyclopedia/ renders correctly with 2000+ words
    - Blog post contains 10+ inline links to EDA pages
    - EDA landing page contains a link to /blog/eda-visual-encyclopedia/
    - Blog listing page shows the new post
    - Build passes without errors
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` completes without errors
2. OG image PNG files exist at dist/open-graph/eda/*.png (4 files)
3. Blog post HTML exists at dist/blog/eda-visual-encyclopedia/index.html
4. Blog post contains 10+ links to /eda/ pages
5. EDA landing page contains link to blog post
6. OG image is referenced in EDA landing page meta tags
</verification>

<success_criteria>
- 4 OG image endpoints generate PNG files during build
- Companion blog post is published with 2000+ words and 10+ EDA cross-links
- EDA landing page links back to the blog post
- OG images are wired to EDA pages via EDALayout ogImage prop
</success_criteria>

<output>
After completion, create `.planning/phases/55-site-integration-seo-polish/55-02-SUMMARY.md`
</output>
