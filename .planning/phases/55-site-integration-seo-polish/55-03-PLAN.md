---
phase: 55-site-integration-seo-polish
plan: 03
type: execute
wave: 2
depends_on: [55-01, 55-02]
files_modified:
  - src/components/eda/TechniquePage.astro
  - src/components/eda/DistributionPage.astro
  - src/pages/eda/index.astro
autonomous: false
requirements: [SITE-10, SITE-11, SITE-12, QUAL-01, QUAL-02, QUAL-03, QUAL-04]

must_haves:
  truths:
    - "Lighthouse scores 90+ on performance and accessibility for representative pages from each tier (A, B, C)"
    - "All SVGs rendered via set:html have container divs with role='img' and aria-label"
    - "Every EDA page cites its NIST source section"
    - "Every formula matches the NIST source character-by-character"
    - "Every technique/distribution page has 200+ words of explanatory prose"
    - "All Python code examples are syntactically valid and include required imports"
    - "All cross-links between related techniques are functional (no 404s)"
  artifacts:
    - path: "src/components/eda/TechniquePage.astro"
      provides: "SVG accessibility attributes on all set:html containers"
      contains: "role=\"img\""
    - path: "src/components/eda/DistributionPage.astro"
      provides: "SVG accessibility attributes on static fallback container"
      contains: "role=\"img\""
  key_links:
    - from: "Technique pages"
      to: "Related technique pages"
      via: "cross-link slugs in technique data"
      pattern: "/eda/techniques/"
    - from: "Quantitative technique pages"
      to: "NIST handbook sections"
      via: "nistSection field in technique data"
      pattern: "nist.gov"
---

<objective>
Verify quality, accessibility, and performance of all EDA pages through automated audits and manual Lighthouse checks.

Purpose: This is the final quality gate before the EDA Visual Encyclopedia ships. Every page must meet WCAG 2.1 AA accessibility standards, Lighthouse 90+ scores, formula accuracy requirements, content completeness thresholds, and cross-link integrity. This plan fixes any issues found during the audit.

Output: Verified Lighthouse scores, fixed accessibility issues, validated formula accuracy, confirmed content completeness, and passing cross-link checks.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-site-integration-seo-polish/55-RESEARCH.md
@.planning/phases/55-site-integration-seo-polish/55-01-SUMMARY.md
@.planning/phases/55-site-integration-seo-polish/55-02-SUMMARY.md

@src/components/eda/TechniquePage.astro
@src/components/eda/DistributionPage.astro
@src/lib/eda/technique-content.ts
@src/lib/eda/quantitative-content.ts
@src/data/eda/techniques.json
@src/data/eda/distributions.json

<interfaces>
<!-- Key patterns the executor needs for auditing. -->

From src/components/eda/TechniquePage.astro (SVG rendering pattern):
```html
<!-- Current pattern -- check if role="img" + aria-label present -->
<div class="w-full overflow-hidden mb-3" set:html={svgMarkup} />
<!-- Should be: -->
<div role="img" aria-label="{technique.title} chart" class="w-full overflow-hidden mb-3" set:html={svgMarkup} />
```

From src/lib/eda/technique-content.ts:
```typescript
// Content keyed by slug, each has: definition, purpose, interpretation, assumptions, pythonCode
export const techniqueContent: Record<string, TechniqueContent> = { ... };
```

From src/lib/eda/quantitative-content.ts:
```typescript
// Content keyed by slug, each has: definition, formula, interpretation, assumptions, pythonCode
export const quantitativeContent: Record<string, QuantitativeContent> = { ... };
```

Lighthouse CLI pattern (from research):
```bash
# Must run against production build, NOT dev server
npx astro build && npx astro preview &
sleep 3
lighthouse http://localhost:4321/eda/techniques/box-plot/ \
  --output=json --chrome-flags="--headless" \
  --only-categories=performance,accessibility
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run quality audits and fix accessibility issues</name>
  <files>
    src/components/eda/TechniquePage.astro
    src/components/eda/DistributionPage.astro
    src/pages/eda/index.astro
  </files>
  <action>
    Run a comprehensive quality audit across all EDA pages. Fix any issues found.

    **SITE-11 -- SVG Accessibility:**
    Check all EDA template components (TechniquePage.astro, DistributionPage.astro, landing page) for `set:html` SVG injections. Every container div that uses `set:html` to inject SVG markup MUST have `role="img"` and a descriptive `aria-label`. The landing page cards already do this correctly (confirmed in 54-03) -- verify and replicate the pattern in technique and distribution pages.

    Specific checks:
    1. TechniquePage.astro: Find all `set:html` usages for SVG plots and variant panels. Add `role="img"` and `aria-label="{technique.title} statistical chart"` to container divs.
    2. DistributionPage.astro: Find the static SVG fallback container. Add `role="img"` and `aria-label="{distribution.title} probability density and cumulative distribution curves"`.
    3. Verify keyboard navigation: Tab through technique pages to confirm all interactive elements (PlotVariantSwap tabs, DistributionExplorer sliders) are keyboard accessible.

    **SITE-12 -- NIST Source Citations:**
    Run a build and check that every technique, distribution, foundation, case study, and reference page displays its NIST section reference. The TechniquePage and DistributionPage templates already render nistSection from the data. Verify foundations, case studies, and reference pages also cite NIST. If any page type is missing the citation, add it to its template.

    **QUAL-01 -- Formula Verification:**
    Write and run a Node.js script that:
    1. Reads `src/data/eda/distributions.json` and extracts all `pdfFormula` and `cdfFormula` fields
    2. Reads `src/lib/eda/quantitative-content.ts` and extracts all formula strings
    3. Outputs each formula with its source slug for manual verification against NIST
    4. Flag any obvious issues (unmatched braces, missing LaTeX commands, empty formulas)
    Run the script and fix any formula issues found. For manual verification, spot-check at least 5 representative formulas against the NIST source.

    **QUAL-02 -- Word Count:**
    Write and run a Node.js script that:
    1. Reads technique-content.ts and counts words for each technique (definition + purpose + interpretation + assumptions combined)
    2. Reads quantitative-content.ts and counts words similarly
    3. Flags any entry with fewer than 200 words
    If any entries are below 200 words, add supplementary prose to bring them above the threshold.

    **QUAL-03 -- Python Code Validation:**
    Write and run a script that extracts all Python code blocks from technique-content.ts and quantitative-content.ts. Check each for:
    1. Presence of import statements (matplotlib, seaborn, scipy, numpy as needed)
    2. Basic Python syntax validation (matching parentheses, no obvious syntax errors)
    3. Flag any code block missing imports or with obvious issues
    Fix any issues found.

    **QUAL-04 -- Cross-link Validation:**
    After building the site, validate cross-links by:
    1. Extract all `relatedTechniques` slugs from techniques.json
    2. Verify each slug resolves to an existing page in dist/eda/techniques/{slug}/index.html
    3. Check that distribution page cross-links to technique pages also resolve
    4. Flag any broken links
    Fix any broken cross-links found.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro build 2>&1 | tail -5 && grep -c 'role="img"' dist/eda/techniques/histogram/index.html && node -e "const t=require('fs').readFileSync('dist/eda/techniques/histogram/index.html','utf8'); console.log(t.includes('nist.gov') ? 'NIST citation found' : 'NIST citation MISSING')"</automated>
  </verify>
  <done>
    - All SVG containers in TechniquePage and DistributionPage have role="img" + aria-label
    - NIST source citations present on all EDA page types
    - Formula audit script ran with no critical issues (or issues fixed)
    - Word count audit confirms 200+ words per technique/distribution page
    - Python code audit shows no missing imports or syntax errors (or issues fixed)
    - Cross-link validation shows no broken links (or broken links fixed)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Lighthouse verification on representative pages</name>
  <what-built>
    Complete EDA Visual Encyclopedia integration: header nav link, homepage callout, JSON-LD structured data on all pages, OG images, companion blog post, LLMs.txt, and accessibility fixes.

    Before this checkpoint, Claude will run Lighthouse CLI against 3 representative pages:
    - Tier A (static SVG): http://localhost:4321/eda/techniques/box-plot/
    - Tier B (SVG swap): http://localhost:4321/eda/techniques/histogram/
    - Tier C (D3 explorer): http://localhost:4321/eda/distributions/normal/

    Process: `npx astro build && npx astro preview` then run Lighthouse in headless Chrome mode and report scores.
  </what-built>
  <how-to-verify>
    1. Review the Lighthouse scores reported by Claude. All three representative pages should score 90+ in Performance and Accessibility.
    2. Visit http://localhost:4321/ and verify:
       - "EDA" link appears in header navigation
       - Scroll to Reference Guides section -- 3 cards in a row (Beauty Index, DB Compass, EDA)
       - Click the EDA card -- navigates to /eda/ landing page
    3. Visit http://localhost:4321/eda/ and verify:
       - Category filter pills work (click Graphical, Quantitative, etc.)
       - Companion blog post link is visible
       - Cards display correctly with SVG thumbnails
    4. Visit http://localhost:4321/blog/ and verify:
       - "Exploratory Data Analysis: A Visual Encyclopedia" blog post appears
       - Click through and verify it has cross-links to EDA pages
    5. Right-click any EDA technique page > View Source > search for "application/ld+json" to verify JSON-LD is present
    6. Check /eda/ page source for OG image meta tag: `<meta property="og:image" content="...overview.png">`
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues that need fixing</resume-signal>
</task>

</tasks>

<verification>
1. Lighthouse Performance 90+ on Tier A, B, C pages
2. Lighthouse Accessibility 90+ on Tier A, B, C pages
3. All SVG containers have role="img" + aria-label
4. NIST citations present on all page types
5. No formula discrepancies found (or all fixed)
6. All pages have 200+ words of prose
7. Python code examples are syntactically complete
8. All cross-links resolve to valid pages
</verification>

<success_criteria>
- Lighthouse 90+ in Performance and Accessibility on 3 representative pages (one per tier)
- All accessibility fixes applied (SVG role="img", aria-label, keyboard nav)
- Quality audits complete: formulas verified, word counts met, Python code valid, cross-links working
- User visually confirms the complete integration (header, homepage, landing page, blog post, JSON-LD, OG images)
</success_criteria>

<output>
After completion, create `.planning/phases/55-site-integration-seo-polish/55-03-SUMMARY.md`
</output>
