---
phase: 19-code-comparison-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/beauty-index/code-features.ts
  - package.json
  - src/stores/tabStore.ts
  - src/components/beauty-index/CodeComparisonTabs.tsx
  - src/components/beauty-index/FeatureMatrix.astro
autonomous: true
requirements: [CODE-02, CODE-03, CODE-04, CODE-05]

must_haves:
  truths:
    - "Data structure exists defining 10 programming features with code snippets for 25 languages"
    - "Tab state can be managed client-side with minimal bundle size"
    - "Feature support matrix renders as a static table at build time"
    - "Tab UI responds to clicks and keyboard navigation"
  artifacts:
    - path: "src/data/beauty-index/code-features.ts"
      provides: "10 features with language-keyed snippets and support tracking"
      exports: ["CODE_FEATURES", "CodeFeature", "FeatureCodeSnippet"]
    - path: "src/stores/tabStore.ts"
      provides: "Nanostore for active tab index"
      exports: ["activeTab", "setActiveTab"]
    - path: "src/components/beauty-index/CodeComparisonTabs.tsx"
      provides: "React island managing tab buttons and panel visibility"
      min_lines: 80
    - path: "src/components/beauty-index/FeatureMatrix.astro"
      provides: "Build-time support matrix table component"
      contains: "<table"
  key_links:
    - from: "src/components/beauty-index/CodeComparisonTabs.tsx"
      to: "src/stores/tabStore.ts"
      via: "useStore hook from @nanostores/react"
      pattern: "useStore\\(activeTab\\)"
    - from: "src/components/beauty-index/FeatureMatrix.astro"
      to: "src/data/beauty-index/code-features.ts"
      via: "import CODE_FEATURES"
      pattern: "import.*CODE_FEATURES.*from.*code-features"
---

<objective>
Build the data foundation and interactive UI infrastructure for the code comparison page.

Purpose: Create the 10-feature dataset covering all 25 languages, install Nanostores for lightweight tab state management, and build the React tab UI component and feature support matrix table that will be assembled into the comparison page in Plan 02.

Output: Code features data structure, tab state management store, tab UI React island with ARIA support, and feature matrix table component.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-code-comparison-page/19-RESEARCH.md
@.planning/phases/16-data-foundation-chart-components/16-01-SUMMARY.md
@.planning/phases/17-overview-language-detail-pages/17-01-SUMMARY.md
@src/data/beauty-index/snippets.ts
@src/lib/beauty-index/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create code features data structure for 10 features × 25 languages</name>
  <files>src/data/beauty-index/code-features.ts</files>
  <action>
Create TypeScript data module exporting CODE_FEATURES array with 10 feature objects.

Each feature has:
- name: string (e.g., "Variable Declaration")
- description: string (1 sentence explaining the feature)
- snippets: Record<string, FeatureCodeSnippet | undefined> (25 language IDs as keys)

FeatureCodeSnippet interface extends existing CodeSnippet interface (lang, label, code) from snippets.ts.

10 features to include:
1. Variable Declaration - basic variable syntax and initialization
2. If/Else - conditional branching
3. Loops - for/while iteration patterns
4. Functions - function/method definition
5. Structs - data structure definition (classes, structs, records)
6. Pattern Matching - native pattern matching constructs (undefined for C, Java, JavaScript, PHP, others without native support)
7. Error Handling - try/catch or Result/Either patterns
8. String Interpolation - embedded expression syntax
9. List Operations - map/filter/reduce or equivalent
10. Signature Idiom - the characteristic code snippet from snippets.ts (reuse existing SNIPPETS data)

For Signature Idiom feature, import SNIPPETS from snippets.ts and use as-is. For other 9 features, write 5-12 line code examples demonstrating each feature in each language's idiomatic style.

Languages without certain features (e.g., C lacks pattern matching, JavaScript lacks native pattern matching before ES2024) should have undefined for that feature's snippet.

Export getFeatureSupport(featureIndex: number): string[] helper function that returns array of language IDs supporting that feature (useful for matrix).
  </action>
  <verify>
```bash
# Verify data file exists and exports correct shape
node -e "
const { CODE_FEATURES, getFeatureSupport } = require('./src/data/beauty-index/code-features.ts');
console.assert(CODE_FEATURES.length === 10, 'Should have 10 features');
console.assert(CODE_FEATURES[0].snippets.haskell, 'Haskell should have snippet for first feature');
console.assert(getFeatureSupport(0).length >= 20, 'Most languages should support basic features');
console.log('✓ CODE_FEATURES validates');
"
```
  </verify>
  <done>src/data/beauty-index/code-features.ts exists with 10 CodeFeature objects, each feature has snippets for ~20-25 languages (some features have undefined for unsupported languages), getFeatureSupport helper function works correctly</done>
</task>

<task type="auto">
  <name>Task 2: Install Nanostores and create tab state store</name>
  <files>package.json, src/stores/tabStore.ts</files>
  <action>
Install Nanostores dependencies:
```bash
npm install nanostores @nanostores/react
```

Create src/stores/tabStore.ts:

```typescript
import { atom } from 'nanostores';

/** Currently active tab index (0-9 for 10 features) */
export const activeTab = atom<number>(0);

/** Set the active tab index and sync DOM visibility */
export function setActiveTab(index: number) {
  activeTab.set(index);
}
```

Keep it minimal - just the atom and setter. Panel visibility sync will happen in CodeComparisonTabs component via useEffect.
  </action>
  <verify>
```bash
# Verify Nanostores installed
npm list nanostores @nanostores/react

# Verify store file exports correct shape
node -e "
const { activeTab, setActiveTab } = require('./src/stores/tabStore.ts');
console.assert(typeof setActiveTab === 'function', 'Should export setActiveTab function');
console.log('✓ Tab store validates');
"
```
  </verify>
  <done>package.json includes nanostores@^0.11.3 and @nanostores/react@^0.8.0, src/stores/tabStore.ts exports activeTab atom and setActiveTab function</done>
</task>

<task type="auto">
  <name>Task 3: Create CodeComparisonTabs React island and FeatureMatrix component</name>
  <files>src/components/beauty-index/CodeComparisonTabs.tsx, src/components/beauty-index/FeatureMatrix.astro</files>
  <action>
Create CodeComparisonTabs.tsx as React island (client:load):

Import useStore from @nanostores/react, activeTab and setActiveTab from tabStore.

Component accepts props: { features: string[], children: React.ReactNode }

Render structure:
- Outer container with tab UI + tab content area
- role="tablist" div with aria-label="Code feature comparison"
- Map features to button elements with full ARIA tab pattern:
  - role="tab"
  - id={`tab-${index}`}
  - aria-selected={currentTab === index}
  - aria-controls={`panel-${index}`}
  - tabIndex={currentTab === index ? 0 : -1} (roving tabindex)
  - onClick={() => setActiveTab(index)}
  - onKeyDown handler for arrow keys, Home, End
- children rendered in tab-content wrapper

useEffect to sync hidden attribute on [data-tab-panel] elements when activeTab changes (querySelectorAll, setAttribute/removeAttribute).

Keyboard navigation function:
- ArrowRight: next tab (wrap to 0)
- ArrowLeft: previous tab (wrap to length-1)
- Home: first tab
- End: last tab
- Move focus to new tab button after state change

Styling: Use existing Tailwind patterns from ScoringTable (button hover states, active indicators). Apply flex layout for horizontal tab row.

---

Create FeatureMatrix.astro as build-time component:

Import CODE_FEATURES from code-features.ts, getCollection('languages').

Render HTML table with:
- thead: Language column + 10 feature name columns
- tbody: 25 language rows
  - First cell: language name (bold)
  - Remaining cells: ✓ if feature.snippets[lang.data.id] exists, — if undefined
  - Use text-center class for checkmarks

Apply Tailwind table styling (border, padding, hover states) matching existing site aesthetic.
  </action>
  <verify>
```bash
# Verify TypeScript compiles
npm run build

# Check for ARIA roles in built component
grep -q 'role="tab"' dist/beauty-index/code/index.html || echo "Note: Page not yet created, will verify in Plan 02"

# Verify React island exports default component
node -e "console.log('✓ Components created')"
```
  </verify>
  <done>CodeComparisonTabs.tsx exists with complete WAI-ARIA tab pattern, keyboard navigation (arrow/Home/End keys), and panel visibility sync via useEffect; FeatureMatrix.astro exists rendering 25×10 support grid with ✓/— indicators; both components TypeScript-compile without errors</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Data validation:
   ```bash
   node -e "const { CODE_FEATURES } = require('./src/data/beauty-index/code-features.ts'); console.log('Features:', CODE_FEATURES.length, '✓');"
   ```

2. Dependency check:
   ```bash
   npm list nanostores @nanostores/react | grep -E '(nanostores|@nanostores/react)'
   ```

3. Component exports:
   ```bash
   ls -la src/components/beauty-index/CodeComparisonTabs.tsx src/components/beauty-index/FeatureMatrix.astro src/stores/tabStore.ts
   ```

4. Build passes:
   ```bash
   npm run build
   ```
</verification>

<success_criteria>
- CODE_FEATURES array contains 10 feature objects with language-specific code snippets
- Pattern Matching and other advanced features correctly have undefined for languages lacking native support
- Nanostores and @nanostores/react installed in package.json
- Tab state store exports atom and setter function
- CodeComparisonTabs React island implements full ARIA tab pattern with keyboard navigation
- FeatureMatrix renders checkmark grid showing feature support across all 25 languages
- TypeScript compilation succeeds with zero errors
- All files committed to git with atomic task commits
</success_criteria>

<output>
After completion, create `.planning/phases/19-code-comparison-page/19-01-SUMMARY.md`
</output>
