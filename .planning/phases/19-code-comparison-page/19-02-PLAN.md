---
phase: 19-code-comparison-page
plan: 02
type: execute
wave: 2
depends_on: [19-01]
files_modified:
  - src/pages/beauty-index/code/index.astro
autonomous: true
requirements: [CODE-01, CODE-04]

must_haves:
  truths:
    - "Visiting /beauty-index/code/ displays a tabbed interface with 10 feature tabs"
    - "Clicking a tab shows syntax-highlighted code blocks for all 25 languages"
    - "Only the active tab's content is visible at any time (hidden attribute on inactive panels)"
    - "Page loads and performs well on mobile devices (Lighthouse 90+)"
    - "Keyboard arrow keys navigate between tabs"
  artifacts:
    - path: "src/pages/beauty-index/code/index.astro"
      provides: "Complete code comparison page with all 250 code blocks"
      min_lines: 150
      contains: "<Code"
  key_links:
    - from: "src/pages/beauty-index/code/index.astro"
      to: "src/components/beauty-index/CodeComparisonTabs.tsx"
      via: "client:load directive for React island"
      pattern: "client:load"
    - from: "src/pages/beauty-index/code/index.astro"
      to: "astro:components Code"
      via: "Build-time syntax highlighting for 250 blocks"
      pattern: "<Code code=.*lang="
    - from: "src/pages/beauty-index/code/index.astro"
      to: "src/data/beauty-index/code-features.ts"
      via: "Import CODE_FEATURES for rendering"
      pattern: "import.*CODE_FEATURES"
---

<objective>
Assemble the complete code comparison page at /beauty-index/code/ with all 10 feature tabs and 250 build-time rendered code blocks.

Purpose: Combine the data, tab infrastructure, and matrix table from Plan 01 into a single Astro page that renders all 250 code blocks at build time, applies performance optimizations (content-visibility, hidden attribute), and delivers a responsive, accessible comparison experience.

Output: Fully functional code comparison page with tabbed navigation, syntax-highlighted code blocks for all 25 languages across 10 features, and feature support matrix table.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-code-comparison-page/19-RESEARCH.md
@.planning/phases/19-code-comparison-page/19-01-SUMMARY.md
@.planning/phases/16-data-foundation-chart-components/16-02-SUMMARY.md
@.planning/phases/17-overview-language-detail-pages/17-02-SUMMARY.md
@src/components/beauty-index/CodeComparisonTabs.tsx
@src/components/beauty-index/FeatureMatrix.astro
@src/data/beauty-index/code-features.ts
@src/stores/tabStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create code comparison page with 10 tabbed feature panels</name>
  <files>src/pages/beauty-index/code/index.astro</files>
  <action>
Create src/pages/beauty-index/code/index.astro following the Beauty Index page pattern from Phase 17-02.

Frontmatter:
- Import Layout from layouts
- Import { Code } from 'astro:components'
- Import type { BuiltinLanguage } from 'shiki'
- Import getCollection from 'astro:content'
- Import CODE_FEATURES from data/beauty-index/code-features.ts
- Import CodeComparisonTabs from components (React island)
- Import FeatureMatrix from components

Load data:
```typescript
const languages = await getCollection('languages');
const sortedLanguages = languages.sort((a, b) => b.data.totalScore - a.data.totalScore);
const features = CODE_FEATURES;
const featureNames = features.map(f => f.name);
```

Page structure:
1. Layout wrapper with title="Code Comparison | Beauty Index", description="Compare how 25 programming languages express the same concepts"

2. Hero section:
   - h1: "Code Comparison"
   - p: "See how 25 languages express the same programming concepts. Click tabs to switch features."

3. CodeComparisonTabs island (client:load) with features={featureNames}:
   - Map features.map((feature, featureIndex) => ...)
   - Each feature renders a div with:
     - data-tab-panel={featureIndex}
     - hidden={featureIndex !== 0} (only first tab visible initially)
     - role="tabpanel"
     - aria-labelledby={`tab-${featureIndex}`}
     - id={`panel-${featureIndex}`}
     - inline style: `content-visibility: auto; contain-intrinsic-size: 0 500px;` (performance optimization per research)

   - Inside each panel:
     - h2: {feature.name}
     - p: {feature.description}
     - Grid of language code blocks (grid-cols-1 md:grid-cols-2 gap-6)
     - Map sortedLanguages.map(lang => ...):
       - Get snippet: `const snippet = feature.snippets[lang.data.id];`
       - If snippet exists:
         ```astro
         <div class="language-block">
           <h3 class="text-lg font-semibold mb-2">{lang.data.name}</h3>
           <Code code={snippet.code} lang={snippet.lang as BuiltinLanguage} />
         </div>
         ```
       - If snippet is undefined (language doesn't support feature):
         ```astro
         <div class="language-block opacity-50">
           <h3 class="text-lg font-semibold mb-2">{lang.data.name}</h3>
           <p class="text-sm text-muted">Feature not supported</p>
         </div>
         ```

4. Feature Matrix section (below tabs):
   - h2: "Feature Support Matrix"
   - p: "Quick reference showing which languages support which features"
   - <FeatureMatrix /> component

Apply Tailwind styling:
- Container max-w-7xl mx-auto px-4
- Generous section spacing (space-y-12)
- Code blocks with dark background matching existing Expressive Code theme
- Language block borders/cards with hover states

SEO meta tags via Layout props (title, description).

Do NOT add navigation links yet - that's Phase 21's scope.
  </action>
  <verify>
```bash
# Verify page builds successfully
npm run build

# Check build output for page
ls -la dist/beauty-index/code/index.html

# Verify all 10 tab panels rendered
grep -c 'data-tab-panel=' dist/beauty-index/code/index.html | grep -E '^10$'

# Verify Code component used for syntax highlighting
grep -c '<Code' src/pages/beauty-index/code/index.astro | grep -E '^[0-9]+$'

# Verify content-visibility applied to panels
grep -q 'content-visibility: auto' dist/beauty-index/code/index.html

# Check file size (should be large due to 250 code blocks but gzip-friendly)
wc -c dist/beauty-index/code/index.html
```
  </verify>
  <done>/beauty-index/code/ route exists and renders 10 tab panels with data-tab-panel attributes, first panel visible (hidden=false), remaining panels hidden (hidden=true), all code blocks syntax-highlighted via Astro Code component, content-visibility optimization applied, FeatureMatrix table rendered below tabs, unsupported features show "Feature not supported" message, page builds without errors</done>
</task>

<task type="auto">
  <name>Task 2: Verify performance and accessibility</name>
  <files>None (verification only)</files>
  <action>
Run build and verify page quality:

1. Build the site:
   ```bash
   npm run build
   ```

2. Serve locally:
   ```bash
   npx astro preview
   ```

3. Open http://localhost:4321/beauty-index/code/ in browser

4. Manual checks:
   - Tab clicking switches visible panel (only one visible at a time)
   - Keyboard arrow keys navigate between tabs
   - Code blocks are syntax-highlighted with correct colors
   - Feature support matrix displays below tabs
   - Languages without feature support show "Feature not supported" message
   - Page is responsive on mobile viewport (DevTools responsive mode)

5. Lighthouse audit (mobile):
   ```bash
   # Use Chrome DevTools Lighthouse panel on http://localhost:4321/beauty-index/code/
   # Target: 90+ Performance, Accessibility, Best Practices, SEO
   ```

If Lighthouse Performance < 90:
- Check content-visibility is applied
- Verify hidden attribute on inactive panels
- Confirm no client-side syntax highlighting libraries loaded

If Accessibility < 90:
- Check ARIA roles (tab, tablist, tabpanel)
- Verify aria-selected, aria-controls, aria-labelledby
- Test keyboard navigation
- Check color contrast on code blocks

Document results in commit message. Performance/accessibility polish is Phase 21's scope if needed.
  </action>
  <verify>
```bash
# Build must succeed
npm run build || echo "Build failed - fix errors before proceeding"

# Page file must exist
test -f dist/beauty-index/code/index.html && echo "✓ Page built successfully"

# Verify interactive elements present
grep -q 'role="tab"' dist/beauty-index/code/index.html && echo "✓ Tab ARIA roles present"
grep -q 'data-tab-panel=' dist/beauty-index/code/index.html && echo "✓ Tab panels present"
```
  </verify>
  <done>npm run build succeeds, /beauty-index/code/index.html exists in dist/, page loads in browser, tab switching works via mouse and keyboard, code blocks display with syntax highlighting, feature matrix table renders, manual verification confirms responsive layout and basic accessibility (detailed audit in Phase 21)</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Route accessibility:
   ```bash
   # Start dev server and curl the page
   npm run dev &
   sleep 5
   curl -I http://localhost:4321/beauty-index/code/ | grep "200 OK"
   killall node
   ```

2. Content validation:
   ```bash
   # Verify 10 panels exist
   grep -c 'data-tab-panel=' dist/beauty-index/code/index.html

   # Verify Code components rendered
   grep -c 'class="expressive-code' dist/beauty-index/code/index.html

   # Verify FeatureMatrix rendered
   grep -q 'Feature Support Matrix' dist/beauty-index/code/index.html
   ```

3. Performance check:
   ```bash
   # File size (gzipped HTML should be reasonable)
   gzip -c dist/beauty-index/code/index.html | wc -c
   ```

4. Interactivity check (manual):
   - Open page in browser
   - Click each of 10 tabs
   - Use arrow keys to navigate
   - Verify only one panel visible at a time
   - Check mobile responsive layout
</verification>

<success_criteria>
- /beauty-index/code/ route accessible and renders successfully
- 10 tab buttons render with correct ARIA attributes
- 10 tab panels exist with data-tab-panel attributes and hidden state
- All 250 code blocks syntax-highlighted at build time (no client-side highlighting)
- content-visibility: auto applied to tab panels for performance
- Feature support matrix table displays below tabs showing ✓/— for each language-feature combo
- Tab switching works via mouse clicks and keyboard arrow/Home/End keys
- Only active tab panel visible at any time (hidden attribute toggled)
- Page builds successfully and loads in browser without console errors
- Mobile layout responsive (grid collapses to single column)
- TypeScript and Astro build pass with zero errors
- All files committed to git with atomic task commits
</success_criteria>

<output>
After completion, create `.planning/phases/19-code-comparison-page/19-02-SUMMARY.md`
</output>
