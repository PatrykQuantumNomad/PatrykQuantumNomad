---
phase: 21-seo-launch-readiness
plan: 03
type: execute
wave: 2
depends_on: [21-01, 21-02]
files_modified: []
autonomous: false
requirements: [SEO-06, SEO-07]

must_haves:
  truths:
    - "Lighthouse Performance score is 90+ on overview, detail, and code comparison pages"
    - "Lighthouse Accessibility score is 90+ on all 3 page types"
    - "Lighthouse Best Practices score is 90+ on all 3 page types"
    - "Lighthouse SEO score is 90+ on all 3 page types"
    - "Keyboard navigation works across all interactive elements (sort, tabs, links)"
  artifacts: []
  key_links: []
---

<objective>
Run Lighthouse audits on all 3 Beauty Index page types and fix any issues to ensure all scores are 90+. Verify keyboard navigation and screen reader accessibility across all interactive elements.

Purpose: Final quality gate ensuring the Beauty Index meets production-ready performance, accessibility, SEO, and best practices standards before launch.
Output: Lighthouse audit results with all scores 90+. Any issues found are fixed in-place.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-seo-launch-readiness/21-RESEARCH.md
@.planning/phases/21-seo-launch-readiness/21-01-SUMMARY.md
@.planning/phases/21-seo-launch-readiness/21-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build site and run Lighthouse audits on 3 Beauty Index page types</name>
  <files></files>
  <action>
  1. Build the site: `npx astro build`
  2. Start the preview server: `npx astro preview &` (runs on localhost:4321 by default)
  3. Wait a few seconds for the server to start, then run Lighthouse on 3 pages:

  ```bash
  npx lighthouse http://localhost:4321/beauty-index/ --output=json --output-path=./lighthouse-overview.json --chrome-flags="--headless --no-sandbox" --quiet
  npx lighthouse http://localhost:4321/beauty-index/python/ --output=json --output-path=./lighthouse-detail.json --chrome-flags="--headless --no-sandbox" --quiet
  npx lighthouse http://localhost:4321/beauty-index/code/ --output=json --output-path=./lighthouse-code.json --chrome-flags="--headless --no-sandbox" --quiet
  ```

  If `lighthouse` is not available globally, install it: `npm install -g lighthouse`

  4. Extract scores from each JSON result:
  ```bash
  node -e "const r=require('./lighthouse-overview.json'); const c=r.categories; console.log('Overview:', 'Perf:', Math.round(c.performance.score*100), 'A11y:', Math.round(c.accessibility.score*100), 'BP:', Math.round(c['best-practices'].score*100), 'SEO:', Math.round(c.seo.score*100))"
  ```
  (Repeat for detail and code JSONs)

  5. If ALL scores are 90+ across all 3 pages, the task passes. Document the scores.

  6. If any score is below 90, identify the failing audits:
  ```bash
  node -e "const r=require('./lighthouse-overview.json'); r.audits && Object.values(r.audits).filter(a => a.score !== null && a.score < 1).forEach(a => console.log(a.id, a.score, a.title))"
  ```

  7. Kill the preview server when done: `kill %1` or find and kill the process.

  8. Clean up: Delete lighthouse JSON files (do not commit them).

  **Expected issues from research:**
  - Code comparison page may flag "Avoid an excessive DOM size" (informational, mitigated by content-visibility: auto)
  - Accessibility gaps should already be fixed by plans 01 and 02 (sr-only data, button-based sort, breadcrumbs)
  - SEO score should improve from JSON-LD structured data added in plan 01

  If Lighthouse cannot be installed or run in this environment, skip to Task 2 which verifies accessibility manually.
  </action>
  <verify>Lighthouse JSON output files exist and scores extracted. All 4 categories at 90+ across all 3 pages, OR failing audits documented for Task 2 to fix.</verify>
  <done>Lighthouse audit complete for all 3 Beauty Index page types. Scores documented. Any issues below 90 identified.</done>
</task>

<task type="auto">
  <name>Task 2: Fix any Lighthouse issues and verify accessibility</name>
  <files></files>
  <action>
  **If all Lighthouse scores are 90+ from Task 1:** This task is a verification-only pass. Run `npx astro build` to confirm a clean build and document the final scores.

  **If any Lighthouse scores are below 90:** Fix the specific failing audits. Common fixes:

  - **Missing button labels:** Add `aria-label` to any buttons lacking accessible names
  - **Missing link text:** Ensure all `<a>` elements have discernible text content
  - **Color contrast:** Adjust any colors below 4.5:1 contrast ratio for text
  - **Missing lang attribute:** Already present on `<html>` via Layout.astro
  - **Missing meta description:** Already present via SEOHead.astro
  - **Image alt text:** Verify all `<img>` elements have alt attributes

  **Accessibility manual checks (regardless of Lighthouse scores):**
  Verify these in the built HTML output (grep the dist/ files):

  1. ScoringTable: Confirm `<button>` elements inside `<th>`, `aria-sort` on sorted column, `aria-live="polite"` region
  2. Radar charts: Confirm sr-only `<dl>` elements with dimension scores adjacent to SVG charts on detail pages
  3. Bar chart: Confirm descriptive `aria-label` on the wrapper div on the overview page
  4. Visual breadcrumbs: Confirm `<nav aria-label="Breadcrumb">` present on all 3 page types
  5. BreadcrumbJsonLd: Confirm `BreadcrumbList` JSON-LD script tags on all 3 page types
  6. Code comparison tabs: Already implement WAI-ARIA tab pattern with roving tabindex (verified in Phase 19)
  7. All interactive elements: Confirm no `tabindex="-1"` on elements that should be keyboard-reachable

  After any fixes, rebuild: `npx astro build`
  </action>
  <verify>Run `npx astro build` -- zero errors. If Lighthouse was run, all scores 90+. Accessibility elements confirmed in generated HTML.</verify>
  <done>All Lighthouse scores at 90+ (or documented if Lighthouse unavailable). Accessibility audit confirms: keyboard-accessible sort, sr-only chart data, proper ARIA attributes, breadcrumb navigation on all Beauty Index pages.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: User verification of complete SEO and accessibility integration</name>
  <files></files>
  <action>
  Present the user with verification steps for all Phase 21 work across all 3 plans. The user should verify navigation, structured data, breadcrumbs, cross-links, accessibility, and Lighthouse scores by following the steps in how-to-verify.
  </action>
  <verify>User confirms all items pass visual and functional inspection.</verify>
  <done>User types "approved" confirming Phase 21 is complete.</done>
  <what-built>
  Complete SEO and accessibility integration for the Beauty Index section:
  - Site navigation includes "Beauty Index" link
  - Structured data (Dataset/ItemList + Breadcrumb JSON-LD) on all pages
  - Visual breadcrumb navigation on all Beauty Index pages
  - Homepage callout section linking to Beauty Index
  - Blog cross-links from 2 posts
  - Accessible ScoringTable with keyboard sort and ARIA announcements
  - Screen reader data alternatives for radar charts
  - Lighthouse scores at 90+ across all categories
  </what-built>
  <how-to-verify>
  1. Visit the site locally (`npm run dev` or `npx astro dev`)
  2. Check the header navigation -- "Beauty Index" should appear between Blog and Projects
  3. Click "Beauty Index" in the nav -- should go to /beauty-index/
  4. On the overview page, verify:
     - Visual breadcrumbs show "Home / Beauty Index" above the title
     - View page source: search for "Dataset" to confirm JSON-LD
     - Tab to the scoring table headers and press Enter to sort -- should work via keyboard
  5. Click any language (e.g., Python) to go to a detail page:
     - Visual breadcrumbs show "Home / Beauty Index / Python"
  6. Navigate to /beauty-index/code/ -- verify breadcrumbs show "Home / Beauty Index / Code Comparison"
  7. Return to homepage -- verify Beauty Index callout section appears between "What I Build" and "Latest Writing"
  8. Visit /blog/building-kubernetes-observability-stack/ -- scroll to bottom, verify Beauty Index cross-link
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 21, or describe any issues to fix.</resume-signal>
</task>

</tasks>

<verification>
- `npx astro build` completes with zero errors
- Lighthouse scores documented for all 3 page types (target: 90+ on all categories)
- Keyboard navigation verified on ScoringTable sort
- Screen reader data alternatives confirmed in HTML
- All SEO requirements (01-07) satisfied
</verification>

<success_criteria>
- Lighthouse Performance, Accessibility, Best Practices, and SEO all score 90+ on overview, detail, and code comparison pages
- Keyboard navigation works for ScoringTable sort, code comparison tabs, and all links
- Screen readers can access chart data via sr-only alternatives
- User visually confirms navigation, breadcrumbs, cross-links, and structured data
</success_criteria>

<output>
After completion, create `.planning/phases/21-seo-launch-readiness/21-03-SUMMARY.md`
</output>
