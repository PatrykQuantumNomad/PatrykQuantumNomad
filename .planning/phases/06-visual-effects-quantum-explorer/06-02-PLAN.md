---
phase: 06-visual-effects-quantum-explorer
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/styles/global.css
  - src/layouts/Layout.astro
  - src/pages/index.astro
  - src/pages/about.astro
  - src/pages/contact.astro
  - src/pages/projects/index.astro
  - src/pages/blog/index.astro
autonomous: true

must_haves:
  truths:
    - "Page sections animate into view (fade up) as the user scrolls down on every page"
    - "Scroll reveal animations trigger once per element and do not re-trigger when scrolling back up"
    - "Users with prefers-reduced-motion see all sections fully visible with no animation"
    - "Scroll reveals re-initialize correctly after view transition navigation via astro:page-load"
    - "Sections above the fold on initial load are visible without waiting for scroll"
  artifacts:
    - path: "src/styles/global.css"
      provides: "Scroll reveal CSS classes (.reveal, .revealed) with reduced-motion override"
      contains: ".reveal"
    - path: "src/layouts/Layout.astro"
      provides: "Global Intersection Observer script that initializes on astro:page-load"
      contains: "initScrollReveal"
  key_links:
    - from: "src/layouts/Layout.astro"
      to: "src/styles/global.css"
      via: ".reveal CSS class used by Intersection Observer adding .revealed"
      pattern: "revealed"
    - from: "src/layouts/Layout.astro"
      to: "astro:page-load"
      via: "document.addEventListener('astro:page-load', initScrollReveal)"
      pattern: "astro:page-load.*initScrollReveal"
    - from: "src/pages/index.astro"
      to: "src/styles/global.css"
      via: "reveal class on section elements"
      pattern: "class=.*reveal"
    - from: "src/pages/about.astro"
      to: "src/styles/global.css"
      via: "reveal class on section elements"
      pattern: "class=.*reveal"
---

<objective>
Add scroll-triggered reveal animations to all page sections across the site. Implement the CSS classes and Intersection Observer in the global layer (global.css + Layout.astro), then apply the `reveal` class to content sections on every page.

Purpose: Scroll reveals add polish and visual depth as users explore the site, making the browsing experience feel dynamic without heavy animation libraries.

Output: global.css gains .reveal/.revealed CSS classes with reduced-motion override. Layout.astro gains a global Intersection Observer script. All page sections animate in on scroll.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-visual-effects-quantum-explorer/06-RESEARCH.md
@.planning/phases/06-visual-effects-quantum-explorer/06-01-SUMMARY.md
@src/layouts/Layout.astro
@src/styles/global.css
@src/pages/index.astro
@src/pages/about.astro
@src/pages/contact.astro
@src/pages/projects/index.astro
@src/pages/blog/index.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll reveal CSS and global Intersection Observer script</name>
  <files>src/styles/global.css, src/layouts/Layout.astro</files>
  <action>
**global.css additions:**

Add the following AFTER the existing `@layer base` block:

```css
/* Scroll Reveal Animations */
.reveal {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}
.reveal.revealed {
  opacity: 1;
  transform: translateY(0);
}
@media (prefers-reduced-motion: reduce) {
  .reveal {
    opacity: 1;
    transform: none;
    transition: none;
  }
}
```

The `.reveal` class starts elements hidden and shifted 20px down. The `.revealed` class (added by JS) fades them in and slides them to position. The reduced-motion media query overrides both opacity and transform to show everything immediately with no animation.

**Layout.astro script addition:**

Add a NEW `<script>` tag (NOT is:inline -- use a module script) BEFORE the closing `</body>` tag. Module scripts run once and persist across ClientRouter navigations, which is exactly what we want for the observer setup:

```html
<script>
  function initScrollReveal() {
    const elements = document.querySelectorAll('.reveal:not(.revealed)');
    if (!elements.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
    );

    elements.forEach((el) => observer.observe(el));
  }

  document.addEventListener('astro:page-load', initScrollReveal);
</script>
```

Key details:
- Uses `astro:page-load` which fires on initial load AND after each ClientRouter navigation.
- Queries only `.reveal:not(.revealed)` so already-revealed elements are skipped (idempotent).
- `observer.unobserve` after reveal prevents re-triggering.
- The `rootMargin: '0px 0px -50px 0px'` ensures elements trigger slightly before they reach the viewport bottom, creating a natural "reveal as you scroll into view" feel.
- `threshold: 0.1` means 10% of the element must be visible before triggering.
  </action>
  <verify>
Run `npm run build` -- build succeeds.
Verify `grep "reveal" src/styles/global.css` shows .reveal and .revealed classes.
Verify `grep "initScrollReveal" src/layouts/Layout.astro` shows the script.
Verify `grep "astro:page-load" src/layouts/Layout.astro` confirms the event listener.
  </verify>
  <done>
global.css contains .reveal/.revealed CSS classes with transition and reduced-motion override. Layout.astro contains a module script with Intersection Observer that initializes on astro:page-load, compatible with ClientRouter navigation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply reveal class to sections across all pages</name>
  <files>src/pages/index.astro, src/pages/about.astro, src/pages/contact.astro, src/pages/projects/index.astro, src/pages/blog/index.astro</files>
  <action>
Add the `reveal` class to content sections on each page. Do NOT add `reveal` to the hero section on the home page (it should be immediately visible). Apply to sections that are below the fold and benefit from scroll-triggered entrance.

**src/pages/index.astro:**
- Hero section: Do NOT add reveal (must be visible immediately).
- "What I Build" section (`<section>` with h2 "What I Build"): Add `reveal` to the `<section>` tag's class list.
- "Latest Writing" section: Add `reveal` to the `<section>` tag's class list.
- "Contact CTA" section: Add `reveal` to the `<section>` tag's class list.

For each section, just append `reveal` to the existing class string. For example:
`<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16 reveal">`

**src/pages/about.astro:**
The about page has a single `<section>` wrapping everything. Instead of revealing the whole section, add `reveal` to the inner content divs:
- The introduction `<div>` (flex container with PG avatar): Add `reveal`.
- The "Tech Stack" `<div class="mb-16">`: Add `reveal`.
- The "Career Highlights" `<div class="mb-16">`: Add `reveal`.
- The "Let's Connect" `<div>`: Add `reveal`.

**src/pages/projects/index.astro:**
- The page header (h1 + description paragraph): Do NOT add reveal (above the fold).
- Each project category group `<div>` (rendered by the `.map()`): Add `reveal` to the outer div. The existing code is `<div class={idx > 0 ? 'mt-12' : ''}>` -- update to include `reveal` in both cases. The simplest approach: change to `<div class={\`${idx > 0 ? 'mt-12' : ''} reveal\`}>` or use a template literal/conditional that always includes `reveal`.

**src/pages/blog/index.astro:**
- Read the file first. The blog listing likely has a header and article cards. Add `reveal` to each blog article card or to a wrapper around the card list if one exists.

**src/pages/contact.astro:**
- Read the file first. Add `reveal` to the main content sections below the page heading.

Do NOT modify blog/[slug].astro -- individual blog post pages have a single content flow that does not benefit from section reveals.
  </action>
  <verify>
Run `npm run build` -- build succeeds.
Run `npm run dev` and visit each page:
- `/` -- "What I Build", "Latest Writing", and "Contact CTA" sections should fade in on scroll. Hero should be immediately visible.
- `/about/` -- Introduction, Tech Stack, Career Highlights, Let's Connect should reveal on scroll.
- `/projects/` -- Each project category group should reveal on scroll.
- `/blog/` -- Blog cards should reveal on scroll.
- `/contact/` -- Content sections should reveal on scroll.
- Enable `prefers-reduced-motion: reduce` in dev tools -- all sections should be fully visible with no animation.
- Navigate between pages using nav links -- reveals should work on each page after transition.
  </verify>
  <done>
All pages have scroll-triggered reveal animations on below-the-fold sections. Hero sections remain immediately visible. Reveals work after ClientRouter navigation. Reduced-motion users see all content immediately.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors.
2. On every page, sections below the fold animate in (fade + slide up) as user scrolls down.
3. Scrolling back up does NOT re-trigger animations -- elements stay revealed.
4. After navigating between pages via ClientRouter, scroll reveals work on the destination page.
5. With `prefers-reduced-motion: reduce`, all sections are immediately visible with no animation on any page.
6. Hero section on home page is always immediately visible (no reveal delay).
7. Page load performance is not noticeably impacted (Intersection Observer is efficient).
</verification>

<success_criteria>
- Scroll reveal CSS classes exist in global.css with proper reduced-motion fallback
- Intersection Observer script runs on initial load and after every view transition
- Home page: 3 below-the-fold sections have reveal animations
- About page: 4 content blocks have reveal animations
- Projects page: each category group has reveal animation
- Blog listing: cards have reveal animation
- Contact page: content sections have reveal animation
- No reveals on hero sections or above-the-fold content
- Reduced-motion preference fully respected
</success_criteria>

<output>
After completion, create `.planning/phases/06-visual-effects-quantum-explorer/06-02-SUMMARY.md`
</output>
