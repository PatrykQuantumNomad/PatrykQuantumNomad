---
phase: 38-rule-documentation-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/tools/compose-validator/rules/index.ts
  - src/lib/tools/compose-validator/rules/related.ts
  - src/pages/tools/compose-validator/rules/[code].astro
  - src/components/tools/compose-results/ComposeViolationList.tsx
autonomous: true
requirements: [DOC-01, DOC-02, DOC-03, DOC-04]

must_haves:
  truths:
    - "Navigating to /tools/compose-validator/rules/cv-c001/ loads a documentation page with title, severity badge, category badge, expert explanation, fix suggestion, before/after YAML code, and related rules"
    - "All 52 rules (44 custom + 8 schema) each have their own documentation page generated at build time"
    - "Each rule page has a unique SEO meta description derived from the rule explanation"
    - "Rule IDs in the violation list link to their documentation pages"
  artifacts:
    - path: "src/lib/tools/compose-validator/rules/index.ts"
      provides: "allDocumentedRules combined array (52 rules) for getStaticPaths"
      exports: ["allDocumentedRules", "allComposeRules", "getComposeRuleById"]
    - path: "src/lib/tools/compose-validator/rules/related.ts"
      provides: "getRelatedComposeRules utility for same-category rule lookups"
      exports: ["getRelatedComposeRules"]
    - path: "src/pages/tools/compose-validator/rules/[code].astro"
      provides: "Dynamic route generating 52 static rule documentation pages"
      contains: "getStaticPaths"
    - path: "src/components/tools/compose-results/ComposeViolationList.tsx"
      provides: "Rule ID anchor links to documentation pages"
      contains: "compose-validator/rules/"
  key_links:
    - from: "src/pages/tools/compose-validator/rules/[code].astro"
      to: "src/lib/tools/compose-validator/rules/index.ts"
      via: "import allDocumentedRules for getStaticPaths"
      pattern: "allDocumentedRules\\.map"
    - from: "src/pages/tools/compose-validator/rules/[code].astro"
      to: "src/lib/tools/compose-validator/rules/related.ts"
      via: "import getRelatedComposeRules for related rules section"
      pattern: "getRelatedComposeRules"
    - from: "src/components/tools/compose-results/ComposeViolationList.tsx"
      to: "/tools/compose-validator/rules/"
      via: "anchor href on rule ID"
      pattern: "compose-validator/rules/"
---

<objective>
Create 52 per-rule SEO documentation pages for the Docker Compose Validator at /tools/compose-validator/rules/[code], with expert explanations, fix suggestions, before/after YAML code blocks, related rules, and breadcrumb structured data -- plus wire rule ID links from the violation list.

Purpose: Each of the 52 compose validation rules gets its own indexed documentation page, providing SEO value (52 long-tail keyword pages) and user value (deep documentation accessible from the validator results). This mirrors the proven Dockerfile Analyzer pattern from Phase 25.

Output: 52 static HTML pages at /tools/compose-validator/rules/{code}/, related rules utility, combined rule registry, and clickable rule ID links in the violation list.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/38-rule-documentation-pages/38-RESEARCH.md

@src/pages/tools/dockerfile-analyzer/rules/[code].astro
@src/lib/tools/dockerfile-analyzer/rules/related.ts
@src/lib/tools/compose-validator/rules/index.ts
@src/lib/tools/compose-validator/rules/schema/index.ts
@src/lib/tools/compose-validator/types.ts
@src/components/tools/compose-results/ComposeViolationList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create combined rule registry and related-rules utility</name>
  <files>
    src/lib/tools/compose-validator/rules/index.ts
    src/lib/tools/compose-validator/rules/related.ts
  </files>
  <action>
1. Modify `src/lib/tools/compose-validator/rules/index.ts`:
   - Import `schemaRules` from `./schema`
   - Import `SchemaRuleMetadata` type from `../types`
   - Create a unified type alias `DocumentedRule` that represents the common documentation shape shared by ComposeLintRule and SchemaRuleMetadata: `{ id: string; title: string; severity: ComposeSeverity; category: ComposeCategory; explanation: string; fix: ComposeRuleFix }`
   - Export a new `allDocumentedRules` array that merges `allComposeRules` (cast to DocumentedRule[]) and `schemaRules` (cast to DocumentedRule[]) -- 52 total
   - Keep existing `allComposeRules`, `getComposeRuleById` exports unchanged

2. Create `src/lib/tools/compose-validator/rules/related.ts`:
   - Clone the pattern from `src/lib/tools/dockerfile-analyzer/rules/related.ts`
   - Import `allDocumentedRules` and `DocumentedRule` type from `./index`
   - Import `ComposeSeverity` type from `../types`
   - Define `SEVERITY_ORDER: Record<ComposeSeverity, number>` mapping error=0, warning=1, info=2
   - Export `getRelatedComposeRules(ruleId: string, limit = 5): DocumentedRule[]` that:
     a. Finds the rule by ID in allDocumentedRules
     b. Filters to same-category rules excluding self
     c. Sorts by severity priority (error first)
     d. Returns up to `limit` results
  </action>
  <verify>Run `npx astro build 2>&1 | tail -20` -- build must succeed with no type errors in the modified/created files.</verify>
  <done>allDocumentedRules exports 52 rules (44 custom + 8 schema). getRelatedComposeRules returns same-category rules sorted by severity. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create rule documentation pages and wire violation list links</name>
  <files>
    src/pages/tools/compose-validator/rules/[code].astro
    src/components/tools/compose-results/ComposeViolationList.tsx
  </files>
  <action>
1. Create `src/pages/tools/compose-validator/rules/[code].astro`:
   - Clone structure from `src/pages/tools/dockerfile-analyzer/rules/[code].astro` exactly
   - Change imports to compose-validator paths:
     - `import { allDocumentedRules } from '../../../../lib/tools/compose-validator/rules/index'`
     - `import { getRelatedComposeRules } from '../../../../lib/tools/compose-validator/rules/related'`
     - `import type { ComposeSeverity, ComposeCategory } from '../../../../lib/tools/compose-validator/types'`
     - `import type { DocumentedRule } from '../../../../lib/tools/compose-validator/rules/index'`
   - getStaticPaths: map allDocumentedRules, params `{ code: rule.id.toLowerCase() }`, props `{ rule }`
   - Interface Props uses `DocumentedRule` type (not LintRule)
   - severityLabel: same as Dockerfile (error/warning/info)
   - categoryLabel: adapt for compose categories:
     `{ schema: 'Schema', security: 'Security', semantic: 'Semantic', 'best-practice': 'Best Practice', style: 'Style' }`
   - severityColor: same as Dockerfile pattern (bg-red-100/text-red-700, bg-amber-100/text-amber-700, bg-blue-100/text-blue-700)
   - pageTitle: `${rule.id}: ${rule.title} -- Docker Compose Validator`
   - pageDesc: truncate explanation at 155 chars + '...'
   - pageUrl: `/tools/compose-validator/rules/${rule.id.toLowerCase()}/`
   - BreadcrumbJsonLd crumbs: Home > Tools > Compose Validator > Rules > [Rule Code]
     - Home: https://patrykgolabek.dev/
     - Tools: https://patrykgolabek.dev/tools/
     - Compose Validator: https://patrykgolabek.dev/tools/compose-validator/
     - Rule: pageUrl
   - Code blocks: use `lang="yaml"` (not "dockerfile")
   - Footer back-links:
     - Left: "&larr; Try the Compose Validator" linking to /tools/compose-validator/
     - Right: No blog post link yet (blog post is Phase 40 -- leave this out or use a placeholder comment)
   - Related rules section: use getRelatedComposeRules(rule.id) and link to `/tools/compose-validator/rules/${related.id.toLowerCase()}/`

2. Modify `src/components/tools/compose-results/ComposeViolationList.tsx`:
   - In the ComposeViolationItem component, change the rule ID from a plain `<span>` to an anchor `<a>`:
     - Replace the `<span className="font-mono text-xs text-[var(--color-accent)]">{violation.ruleId}</span>`
     - With: `<a href={'/tools/compose-validator/rules/' + violation.ruleId.toLowerCase() + '/'} className="font-mono text-xs text-[var(--color-accent)] hover:underline" onClick={(e) => e.stopPropagation()}>{violation.ruleId}</a>`
     - The onClick stopPropagation prevents the details/summary toggle when clicking the link
   - Remove the comment about "compose rule pages do not exist yet (Phase 38)"
  </action>
  <verify>
1. Run `npx astro build 2>&1 | tail -30` -- build must succeed and generate 52 rule pages
2. Run `ls dist/tools/compose-validator/rules/ | wc -l` -- should show 52 directories
3. Run `cat dist/tools/compose-validator/rules/cv-c001/index.html | grep -o '<title>.*</title>'` -- should contain "CV-C001: Privileged Mode -- Docker Compose Validator"
4. Run `cat dist/tools/compose-validator/rules/cv-s001/index.html | grep -o 'lang="yaml"'` -- should find yaml syntax blocks
  </verify>
  <done>52 rule documentation pages generated at /tools/compose-validator/rules/{code}/. Each page has title, severity badge, category badge, explanation, fix description, before/after YAML code with syntax highlighting, related rules with interlinks, and BreadcrumbJsonLd. Rule IDs in ComposeViolationList are clickable links to their documentation pages. Build produces 52 rule directories in dist/.</done>
</task>

</tasks>

<verification>
1. Build succeeds: `npx astro build` completes without errors
2. Page count: 52 directories under dist/tools/compose-validator/rules/
3. Content check: At least one page from each category (schema: cv-s001, security: cv-c001, semantic: cv-m001, best-practice: cv-b001, style: cv-f001) renders correctly with all sections
4. SEO: Each page has unique title and meta description in the HTML output
5. Related rules: Rule pages show related rules from the same category with working interlinks
6. Violation list links: ComposeViolationList renders rule IDs as anchor tags pointing to /tools/compose-validator/rules/{code}/
</verification>

<success_criteria>
- 52 static HTML pages exist at /tools/compose-validator/rules/{code}/ (44 custom + 8 schema)
- Each page contains: expert explanation, severity/category badges, fix suggestion with YAML before/after code, related rules section, breadcrumb JSON-LD
- Each page has a unique SEO meta description (truncated explanation)
- Rule IDs in ComposeViolationList are clickable links to their documentation pages
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/38-rule-documentation-pages/38-01-SUMMARY.md`
</output>
