---
phase: 36-results-panel-dependency-graph
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tools/ComposeResultsPanel.tsx
  - src/components/tools/compose-results/ComposeViolationList.tsx
  - src/components/tools/compose-results/ComposeCategoryBreakdown.tsx
  - src/components/tools/compose-results/ComposeEmptyState.tsx
  - src/components/tools/compose-results/GraphSkeleton.tsx
autonomous: true
requirements:
  - RESULT-01
  - RESULT-02
  - RESULT-03
  - RESULT-04
  - RESULT-05
  - RESULT-06
  - RESULT-07

must_haves:
  truths:
    - "Score gauge displays overall 0-100 score and letter grade after analysis"
    - "Category breakdown shows per-category sub-scores with compose categories (Security, Semantic, Best Practice, Schema, Style)"
    - "Violations are grouped by severity with expandable details and click-to-navigate"
    - "Clicking a violation line number scrolls the editor to that line with highlight flash"
    - "Clean compose file shows congratulatory empty state with score gauge"
    - "Tabbed panel shows Violations and Dependency Graph tabs"
    - "Stale results banner appears when editor content changes after analysis"
  artifacts:
    - path: "src/components/tools/ComposeResultsPanel.tsx"
      provides: "Tabbed results panel with violations view and graph tab placeholder"
      min_lines: 80
    - path: "src/components/tools/compose-results/ComposeViolationList.tsx"
      provides: "Compose-specific violation list wrapper with correct rule ID display (no links to nonexistent pages)"
      min_lines: 30
    - path: "src/components/tools/compose-results/ComposeCategoryBreakdown.tsx"
      provides: "Compose-specific category breakdown with correct category labels and colors"
      min_lines: 20
    - path: "src/components/tools/compose-results/ComposeEmptyState.tsx"
      provides: "Compose-specific empty state with congratulatory message"
      min_lines: 15
    - path: "src/components/tools/compose-results/GraphSkeleton.tsx"
      provides: "Loading skeleton for lazy-loaded graph tab"
      min_lines: 10
  key_links:
    - from: "src/components/tools/ComposeResultsPanel.tsx"
      to: "composeResult nanostore"
      via: "useStore(composeResult)"
      pattern: "useStore\\(composeResult\\)"
    - from: "src/components/tools/ComposeResultsPanel.tsx"
      to: "src/components/tools/results/ScoreGauge.tsx"
      via: "direct import and render"
      pattern: "ScoreGauge.*score.*grade"
    - from: "src/components/tools/compose-results/ComposeViolationList.tsx"
      to: "src/lib/tools/dockerfile-analyzer/highlight-line.ts"
      via: "highlightAndScroll called on violation click"
      pattern: "highlightAndScroll"
    - from: "src/components/tools/compose-results/ComposeViolationList.tsx"
      to: "composeEditorViewRef nanostore"
      via: "reads editor view for click-to-navigate"
      pattern: "composeEditorViewRef\\.get\\(\\)"
---

<objective>
Refactor the stub ComposeResultsPanel into a fully functional tabbed results panel with violations view, reusing shared ScoreGauge while creating compose-specific wrappers for CategoryBreakdown, ViolationList, and EmptyState.

Purpose: Users need to see their validation results in a rich, interactive format -- score gauge, category breakdown, severity-grouped violations with click-to-navigate, and tab structure ready for the dependency graph.
Output: Complete violations tab with all results display components, tabbed panel UI, and graph tab skeleton placeholder.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-results-panel-dependency-graph/36-RESEARCH.md

@src/components/tools/ComposeResultsPanel.tsx
@src/components/tools/ComposeEditorPanel.tsx
@src/components/tools/ResultsPanel.tsx
@src/components/tools/results/ScoreGauge.tsx
@src/components/tools/results/CategoryBreakdown.tsx
@src/components/tools/results/ViolationList.tsx
@src/components/tools/results/EmptyState.tsx
@src/stores/composeValidatorStore.ts
@src/lib/tools/compose-validator/types.ts
@src/lib/tools/dockerfile-analyzer/types.ts
@src/lib/tools/dockerfile-analyzer/highlight-line.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create compose-specific result wrapper components</name>
  <files>
    src/components/tools/compose-results/ComposeViolationList.tsx
    src/components/tools/compose-results/ComposeCategoryBreakdown.tsx
    src/components/tools/compose-results/ComposeEmptyState.tsx
    src/components/tools/compose-results/GraphSkeleton.tsx
  </files>
  <action>
Create 4 new files in src/components/tools/compose-results/:

1. **ComposeViolationList.tsx** -- Thin wrapper around the violation list pattern for compose types. Must NOT link rule IDs to rule pages (compose rule pages do not exist yet -- Phase 38 creates them). Instead, display rule IDs as plain styled text (font-mono, accent color, no anchor tag). Accept `violations: ComposeLintViolation[]` and `onNavigate: (line: number) => void` props. Reuse the same severity grouping pattern from the existing ViolationList (group by severity, order error > warning > info, expandable details with explanation and before/after code). The `onNavigate` callback is wired by the parent (ComposeResultsPanel) using `composeEditorViewRef.get()` + `highlightAndScroll()`.

Key differences from the Dockerfile ViolationList:
- Import `ComposeLintViolation` from compose-validator types (NOT `LintViolation` from dockerfile types)
- Rule ID displayed as `<span>` not `<a>` (no link to rule pages)
- Same severity colors, severity icons, expandable details pattern

2. **ComposeCategoryBreakdown.tsx** -- Wrapper providing compose-specific category labels and colors. Accept `categories: ComposeCategoryScore[]`. Map compose categories to labels: security -> "Security", semantic -> "Semantic", "best-practice" -> "Best Practice", schema -> "Schema", style -> "Style". Map to colors: security -> "#ef4444", semantic -> "#8b5cf6", "best-practice" -> "#06b6d4", schema -> "#f59e0b", style -> "#84cc16". Render the same bar layout as the shared CategoryBreakdown (label, progress bar, score number). Do NOT import the shared CategoryBreakdown -- build the compose-specific version directly since the type systems differ (ComposeCategoryScore vs CategoryScore have different category union types).

3. **ComposeEmptyState.tsx** -- Similar to the existing EmptyState but with compose-specific copy: "No Issues Found" heading, "This Docker Compose file follows best practices. Great configuration!" paragraph. Import and render ScoreGauge from the shared results/ directory (it accepts generic score/grade props and works as-is). Accept `score: number` and `grade: string` props.

4. **GraphSkeleton.tsx** -- Suspense fallback skeleton for the lazy-loaded dependency graph. Render a centered container (min-h-[400px]) with a pulsing placeholder: an SVG icon suggesting a graph/network (3 circles connected by lines) with "Loading dependency graph..." text below. Use animate-pulse class and theme-consistent colors (var(--color-text-secondary), var(--color-border)).
  </action>
  <verify>
Run `npx tsc --noEmit` -- all 4 new files compile without type errors. Verify file count: `ls src/components/tools/compose-results/` shows 4 files.
  </verify>
  <done>
All 4 compose-specific wrapper components exist, compile cleanly, and use correct compose types (ComposeLintViolation, ComposeCategoryScore). ComposeViolationList has no anchor tags for rule IDs. ComposeCategoryBreakdown has all 5 compose category labels and colors. ComposeEmptyState shows compose-specific congratulatory copy. GraphSkeleton shows a loading skeleton.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor ComposeResultsPanel into tabbed panel with full violations view</name>
  <files>
    src/components/tools/ComposeResultsPanel.tsx
  </files>
  <action>
Replace the existing stub ComposeResultsPanel with a full tabbed results panel. Follow the Dockerfile ResultsPanel pattern (src/components/tools/ResultsPanel.tsx) as the structural reference, but add tab UI on top.

**Tab structure:**
- Two tabs: "Violations" (default active) and "Dependency Graph"
- Tab state via `useState<'violations' | 'graph'>('violations')`
- Tab bar: flex row with 2 buttons, styled with border-b, active tab gets accent border-bottom (border-b-2 border-[var(--color-accent)]) and primary text color, inactive gets secondary text color and transparent border
- Tab content area below, switching between violations view and graph placeholder

**Violations tab content (when activeTab === 'violations'):**
Read from nanostores: `useStore(composeResult)`, `useStore(composeAnalyzing)`, `useStore(composeResultsStale)`.

State handling (same flow as Dockerfile ResultsPanel):
1. `analyzing === true` -> show "Analyzing..." pulse text
2. `result === null` -> show "Click Analyze to validate your Docker Compose file" prompt
3. `result.parseSuccess === false` -> show "YAML parse error -- check your syntax" in red
4. `result.violations.length === 0` -> show ComposeEmptyState with score/grade
5. Otherwise -> show full results: ScoreGauge + ComposeCategoryBreakdown + violation summary + ComposeViolationList

For case 5, render:
- Stale banner at top if `stale === true` (same amber styling as Dockerfile ResultsPanel)
- Flex row: ScoreGauge (size=100, from shared results/ScoreGauge) + ComposeCategoryBreakdown (flex-1)
- Violation count summary line: "{N} issue(s) found ({X errors, Y warnings, Z info})"
- ComposeViolationList with onNavigate callback

**Click-to-navigate wiring:**
```typescript
const handleNavigate = (line: number) => {
  const view = composeEditorViewRef.get();
  if (!view) return;
  highlightAndScroll(view, line);
};
```
Import `highlightAndScroll` from `../../lib/tools/dockerfile-analyzer/highlight-line` and `composeEditorViewRef` from `../../stores/composeValidatorStore`.

**Graph tab content (when activeTab === 'graph'):**
For now, render GraphSkeleton as a static placeholder (not inside Suspense yet -- Plan 36-02 will add the lazy-loaded DependencyGraph and replace this). Show a message: "Dependency graph will be available after analysis" if result is null, otherwise show GraphSkeleton with text "Graph visualization loading..." to establish the tab structure.

**Severity summary helper:**
Create a local `severitySummary(violations)` function matching the pattern in the Dockerfile ResultsPanel -- counts by severity, returns formatted string like "3 errors, 2 warnings, 1 info".

**Important:** Keep the same outer container structure (`flex flex-col h-full`) since ComposeValidator.tsx relies on it for the grid layout. The header "Results" text can be removed (the tabs serve as the header now) or kept above the tabs.
  </action>
  <verify>
Run `npx tsc --noEmit` -- ComposeResultsPanel compiles without errors. Run `npm run build` -- Astro builds successfully. Manually verify in dev server (`npm run dev`) that /tools/compose-validator/ loads, clicking Analyze shows score gauge + category breakdown + violation list, clicking a violation line number scrolls the editor, and the Graph tab switches to show the skeleton placeholder.
  </verify>
  <done>
ComposeResultsPanel renders a tabbed panel with Violations and Dependency Graph tabs. The Violations tab displays ScoreGauge, ComposeCategoryBreakdown, violation summary, and ComposeViolationList with click-to-navigate. Empty state shows ComposeEmptyState. Stale banner appears on content change. Graph tab shows placeholder skeleton. All state flows through nanostores. RESULT-01 (inline annotations from Phase 35) verified as working. RESULT-02 through RESULT-07 all functional.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` completes successfully
3. Navigate to /tools/compose-validator/ in dev server
4. Click Analyze -- score gauge appears with letter grade and 0-100 score (RESULT-02)
5. Category breakdown shows 5 compose categories with correct labels and colors (RESULT-03)
6. Violations grouped by severity with expandable details showing explanation and before/after code (RESULT-04)
7. Click violation line number -- editor scrolls to that line with yellow flash highlight (RESULT-05)
8. Edit the sample to remove all issues -- empty state shows "No Issues Found" with gauge (RESULT-06)
9. Both "Violations" and "Dependency Graph" tabs are visible and switchable (RESULT-07)
10. Squiggly underlines and gutter markers appear in editor on analysis (RESULT-01, verify Phase 35 work persists)
</verification>

<success_criteria>
- All 7 RESULT requirements addressed (RESULT-01 verified, RESULT-02 through RESULT-07 implemented)
- 5 files created/modified, all compile cleanly
- Score gauge, category breakdown, violation list, click-to-navigate, empty state, and tabbed UI all functional
- Graph tab placeholder ready for Plan 36-02 to wire in the actual dependency graph
</success_criteria>

<output>
After completion, create `.planning/phases/36-results-panel-dependency-graph/36-01-SUMMARY.md`
</output>
