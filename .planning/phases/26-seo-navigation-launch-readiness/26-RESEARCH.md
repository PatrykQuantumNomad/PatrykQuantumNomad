# Phase 26: SEO, Navigation & Launch Readiness - Research

**Researched:** 2026-02-20
**Domain:** Astro site navigation, JSON-LD structured data (SoftwareApplication), sitemap integration, Lighthouse auditing, WCAG 2.1 AA accessibility for CodeMirror editors
**Confidence:** HIGH

## Summary

Phase 26 is the final integration phase for the Dockerfile Analyzer (v1.4). It covers 8 requirements spanning navigation (NAV-01, NAV-02), structured data (SEO-01), homepage cross-linking (SEO-02), sitemap (SEO-03), meta descriptions (SEO-04), performance auditing (SEO-05), and accessibility auditing (SEO-06). This phase directly mirrors Phase 21 (SEO & Launch Readiness for the Beauty Index), and every pattern needed has already been established and verified in the codebase.

No new libraries need to be installed. The codebase already has all building blocks: `BreadcrumbJsonLd.astro` (used on blog and Beauty Index pages), `SEOHead.astro` (used on all pages via `Layout.astro`), `Header.astro` (with a `navLinks` array that currently has 6 entries), `@astrojs/sitemap` integration (auto-includes all static pages), and 6 existing JSON-LD component patterns (`PersonJsonLd`, `BlogPostingJsonLd`, `ProjectsJsonLd`, `BeautyIndexJsonLd`, `FAQPageJsonLd`, `BreadcrumbJsonLd`). The Dockerfile Analyzer tool page and 39 rule documentation pages already use `Layout.astro`, so canonical URLs and OG tags are handled.

The primary work is: (1) adding "Dockerfile Analyzer" to the header nav and updating the navLinks array, (2) adding visual breadcrumbs + BreadcrumbJsonLd to the tool page (rule pages already have both), (3) creating a new `DockerfileAnalyzerJsonLd.astro` component with SoftwareApplication schema, (4) adding a homepage callout section following the Beauty Index callout pattern, (5) verifying all 41 pages appear in the sitemap, (6) ensuring the tool page meta description is SEO-optimized and all 39 rule pages already have dynamic meta descriptions, (7) running Lighthouse and fixing any issues, and (8) auditing keyboard/screen reader accessibility including the CodeMirror Tab escape mechanism.

The accessibility work (SEO-06) has a unique challenge compared to Phase 21: CodeMirror 6 is a React island (`client:only="react"`) with complex keyboard interactions. CodeMirror 6 was designed from the start with accessibility in mind and does NOT capture the Tab key by default (passing WCAG 2.1.2 "No Keyboard Trap"). Users can also press Escape then Tab to move focus out. The current implementation uses `basicSetup` which includes the default keymap with `toggleTabFocusMode` (Ctrl-M / Shift-Alt-M on macOS). The results panel uses standard HTML elements (buttons, details/summary, links) that are natively keyboard-accessible.

**Primary recommendation:** Implement as 3 sub-plans matching the Phase 21 structure: (1) Navigation + structured data + sitemap + meta descriptions (NAV-01, NAV-02, SEO-01, SEO-03, SEO-04), (2) Homepage callout (SEO-02), (3) Lighthouse audit + accessibility fixes (SEO-05, SEO-06). No new dependencies required.

<phase_requirements>
## Phase Requirements

| ID | Description | Research Support |
|----|-------------|-----------------|
| NAV-01 | Header navigation link for Dockerfile Analyzer | Header.astro has a `navLinks` array (currently 6 items); add `{ href: '/tools/dockerfile-analyzer/', label: 'Dockerfile Analyzer' }` or a "Tools" parent. Adding a 7th item needs careful consideration for desktop nav width. |
| NAV-02 | Breadcrumb navigation on tool page and rule documentation pages | Rule pages (`[code].astro`) already have visual breadcrumbs and BreadcrumbJsonLd. Tool page (`index.astro`) needs both added. Follow existing pattern from rule pages. |
| SEO-01 | JSON-LD structured data (SoftwareApplication schema) on tool page | Create `DockerfileAnalyzerJsonLd.astro` following existing JSON-LD component pattern. Use `SoftwareApplication` type with `applicationCategory: "DeveloperApplication"`, `operatingSystem: "Web Browser"`, `offers: { price: "0" }`. |
| SEO-02 | Homepage callout linking to the Dockerfile Analyzer | Add a callout section on homepage following the exact Beauty Index callout pattern (lines 154-165 of `src/pages/index.astro`). |
| SEO-03 | All tool and rule pages in sitemap | `@astrojs/sitemap` auto-includes all static pages. Rule pages are generated by `getStaticPaths` and auto-included. Verification only. |
| SEO-04 | SEO-optimized meta descriptions for tool page and all 40 rule pages | Tool page already has a description (line 8 of `index.astro`). Rule pages have dynamic descriptions from `rule.explanation` (truncated to 155 chars). Review and optimize both. |
| SEO-05 | Lighthouse 90+ audit on tool page | Run Lighthouse on the tool page. Key risk: CodeMirror is `client:only="react"` so the page renders a shell until JS hydrates. Lighthouse will see the unhydrated state. |
| SEO-06 | Accessibility audit (keyboard navigation, screen reader, WCAG 2.1 AA) | CodeMirror 6 doesn't trap Tab by default (WCAG 2.1.2 compliant). Verify: results panel elements keyboard-reachable, score gauge has aria-label, violation list details are expandable, rule page links have descriptive text. |
</phase_requirements>

## Standard Stack

### Core

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| `@astrojs/sitemap` | Already installed | Auto-generates sitemap-index.xml for all static pages | Already configured in astro.config.mjs; tool and rule pages auto-included |
| `BreadcrumbJsonLd.astro` | Existing component | Renders BreadcrumbList JSON-LD | Already used on blog pages, Beauty Index pages, and rule pages |
| `SEOHead.astro` | Existing component | Meta tags, OG tags, canonical URLs | Already used on all pages via Layout.astro |
| `Layout.astro` | Existing component | Page shell with SEOHead, header, footer | All Dockerfile Analyzer pages already use this |

### Supporting

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| Lighthouse CI | CLI tool | Automated performance/accessibility/SEO auditing | Run against built site to verify SEO-05 scores |
| Chrome DevTools Accessibility Inspector | Built-in | Manual WCAG 2.1 AA verification | For keyboard navigation and screen reader testing |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Custom SoftwareApplication JSON-LD component | `schema-dts` TypeScript types | Unnecessary dependency for 1 JSON-LD type; hand-written is simpler and consistent with 6 existing JSON-LD components in the codebase |
| Adding "Tools" dropdown nav | Direct "Dockerfile Analyzer" link | Dropdown adds complexity; direct link matches how Beauty Index was added |
| Adding "Tools" as a nav entry linking to `/tools/` | "Dockerfile Analyzer" direct link | No `/tools/` landing page exists; would need to create one. Direct link is simpler. If a Tools landing page is desired later, it can be added in a future phase. |

**Installation:** None required. All dependencies already present.

## Architecture Patterns

### File Structure (Changes Only)

```
src/
├── components/
│   ├── Header.astro                           # EDIT: Add Dockerfile Analyzer to navLinks
│   └── DockerfileAnalyzerJsonLd.astro         # NEW: SoftwareApplication JSON-LD
├── pages/
│   ├── index.astro                            # EDIT: Add Dockerfile Analyzer callout section
│   └── tools/
│       └── dockerfile-analyzer/
│           ├── index.astro                    # EDIT: Add BreadcrumbJsonLd + visual breadcrumbs + DockerfileAnalyzerJsonLd
│           └── rules/
│               └── [code].astro               # ALREADY HAS: BreadcrumbJsonLd + visual breadcrumbs
```

### Pattern 1: Adding Navigation Link (NAV-01)

**What:** Add "Dockerfile Analyzer" to the site header navigation.

**When to use:** When a new top-level section needs global navigation presence.

**Key Decision — Nav item count:** The nav currently has 6 items: Home, Blog, Beauty Index, Projects, About, Contact. Adding a 7th item labeled "Dockerfile Analyzer" (19 characters) is the longest label and may cause layout pressure on medium-width desktop viewports. Three options:

**Option A (Recommended): Add "Tools" nav link pointing to `/tools/dockerfile-analyzer/`**
```astro
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/blog/', label: 'Blog' },
  { href: '/beauty-index/', label: 'Beauty Index' },
  { href: '/tools/dockerfile-analyzer/', label: 'Tools' },
  { href: '/projects/', label: 'Projects' },
  { href: '/about/', label: 'About' },
  { href: '/contact/', label: 'Contact' },
];
```
Short label, keeps 7 items manageable. The `isActive` logic (`currentPath.startsWith(link.href)`) would NOT work here because the href is deep (`/tools/dockerfile-analyzer/`), but `startsWith` would still correctly highlight for `/tools/dockerfile-analyzer/rules/dl3006/` etc. Issue: if more tools are added later, the `/tools/dockerfile-analyzer/` href would need to become `/tools/`. For now it works.

**Option B: Add full label "Dockerfile Analyzer"**
```astro
{ href: '/tools/dockerfile-analyzer/', label: 'Dockerfile Analyzer' },
```
Most descriptive but adds 19-character label to a 7-item nav. May wrap on medium screens. The nav already handles overflow via the hamburger menu on mobile.

**Option C: Create a `/tools/` landing page and use "Tools" nav link**
```astro
{ href: '/tools/', label: 'Tools' },
```
Requires creating `src/pages/tools/index.astro` as a tools landing page. More future-proof but adds scope to this phase.

**Recommendation:** Option A — use the "Tools" label pointing to `/tools/dockerfile-analyzer/` as the only tool. The nav currently uses short labels (Home, Blog, Projects, About, Contact) with "Beauty Index" being the longest at 12 characters. "Tools" at 5 characters fits naturally. If more tools are added in the future, create a `/tools/` landing page then. The `isActive` highlighting will correctly activate for all `/tools/dockerfile-analyzer/` subpaths because the `currentPath.startsWith(link.href)` check works with the deep href.

**Source:** Verified from `src/components/Header.astro` lines 7-14 and 44. The `isActive` logic on line 44 is: `const isActive = currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href));`

### Pattern 2: JSON-LD SoftwareApplication Schema (SEO-01)

**What:** Add structured data to the tool page using schema.org SoftwareApplication type.

**When to use:** On the `/tools/dockerfile-analyzer/` page.

**Implementation:** Create `src/components/DockerfileAnalyzerJsonLd.astro`:

```astro
---
const schema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Dockerfile Analyzer",
  "description": "Free browser-based Dockerfile linter and best-practice analyzer. 39 rules across security, efficiency, maintainability, reliability, and best practices. 100% client-side — your code never leaves your browser.",
  "url": "https://patrykgolabek.dev/tools/dockerfile-analyzer/",
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Web Browser",
  "softwareVersion": "1.0",
  "featureList": [
    "39 lint rules based on Hadolint DL codes and production Kubernetes experience",
    "Category-weighted scoring with letter grades (A+ through F)",
    "Inline CodeMirror annotations with severity-colored gutter markers",
    "100% client-side analysis — no data transmitted",
    "Dockerfile syntax highlighting",
    "Click-to-navigate from findings to source lines"
  ],
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "author": {
    "@type": "Person",
    "@id": "https://patrykgolabek.dev/#person"
  },
  "isPartOf": {
    "@type": "WebSite",
    "@id": "https://patrykgolabek.dev/#website"
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
```

**Source:** Pattern follows existing JSON-LD components (`BeautyIndexJsonLd.astro`, `ProjectsJsonLd.astro`). SoftwareApplication properties verified from [schema.org/SoftwareApplication](https://schema.org/SoftwareApplication). The `offers` with `price: "0"` communicates "free" to search engines, which can improve rich result display.

### Pattern 3: Breadcrumb Navigation on Tool Page (NAV-02)

**What:** Add visual breadcrumbs and BreadcrumbJsonLd to the tool page. Rule pages already have both.

**Current state:**
- Tool page (`index.astro`): NO breadcrumbs at all
- Rule pages (`[code].astro`): Already has visual breadcrumbs (lines 56-68) and BreadcrumbJsonLd (lines 176-181) with hierarchy: Home > Tools > Dockerfile Analyzer > Rules > [Code]

**Implementation for tool page:**

Visual breadcrumbs (add before the `<h1>`):
```astro
<nav aria-label="Breadcrumb" class="mb-4 text-sm text-[var(--color-text-secondary)]">
  <ol class="flex flex-wrap items-center gap-1">
    <li><a href="/" class="hover:text-[var(--color-accent)] transition-colors">Home</a></li>
    <li aria-hidden="true" class="mx-1">/</li>
    <li><a href="/tools/" class="hover:text-[var(--color-accent)] transition-colors">Tools</a></li>
    <li aria-hidden="true" class="mx-1">/</li>
    <li><span aria-current="page" class="text-[var(--color-text-primary)] font-medium">Dockerfile Analyzer</span></li>
  </ol>
</nav>
```

BreadcrumbJsonLd (add inside Layout, at end before closing `</Layout>`):
```astro
<BreadcrumbJsonLd crumbs={[
  { name: 'Home', url: siteBase },
  { name: 'Tools', url: `${siteBase}/tools/` },
  { name: 'Dockerfile Analyzer', url: `${siteBase}/tools/dockerfile-analyzer/` },
]} />
```

Note: The visual breadcrumbs include a "Tools" link to `/tools/` even though no `/tools/` landing page exists. This is acceptable — the breadcrumb serves as a navigation hint and the URL can be created later. Alternatively, make "Tools" non-linked text. The rule pages already link to `/tools/` in their breadcrumbs (line 60 of `[code].astro`), so maintaining consistency is important. Given that no `/tools/` page exists, the breadcrumb link will 404. **Decision needed: either make "Tools" in breadcrumbs a non-clickable span, or create a minimal `/tools/` redirect page.**

**Recommendation:** Make "Tools" in the breadcrumb a non-clickable text span (not an anchor) for now, OR create a minimal redirect from `/tools/` to `/tools/dockerfile-analyzer/`. The simplest approach: update both tool page and rule page breadcrumbs to use a non-linked "Tools" text element. However, the rule pages already use `<a href="/tools/">` — changing this would be a modification to Phase 25's output. The pragmatic choice is to create a minimal `/tools/index.astro` that redirects to `/tools/dockerfile-analyzer/`:

```astro
---
// Redirect /tools/ to the only tool available
return Astro.redirect('/tools/dockerfile-analyzer/', 301);
---
```

This approach keeps the breadcrumb links functional and works correctly if more tools are added later.

**Source:** Verified from `src/pages/tools/dockerfile-analyzer/rules/[code].astro` lines 56-68 (existing visual breadcrumb pattern) and lines 176-181 (existing BreadcrumbJsonLd usage). The `siteBase` pattern is from line 49 of the same file.

### Pattern 4: Homepage Callout (SEO-02)

**What:** Add a Dockerfile Analyzer callout section on the homepage.

**When to use:** For prominent internal cross-linking from the homepage.

**Existing Beauty Index callout pattern (lines 154-165 of `src/pages/index.astro`):**
```astro
{/* Beauty Index Callout */}
<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-8 mb-8 pt-2" data-reveal>
  <a href="/beauty-index/" class="block card-hover p-6 rounded-lg border border-[var(--color-border)] no-underline" data-tilt>
    <article>
      <h3 class="text-lg font-heading font-bold text-[var(--color-text-primary)]">The Beauty Index</h3>
      <p class="meta-mono mt-2">2026 Edition</p>
      <p class="text-sm text-[var(--color-text-secondary)] mt-2">
        25 programming languages ranked across 6 aesthetic dimensions. From Haskell's mathematical purity to PHP's industrial grit.
      </p>
    </article>
  </a>
</section>
```

**Dockerfile Analyzer callout (add after Beauty Index callout, before the gradient divider):**
```astro
{/* Dockerfile Analyzer Callout */}
<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mb-8 pt-2" data-reveal>
  <a href="/tools/dockerfile-analyzer/" class="block card-hover p-6 rounded-lg border border-[var(--color-border)] no-underline" data-tilt>
    <article>
      <h3 class="text-lg font-heading font-bold text-[var(--color-text-primary)]">Dockerfile Analyzer</h3>
      <p class="meta-mono mt-2">Free Browser Tool</p>
      <p class="text-sm text-[var(--color-text-secondary)] mt-2">
        Paste your Dockerfile, get instant best-practice feedback from a Kubernetes architect. 39 rules across security, efficiency, and maintainability. 100% client-side.
      </p>
    </article>
  </a>
</section>
```

**Placement:** After the Beauty Index callout (line 165) and before the gradient divider (line 167). This groups the two "featured content" callouts together on the homepage.

### Pattern 5: Meta Description Optimization (SEO-04)

**What:** Ensure all tool and rule pages have SEO-optimized meta descriptions.

**Current state:**
- Tool page (`index.astro` line 8): `description="Paste your Dockerfile and get instant best-practice analysis from a Kubernetes architect. 100% client-side — your code never leaves your browser."` — 143 characters, already good. Contains action verb, value proposition, and privacy differentiator.
- Rule pages (`[code].astro` lines 44-47): Uses `rule.explanation` truncated to 155 characters. Each rule has a unique explanation so descriptions are unique and relevant. Already SEO-appropriate.
- Blog post (`dockerfile-best-practices.mdx` line 3): `description="A production-tested guide to writing secure, efficient, and maintainable Dockerfiles."` — Already good.

**Optimization opportunity:** The tool page description could be slightly enhanced with keyword terms:
```
"Free Dockerfile linter and best-practice analyzer by a Kubernetes architect. 39 rules for security, efficiency, and maintainability. 100% browser-based — your code never leaves your device."
```
This adds "Dockerfile linter" (high-value search term), "free" (conversion signal), and "39 rules" (specificity).

### Anti-Patterns to Avoid

- **Hardcoding sitemap entries for tool/rule pages.** The `@astrojs/sitemap` integration auto-discovers all static pages. Adding `customPages` entries would create duplicates. The `customPages` array is only for external subdomain apps.
- **Adding a dropdown/submenu nav.** The nav uses a flat list. Adding dropdowns changes the component architecture significantly. A simple flat link is consistent.
- **Using `WebApplication` instead of `SoftwareApplication`.** `WebApplication` is a valid subtype of `SoftwareApplication`, but Google's documentation and rich result tooling better recognizes `SoftwareApplication`. Both are acceptable; `SoftwareApplication` is more commonly used.
- **Adding too many nav items.** 7 items (Home, Blog, Beauty Index, Tools, Projects, About, Contact) is the practical maximum. The Beauty Index callout already has 7; adding an 8th would be excessive.
- **Skipping the `/tools/` redirect page.** Without it, the breadcrumb link to `/tools/` on rule pages (already deployed from Phase 25) produces a 404. This is a pre-existing issue that Phase 26 should fix.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Breadcrumb JSON-LD | Custom schema builder | `BreadcrumbJsonLd.astro` component | Already exists, tested, used on 30+ pages |
| Sitemap entries | Manual XML or `customPages` config | `@astrojs/sitemap` auto-discovery | Static pages auto-included; manual would create duplicates |
| Meta tags (title, description, OG, Twitter) | Custom meta component | `SEOHead.astro` via `Layout.astro` | All tool pages already use this |
| Canonical URLs | Manual URL construction | `SEOHead.astro` auto-computes from `Astro.url` | Already working for all pages |
| Tab escape in CodeMirror | Custom keyboard handler | CodeMirror 6 built-in behavior | Default config does NOT capture Tab; Escape+Tab always escapes |
| Homepage callout styling | Custom card component | Existing Beauty Index callout pattern | Identical markup with different content |

**Key insight:** Phase 26 is structurally identical to Phase 21. Every infrastructure component exists. The work is: (1) connecting existing pieces to Dockerfile Analyzer pages and (2) running quality audits. The only new component is `DockerfileAnalyzerJsonLd.astro`.

## Common Pitfalls

### Pitfall 1: Nav Item Count Causing Desktop Layout Overflow

**What goes wrong:** Adding a 7th navigation item with a long label causes text wrapping or overflow on medium-width desktop viewports (768px-1024px).

**Why it happens:** The desktop nav uses `flex items-center gap-6` with no text truncation. 7 items with a 19-character label ("Dockerfile Analyzer") plus existing items may exceed available space.

**How to avoid:** Use a short label ("Tools" = 5 characters) instead of the full name. The `isActive` logic still works because it uses `startsWith` against the href, not the label.

**Warning signs:** Nav items wrapping to two lines on medium screens. Labels being clipped or overlapping the logo.

### Pitfall 2: Breadcrumb Links to Non-Existent `/tools/` Page

**What goes wrong:** Rule pages (from Phase 25) already have breadcrumbs with `<a href="/tools/">` linking to a page that does not exist. Users clicking "Tools" in the breadcrumb get a 404.

**Why it happens:** The rule page breadcrumbs were designed assuming a `/tools/` landing page would exist.

**How to avoid:** Create a minimal `src/pages/tools/index.astro` that either redirects to `/tools/dockerfile-analyzer/` (simplest) or renders a minimal tools listing page. This also makes the BreadcrumbJsonLd `url` for "Tools" valid.

**Warning signs:** 404 responses for `/tools/` in server logs. Broken link warnings from SEO tools.

### Pitfall 3: CodeMirror Client-Only Rendering Hurting Lighthouse Scores

**What goes wrong:** The Dockerfile Analyzer uses `client:only="react"` which means the editor and results panel render NOTHING on the server. Lighthouse sees an empty `<div>` where the tool should be. This can hurt Performance (Largest Contentful Paint) and potentially Accessibility scores.

**Why it happens:** CodeMirror 6 cannot be SSR'd (it requires DOM APIs). The `client:only` directive intentionally skips SSR. Lighthouse in its headless mode will wait for JavaScript to execute, but the initial HTML has no meaningful content in the tool area.

**How to avoid:** This is inherent to the architecture and accepted. Lighthouse should still score well because:
1. The page has meaningful server-rendered content (h1, description paragraph, aside with links, breadcrumbs)
2. CodeMirror 6 initializes quickly (no network requests needed)
3. The page layout is defined by Astro (header, footer, main content area) so LCP is the h1/description text, not the editor

If Lighthouse Performance dips below 90, the fix is to ensure the server-rendered portion of the page is substantial enough to have a fast LCP. The current h1 + description + aside text should suffice.

**Warning signs:** LCP element reported as the CodeMirror container instead of the h1. Performance below 90 on tool page specifically.

### Pitfall 4: Duplicate JSON-LD on Tool Page

**What goes wrong:** Adding `DockerfileAnalyzerJsonLd` to the tool page alongside the existing `WebSite` JSON-LD from `Layout.astro` causes concerns about conflicting schemas.

**Why it happens:** Misunderstanding of JSON-LD — multiple script tags are valid and encouraged. Google explicitly supports multiple JSON-LD blocks per page.

**How to avoid:** This is NOT actually a problem. The page will have: (1) `WebSite` JSON-LD from Layout, (2) `SoftwareApplication` JSON-LD from DockerfileAnalyzerJsonLd, (3) `BreadcrumbList` JSON-LD from BreadcrumbJsonLd. All three are independent and correct.

**Warning signs:** None — this is a non-issue, listed here to prevent unnecessary "fixing."

### Pitfall 5: Missing aria-label on Score Gauge After Analysis

**What goes wrong:** The `ScoreGauge` component renders an SVG gauge with `aria-hidden="true"` and a text overlay with `aria-label`. However, the overlay div uses `aria-label` which is not always announced by screen readers on non-interactive elements.

**Why it happens:** The `aria-label` on a `<div>` without a `role` is technically invalid per ARIA spec — `aria-label` is primarily for interactive elements or elements with landmark roles.

**How to avoid:** Add `role="status"` to the score overlay div (or wrap the score in a `<p>` element) so the `aria-label` is properly announced. Alternatively, use `role="img"` on the parent container and move the `aria-label` there.

**Warning signs:** Screen readers announce nothing for the score gauge. Lighthouse accessibility audit flags "aria-label on non-interactive element."

### Pitfall 6: CodeMirror Tab Key Confusion for Users

**What goes wrong:** Users expect Tab to indent code in the editor, but CodeMirror 6 by default does NOT capture Tab (for accessibility). Pressing Tab moves focus to the next element.

**Why it happens:** CodeMirror 6 intentionally does not handle Tab by default to comply with WCAG 2.1.2 "No Keyboard Trap." This is correct behavior but can surprise users unfamiliar with the pattern.

**How to avoid:** The current implementation does NOT use `indentWithTab` (verified by grepping for `indentWithTab` and `tabFocusMode` — neither appears in the codebase). This means Tab correctly moves focus out of the editor. No changes needed. If Tab indentation is desired in the future, CodeMirror 6 provides Escape+Tab as an escape mechanism (press Escape, then Tab to move focus out).

**Warning signs:** None currently — the default behavior is correct for accessibility.

## Code Examples

### Example 1: DockerfileAnalyzerJsonLd Component

Complete component following the project's JSON-LD pattern:

```astro
---
/**
 * DockerfileAnalyzerJsonLd.astro — SoftwareApplication JSON-LD structured data
 * for the Dockerfile Analyzer tool page.
 */
const schema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Dockerfile Analyzer",
  "description": "Free browser-based Dockerfile linter and best-practice analyzer. 39 rules across security, efficiency, maintainability, reliability, and best practices. Scored by a Kubernetes architect with 17+ years of experience.",
  "url": "https://patrykgolabek.dev/tools/dockerfile-analyzer/",
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Web Browser",
  "softwareVersion": "1.0",
  "featureList": [
    "39 lint rules based on Hadolint DL codes and production Kubernetes experience",
    "Category-weighted scoring with letter grades (A+ through F)",
    "Inline CodeMirror annotations with severity-colored gutter markers",
    "100% client-side analysis — no data transmitted",
    "Dockerfile syntax highlighting with CodeMirror 6",
    "Click-to-navigate from findings to source lines"
  ],
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "author": {
    "@type": "Person",
    "@id": "https://patrykgolabek.dev/#person"
  },
  "isPartOf": {
    "@type": "WebSite",
    "@id": "https://patrykgolabek.dev/#website"
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
```

**Source:** Pattern verified from `src/components/BeautyIndexJsonLd.astro`, `src/components/ProjectsJsonLd.astro`. SoftwareApplication properties from [schema.org/SoftwareApplication](https://schema.org/SoftwareApplication).

### Example 2: Tool Page Breadcrumb (Visual + JSON-LD)

```astro
---
import BreadcrumbJsonLd from '../../../components/BreadcrumbJsonLd.astro';
import DockerfileAnalyzerJsonLd from '../../../components/DockerfileAnalyzerJsonLd.astro';

const siteBase = (Astro.site?.toString() ?? 'https://patrykgolabek.dev').replace(/\/$/, '');
---

<Layout title="..." description="...">
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    <nav aria-label="Breadcrumb" class="mb-4 text-sm text-[var(--color-text-secondary)]">
      <ol class="flex flex-wrap items-center gap-1">
        <li><a href="/" class="hover:text-[var(--color-accent)] transition-colors">Home</a></li>
        <li aria-hidden="true" class="mx-1">/</li>
        <li><a href="/tools/dockerfile-analyzer/" class="hover:text-[var(--color-accent)] transition-colors">Tools</a></li>
        <li aria-hidden="true" class="mx-1">/</li>
        <li><span aria-current="page" class="text-[var(--color-text-primary)] font-medium">Dockerfile Analyzer</span></li>
      </ol>
    </nav>
    ...
  </section>

  <BreadcrumbJsonLd crumbs={[
    { name: 'Home', url: siteBase },
    { name: 'Tools', url: `${siteBase}/tools/` },
    { name: 'Dockerfile Analyzer', url: `${siteBase}/tools/dockerfile-analyzer/` },
  ]} />
  <DockerfileAnalyzerJsonLd />
</Layout>
```

### Example 3: Sitemap Verification

```bash
npx astro build && grep "dockerfile-analyzer" dist/sitemap-*.xml
```

Expected output should include:
- `https://patrykgolabek.dev/tools/dockerfile-analyzer/`
- 39 rule URLs like `https://patrykgolabek.dev/tools/dockerfile-analyzer/rules/dl3006/`

Total: 40 URLs (1 tool page + 39 rules). The blog post at `/blog/dockerfile-best-practices/` is also auto-included separately.

### Example 4: Minimal Tools Redirect Page

```astro
---
// src/pages/tools/index.astro
// Redirect /tools/ to the Dockerfile Analyzer (the only tool currently)
return Astro.redirect('/tools/dockerfile-analyzer/', 301);
---
```

### Example 5: Accessibility Fix for ScoreGauge

Current (line 56-57 of `ScoreGauge.tsx`):
```tsx
<div
  className="absolute inset-0 flex flex-col items-center justify-center"
  aria-label={`Score ${score}, Grade ${grade}`}
>
```

Improved:
```tsx
<div
  className="absolute inset-0 flex flex-col items-center justify-center"
  role="status"
  aria-label={`Dockerfile analysis score: ${score} out of 100, grade ${grade}`}
>
```

Adding `role="status"` makes the `aria-label` valid on a non-interactive element and announces score changes to screen readers via implicit `aria-live="polite"`.

## Accessibility Audit Checklist (SEO-06)

### Tool Page (`/tools/dockerfile-analyzer/`)

| Element | Current State | Assessment |
|---------|--------------|------------|
| CodeMirror editor | `client:only="react"`, uses `basicSetup` which includes accessibility features | Tab does NOT trap (WCAG 2.1.2 compliant). Escape+Tab escapes. Has aria roles from basicSetup. |
| Analyze button | Standard `<button>` with text "Analyze" | Keyboard-accessible (Tab + Enter/Space). Has focus-visible outline. |
| Results panel heading | `<h2>` element ("Results") | Proper heading hierarchy. |
| Score gauge SVG | `aria-hidden="true"` on SVG, text overlay has `aria-label` | Needs `role="status"` on overlay div for valid ARIA. |
| Category breakdown bars | Visual bars with category labels and scores | Labels are text content. Score numbers are text. No ARIA issues. |
| Violation list (details/summary) | Native `<details>` + `<summary>` elements | Natively accessible. Enter/Space toggles. |
| Line navigation buttons | `<button>` with `title` and text "L{n}" | Accessible. Has title for tooltip. |
| Breadcrumbs | NOT PRESENT (to be added) | Will be added by Phase 26 |

### Rule Pages (`/tools/dockerfile-analyzer/rules/[code]`)

| Element | Current State | Assessment |
|---------|--------------|------------|
| Visual breadcrumbs | Present (lines 56-68) | Proper `<nav aria-label="Breadcrumb">` with `<ol>`, `aria-hidden` separators, `aria-current="page"` |
| BreadcrumbJsonLd | Present (lines 176-181) | Correct 4-level hierarchy |
| Code blocks | Astro `<Code>` component (Expressive Code) | Built-in accessibility from Expressive Code |
| Severity badges | `<span>` with colored backgrounds | Text content provides meaning; color alone does not convey severity (text labels present) |
| Related rule links | `<a>` elements with text content | Descriptive link text (rule ID + title). Keyboard-accessible. |
| Back-link buttons | `<a>` elements with text content | Proper link text. Keyboard-accessible. |

### Cross-Page Checks

| Check | WCAG Criterion | Status |
|-------|----------------|--------|
| All interactive elements keyboard-reachable | 2.1.1 Keyboard (A) | CodeMirror, Analyze button, violation list, links — all reachable via Tab |
| No keyboard trap | 2.1.2 No Keyboard Trap (A) | CodeMirror default does NOT capture Tab; Escape+Tab always works |
| Focus visible on all interactive elements | 2.4.7 Focus Visible (AA) | Analyze button has `focus-visible` outline. Links inherit browser defaults. Need to verify CodeMirror container focus ring. |
| Color contrast 4.5:1 for text | 1.4.3 Contrast (AA) | Lighthouse automated check. Known site-wide issue with some secondary text. |
| Non-text contrast 3:1 for UI components | 1.4.11 Non-text Contrast (AA) | Severity colors (red, amber, blue) on dark background should pass. Score gauge arc colors need verification. |
| Text alternatives for non-text content | 1.1.1 Non-text Content (A) | Score gauge SVG is `aria-hidden`; overlay text provides alternative. Need `role="status"`. |
| Meaningful sequence | 1.3.2 Meaningful Sequence (A) | DOM order: h1 > description > editor > results. Matches visual order. |

## Lighthouse Audit Strategy (SEO-05)

### Pages to Audit

1. `/tools/dockerfile-analyzer/` — Tool page (CodeMirror React island, main concern)
2. `/tools/dockerfile-analyzer/rules/dl3006/` — Representative rule page (static content, should score well)

### Expected Issue Areas

| Category | Likely Issue | Mitigation |
|----------|-------------|------------|
| Performance | `client:only="react"` delays LCP | Server-rendered h1 + description provides fast LCP before React hydrates |
| Performance | CodeMirror bundle size | Already bundled via Vite; basicSetup is ~180KB minified but gzipped is ~50KB. Acceptable for a developer tool. |
| Accessibility | ScoreGauge `aria-label` on non-role div | Fix by adding `role="status"` |
| Accessibility | Missing form labels (unlikely) | Analyze button has text content |
| SEO | Missing structured data | Added by SEO-01 (SoftwareApplication JSON-LD) |
| SEO | Already has meta description | Already present, will optimize wording |
| Best Practices | CSP with `unsafe-inline` | Pre-existing site-wide policy, not introduced by this phase |

### Running Lighthouse

```bash
npx astro build
npx astro preview &
sleep 3

npx lighthouse http://localhost:4321/tools/dockerfile-analyzer/ \
  --output=json --output-path=./lighthouse-tool.json \
  --chrome-flags="--headless --no-sandbox" --quiet

npx lighthouse http://localhost:4321/tools/dockerfile-analyzer/rules/dl3006/ \
  --output=json --output-path=./lighthouse-rule.json \
  --chrome-flags="--headless --no-sandbox" --quiet

# Extract scores
node -e "const r=require('./lighthouse-tool.json'); const c=r.categories; console.log('Tool:', 'Perf:', Math.round(c.performance.score*100), 'A11y:', Math.round(c.accessibility.score*100), 'BP:', Math.round(c['best-practices'].score*100), 'SEO:', Math.round(c.seo.score*100))"

kill %1
rm lighthouse-tool.json lighthouse-rule.json
```

Target: All four categories at 90+.

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| `SoftwareApplication` alone | `SoftwareApplication` with `offers.price: "0"` | Google Rich Results update 2024 | Free price signal improves rich result display |
| Custom accessibility handlers for Tab in editors | CodeMirror 6 built-in no-Tab-capture | CodeMirror 6.0 (2022) | Default config is WCAG 2.1.2 compliant out of the box |
| `aria-sort="none"` on unsorted elements | Omit `aria-sort` entirely | WAI-ARIA best practice | Not relevant here (no sortable tables) but recorded for consistency |
| Manual sitemap management | `@astrojs/sitemap` auto-discovery | Astro 4+ | Tool pages auto-included; no manual entries needed |

**Deprecated/outdated:**
- None relevant. All patterns are current.

## Open Questions

1. **Navigation label: "Tools" vs "Dockerfile Analyzer"**
   - What we know: The nav currently has 6 items with a maximum label length of 12 characters ("Beauty Index"). Adding "Dockerfile Analyzer" (19 chars) as a 7th item may cause layout issues on medium viewports.
   - What's unclear: Whether the user prefers a short generic "Tools" label (future-proof for more tools) or the specific "Dockerfile Analyzer" label (more descriptive).
   - Recommendation: Use "Tools" as the label with href pointing to `/tools/dockerfile-analyzer/`. This keeps the nav clean and allows future tools to be added without renaming. The full name "Dockerfile Analyzer" appears in the h1 on the tool page.

2. **`/tools/` landing page vs redirect**
   - What we know: Rule pages already link to `/tools/` in their breadcrumbs (Phase 25). No `/tools/` page exists, causing a potential 404.
   - What's unclear: Whether to create a redirect or a minimal landing page.
   - Recommendation: Create a minimal `src/pages/tools/index.astro` that redirects (301) to `/tools/dockerfile-analyzer/`. If more tools are added later, this file becomes a real landing page. This is the simplest fix that makes existing breadcrumb links functional.

3. **ScoreGauge `role="status"` side effect**
   - What we know: Adding `role="status"` implies `aria-live="polite"` which would cause screen readers to announce changes.
   - What's unclear: Whether announcing score updates (which happen on button click, not continuously) is desirable UX.
   - Recommendation: `role="status"` is appropriate here because the score only changes on explicit user action (clicking "Analyze"). The announcement is helpful — users who cannot see the gauge need to know their score. Using `role="img"` with `aria-label` is the alternative if announcements are not desired.

## Sources

### Primary (HIGH confidence)

- **Codebase inspection** -- All findings verified by reading actual source files:
  - `src/components/Header.astro` -- navigation structure, `navLinks` array (6 items), `isActive` logic
  - `src/components/BreadcrumbJsonLd.astro` -- existing breadcrumb component interface
  - `src/components/BeautyIndexJsonLd.astro` -- existing JSON-LD pattern (Dataset)
  - `src/components/ProjectsJsonLd.astro` -- existing JSON-LD pattern (SoftwareSourceCode)
  - `src/components/PersonJsonLd.astro` -- existing JSON-LD pattern (Person)
  - `src/components/FAQPageJsonLd.astro` -- existing JSON-LD pattern (FAQPage)
  - `src/components/SEOHead.astro` -- meta tag management
  - `src/layouts/Layout.astro` -- page shell structure, WebSite JSON-LD
  - `src/pages/index.astro` -- homepage structure, Beauty Index callout pattern (lines 154-165)
  - `src/pages/tools/dockerfile-analyzer/index.astro` -- tool page (no breadcrumbs, no JSON-LD)
  - `src/pages/tools/dockerfile-analyzer/rules/[code].astro` -- rule pages (already has breadcrumbs + BreadcrumbJsonLd)
  - `src/components/tools/DockerfileAnalyzer.tsx` -- React island root component
  - `src/components/tools/EditorPanel.tsx` -- CodeMirror editor, Analyze button
  - `src/components/tools/ResultsPanel.tsx` -- results display
  - `src/components/tools/results/ScoreGauge.tsx` -- SVG gauge with aria-hidden and overlay aria-label
  - `src/components/tools/results/ViolationList.tsx` -- details/summary pattern, line navigation buttons
  - `src/components/tools/results/CategoryBreakdown.tsx` -- category bars
  - `src/lib/tools/dockerfile-analyzer/use-codemirror.ts` -- CodeMirror setup (basicSetup, no indentWithTab)
  - `src/lib/tools/dockerfile-analyzer/rules/index.ts` -- 39 rules verified (10+8+7+5+9)
  - `astro.config.mjs` -- sitemap integration, customPages array
  - `.planning/phases/21-seo-launch-readiness/21-RESEARCH.md` -- Phase 21 patterns (direct precedent)
  - `.planning/phases/21-seo-launch-readiness/21-01-PLAN.md` -- Phase 21 nav + structured data plan
  - `.planning/phases/21-seo-launch-readiness/21-02-PLAN.md` -- Phase 21 cross-linking + accessibility plan
  - `.planning/phases/21-seo-launch-readiness/21-03-PLAN.md` -- Phase 21 Lighthouse + audit plan
  - `.planning/phases/21-seo-launch-readiness/21-VERIFICATION.md` -- Phase 21 verification results

- [schema.org/SoftwareApplication](https://schema.org/SoftwareApplication) -- SoftwareApplication type properties and examples
- [CodeMirror Tab Handling](https://codemirror.net/examples/tab/) -- Official documentation on Tab key behavior and accessibility

### Secondary (MEDIUM confidence)

- [WCAG 2.1.2 No Keyboard Trap](https://www.getstark.co/wcag-explained/operable/keyboard-accessible/no-keyboard-trap/) -- Keyboard trap accessibility requirements
- Phase 21 Lighthouse scores as baseline expectation: Overview (99/96/96/92), Detail (100/93/96/92), Code (98/97/96/92)

### Tertiary (LOW confidence)

- None. All findings verified from primary or secondary sources.

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH -- all tools already installed, verified from codebase
- Architecture: HIGH -- all patterns follow existing codebase conventions verified from Phase 21 and source inspection
- Pitfalls: HIGH -- accessibility gaps identified by direct code inspection; CodeMirror behavior verified from official documentation
- JSON-LD schema: HIGH -- verified from schema.org official documentation and 6 existing codebase examples
- Lighthouse targets: MEDIUM -- actual scores depend on runtime performance (CodeMirror client:only rendering is the main variable)

**Research date:** 2026-02-20
**Valid until:** 2026-03-20 (stable -- no external dependencies or fast-moving libraries)
