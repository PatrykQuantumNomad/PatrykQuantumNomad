---
phase: 54-case-studies-reference-landing-page
plan: 03
type: execute
wave: 2
depends_on: ["54-01", "54-02"]
files_modified:
  - src/stores/categoryFilterStore.ts
  - src/components/eda/CategoryFilter.tsx
  - src/pages/eda/index.astro
autonomous: true
requirements: [LAND-01, LAND-02, LAND-03, LAND-04, LAND-06, LAND-07]

must_haves:
  truths:
    - "The /eda/ landing page displays a card grid with entries from all content types (graphical, quantitative, distributions, foundations, case studies, reference)"
    - "Category filter pills (All, Graphical, Quantitative, Distributions, Case Studies, Reference) toggle card visibility in real time"
    - "Card grid is responsive: 3 columns desktop, 2 columns tablet, 1 column mobile"
    - "Each card shows title, section reference (e.g., Section 1.3.3.1), and description"
    - "Section navigation anchors exist for Foundations, Techniques, Quantitative Methods, Distributions, Case Studies, Reference"
    - "Graphical technique and distribution cards display SVG thumbnails"
  artifacts:
    - path: "src/stores/categoryFilterStore.ts"
      provides: "Nanostores atom for category filter state"
      contains: "activeCategory"
    - path: "src/components/eda/CategoryFilter.tsx"
      provides: "React island with category pill buttons"
      contains: "CategoryFilter"
    - path: "src/pages/eda/index.astro"
      provides: "EDA Visual Encyclopedia landing page"
      min_lines: 80
  key_links:
    - from: "src/components/eda/CategoryFilter.tsx"
      to: "src/stores/categoryFilterStore.ts"
      via: "import activeCategory + setCategory"
      pattern: "import.*categoryFilterStore"
    - from: "src/components/eda/CategoryFilter.tsx"
      to: "DOM data-category attributes"
      via: "useEffect querySelectorAll('[data-category]')"
      pattern: "data-category"
    - from: "src/pages/eda/index.astro"
      to: "edaTechniques + edaDistributions + edaPages collections"
      via: "getCollection aggregation into unified card array"
      pattern: "getCollection"
    - from: "src/pages/eda/index.astro"
      to: "src/components/eda/CategoryFilter.tsx"
      via: "client:visible React island mount"
      pattern: "client:visible"
---

<objective>
Build the EDA Visual Encyclopedia landing page at /eda/ with a filterable card grid aggregating all 90+ pages across all content types, powered by a CategoryFilter.tsx React island.

Purpose: The landing page is the primary discovery interface for the entire encyclopedia. Visitors can browse by section or filter by category to find specific techniques, distributions, case studies, or reference material. It ties together all prior phases into a unified navigable resource.

Output: Landing page at /eda/ with category filter pills, section navigation, responsive card grid with SVG thumbnails, and NIST section references on each card.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/54-case-studies-reference-landing-page/54-RESEARCH.md
@src/components/beauty-index/LanguageFilter.tsx
@src/stores/languageFilterStore.ts
@src/pages/eda/distributions/index.astro
@src/lib/eda/routes.ts
@src/lib/eda/thumbnail.ts
@src/lib/eda/svg-generators/distribution-curve.ts
@src/content.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create categoryFilterStore and CategoryFilter.tsx React island</name>
  <files>
    src/stores/categoryFilterStore.ts
    src/components/eda/CategoryFilter.tsx
  </files>
  <action>
**categoryFilterStore.ts:**
Create a nanostores atom for single-select category filtering (simpler than LanguageFilter's multi-select Set pattern).

```typescript
import { atom } from 'nanostores';

/** Currently active category filter. 'all' shows everything. */
export const activeCategory = atom<string>('all');

/** Set the active category */
export function setCategory(cat: string) {
  activeCategory.set(cat);
}
```

Initialize with `'all'` so hydration matches server-rendered state (all cards visible).

**CategoryFilter.tsx:**
Create a React island with 6 category pill buttons. Follow LanguageFilter.tsx patterns but simplified for single-select:

Categories (in order):
```typescript
const CATEGORIES = [
  { id: 'all', label: 'All' },
  { id: 'graphical', label: 'Graphical' },
  { id: 'quantitative', label: 'Quantitative' },
  { id: 'distributions', label: 'Distributions' },
  { id: 'case-studies', label: 'Case Studies' },
  { id: 'reference', label: 'Reference' },
] as const;
```

Component behavior:
1. Subscribe to `activeCategory` store via `useEffect` on mount
2. On category change, query all `[data-category]` elements in the DOM
3. For each card: show if `active === 'all'` OR `card.dataset.category === active`, hide otherwise
4. Use `card.style.display = '' | 'none'` toggling (same as LanguageFilter)

Styling:
- `flex flex-wrap gap-2 mb-8` container
- Each pill: `px-4 py-1.5 rounded-full text-sm border transition-all`
- Active: `border-[var(--color-accent)] text-[var(--color-accent)] font-medium`
- Inactive: `border-[var(--color-border)] text-[var(--color-text-secondary)]`
- Include `aria-pressed={active === cat.id}` for accessibility

Export as default function `CategoryFilter`.

IMPORTANT:
- Use `client:visible` on the landing page (not `client:load`) -- filter is below the fold
- Foundations pages have category 'foundations' which is NOT in the pill list -- they only appear under "All"
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx tsc --noEmit --pretty 2>&1 | tail -10</automated>
    <manual>Check CategoryFilter.tsx compiles without type errors</manual>
  </verify>
  <done>categoryFilterStore.ts exports activeCategory atom and setCategory function. CategoryFilter.tsx renders 6 pill buttons with DOM-based card visibility toggling.</done>
</task>

<task type="auto">
  <name>Task 2: Create EDA landing page with aggregated card grid and section navigation</name>
  <files>src/pages/eda/index.astro</files>
  <action>
Create `src/pages/eda/index.astro` -- the Visual Encyclopedia landing page.

**Frontmatter data aggregation:**
```typescript
import { getCollection } from 'astro:content';
import EDALayout from '../../layouts/EDALayout.astro';
import BreadcrumbJsonLd from '../../components/BreadcrumbJsonLd.astro';
import CategoryFilter from '../../components/eda/CategoryFilter.tsx';
import { techniqueUrl, distributionUrl, caseStudyUrl, referenceUrl, foundationUrl } from '../../lib/eda/routes';
import { generateThumbnail } from '../../lib/eda/thumbnail';
import { generateDistributionCurve } from '../../lib/eda/svg-generators/distribution-curve';
```

Define a `LandingCard` interface:
```typescript
interface LandingCard {
  title: string;
  url: string;
  category: string;       // matches filter pill id or 'foundations'
  section: string;         // NIST section ref (LAND-06)
  description: string;
  thumbnail?: string;      // SVG string (only graphical + distributions have this)
}
```

Aggregate all collections into a single `cards: LandingCard[]` array:
1. **Graphical techniques** from `edaTechniques` filtered by `category === 'graphical'`: use `techniqueUrl(slug, 'graphical')`, `generateThumbnail(slug)` for thumbnail
2. **Quantitative techniques** from `edaTechniques` filtered by `category === 'quantitative'`: use `techniqueUrl(slug, 'quantitative')`, no thumbnail (formula-based pages)
3. **Distributions** from `edaDistributions`: use `distributionUrl(slug)`, generate thumbnail via `generateDistributionCurve({ type: 'pdf', distribution: dist.data.id, params: defaultParams, config: { width: 200, height: 140, margin: { top: 10, right: 10, bottom: 20, left: 25 } } })`
4. **edaPages** (foundations, case-studies, reference): determine URL function by category (`foundations` -> `foundationUrl`, `case-studies` -> `caseStudyUrl`, `reference` -> `referenceUrl`). Strip category prefix from `page.id` for slug. No thumbnails.

For distribution `section` field: extract from `nistSection` string using `dist.data.nistSection.match(/[\d.]+/)?.[0] ?? ''`.

**Page template structure:**

```
EDALayout (title="EDA Visual Encyclopedia", description="...")
  BreadcrumbJsonLd (Home > EDA)
  <article class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- Header -->
    <h1>EDA Visual Encyclopedia</h1>
    <p>Subtitle describing the encyclopedia</p>

    <!-- Section Navigation (LAND-03) -->
    <nav> anchor links to #foundations, #techniques, #quantitative, #distributions, #case-studies, #reference </nav>

    <!-- Category Filter (LAND-02, LAND-07) -->
    <CategoryFilter client:visible />

    <!-- Card Grid (LAND-01, LAND-04) grouped by section -->

    <!-- Foundations section -->
    <section id="foundations">
      <h2>Foundations</h2>
      grid of foundations cards
    </section>

    <!-- Graphical Techniques section -->
    <section id="techniques">
      <h2>Graphical Techniques</h2>
      grid of graphical cards
    </section>

    <!-- Quantitative Methods section -->
    <section id="quantitative">
      <h2>Quantitative Methods</h2>
      grid of quantitative cards
    </section>

    <!-- Distributions section -->
    <section id="distributions">
      <h2>Probability Distributions</h2>
      grid of distribution cards
    </section>

    <!-- Case Studies section -->
    <section id="case-studies">
      <h2>Case Studies</h2>
      grid of case study cards
    </section>

    <!-- Reference section -->
    <section id="reference">
      <h2>Reference</h2>
      grid of reference cards
    </section>
  </article>
```

**Card component (inline, not separate file):**
Each card is an `<a>` tag with `data-category={card.category}` attribute:
```astro
<a href={card.url} data-category={card.category}
   class="group rounded-lg border border-[var(--color-border)] p-4 hover:border-[var(--color-accent)] transition-colors">
  {card.thumbnail && (
    <div role="img" aria-label={`${card.title} preview`}
         class="w-full overflow-hidden mb-3" set:html={card.thumbnail} />
  )}
  <h3 class="text-base font-heading font-bold group-hover:text-[var(--color-accent)] transition-colors">
    {card.title}
  </h3>
  <p class="text-xs text-[var(--color-text-secondary)] mt-1">
    Section {card.section}
  </p>
  <p class="text-sm text-[var(--color-text-secondary)] mt-2 line-clamp-2">
    {card.description}
  </p>
</a>
```

**Grid layout (LAND-04):**
`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6`

**Section navigation (LAND-03):**
Horizontal scrollable nav with anchor links styled as pills:
```astro
<nav class="flex flex-wrap gap-2 mb-6">
  {['Foundations', 'Techniques', 'Quantitative', 'Distributions', 'Case Studies', 'Reference'].map(s => (
    <a href={`#${s.toLowerCase().replace(' ', '-')}`}
       class="text-sm px-3 py-1 rounded-full border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-colors">
      {s}
    </a>
  ))}
</nav>
```

**Section headings** should also have `data-category` attributes matching their category id so the CategoryFilter can hide/show entire sections:
```astro
<section id="foundations" data-category="foundations">
```

The CategoryFilter must handle section-level visibility too. Update CategoryFilter.tsx useEffect to also toggle `section[data-category]` visibility (or simpler: put each section grid's cards directly with `data-category` and let the filter show/hide individual cards regardless of section).

IMPORTANT decisions:
- Use `client:visible` for CategoryFilter (not `client:load`)
- Include foundation pages in the grid (they appear under "All" and in section nav)
- Cards without thumbnails display fine -- just no image area, text-only card
- Sort cards within each section alphabetically by title
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/PatrykQuantumNomad && npx astro build 2>&1 | tail -20</automated>
    <manual>Open /eda/ and verify: (1) all sections visible, (2) filter pills toggle cards, (3) responsive grid works</manual>
  </verify>
  <done>Landing page at /eda/ renders a filterable card grid with 90+ entries across all content types, category filter pills, section navigation, responsive layout, and NIST section references on each card.</done>
</task>

</tasks>

<verification>
1. `npx astro build` completes without errors
2. /eda/ page renders with all 6 sections and 90+ cards
3. CategoryFilter pills show/hide cards by category in the browser
4. Grid is responsive: 3-col on lg, 2-col on sm, 1-col on mobile
5. Graphical technique cards and distribution cards show SVG thumbnails
6. Cards without thumbnails (quantitative, case studies, reference, foundations) display cleanly as text-only cards
7. Section navigation anchor links scroll to correct sections
</verification>

<success_criteria>
- /eda/ landing page is live with filterable card grid
- All 90+ pages from the encyclopedia are represented as cards
- Category filter works in real time (no page reload)
- Responsive grid adapts to viewport width
- SVG thumbnails render for graphical techniques and distributions
- Each card displays title, NIST section reference, and description
</success_criteria>

<output>
After completion, create `.planning/phases/54-case-studies-reference-landing-page/54-03-SUMMARY.md`
</output>
