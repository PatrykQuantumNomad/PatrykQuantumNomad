---
phase: 30-overview-page
plan: 02
type: execute
wave: 2
depends_on: [30-01]
files_modified:
  - src/components/db-compass/UseCaseFilter.tsx
  - src/pages/tools/db-compass/index.astro
autonomous: true
requirements: [PAGE-01, PAGE-05, SEO-01, SEO-03, SEO-06]

must_haves:
  truths:
    - "Visiting /tools/db-compass/ renders the complexity spectrum, model card grid, scoring table, and dimension legend"
    - "Users can filter models by use-case category via toggle buttons and filtered models show/hide in the card grid"
    - "JSON-LD Dataset + ItemList and BreadcrumbList structured data are present in the page HTML source"
    - "The page has an SEO-optimized meta description that is at most 160 characters long"
    - "All 12 model cards link to /tools/db-compass/[slug]/ detail pages"
  artifacts:
    - path: "src/components/db-compass/UseCaseFilter.tsx"
      provides: "React island for interactive use-case category filtering"
      exports: ["default"]
    - path: "src/pages/tools/db-compass/index.astro"
      provides: "Overview page at /tools/db-compass/"
      contains: "getCollection"
  key_links:
    - from: "src/components/db-compass/UseCaseFilter.tsx"
      to: "src/stores/compassFilterStore.ts"
      via: "nanostores subscribe for filter state"
      pattern: "activeCategories"
    - from: "src/components/db-compass/UseCaseFilter.tsx"
      to: "src/lib/db-compass/use-case-categories.ts"
      via: "imports USE_CASE_CATEGORIES for category labels"
      pattern: "USE_CASE_CATEGORIES"
    - from: "src/components/db-compass/UseCaseFilter.tsx"
      to: "src/components/db-compass/ModelCardGrid.astro"
      via: "DOM manipulation of data-model-id elements"
      pattern: "data-model-id"
    - from: "src/pages/tools/db-compass/index.astro"
      to: "src/components/db-compass/CompassJsonLd.astro"
      via: "JSON-LD structured data injection"
      pattern: "CompassJsonLd"
    - from: "src/pages/tools/db-compass/index.astro"
      to: "src/components/BreadcrumbJsonLd.astro"
      via: "breadcrumb structured data"
      pattern: "BreadcrumbJsonLd"
    - from: "src/pages/tools/db-compass/index.astro"
      to: "src/components/db-compass/UseCaseFilter.tsx"
      via: "React island with client:load"
      pattern: "client:load"
---

<objective>
Build the UseCaseFilter React island and assemble the complete overview page at /tools/db-compass/ by composing all foundation components from Plan 01 with existing Phase 29 visualization components.

Purpose: This is the primary deliverable of Phase 30 -- the public-facing overview page where users explore all 12 database models through the spectrum, filterable grid, scoring table, and dimension legend.
Output: 2 files -- UseCaseFilter.tsx React island + index.astro overview page with full SEO metadata.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-overview-page/30-RESEARCH.md
@.planning/phases/30-overview-page/30-01-SUMMARY.md

@src/lib/db-compass/schema.ts
@src/lib/db-compass/dimensions.ts
@src/lib/db-compass/use-case-categories.ts
@src/stores/compassFilterStore.ts
@src/components/db-compass/ModelCardGrid.astro
@src/components/db-compass/DimensionLegend.astro
@src/components/db-compass/CompassJsonLd.astro
@src/components/db-compass/ComplexitySpectrum.astro
@src/components/db-compass/CompassScoringTable.astro
@src/components/beauty-index/LanguageFilter.tsx
@src/stores/languageFilterStore.ts
@src/pages/beauty-index/index.astro
@src/components/BreadcrumbJsonLd.astro
@src/layouts/Layout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UseCaseFilter React island</name>
  <files>src/components/db-compass/UseCaseFilter.tsx</files>
  <action>
    Follow the LanguageFilter.tsx pattern to create an interactive use-case filter React island:

    **Props interface:**
    ```typescript
    interface UseCaseFilterProps {
      models: { id: string; name: string; useCases: string[] }[];
    }
    ```

    **Core behavior:**
    1. Import `USE_CASE_CATEGORIES` and `modelCategories` from `../../lib/db-compass/use-case-categories`
    2. Import `activeCategories`, `initCategories`, `toggleCategory`, `selectAllCategories`, `selectNoCategories` from `../../stores/compassFilterStore`
    3. Use `useState` to track the active set, subscribe to `activeCategories` store via `useEffect`
    4. On mount (`useEffect` with empty deps), call `initCategories(USE_CASE_CATEGORIES.map(c => c.id))` to start with all categories active (matches server-rendered state where all cards are visible)
    5. Subscribe to `activeCategories.subscribe()` and update local state

    **DOM filtering logic (in a separate useEffect watching `active` state):**
    - Query all `[data-model-id]` elements in the document
    - For each card, read its `data-use-cases` attribute, split by comma into an array
    - Use `modelCategories(cardUseCases)` to get that model's category IDs
    - Show the card (`style.display = ''`) if ANY of the model's category IDs are in the active set
    - Hide the card (`style.display = 'none'`) if NONE of the model's category IDs are in the active set
    - If the active set contains ALL categories, show all cards (optimization)

    **Render:**
    - Wrapper div with flex wrap gap layout
    - "All" button that calls `selectAllCategories(USE_CASE_CATEGORIES.map(c => c.id))`
    - One button per category from USE_CASE_CATEGORIES showing `cat.label`
    - Active buttons get accent styling: `bg-[var(--color-accent)] text-white`
    - Inactive buttons get border styling: `border border-[var(--color-border)] text-[var(--color-text-secondary)] hover:border-[var(--color-accent)]`
    - Each category button calls `toggleCategory(cat.id)` on click
    - Add "All" button that is active when all categories are selected, and "None" button to clear
    - Buttons use `rounded-full px-3 py-1 text-sm font-medium transition-colors cursor-pointer` styling

    **Key implementation notes:**
    - Use `client:load` directive when mounting (not `client:visible`) since the filter controls above-the-fold content
    - Do NOT hydrate the card grid -- it remains server-rendered HTML, filter only manipulates `style.display`
    - The brief flash between server render and hydration is acceptable (same as LanguageFilter pattern)
  </action>
  <verify>
    Run `npx astro check 2>&1 | grep UseCaseFilter` -- zero type errors.
    The component file exists and exports a default function component.
  </verify>
  <done>
    UseCaseFilter.tsx is a React island that renders 10 category toggle buttons + All/None controls, subscribes to compassFilterStore, and shows/hides model cards via data-model-id DOM manipulation. Follows LanguageFilter.tsx pattern exactly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Assemble overview page at /tools/db-compass/</name>
  <files>src/pages/tools/db-compass/index.astro</files>
  <action>
    Create the overview page following the beauty-index/index.astro pattern. This is the primary composition task that brings together all components.

    **Frontmatter:**
    - Import `getCollection` from `astro:content`
    - Import Layout from `../../../layouts/Layout.astro`
    - Import components: ComplexitySpectrum, ModelCardGrid, CompassScoringTable, DimensionLegend, CompassJsonLd, UseCaseFilter, BreadcrumbJsonLd
    - NOTE: Do NOT import CapBadge here -- it is only used inside ModelCardGrid.astro (already imported there)
    - Import totalScore from schema.ts
    - Load data: `const dbModels = await getCollection('dbModels');`
    - Map and sort: `const allModels = dbModels.map(e => e.data);` then sort by totalScore descending or by complexity position as appropriate for the spectrum

    **Layout wrapper:**
    - Title: `"Database Compass: Compare 12 Database Models Across 8 Dimensions | Patryk Golabek"` (SEO-06)
    - Description: `"Compare 12 database models across 8 dimensions -- scalability, performance, reliability, and more. Interactive scoring, filtering, and radar charts."` (149 characters -- MUST be under 160) (SEO-06)

    **Page sections (in order):**

    1. **JSON-LD (invisible):** `<CompassJsonLd models={sorted} />` (SEO-01) and `<BreadcrumbJsonLd crumbs={[{name:'Home', url:'https://patrykgolabek.dev/'}, {name:'Tools', url:'https://patrykgolabek.dev/tools/'}, {name:'Database Compass', url:'https://patrykgolabek.dev/tools/db-compass/'}]} />` (SEO-03)

    2. **Hero section:** Centered, max-w-4xl, py-16. Badge: "2026 Edition" in mono accent (same pattern as Beauty Index). H1: "Database Compass". Subtitle: "Compare 12 database models across 8 dimensions." Tagline: "An opinionated guide by a cloud-native architect." Link to companion blog post (placeholder href for Phase 32).

    3. **Complexity Spectrum section:** H2: "Complexity Spectrum", max-w-6xl, responsive overflow-x-auto wrapper. `<ComplexitySpectrum models={allModels} />`

    4. **Use-Case Filter + Model Card Grid section:** H2: "Database Models". Place UseCaseFilter ABOVE the grid (filter must be visible before cards). `<UseCaseFilter client:load models={allModels.map(m => ({id: m.id, name: m.name, useCases: m.useCases}))} />`. Below filter: `<ModelCardGrid models={sorted} />` where sorted is by totalScore descending.

    5. **Scoring Table section:** H2: "Score Breakdown", helper text "Click any column header to sort". `<CompassScoringTable models={sorted} />`

    6. **Dimension Legend section:** H2: "Scoring Dimensions". `<DimensionLegend />`

    **Section spacing:** Each section gets `max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-16` matching the Beauty Index overview page pattern. Last section adds `pb-16`.

    **Breadcrumb navigation (visual):** Add a centered visual breadcrumb nav at top of page (below hero, above spectrum) following the Beauty Index pattern: `Home > Tools > Database Compass` with links to / and /tools/ and current page unlinked.

    **Key implementation notes:**
    - Use `getCollection('dbModels')` for type-safe data loading (not raw JSON import)
    - UseCaseFilter uses `client:load` (NOT `client:visible`) since it controls above-the-fold content
    - The scoring table always shows all 12 models regardless of filter state (filter only affects ModelCardGrid)
    - All sections follow the max-w-6xl container pattern from beauty-index/index.astro
  </action>
  <verify>
    1. Run `npx astro build 2>&1 | tail -10` -- build succeeds, page generated at /tools/db-compass/
    2. Run `npx astro build 2>&1 | grep 'tools/db-compass'` -- confirms page route exists
    3. Check the built HTML: `grep -l 'application/ld+json' dist/tools/db-compass/index.html` -- JSON-LD present
    4. Check breadcrumbs: `grep 'BreadcrumbList' dist/tools/db-compass/index.html` -- BreadcrumbList JSON-LD present
    5. Check meta description length: `grep -oP 'content="\K[^"]+' dist/tools/db-compass/index.html | head -1 | wc -c` -- must be under 161 (160 chars + newline). Alternatively, extract the meta description and assert its character count is at most 160.
    6. Check data attributes: `grep 'data-model-id' dist/tools/db-compass/index.html` -- 12 model cards have data attributes
    7. Verify CapBadge is NOT imported in index.astro: `grep -c 'CapBadge' src/pages/tools/db-compass/index.astro` -- should be 0
  </verify>
  <done>
    Overview page at /tools/db-compass/ renders: hero section, complexity spectrum, use-case filter with 10 category toggles, 12-card model grid with radar thumbnails, sortable scoring table, dimension legend. JSON-LD Dataset+ItemList and BreadcrumbList present. SEO title and description set (description is 149 characters, under the 160-character limit). CapBadge is not imported directly -- it is used only within ModelCardGrid. Build passes clean.
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` succeeds with the overview page generated at /tools/db-compass/
2. Page HTML contains `application/ld+json` script with Dataset and ItemList
3. Page HTML contains BreadcrumbList JSON-LD with Home > Tools > Database Compass
4. Page meta description is under 160 characters (verified by character count assertion) and contains database-related keywords
5. 12 model cards have `data-model-id` attributes for filter integration
6. UseCaseFilter renders with `client:load` directive
7. Scoring table is present and independent of filter state
8. All existing Phase 29 components render correctly on the page
9. CapBadge is NOT imported in index.astro (only used inside ModelCardGrid)
</verification>

<success_criteria>
- /tools/db-compass/ renders with all 4 major sections: spectrum, grid, table, legend
- Filter toggles 10 use-case categories and shows/hides model cards
- JSON-LD and breadcrumb structured data are in page source
- SEO meta description is at most 160 characters
- Page builds successfully as part of the full site build
- All 12 model cards link to their detail page URLs
- No unnecessary component imports in index.astro
</success_criteria>

<output>
After completion, create `.planning/phases/30-overview-page/30-02-SUMMARY.md`
</output>
