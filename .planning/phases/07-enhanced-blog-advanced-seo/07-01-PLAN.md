---
phase: 07-enhanced-blog-advanced-seo
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/blog/tags/[tag].astro
  - src/pages/blog/[slug].astro
  - src/components/TableOfContents.astro
  - src/pages/llms.txt.ts
autonomous: true

must_haves:
  truths:
    - "User can click a tag on a blog post and land on /blog/tags/[tag]/ showing all posts with that tag"
    - "Tag pages list posts filtered to the clicked tag, sorted newest-first"
    - "Blog posts with 2+ headings display a navigable table of contents with anchor links"
    - "Blog posts with 0-1 headings do NOT display a table of contents"
    - "/llms.txt serves a plain-text markdown summary with site info and blog post links"
  artifacts:
    - path: "src/pages/blog/tags/[tag].astro"
      provides: "Dynamic tag listing pages"
      contains: "getStaticPaths"
    - path: "src/components/TableOfContents.astro"
      provides: "Reusable ToC component from heading array"
      min_lines: 15
    - path: "src/pages/llms.txt.ts"
      provides: "LLM-friendly content endpoint"
      contains: "text/plain"
  key_links:
    - from: "src/pages/blog/[slug].astro"
      to: "/blog/tags/[tag]/"
      via: "anchor tags on tag pills"
      pattern: "href=.*blog/tags/"
    - from: "src/pages/blog/[slug].astro"
      to: "src/components/TableOfContents.astro"
      via: "import and render with headings prop"
      pattern: "TableOfContents"
    - from: "src/pages/llms.txt.ts"
      to: "astro:content"
      via: "getCollection for blog posts"
      pattern: "getCollection"
---

<objective>
Add tag filtering pages, auto-generated table of contents, and LLMs.txt endpoint to the blog.

Purpose: BLOG-06 (tag pages), BLOG-07 (ToC), and SEO-08 (LLMs.txt) are three independent features that share no external dependencies and use only built-in Astro APIs. Completing them first clears the simpler requirements before the more complex OG image work in Plan 02.

Output: Tag listing pages at /blog/tags/[tag]/, TableOfContents component rendered on blog posts, and /llms.txt endpoint.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-blog-advanced-seo/07-RESEARCH.md

@src/pages/blog/[slug].astro
@src/pages/blog/index.astro
@src/components/BlogCard.astro
@src/content.config.ts
@src/layouts/Layout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tag listing pages and convert tag spans to links</name>
  <files>src/pages/blog/tags/[tag].astro, src/pages/blog/[slug].astro, src/components/BlogCard.astro</files>
  <action>
Create `src/pages/blog/tags/[tag].astro`:
- Import `getCollection` from `astro:content`, `Layout` from layouts, `BlogCard` from components
- `getStaticPaths()`: query all non-draft posts (same filter pattern as blog/index.astro: `import.meta.env.PROD ? data.draft !== true : true`), extract unique tags with `[...new Set(posts.flatMap(p => p.data.tags))]`, return one path per tag with params `{ tag }` and props containing `{ tag, posts }` where posts are filtered to that tag and sorted by `publishedDate` descending
- Use `post.id` for URLs (NOT `post.slug` -- Astro 5)
- Template: Layout with title `"Posts tagged '${tag}' -- Patryk Golabek"` and description `"Blog posts about ${tag} by Patryk Golabek"`. Render heading `Posts tagged "${tag}"`, a link back to /blog/, and map over posts rendering BlogCard in reveal divs (same pattern as blog/index.astro)

Update `src/pages/blog/[slug].astro`:
- Change the tag `<span>` elements to `<a>` elements linking to `/blog/tags/${tag}/`
- Keep the existing Tailwind classes, add `hover:bg-[var(--color-accent)]/20 transition-colors` for hover state
- Keep the tag display in the header section

Update `src/components/BlogCard.astro`:
- Change the tag `<span>` elements to `<a>` elements linking to `/blog/tags/${tag}/`
- Add `hover:bg-[var(--color-accent)]/20 transition-colors` for hover state
- Add `e.stopPropagation()` is NOT needed since BlogCard uses an `<a>` wrapping the card -- instead, add `relative z-10` to tag links so they are clickable independently of the card link. Also add `onclick="event.stopPropagation()"` is not needed in Astro static -- the tag `<a>` simply needs to be a separate clickable element. Since the card is a block-level `<a>`, nested `<a>` tags are invalid HTML. Instead: restructure BlogCard so the card link covers the card via CSS (`absolute inset-0`) and the tag links sit above it. Specifically:
  - Wrap the outer element in a `<article class="group relative">` (already has `group`)
  - Change the `<a>` wrapping the card to a span/div with the card styles, and add an invisible `<a>` overlay with `class="absolute inset-0 z-0"` and the href to the post
  - Make the tag `<a>` links `relative z-10` so they sit above the overlay and are independently clickable
  - This avoids nested `<a>` tags (invalid HTML) while keeping the entire card clickable
  </action>
  <verify>Run `npm run build` -- check that tag pages are generated in dist/blog/tags/ directories and no build errors. Verify no nested `<a>` tags in the BlogCard output.</verify>
  <done>Tag pages exist at /blog/tags/[tag]/ for each unique tag. Tags on blog posts and blog cards are clickable links to tag pages. No invalid nested anchor tags.</done>
</task>

<task type="auto">
  <name>Task 2: Create TableOfContents component and integrate into blog posts</name>
  <files>src/components/TableOfContents.astro, src/pages/blog/[slug].astro</files>
  <action>
Create `src/components/TableOfContents.astro`:
- Props interface: `{ headings: { depth: number; slug: string; text: string }[]; minDepth?: number; maxDepth?: number }`
- Default minDepth=2, maxDepth=3 (h2 and h3 only)
- Filter headings to those within depth range
- Only render if `filtered.length > 1` (skip for posts with 0-1 qualifying headings -- avoids visual clutter per research pitfall #6)
- Render a `<nav aria-label="Table of contents">` with `<h2 class="text-sm font-heading font-semibold uppercase tracking-wider text-[var(--color-text-secondary)] mb-3">On this page</h2>`
- Render `<ul>` with `<li>` per heading. Each `<li>` gets left margin based on depth: `margin-left: ${(heading.depth - minDepth) * 1}rem`. Each contains `<a href={"#" + heading.slug}>` with the heading text
- Style the nav container with: `p-4 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]`
- Style links with: `text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-accent)] transition-colors`

Update `src/pages/blog/[slug].astro`:
- Destructure `headings` from `await render(post)` (currently only destructures `Content` and `remarkPluginFrontmatter`)
- Import TableOfContents from components
- Place `<TableOfContents headings={headings} />` between the `<header>` and the `<div class="prose">` content, with `class="mb-8"` wrapper
  </action>
  <verify>Run `npm run build` -- no errors. Check that the blog post "Building a Kubernetes Observability Stack" (which has multiple h2/h3 headings) generates HTML containing the ToC nav element with anchor links.</verify>
  <done>Blog posts with 2+ headings display a styled table of contents with working anchor links. Posts with 0-1 headings show no ToC.</done>
</task>

<task type="auto">
  <name>Task 3: Create LLMs.txt endpoint</name>
  <files>src/pages/llms.txt.ts</files>
  <action>
Create `src/pages/llms.txt.ts`:
- Import `getCollection` from `astro:content` and `APIContext` type from `astro`
- Export `async function GET(context: APIContext)` (Astro static endpoint pattern)
- Query blog collection, filter drafts (`!data.draft`), sort by publishedDate descending
- Build plain-text markdown following the llmstxt.org specification:
  - H1: `# Patryk Golabek`
  - Blockquote: `> Cloud-Native Software Architect with 17+ years of experience in Kubernetes, AI/ML systems, platform engineering, and DevSecOps. Ontario, Canada.`
  - H2 `## Blog Posts` with list of posts as `- [Title](https://patrykgolabek.dev/blog/{post.id}/): {description}`
  - H2 `## Optional` (special section per spec -- skippable content)
  - List: Projects page, About page, Contact page with full URLs using `https://patrykgolabek.dev`
- Return `new Response(content, { headers: { 'Content-Type': 'text/plain; charset=utf-8' } })`
  </action>
  <verify>Run `npm run build` -- check that `dist/llms.txt` exists and contains the expected markdown structure with the H1, blockquote, blog post links, and Optional section.</verify>
  <done>/llms.txt serves a valid LLMs.txt-format plain-text file with site summary, blog post links, and optional page links. Content is dynamically generated from the blog collection.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `dist/blog/tags/` contains directories for each tag used in blog posts (e.g., kubernetes, observability, etc.)
3. Blog post HTML contains `<a href="/blog/tags/...">` tag links (not `<span>` tags)
4. Blog post HTML contains `<nav aria-label="Table of contents">` with heading anchor links
5. `dist/llms.txt` exists with plain-text markdown content including blog post URLs
6. No nested `<a>` tags in BlogCard HTML output
</verification>

<success_criteria>
- Tag pages generate and list filtered posts at /blog/tags/[tag]/
- Tags are clickable links in both blog post pages and blog listing cards
- Table of contents renders on posts with 2+ headings, hidden on shorter posts
- /llms.txt serves LLM-friendly content summary with blog post links
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-blog-advanced-seo/07-01-SUMMARY.md`
</output>
