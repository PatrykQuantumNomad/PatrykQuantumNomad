---
phase: 07-enhanced-blog-advanced-seo
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - src/layouts/Layout.astro
  - src/styles/global.css
  - src/pages/index.astro
autonomous: false

must_haves:
  truths:
    - "Lighthouse Performance score is 90+ on mobile for the homepage"
    - "Lighthouse Accessibility score is 90+ on mobile for the homepage"
    - "Lighthouse Best Practices score is 90+ on mobile for the homepage"
    - "Lighthouse SEO score is 90+ on mobile for the homepage"
    - "No render-blocking resource warnings for fonts in Lighthouse report"
  artifacts:
    - path: "src/layouts/Layout.astro"
      provides: "Optimized font loading strategy"
      contains: "font-display"
    - path: "src/styles/global.css"
      provides: "Any accessibility or CLS fixes"
  key_links:
    - from: "src/layouts/Layout.astro"
      to: "Google Fonts"
      via: "preload or optimized link tags"
      pattern: "fonts.googleapis"
---

<objective>
Audit and optimize the site for Lighthouse 90+ scores across all four categories on mobile.

Purpose: INFRA-03 requires verified Lighthouse 90+ in Performance, Accessibility, Best Practices, and SEO. The site is a static Astro site which inherently scores well, but font loading strategy and accessibility details need verification and potential fixes. This plan runs last because all content and features must be in place before a meaningful audit.

Output: Optimized font loading, accessibility fixes (if any), and verified Lighthouse scores.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-blog-advanced-seo/07-RESEARCH.md
@.planning/phases/07-enhanced-blog-advanced-seo/07-01-SUMMARY.md
@.planning/phases/07-enhanced-blog-advanced-seo/07-02-SUMMARY.md

@src/layouts/Layout.astro
@src/styles/global.css
@src/pages/index.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Optimize font loading and fix known performance/accessibility issues</name>
  <files>src/layouts/Layout.astro, src/styles/global.css, src/pages/index.astro</files>
  <action>
Audit and fix the following known issues identified in research:

**Font loading optimization (Performance):**
The current Google Fonts `<link>` tag is render-blocking. The URL already includes `display=swap` which is good. Apply these optimizations in `src/layouts/Layout.astro`:
1. Add `media="print" onload="this.media='all'"` to the Google Fonts stylesheet `<link>` to make it non-render-blocking. Add a `<noscript>` fallback with the regular link.
2. Keep the existing `preconnect` hints (already present, good).
3. This converts the font loading from render-blocking to async, eliminating the Lighthouse "Eliminate render-blocking resources" warning.

Alternative approach if the media trick causes FOUT issues: Instead of the media trick, add `rel="preload" as="style"` to hint the browser to fetch the font CSS early without blocking render, then load it normally. Choose whichever approach is cleaner -- the media="print" trick is well-established and works reliably.

**CLS prevention (Performance):**
The typing animation on the homepage hero could cause layout shift when text changes width. In `src/pages/index.astro` (or wherever the typing animation container is), ensure the container has a fixed `min-height` so the text swap does not shift layout. Check if this is already handled. If the container already has fixed dimensions, no change needed.

**Accessibility audit (Accessibility):**
Review and fix if needed:
1. All images have alt text (site currently has no images, so this is N/A until OG images -- which are only in meta tags, not rendered)
2. Color contrast: verify `--color-text-secondary` against `--color-surface` meets WCAG AA 4.5:1 ratio. If it does not, adjust the secondary text color slightly. Check both light and dark themes.
3. Heading hierarchy: ensure pages use h1 -> h2 -> h3 without skipping levels. Check all pages.
4. Focus indicators: ensure interactive elements (links, buttons, toggle) have visible focus outlines. The default Tailwind focus ring should handle this, but verify.
5. ARIA labels: verify the mobile menu button, theme toggle, and any icon-only buttons have aria-label attributes.

**Best Practices:**
1. Ensure no `console.log` statements remain in production code
2. Ensure HTTPS is configured (already is via GitHub Pages)
3. Ensure viewport meta tag is present (already is in Layout.astro)

**SEO:**
1. All pages already have meta descriptions and titles (Phase 5)
2. Canonical URLs present (Phase 5)
3. Sitemap present (Phase 5)
4. Structured data present (Phase 5)
5. No additional SEO changes expected

Apply only the changes that are actually needed. Do NOT make changes for the sake of making changes. If the site already passes, document that it passes.
  </action>
  <verify>Run `npm run build && npm run preview` to start the local server. Then use `npx lighthouse http://localhost:4321 --output=json --output-path=./lighthouse-report.json --chrome-flags="--headless --no-sandbox" --preset=perf --form-factor=mobile` (or similar) to run a Lighthouse audit programmatically. Check that all four scores are 90+. If lighthouse CLI is not available, install it: `npm install -g lighthouse`. Alternative: use `npx @lhci/cli autorun` if available.</verify>
  <done>Font loading is optimized (non-render-blocking). Any accessibility issues are fixed. Build passes cleanly.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Lighthouse scores 90+ on all categories</name>
  <what-built>Complete Phase 7 implementation: tag pages, table of contents, dynamic OG images, LLMs.txt, GEO optimization, and performance/accessibility optimizations. The site should now meet all Phase 7 success criteria.</what-built>
  <how-to-verify>
1. Run `npm run build && npm run preview` in the project root
2. Open Chrome DevTools on `http://localhost:4321/`
3. Go to Lighthouse tab, select "Mobile" device, check all four categories (Performance, Accessibility, Best Practices, SEO)
4. Run the audit
5. Verify all four scores are 90+
6. If any score is below 90, note the specific failing audits so they can be addressed

Additionally verify these Phase 7 features:
7. Visit `/blog/` -- click a tag on any blog card and verify it navigates to `/blog/tags/{tag}/` with filtered posts
8. Visit a blog post -- verify the table of contents appears with clickable anchor links
9. Visit `/llms.txt` -- verify it returns plain-text markdown with blog post links
10. View page source on a blog post -- verify `og:image` meta tag exists with a URL to `/open-graph/blog/...`
11. Open the OG image URL directly in the browser to verify it renders a branded PNG
  </how-to-verify>
  <resume-signal>Type "approved" if all Lighthouse scores are 90+ and features work. Otherwise describe issues to fix.</resume-signal>
</task>

</tasks>

<verification>
1. Lighthouse Performance >= 90 on mobile
2. Lighthouse Accessibility >= 90 on mobile
3. Lighthouse Best Practices >= 90 on mobile
4. Lighthouse SEO >= 90 on mobile
5. No render-blocking font warnings in Lighthouse
6. All Phase 7 features functional (tags, ToC, OG images, LLMs.txt)
</verification>

<success_criteria>
- All four Lighthouse scores are 90+ on mobile (verified by human)
- Font loading is non-render-blocking
- Accessibility meets WCAG AA standards
- Phase 7 is complete: all 5 success criteria from ROADMAP.md are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-blog-advanced-seo/07-03-SUMMARY.md`
</output>
