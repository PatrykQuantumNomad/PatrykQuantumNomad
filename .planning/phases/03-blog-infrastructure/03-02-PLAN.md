---
phase: 03-blog-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/BlogCard.astro
  - src/pages/blog/index.astro
  - src/pages/blog/[slug].astro
autonomous: true

must_haves:
  truths:
    - "User can browse a chronologically sorted list of published blog posts at /blog/"
    - "User can click through to read a full blog post at /blog/[slug]/ with readable typography"
    - "Code blocks in blog posts display syntax highlighting with a visible copy button"
    - "Each blog post displays an estimated reading time"
    - "Posts with draft: true do not appear on /blog/ or generate pages in production builds"
  artifacts:
    - path: "src/pages/blog/index.astro"
      provides: "Blog listing page at /blog/"
      contains: "getCollection"
    - path: "src/pages/blog/[slug].astro"
      provides: "Individual blog post pages at /blog/[slug]/"
      contains: "getStaticPaths"
    - path: "src/components/BlogCard.astro"
      provides: "Blog post preview card for listing page"
      contains: "CollectionEntry"
  key_links:
    - from: "src/pages/blog/index.astro"
      to: "src/content.config.ts"
      via: "getCollection('blog') call"
      pattern: "getCollection.*blog"
    - from: "src/pages/blog/index.astro"
      to: "src/components/BlogCard.astro"
      via: "component import and rendering"
      pattern: "import BlogCard"
    - from: "src/pages/blog/[slug].astro"
      to: "src/content.config.ts"
      via: "getCollection + render in getStaticPaths"
      pattern: "getCollection.*blog.*getStaticPaths"
    - from: "src/pages/blog/[slug].astro"
      to: "remark-reading-time.mjs"
      via: "remarkPluginFrontmatter.minutesRead from render()"
      pattern: "remarkPluginFrontmatter"
---

<objective>
Create the blog listing page, individual blog post page, and BlogCard component that together deliver the complete user-facing blog experience.

Purpose: Users can browse, discover, and read blog posts. This is the presentation layer that consumes the content collection and configuration established in Plan 01.
Output: Three Astro files that implement the /blog/ listing and /blog/[slug]/ post routes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-blog-infrastructure/03-RESEARCH.md
@.planning/phases/03-blog-infrastructure/03-01-SUMMARY.md
@src/layouts/Layout.astro
@src/styles/global.css
@src/content.config.ts
@astro.config.mjs
@tailwind.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BlogCard component and blog listing page</name>
  <files>
    src/components/BlogCard.astro
    src/pages/blog/index.astro
  </files>
  <action>
1. Create `src/components/BlogCard.astro`:
   - Import `CollectionEntry` type from 'astro:content'
   - Props interface: { post: CollectionEntry<'blog'> }
   - Destructure post.data to get title, description, publishedDate, tags
   - Render as an `<article>` with class "group" containing:
     - An `<a>` link to `/blog/${post.id}/` wrapping the entire card
     - Card styling: p-6, rounded-lg, border using var(--color-border), bg using var(--color-surface-alt), hover:border using var(--color-accent), transition-colors
     - `<time>` element with datetime attribute (publishedDate.toISOString()) showing formatted date using toLocaleDateString('en-CA', { year: 'numeric', month: 'long', day: 'numeric' })
     - `<h2>` with title: text-xl font-heading font-bold, group-hover color change to var(--color-accent)
     - `<p>` with description: text color var(--color-text-secondary)
     - Tags row (conditional on tags.length > 0): flex flex-wrap gap-2 mt-4, each tag as a `<span>` with text-xs px-2 py-1 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]
   - Use Astro 5 API: `post.id` (NOT post.slug -- slug was removed in Astro 5)

2. Create `src/pages/blog/index.astro`:
   - Import getCollection from 'astro:content', Layout from layouts, BlogCard from components
   - Query: `const posts = await getCollection('blog', ({ data }) => { return import.meta.env.PROD ? data.draft !== true : true; });`
   - Sort: descending by publishedDate (newest first)
   - Layout wrapper with title="Blog" and description="Articles on cloud-native architecture, Kubernetes, and AI/ML engineering by Patryk Golabek"
   - Page structure:
     - `<section>` with max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16
     - `<h1>` "Blog" with text-3xl sm:text-4xl font-heading font-bold mb-8
     - A `<div class="space-y-8">` mapping over sortedPosts, rendering `<BlogCard post={post} />` for each
     - Empty state: if sortedPosts.length === 0, show a `<p>` with "No posts yet. Check back soon!" in text-secondary color
  </action>
  <verify>
    Run `npm run build` and confirm:
    - /blog/index.html is generated in dist/
    - The HTML contains the published post title ("Building a Kubernetes Observability Stack")
    - The HTML does NOT contain the draft post title ("Upcoming: AI Agent Architectures with LangGraph")
  </verify>
  <done>
    BlogCard component renders post metadata with proper link structure. Blog listing page at /blog/ shows chronologically sorted published posts, excludes drafts in production, handles empty state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create individual blog post page with prose styling and reading time</name>
  <files>
    src/pages/blog/[slug].astro
  </files>
  <action>
1. Create `src/pages/blog/[slug].astro`:
   - Import getCollection and render from 'astro:content' (Astro 5: render is a standalone import, NOT a method on the entry)
   - Import Layout from '../../layouts/Layout.astro'

   - Export async function getStaticPaths():
     - Query posts with SAME draft filter as listing page: `import.meta.env.PROD ? data.draft !== true : true` (CRITICAL: must filter here too, otherwise draft posts generate pages even if hidden from listing)
     - Map posts to params/props: `{ params: { slug: post.id }, props: { post } }` (use post.id, NOT post.slug)

   - In the page body:
     - Get post from Astro.props
     - Call `const { Content, remarkPluginFrontmatter } = await render(post);`
     - Wrap in Layout with title={post.data.title} and description={post.data.description}

   - Article structure:
     - `<article>` with max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-16
     - `<header class="mb-8">`:
       - `<h1>` with text-3xl sm:text-4xl font-heading font-bold
       - Metadata row: flex flex-wrap items-center gap-x-4 gap-y-2 mt-4 text-sm text-[var(--color-text-secondary)]
         - `<time>` with datetime attribute, formatted date
         - `<span>` with aria-label="Reading time" showing {remarkPluginFrontmatter.minutesRead}
       - Tags row (conditional): same styling as BlogCard tags
     - `<div class="prose max-w-none mt-8">`:
       - Use just `prose` class (NOT `prose dark:prose-invert`) because the tailwind.config.mjs prose customization maps to CSS custom properties that already change between light and dark modes
       - max-w-none because the outer article already constrains width to max-w-3xl
       - Render `<Content />` inside this div
     - After the article, add a "Back to Blog" link:
       - `<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">`
       - `<a href="/blog/" class="text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] transition-colors">` with text "‚Üê Back to Blog"
  </action>
  <verify>
    Run `npm run build` and confirm:
    - /blog/building-kubernetes-observability-stack/index.html is generated in dist/
    - The HTML contains the post title, reading time text (e.g., "2 min read"), formatted date
    - The HTML contains syntax-highlighted code blocks (look for expressive-code wrapper classes)
    - The draft post does NOT have a generated page in dist/blog/
    - Run `npm run dev` and manually verify at http://localhost:4321/blog/building-kubernetes-observability-stack/ that:
      - Prose typography is readable
      - Code blocks have syntax highlighting
      - Copy button is visible on code blocks
  </verify>
  <done>
    Individual blog post pages render at /blog/[slug]/ with: readable prose typography, syntax-highlighted code blocks with copy buttons, reading time display, formatted date, tags, back-to-blog link. Draft posts do not generate pages in production.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. dist/blog/index.html exists and contains published post title but NOT draft post title
3. dist/blog/building-kubernetes-observability-stack/index.html exists with prose content, reading time, syntax highlighting
4. No dist/blog/draft-placeholder/index.html exists (draft filtered)
5. Code blocks in the built HTML have expressive-code wrapper markup (syntax highlighting + copy button)
6. Reading time text (e.g., "2 min read") appears in the post page HTML
</verification>

<success_criteria>
- /blog/ listing page shows published posts sorted newest-first, excludes drafts in production
- /blog/[slug]/ post pages render with readable prose, syntax-highlighted code, copy buttons, reading time, date, tags
- Draft posts neither appear on /blog/ listing nor generate individual pages in production builds
- All five Phase 3 requirements (BLOG-01 through BLOG-05) are satisfied
- `npm run build` passes cleanly with correct page output
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-infrastructure/03-02-SUMMARY.md`
</output>
