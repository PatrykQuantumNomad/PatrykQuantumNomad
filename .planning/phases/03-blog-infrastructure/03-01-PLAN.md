---
phase: 03-blog-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - astro.config.mjs
  - tailwind.config.mjs
  - remark-reading-time.mjs
  - src/content.config.ts
  - src/data/blog/building-kubernetes-observability-stack.md
  - src/data/blog/draft-placeholder.md
autonomous: true

must_haves:
  truths:
    - "Astro content collection for blog is defined and recognized at build time"
    - "Blog posts with valid frontmatter are loadable via getCollection('blog')"
    - "Reading time is auto-calculated for each post at build time"
    - "Syntax highlighting themes sync with the class-based dark mode toggle"
    - "Tailwind prose classes render readable typography using site theme colors"
  artifacts:
    - path: "src/content.config.ts"
      provides: "Blog collection schema with Zod validation"
      contains: "defineCollection"
    - path: "remark-reading-time.mjs"
      provides: "Reading time remark plugin"
      contains: "remarkReadingTime"
    - path: "astro.config.mjs"
      provides: "Integration config with expressiveCode, mdx, tailwind, and remark plugin"
      contains: "expressiveCode"
    - path: "tailwind.config.mjs"
      provides: "Typography plugin with CSS custom property prose overrides"
      contains: "typography"
    - path: "src/data/blog/building-kubernetes-observability-stack.md"
      provides: "Sample published blog post with code blocks and valid frontmatter"
      contains: "draft: false"
    - path: "src/data/blog/draft-placeholder.md"
      provides: "Sample draft blog post for testing draft filtering"
      contains: "draft: true"
  key_links:
    - from: "astro.config.mjs"
      to: "remark-reading-time.mjs"
      via: "remarkPlugins array"
      pattern: "remarkPlugins.*remarkReadingTime"
    - from: "astro.config.mjs"
      to: "astro-expressive-code"
      via: "integrations array (before mdx)"
      pattern: "expressiveCode.*mdx"
    - from: "src/content.config.ts"
      to: "src/data/blog/"
      via: "glob loader base path"
      pattern: "glob.*src/data/blog"
---

<objective>
Install blog infrastructure dependencies and create the content collection schema, remark reading-time plugin, sample blog posts, and all configuration updates needed for the blog to function.

Purpose: Establishes the data layer and build pipeline that Plan 02 (pages and components) depends on. Without this foundation, there is no content to query or render.
Output: Working content collection, configured integrations (expressive-code, MDX, typography), reading time plugin, and sample posts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-blog-infrastructure/03-RESEARCH.md
@astro.config.mjs
@tailwind.config.mjs
@package.json
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure integrations</name>
  <files>
    package.json
    astro.config.mjs
    tailwind.config.mjs
    remark-reading-time.mjs
  </files>
  <action>
1. Install all required packages:
   ```
   npm install @astrojs/mdx astro-expressive-code @tailwindcss/typography reading-time mdast-util-to-string
   ```

2. Create `remark-reading-time.mjs` at project root:
   - Import `getReadingTime` from 'reading-time' and `toString` from 'mdast-util-to-string'
   - Export `remarkReadingTime` function that extracts text from the markdown AST tree, passes it to getReadingTime, and injects `data.astro.frontmatter.minutesRead` with the result text (e.g., "5 min read")
   - Follow the exact pattern from the official Astro recipe in the research doc

3. Update `astro.config.mjs`:
   - Add imports: expressiveCode from 'astro-expressive-code', mdx from '@astrojs/mdx', remarkReadingTime from './remark-reading-time.mjs'
   - Replace the integrations array with: expressiveCode (MUST come first), then mdx(), then tailwind()
   - Expressive Code config:
     - themes: ['github-dark', 'github-light']
     - themeCssSelector: function that maps 'github-dark' to '.dark' selector and 'github-light' to ':root:not(.dark)'
     - useDarkModeMediaQuery: false (critical -- the existing site uses class-based dark mode via .dark on html, NOT media queries)
   - Add markdown.remarkPlugins: [remarkReadingTime]
   - Keep existing site and output config unchanged

4. Update `tailwind.config.mjs`:
   - Add ESM import: `import typography from '@tailwindcss/typography';` (NOT require -- project uses "type": "module")
   - Add `typography` section inside theme.extend with prose CSS custom property overrides:
     - DEFAULT.css: set --tw-prose-body, --tw-prose-headings, --tw-prose-links, --tw-prose-bold, --tw-prose-code, --tw-prose-quotes, --tw-prose-hr, --tw-prose-th-borders, --tw-prose-td-borders using the existing CSS custom properties (var(--color-text-primary), var(--color-accent), var(--color-text-secondary), var(--color-border))
     - The invert variant is NOT needed because CSS custom properties already change values between :root and :root.dark. Just use `prose` class (no need for dark:prose-invert since the custom properties handle both modes).
   - Add `plugins: [typography]` (replacing the empty plugins array)
  </action>
  <verify>
    Run `npm run build` -- build must complete without errors. Specifically:
    - No "require is not defined" errors (ESM compatibility)
    - No "integration not found" errors
    - expressiveCode, mdx, and tailwind all listed in build output
  </verify>
  <done>
    All 5 packages installed, astro.config.mjs has expressiveCode (before mdx) + mdx + tailwind integrations with reading-time remark plugin, tailwind.config.mjs has typography plugin with prose custom property overrides, remark-reading-time.mjs exists at project root.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create content collection schema and sample blog posts</name>
  <files>
    src/content.config.ts
    src/data/blog/building-kubernetes-observability-stack.md
    src/data/blog/draft-placeholder.md
  </files>
  <action>
1. Create `src/content.config.ts` (MUST be inside src/, not project root -- Astro 5 requirement):
   - Import defineCollection, z from 'astro:content' and glob from 'astro/loaders'
   - Define `blog` collection with glob loader: pattern '**/*.{md,mdx}', base './src/data/blog'
   - Zod schema with fields:
     - title: z.string()
     - description: z.string()
     - publishedDate: z.coerce.date()
     - updatedDate: z.coerce.date().optional()
     - tags: z.array(z.string()).default([])
     - draft: z.boolean().default(false)
   - Export collections = { blog }

2. Create `src/data/blog/building-kubernetes-observability-stack.md`:
   - This is a REAL blog post with meaningful content (not lorem ipsum) -- the project requires "full real content" per PROJECT.md
   - Frontmatter:
     - title: "Building a Kubernetes Observability Stack"
     - description: "A practical guide to implementing observability in Kubernetes using Prometheus, Grafana, and OpenTelemetry for production-grade monitoring."
     - publishedDate: 2026-02-11
     - tags: ["kubernetes", "observability", "cloud-native", "devops"]
     - draft: false
   - Content: Write 400-600 words covering: why observability matters for K8s, the three pillars (metrics, logs, traces), a brief overview of the Prometheus + Grafana + OpenTelemetry stack, and a code block showing a sample Prometheus scrape config or a Kubernetes deployment manifest snippet (YAML). Include at least one TypeScript/JavaScript code block as well to test syntax highlighting for multiple languages. Use 2-3 headings (h2).
   - The content must be genuinely useful and SEO-relevant (Patryk is a Kubernetes architect with 17+ years experience)

3. Create `src/data/blog/draft-placeholder.md`:
   - Frontmatter:
     - title: "Upcoming: AI Agent Architectures with LangGraph"
     - description: "Exploring multi-agent systems and graph-based orchestration for LLM applications."
     - publishedDate: 2026-03-01
     - tags: ["ai", "langraph", "llm-agents"]
     - draft: true
   - Content: 2-3 paragraphs of placeholder content (this is a draft so placeholder is fine)
  </action>
  <verify>
    Run `npm run build` -- build must complete without errors. Specifically:
    - No Zod validation errors (all frontmatter fields pass schema)
    - Content collection is detected (no "collection not found" warnings)
    - Only the published post generates a page (check build output for page count)
  </verify>
  <done>
    Content collection defined at src/content.config.ts with Zod schema, one published post and one draft post exist in src/data/blog/, build succeeds with collection detection.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Build output shows expressiveCode and mdx integrations loaded
3. No Zod schema validation errors from content collection
4. The published post is processed; the draft post does not generate a page in production build
</verification>

<success_criteria>
- All 5 npm packages installed and importable
- astro.config.mjs: expressiveCode (before mdx), mdx, tailwind integrations; remarkReadingTime in markdown.remarkPlugins
- tailwind.config.mjs: typography plugin with prose CSS custom property overrides
- remark-reading-time.mjs: exports remarkReadingTime function
- src/content.config.ts: blog collection with Zod schema and glob loader pointing to src/data/blog/
- src/data/blog/ contains one published post with code blocks and one draft post
- `npm run build` passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-infrastructure/03-01-SUMMARY.md`
</output>
