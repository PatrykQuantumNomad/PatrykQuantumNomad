---
phase: 56-infrastructure-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/eda/PlotFigure.astro
  - src/components/eda/NormalRandomPlots.astro
  - src/components/eda/CryothermometryPlots.astro
  - src/components/eda/FilterTransmittancePlots.astro
  - src/components/eda/HeatFlowMeterPlots.astro
  - src/components/eda/FatigueLifePlots.astro
  - src/components/eda/CeramicStrengthPlots.astro
  - src/components/eda/UniformRandomPlots.astro
  - src/components/eda/BeamDeflectionPlots.astro
  - src/components/eda/RandomWalkPlots.astro
  - .planning/phases/56-infrastructure-foundation/case-study-template.md
  - .planning/phases/56-infrastructure-foundation/url-cross-reference.md
autonomous: true
requirements:
  - INFRA-02
  - INFRA-03
  - INFRA-04

must_haves:
  truths:
    - "PlotFigure.astro renders identical HTML output to the inline figure block it replaces"
    - "All 9 Plots components use PlotFigure instead of inline figure HTML"
    - "A canonical section template document defines the standard heading structure for all 4 case study variations"
    - "A URL cross-reference cheat sheet lists every technique, quantitative, distribution, and case study slug"
  artifacts:
    - path: "src/components/eda/PlotFigure.astro"
      provides: "Shared figure wrapper for all EDA plot components"
      exports: ["default"]
      contains: "figure class"
    - path: ".planning/phases/56-infrastructure-foundation/case-study-template.md"
      provides: "Canonical section template with 4 variations"
      contains: "Background and Data"
    - path: ".planning/phases/56-infrastructure-foundation/url-cross-reference.md"
      provides: "Complete slug mapping for cross-reference links"
      contains: "/eda/techniques/"
  key_links:
    - from: "src/components/eda/NormalRandomPlots.astro"
      to: "src/components/eda/PlotFigure.astro"
      via: "import PlotFigure"
      pattern: "import PlotFigure"
    - from: "src/components/eda/CryothermometryPlots.astro"
      to: "src/components/eda/PlotFigure.astro"
      via: "import PlotFigure"
      pattern: "import PlotFigure"
    - from: ".planning/phases/56-infrastructure-foundation/url-cross-reference.md"
      to: "src/data/eda/techniques.json"
      via: "slug enumeration"
      pattern: "techniques"
---

<objective>
Extract the shared PlotFigure.astro wrapper component, refactor all 9 Plots components to use it, create the canonical case study section template, and build the URL cross-reference cheat sheet.

Purpose: PlotFigure eliminates 99 lines of HTML duplication across 9 components and ensures consistent figure rendering for all case studies added in phases 57-62. The template and cheat sheet are reference documents that prevent structural inconsistencies and broken links during content authoring.

Output: PlotFigure.astro component, 9 refactored Plots components, case-study-template.md, url-cross-reference.md
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-infrastructure-foundation/56-RESEARCH.md

@src/components/eda/NormalRandomPlots.astro
@src/data/eda/techniques.json
@src/data/eda/distributions.json
</context>

<interfaces>
<!-- Key interfaces the executor needs from existing codebase -->

From src/components/eda/NormalRandomPlots.astro (lines 114-123) -- the shared figure HTML block to extract:
```astro
<figure class="my-8 not-prose">
  <div class="overflow-x-auto rounded-lg border border-[var(--color-border)] bg-white dark:bg-[#1a1a2e] p-3">
    <div class="mx-auto" style={`max-width: ${type === '4-plot' ? '720px' : '720px'}`} set:html={svg} />
  </div>
  {figCaption && (
    <figcaption class="mt-2 text-center text-sm text-[var(--color-text-secondary)] italic">
      {figCaption}
    </figcaption>
  )}
</figure>
```

Note: The ternary `type === '4-plot' ? '720px' : '720px'` always evaluates to '720px' -- simplify to a constant default.

All 9 *Plots.astro files share this identical block. Each file has a `svg` variable (string) and a `figCaption` variable (string | undefined).
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Create PlotFigure.astro and refactor all 9 Plots components</name>
  <files>
    src/components/eda/PlotFigure.astro
    src/components/eda/NormalRandomPlots.astro
    src/components/eda/CryothermometryPlots.astro
    src/components/eda/FilterTransmittancePlots.astro
    src/components/eda/HeatFlowMeterPlots.astro
    src/components/eda/FatigueLifePlots.astro
    src/components/eda/CeramicStrengthPlots.astro
    src/components/eda/UniformRandomPlots.astro
    src/components/eda/BeamDeflectionPlots.astro
    src/components/eda/RandomWalkPlots.astro
  </files>
  <action>
    1. Create `src/components/eda/PlotFigure.astro` with this exact implementation:
       - Props interface: `{ svg: string; caption?: string; maxWidth?: string }`
       - Default maxWidth: '720px'
       - Template: the shared figure/figcaption HTML block from the existing Plots components
       - The figure HTML must be pixel-identical to the current inline version

    2. Refactor `NormalRandomPlots.astro` first as proof of concept:
       - Add `import PlotFigure from './PlotFigure.astro';` at the top of the frontmatter
       - Replace the entire `<figure>...</figure>` block (lines 114-123) with:
         `<PlotFigure svg={svg} caption={figCaption} />`
       - Keep all frontmatter logic (switch statement, defaultCaptions, etc.) unchanged

    3. Run `npx astro build` to verify NormalRandomPlots renders correctly with no regressions.

    4. Refactor the remaining 8 *Plots.astro files identically:
       - Read each file to understand its specific variables (they all use `svg` and `figCaption` but variable names may differ slightly)
       - Add the PlotFigure import
       - Replace the inline figure block with `<PlotFigure svg={svg} caption={figCaption} />`
       - Do NOT change any frontmatter logic, switch statements, or dataset imports

    5. Run `npx astro build` again to verify all 9 components work correctly.

    **What to avoid and why:**
    - Do NOT change the CSS classes or structure inside PlotFigure -- the extraction must produce identical HTML output
    - Do NOT rename the `figCaption` variable in any component -- just pass it through to PlotFigure's `caption` prop
    - Do NOT add any additional props or features to PlotFigure beyond svg, caption, and maxWidth -- keep it minimal for now
  </action>
  <verify>
    ```bash
    npx astro build 2>&1 | tail -10
    ```
    Build completes successfully with 0 errors. Grep to confirm all 9 components import PlotFigure:
    ```bash
    grep -l "import PlotFigure" src/components/eda/*Plots.astro | wc -l
    ```
    Result must be 9.
  </verify>
  <done>PlotFigure.astro exists with svg/caption/maxWidth props. All 9 *Plots.astro files import and use PlotFigure instead of inline figure HTML. Astro build passes with 0 errors.</done>
</task>

<task type="auto">
  <name>Task 2: Create canonical case study section template and URL cross-reference cheat sheet</name>
  <files>
    .planning/phases/56-infrastructure-foundation/case-study-template.md
    .planning/phases/56-infrastructure-foundation/url-cross-reference.md
  </files>
  <action>
    1. Create `.planning/phases/56-infrastructure-foundation/case-study-template.md`:
       - Title: "Canonical Case Study Section Template"
       - Purpose section explaining this is a reference for phases 57-62 content authors
       - **Standard Template** (for Normal Random, Cryothermometry, Heat Flow Meter, Filter Transmittance):
         ```
         ## Background and Data
         ## Test Underlying Assumptions
         ### Goals
         ## Graphical Output and Interpretation
         ### 4-Plot Overview
         ### Run Sequence Plot
         ### Lag Plot
         ### Histogram
         ### Normal Probability Plot
         ### Autocorrelation Plot
         ### Spectral Plot
         ## Quantitative Output and Interpretation
         ### Summary Statistics
         ### Location Test
         ### Variation Test
         ### Randomness Tests
         ### Distribution Test
         ### Outlier Detection
         ### Test Summary
         ## Interpretation
         ## Conclusions
         ```
       - **Distribution Focus Variation** (Uniform Random, Fatigue Life): Add "### Distribution Comparison" subsection under Graphical Output
       - **Model Development Variation** (Beam Deflections): Add "## Develop Better Model" and "## Validate New Model" sections after Quantitative Output
       - **DOE Variation** (Ceramic Strength): Replace standard sections with "## Response Variable Analysis", "## Batch Effect Analysis", "## Lab Effect Analysis", "## Primary Factors Analysis", "## Interpretation"
       - For each heading in the template, include a 1-line description of what content goes there
       - Include notes on which `<*Plots type="...">` component call maps to each graphical subsection
       - Include notes on which statistics function call maps to each quantitative subsection

    2. Create `.planning/phases/56-infrastructure-foundation/url-cross-reference.md`:
       - Title: "EDA URL Cross-Reference Cheat Sheet"
       - Purpose section explaining this prevents broken links in case study MDX
       - **Section 1: Route Patterns** -- table showing the 6 URL patterns (/eda/techniques/{slug}/, /eda/quantitative/{slug}/, /eda/distributions/{slug}/, /eda/case-studies/{slug}/, /eda/foundations/{slug}/, /eda/reference/{slug}/)
       - **Section 2: Graphical Technique Slugs** -- enumerate all 28 slugs from techniques.json where category="graphical", read the actual file to get exact slugs
       - **Section 3: Quantitative Technique Slugs** -- enumerate all 18 slugs from techniques.json where category="quantitative"
       - **Section 4: Distribution Slugs** -- enumerate from distributions.json
       - **Section 5: Case Study Slugs** -- list all 9 case study slugs (including "standard-resistor" which will be added in Phase 58)
       - **Section 6: Foundation Slugs** -- enumerate from foundations/*.mdx filenames
       - **Section 7: Reference Slugs** -- enumerate from reference/*.mdx filenames
       - **Section 8: Most Common Cross-References** -- table of the most frequently used links in case studies (technique pages, quantitative pages, inter-case-study links) with the full URL path for easy copy-paste
       - Read `src/data/eda/techniques.json` and `src/data/eda/distributions.json` to enumerate actual slugs -- do NOT copy from research, verify from source data

    **What to avoid and why:**
    - Do NOT invent slugs -- enumerate from actual data files only
    - Do NOT make these rendered Astro components -- they are planning reference documents in .planning/
    - Do NOT include URLs for pages that don't exist yet (standard-resistor is not yet built, but include it with a "(Phase 58)" note)
  </action>
  <verify>
    Verify both files exist and have substantive content:
    ```bash
    wc -l .planning/phases/56-infrastructure-foundation/case-study-template.md .planning/phases/56-infrastructure-foundation/url-cross-reference.md
    ```
    case-study-template.md should be 80+ lines (4 template variations with descriptions).
    url-cross-reference.md should be 100+ lines (all slugs enumerated).
  </verify>
  <done>case-study-template.md exists with the standard template plus 3 variations (distribution, model-development, DOE), each heading annotated with content description and component/function mappings. url-cross-reference.md exists with all slugs enumerated from actual data files, organized by route pattern, with a common cross-references quick-reference table.</done>
</task>

</tasks>

<verification>
Overall plan verification:
1. `npx astro build` completes with 0 errors (PlotFigure extraction did not break rendering)
2. All 9 *Plots.astro files import PlotFigure (grep confirms 9 matches)
3. case-study-template.md covers all 4 template variations
4. url-cross-reference.md lists all slugs from techniques.json (28 graphical + 18 quantitative) + distributions.json + case studies
</verification>

<success_criteria>
- PlotFigure.astro component exists with svg, caption, maxWidth props
- All 9 *Plots.astro files refactored to use PlotFigure (0 inline figure blocks remaining)
- Astro build passes with 0 errors
- case-study-template.md defines canonical heading structure for 4 case study variations
- url-cross-reference.md maps all technique/quantitative/distribution/case-study slugs
</success_criteria>

<output>
After completion, create `.planning/phases/56-infrastructure-foundation/56-02-SUMMARY.md`
</output>
