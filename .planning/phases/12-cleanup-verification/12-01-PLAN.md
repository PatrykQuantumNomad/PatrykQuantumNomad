---
phase: 12-cleanup-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/blog/draft-placeholder.md
  - src/pages/llms.txt.ts
  - src/pages/index.astro
autonomous: true

must_haves:
  truths:
    - "Draft placeholder blog post does not exist in the repository"
    - "LLMs.txt links external blog posts to their canonical external URLs, not internal /blog/ext-*/ paths"
    - "Homepage Latest Writing links external posts to their external URLs with target=_blank"
    - "astro build completes with zero errors"
    - "Sitemap contains all valid pages and no removed or non-existent pages"
    - "RSS feed links external posts to external URLs and local posts to internal URLs"
    - "LLMs.txt contains no broken links to non-existent /blog/ext-*/ pages"
  artifacts:
    - path: "src/pages/llms.txt.ts"
      provides: "LLMs.txt with correct external post URLs"
      contains: "externalUrl"
    - path: "src/pages/index.astro"
      provides: "Homepage with correct Latest Writing links"
      contains: "externalUrl"
  key_links:
    - from: "src/pages/llms.txt.ts"
      to: "blog collection externalUrl field"
      via: "nullish coalescing for URL resolution"
      pattern: "externalUrl.*\\?\\?"
    - from: "src/pages/index.astro"
      to: "blog collection externalUrl field"
      via: "conditional href with target=_blank for external"
      pattern: "externalUrl"
---

<objective>
Delete the draft placeholder blog post, fix two bugs where external blog posts link to non-existent internal paths (LLMs.txt and homepage Latest Writing), and verify all build outputs reflect the complete v1.1 content changes.

Purpose: This is the final phase of v1.1. It ensures every generated output (sitemap, RSS, LLMs.txt, OG images) accurately reflects the content changes made in Phases 8-11, and removes the last piece of stale content.
Output: Clean repository with all outputs verified correct.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-cleanup-verification/12-RESEARCH.md
@src/pages/llms.txt.ts
@src/pages/index.astro
@src/components/BlogCard.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete draft placeholder and fix external URL bugs in LLMs.txt and homepage</name>
  <files>src/data/blog/draft-placeholder.md, src/pages/llms.txt.ts, src/pages/index.astro</files>
  <action>
    **1. Delete draft placeholder (CLEAN-01):**
    Delete `src/data/blog/draft-placeholder.md` entirely. No other files reference it -- the draft filter handles exclusion already, so deletion requires no other changes.

    **2. Fix LLMs.txt external URL bug:**
    In `src/pages/llms.txt.ts`, line 19 hardcodes `https://patrykgolabek.dev/blog/${p.id}/` for ALL posts. External posts (10 of them) link to non-existent `/blog/ext-*/` paths.

    Fix: Change the map callback to use nullish coalescing (same pattern as `rss.xml.ts`):
    ```typescript
    `- [${p.data.title}](${p.data.externalUrl ?? `https://patrykgolabek.dev/blog/${p.id}/`}): ${p.data.description}`
    ```

    **3. Fix homepage Latest Writing external URL bug:**
    In `src/pages/index.astro`, the "Latest Writing" section (around line 122) hardcodes `href={/blog/${post.id}/}` for all posts. External posts link to 404 pages.

    Fix: Follow the established BlogCard.astro pattern. Before the map in the frontmatter section (or inline), compute the correct href and add external attributes:
    ```astro
    {latestPosts.map((post) => {
      const isExternal = !!post.data.externalUrl;
      const href = isExternal ? post.data.externalUrl : `/blog/${post.id}/`;
      return (
        <article class="p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
          <a
            href={href}
            class="text-lg font-heading font-bold text-[var(--color-text-primary)] hover:text-[var(--color-accent)] transition-colors"
            {...isExternal && { target: "_blank", rel: "noopener noreferrer" }}
          >
            {post.data.title}
          </a>
          ...rest of article unchanged...
        </article>
      );
    })}
    ```

    Also add a source badge and external link icon for external posts to match BlogCard.astro's visual pattern. After the `<time>` element, add:
    ```astro
    {post.data.source && (
      <span class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">
        on {post.data.source}
      </span>
    )}
    {isExternal && (
      <svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 text-[var(--color-text-secondary)] ml-1" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5zm7.25-.75a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0V6.31l-5.47 5.47a.75.75 0 01-1.06-1.06l5.47-5.47H12.25a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
      </svg>
    )}
    ```

    **What NOT to do:**
    - Do NOT extract a shared `getBlogPostUrl` helper -- it is optional and out of scope for Phase 12 (only 2 files need fixing, pattern is a one-liner).
    - Do NOT fix the pre-existing `astro check` Buffer type error in `[...slug].png.ts` -- it predates v1.1 and is out of scope.
  </action>
  <verify>
    1. Confirm `src/data/blog/draft-placeholder.md` no longer exists: `ls src/data/blog/draft-placeholder.md` should fail
    2. Confirm `llms.txt.ts` contains `externalUrl` in the URL construction
    3. Confirm `index.astro` contains `externalUrl` in the Latest Writing href and has `target: "_blank"` for external posts
  </verify>
  <done>
    - draft-placeholder.md is deleted from the repository
    - llms.txt.ts uses nullish coalescing to resolve external blog post URLs
    - index.astro Latest Writing section links external posts to their external URLs with target=_blank and shows source badge + external link icon
  </done>
</task>

<task type="auto">
  <name>Task 2: Build and verify all generated outputs match v1.1 content</name>
  <files></files>
  <action>
    Run `astro build` and inspect all generated outputs to confirm CLEAN-02 and CLEAN-03.

    **CLEAN-02 verification:**
    1. Run `npx astro build` -- must complete with zero errors
    2. Confirm page count is 19 (same as before deletion, since draft was already excluded from prod builds):
       - 5 static pages: index, about, blog/index, contact, projects/index
       - 1 blog detail: building-kubernetes-observability-stack
       - 13 tag pages
    3. Note: the pre-existing `astro check` Buffer type error is NOT a v1.1 issue and is acceptable

    **CLEAN-03 verification -- Sitemap:**
    1. Read `dist/sitemap-0.xml`
    2. Confirm 19 URLs present
    3. Confirm NO `/blog/ext-*/` URLs in sitemap
    4. Confirm NO draft-placeholder URLs in sitemap

    **CLEAN-03 verification -- RSS feed:**
    1. Read `dist/rss.xml`
    2. Confirm 11 items (1 local + 10 external)
    3. Confirm external posts have external URLs as links (e.g., mykubert.com, translucentcomputing.com)
    4. Confirm local post links to `https://patrykgolabek.dev/blog/building-kubernetes-observability-stack/`

    **CLEAN-03 verification -- LLMs.txt:**
    1. Read `dist/llms.txt`
    2. Confirm ALL external posts link to their external URLs (no `patrykgolabek.dev/blog/ext-*/` links)
    3. Confirm local post links to correct internal path

    **CLEAN-03 verification -- OG images:**
    1. List `dist/open-graph/` directory
    2. Confirm only 1 OG image exists: `blog/building-kubernetes-observability-stack.png`
    3. Confirm NO `ext-*` OG images exist

    **CLEAN-03 verification -- Homepage:**
    1. Read `dist/index.html`
    2. Confirm Latest Writing links use correct external URLs for external posts
    3. Confirm `target="_blank"` present on external post links

    Report all verification results. If any check fails, fix the issue and re-verify.
  </action>
  <verify>
    All checks pass:
    - `npx astro build` exits 0
    - `dist/sitemap-0.xml` has 19 URLs, no ext-* or draft paths
    - `dist/rss.xml` has 11 items with correct links
    - `dist/llms.txt` has no broken ext-* links
    - `dist/open-graph/` has exactly 1 image
    - `dist/index.html` Latest Writing links are correct
  </verify>
  <done>
    - astro build completes with zero errors and produces 19 pages
    - Sitemap lists 19 valid URLs with no stale or non-existent pages
    - RSS feed has 11 items with correct links (external posts use external URLs)
    - LLMs.txt links all external posts to their canonical external URLs
    - Only 1 OG image generated (for the single local blog post)
    - Homepage Latest Writing links are correct for both local and external posts
    - All CLEAN-01, CLEAN-02, CLEAN-03 requirements are satisfied
  </done>
</task>

</tasks>

<verification>
Phase-level verification after both tasks complete:

1. **CLEAN-01**: `src/data/blog/draft-placeholder.md` does not exist in the repository
2. **CLEAN-02**: `astro build` completes with zero errors, producing 19 pages
3. **CLEAN-03**: All generated outputs are consistent:
   - Sitemap: 19 URLs, all valid
   - RSS: 11 items, correct links
   - LLMs.txt: No broken links, external posts use external URLs
   - OG images: 1 image for the single local post
   - Homepage: Latest Writing links resolve correctly

**Known pre-existing issue (NOT a blocker):** `astro check` reports a Buffer type error in `src/pages/open-graph/[...slug].png.ts` -- this predates v1.1 and is out of scope.
</verification>

<success_criteria>
- draft-placeholder.md deleted from repository
- llms.txt.ts uses externalUrl for external blog posts
- index.astro Latest Writing uses externalUrl with target=_blank for external posts
- astro build produces 19 pages with zero errors
- All 5 generated outputs (sitemap, RSS, LLMs.txt, OG images, homepage HTML) verified correct
- v1.1 Content Refresh milestone is complete
</success_criteria>

<output>
After completion, create `.planning/phases/12-cleanup-verification/12-01-SUMMARY.md`
</output>
