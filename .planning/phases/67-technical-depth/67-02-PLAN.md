---
phase: 67-technical-depth
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/eda/technique-content/distribution-shape.ts
autonomous: true
requirements: [DEFN-02, PYTH-01, PYTH-02, PYTH-03, PYTH-04]

must_haves:
  truths:
    - "All 9 distribution-shape technique pages display syntax-highlighted Python code examples"
    - "bootstrap-plot, box-cox-linearity, box-cox-normality, normal-probability-plot, and probability-plot pages display KaTeX-rendered formulas"
    - "qq-plot page displays KaTeX-rendered formulas"
    - "No deprecated Python APIs appear in any code example"
    - "All Python examples are self-contained with imports and sample data generation"
    - "KaTeX CSS loads only on the 6 pages with formulas, not on bihistogram/box-plot/histogram"
  artifacts:
    - path: "src/lib/eda/technique-content/distribution-shape.ts"
      provides: "formulas (6 techniques) + pythonCode (9 techniques)"
      contains: "pythonCode"
  key_links:
    - from: "src/lib/eda/technique-content/distribution-shape.ts"
      to: "src/pages/eda/techniques/[slug].astro"
      via: "getTechniqueContent() barrel export"
      pattern: "formulas.*String\\.raw"
---

<objective>
Add KaTeX formulas and Python code examples to all 9 techniques in the distribution-shape category file.

Purpose: This is the largest category with 9 techniques and 6 formula sets (5 from the original 12 list + qq-plot). It covers the core distribution analysis techniques that form the backbone of EDA.
Output: distribution-shape.ts with 6 formula arrays and 9 pythonCode strings
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/67-technical-depth/67-RESEARCH.md

@src/lib/eda/technique-content/types.ts
@src/lib/eda/technique-content/distribution-shape.ts
@src/lib/eda/quantitative-content.ts

<interfaces>
From src/lib/eda/technique-content/types.ts:
```typescript
formulas?: Array<{
  label: string;
  tex: string;       // KaTeX display-mode formula (MUST use String.raw)
  explanation: string;
}>;
pythonCode?: string;
```

Deprecated API watchlist (MUST NOT appear):
- distplot -> use sns.histplot() or sns.kdeplot()
- vert=True -> use orientation='vertical'
- normed=True -> use density=True
- random_state= -> use rng=
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add formulas and pythonCode to 5 formula-bearing distribution-shape techniques</name>
  <files>src/lib/eda/technique-content/distribution-shape.ts</files>
  <action>
Add `formulas` and `pythonCode` fields to the 5 techniques that need BOTH formulas and Python code. Place fields AFTER existing content fields in each entry. Also add formulas and pythonCode to qq-plot (6th formula technique in this file).

**probability-plot** (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.22
  1. Plotting positions: m_i = (i - a)/(N + 1 - 2a) where a depends on distribution
  2. PPCC correlation coefficient between ordered data and theoretical quantiles
- pythonCode: Use `scipy.stats.probplot(dist='expon')` to show non-normal distribution fitting. ~15-18 lines.

**normal-probability-plot** (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.21
  1. Normal order statistics median approximation
  2. Slope = sigma estimate, intercept = mu estimate from fitted line
- pythonCode: Use `scipy.stats.probplot(dist='norm')`. Generate normal data. ~15-18 lines.

**bootstrap-plot** (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.4
  1. Bootstrap resample: draw N observations with replacement from original sample
  2. Percentile confidence interval: (theta*_{alpha/2}, theta*_{1-alpha/2})
- pythonCode: Use `scipy.stats.bootstrap()` with `rng=` parameter (NOT `random_state=`). Generate normal data, bootstrap the mean. Show histogram of bootstrap distribution. ~20-25 lines.

**box-cox-linearity** (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.5
  1. Box-Cox transformation: T(X) = (X^lambda - 1)/lambda for lambda != 0, ln(X) for lambda = 0
  2. Linearity measure: correlation r(lambda) between Y and T_lambda(X)
- pythonCode: Manual loop computing Pearson correlation for each lambda value. Use `scipy.stats.pearsonr()`. Generate nonlinear relationship data. ~20-25 lines.

**box-cox-normality** (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.6
  1. Box-Cox transformation for normality: T(Y) = (Y^lambda - 1)/lambda
  2. PPCC vs lambda curve (the plot itself)
- pythonCode: Use `scipy.stats.boxcox_normplot()`. Generate right-skewed lognormal data. ~15-18 lines. (Pattern provided in RESEARCH.md code examples.)

**qq-plot** (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.24
  1. Quantile matching: plot Q_1(p_i) vs Q_2(p_i) for percentiles p_i
  2. Plotting positions: p_i = (i - 0.5)/N
- pythonCode: Two-sample QQ plot -- manual quantile matching with `np.quantile()`. Generate two samples from different distributions. ~18-22 lines.

CRITICAL RULES:
- ALL `tex` values MUST use `String.raw` template literals
- ALL Python examples MUST use `np.random.default_rng(42)`
- For bootstrap: use `scipy.stats.bootstrap(rng=np.random.default_rng(42))` NOT `random_state=`
- For box-cox-normality: follow the exact pattern from RESEARCH.md code example
- Do NOT use `distplot`, `vert=True`, `normed=True`, or `plt.acorr()`
  </action>
  <verify>
npx astro build 2>&1 | tail -5
# Must show zero errors
grep -c 'formulas' src/lib/eda/technique-content/distribution-shape.ts
# Must return at least 6 (one per formula-bearing technique)
grep -c 'String.raw' src/lib/eda/technique-content/distribution-shape.ts
# Must return at least 12 (2 formulas each x 6 techniques)
grep -n 'distplot\|vert=True\|normed=True\|plt\.acorr(\|random_state=' src/lib/eda/technique-content/distribution-shape.ts
# Must return zero matches
  </verify>
  <done>6 distribution-shape techniques have formulas arrays with String.raw tex strings and pythonCode strings. Build passes. No deprecated APIs.</done>
</task>

<task type="auto">
  <name>Task 2: Add pythonCode to 3 remaining distribution-shape techniques</name>
  <files>src/lib/eda/technique-content/distribution-shape.ts</files>
  <action>
Add `pythonCode` fields to the 3 distribution-shape techniques that need Python code only (no formulas). Place after existing content fields.

**bihistogram** (pythonCode only):
- pythonCode: Two `ax.hist()` calls -- one normal, one inverted with `ax.invert_yaxis()` on the lower subplot. Use `fig, (ax1, ax2) = plt.subplots(2, 1, sharex=True)`. Generate two groups of data (e.g., before/after treatment). ~18-22 lines. Use `density=True` NOT `normed=True`.

**box-plot** (pythonCode only):
- pythonCode: Use `plt.boxplot()` with `orientation='vertical'` (NOT `vert=True` -- deprecated in matplotlib 3.10+). Generate 3-4 groups of data. ~15-18 lines.

**histogram** (pythonCode only):
- pythonCode: Use `plt.hist(density=True)` (NOT `normed=True`). Generate bimodal data as mixture of two normals. ~15-18 lines. (Pattern provided in RESEARCH.md code examples.)

CRITICAL RULES:
- Box-plot MUST use `orientation='vertical'` NOT `vert=True`
- Histogram MUST use `density=True` NOT `normed=True`
- Bihistogram MUST use `density=True` for both histograms
- ALL examples MUST use `np.random.default_rng(42)`
- No formulas for these 3 techniques -- they have no NIST mathematical formulas
  </action>
  <verify>
npx astro build 2>&1 | tail -5
# Must show zero errors
grep -c 'pythonCode' src/lib/eda/technique-content/distribution-shape.ts
# Must return 9 (one per technique in the file)
grep -n 'distplot\|vert=True\|normed=True\|plt\.acorr(\|random_state=' src/lib/eda/technique-content/distribution-shape.ts
# Must return zero matches
  </verify>
  <done>All 9 distribution-shape techniques have pythonCode strings. 6 have formula arrays. Build passes. No deprecated APIs. bihistogram/box-plot/histogram pages do NOT load KaTeX CSS (no formulas field).</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx astro build` passes with zero errors
2. `grep -c 'pythonCode' src/lib/eda/technique-content/distribution-shape.ts` returns 9
3. `grep -c 'String.raw' src/lib/eda/technique-content/distribution-shape.ts` returns at least 12
4. `grep -rn 'distplot\|vert=True\|normed=True\|plt\.acorr(\|random_state=' src/lib/eda/technique-content/distribution-shape.ts` returns zero matches
5. Verify no formulas field on bihistogram, box-plot, histogram entries (KaTeX CSS conditional loading)
</verification>

<success_criteria>
- 9 techniques have pythonCode fields with self-contained Python examples
- 6 techniques have KaTeX formula arrays with String.raw tex strings
- 3 techniques (bihistogram, box-plot, histogram) have NO formulas field
- Zero deprecated Python API patterns found via grep
- astro build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/67-technical-depth/67-02-SUMMARY.md`
</output>
