---
phase: 67-technical-depth
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/eda/technique-content/comparison.ts
  - src/lib/eda/technique-content/designed-experiments.ts
  - src/lib/eda/technique-content/regression.ts
  - src/lib/eda/technique-content/multivariate.ts
autonomous: true
requirements: [DEFN-02, PYTH-01, PYTH-02, PYTH-03, PYTH-04]

must_haves:
  truths:
    - "All 4 comparison technique pages display syntax-highlighted Python code examples"
    - "All 2 designed-experiments technique pages display syntax-highlighted Python code examples"
    - "All 3 regression technique pages display syntax-highlighted Python code examples"
    - "All 3 multivariate technique pages display syntax-highlighted Python code examples"
    - "mean-plot page displays KaTeX-rendered formulas"
    - "std-deviation-plot page displays KaTeX-rendered formulas"
    - "No deprecated Python APIs appear in any code example"
    - "All Python examples are self-contained with imports and sample data generation"
  artifacts:
    - path: "src/lib/eda/technique-content/comparison.ts"
      provides: "formulas (1 technique) + pythonCode (4 techniques)"
      contains: "pythonCode"
    - path: "src/lib/eda/technique-content/designed-experiments.ts"
      provides: "formulas (1 technique) + pythonCode (2 techniques)"
      contains: "pythonCode"
    - path: "src/lib/eda/technique-content/regression.ts"
      provides: "pythonCode (3 techniques)"
      contains: "pythonCode"
    - path: "src/lib/eda/technique-content/multivariate.ts"
      provides: "pythonCode (3 techniques)"
      contains: "pythonCode"
  key_links:
    - from: "src/lib/eda/technique-content/comparison.ts"
      to: "src/pages/eda/techniques/[slug].astro"
      via: "getTechniqueContent() barrel export"
      pattern: "pythonCode"
    - from: "src/lib/eda/technique-content/regression.ts"
      to: "src/pages/eda/techniques/[slug].astro"
      via: "getTechniqueContent() barrel export"
      pattern: "pythonCode"
---

<objective>
Add KaTeX formulas and Python code examples to all 12 techniques across the comparison, designed-experiments, regression, and multivariate category files.

Purpose: These 4 files contain the remaining 12 of 29 techniques. Most are python-only (no formulas), except mean-plot (1 formula set) and std-deviation-plot (1 formula set). This plan completes the full 29-technique Python code coverage.
Output: 4 category files updated with 2 formula arrays and 12 pythonCode strings
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/67-technical-depth/67-RESEARCH.md

@src/lib/eda/technique-content/types.ts
@src/lib/eda/technique-content/comparison.ts
@src/lib/eda/technique-content/designed-experiments.ts
@src/lib/eda/technique-content/regression.ts
@src/lib/eda/technique-content/multivariate.ts
@src/lib/eda/quantitative-content.ts

<interfaces>
From src/lib/eda/technique-content/types.ts:
```typescript
formulas?: Array<{
  label: string;
  tex: string;       // KaTeX display-mode formula (MUST use String.raw)
  explanation: string;
}>;
pythonCode?: string;
```

Technique-to-library mapping (from RESEARCH.md):
- block-plot: Manual grouped scatter (matplotlib)
- mean-plot: plt.plot() with group means
- star-plot: plt.subplot(polar=True) radar chart
- youden-plot: plt.scatter() with reference lines
- doe-plots: Grouped scatter + mean/std panels
- std-deviation-plot: plt.plot() with group stds
- linear-plots: scipy.stats.linregress() + subplots
- scatter-plot: plt.scatter()
- 6-plot: linregress() + probplot() in 6 panels
- contour-plot: plt.contourf()
- scatterplot-matrix: sns.pairplot()
- conditioning-plot: Manual faceted scatter
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add formulas and pythonCode to comparison and designed-experiments techniques</name>
  <files>
src/lib/eda/technique-content/comparison.ts
src/lib/eda/technique-content/designed-experiments.ts
  </files>
  <action>
Add `formulas` and/or `pythonCode` fields to 6 techniques across 2 files. Place fields AFTER existing content fields.

**comparison.ts (4 techniques):**

*block-plot* (pythonCode only):
- Manual grouped scatter plot. Generate 3 treatments x 4 blocks data as a 2D array. Plot each treatment as a separate series with block on x-axis. ~18-22 lines.

*mean-plot* (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.20
  1. Group mean: x_bar_j = (1/n_j) * sum(x_ij) for i=1 to n_j
  2. Grand mean: x_bar = (1/k) * sum(x_bar_j) for j=1 to k
- pythonCode: Compute means for 5-6 groups, plot with horizontal grand mean line. Generate grouped data with `np.random.default_rng(42)`. ~15-18 lines.

*star-plot* (pythonCode only):
- Radar chart using `plt.subplot(polar=True)`. Generate data for 3-4 items across 5-6 variables. Close polygon with `np.concatenate([values, [values[0]]])`. ~20-25 lines. Keep to 5-6 variables max per research recommendation.

*youden-plot* (pythonCode only):
- Simple bivariate scatter with reference lines (mean of x, mean of y, and 45-degree line). Generate paired lab comparison data. ~15-18 lines.

**designed-experiments.ts (2 techniques):**

*doe-plots* (pythonCode only):
- 3-panel display: (1) grouped scatter of raw data by factor level, (2) mean plot, (3) std deviation plot. Use `plt.subplots(1, 3, figsize=(15, 4))`. Generate factorial experiment data with 3 levels. ~25-30 lines.

*std-deviation-plot* (formulas + pythonCode):
- formulas: 2 entries from NIST 1.3.3.28
  1. Group standard deviation: s_j = sqrt((1/(n_j-1)) * sum((x_ij - x_bar_j)^2))
  2. Pooled standard deviation: s_p = sqrt((1/k) * sum(s_j^2)) (for equal group sizes)
- pythonCode: Compute std for 5-6 groups, plot with horizontal pooled-std line. ~15-18 lines.

CRITICAL RULES:
- ALL `tex` values MUST use `String.raw`
- ALL Python examples MUST use `np.random.default_rng(42)`
- Do NOT use deprecated APIs
- star-plot: close polygon loop properly
- doe-plots: all 3 panels in one figure
  </action>
  <verify>
npx astro build 2>&1 | tail -5
# Must show zero errors
grep -c 'pythonCode' src/lib/eda/technique-content/comparison.ts
# Must return 4
grep -c 'pythonCode' src/lib/eda/technique-content/designed-experiments.ts
# Must return 2
grep -c 'String.raw' src/lib/eda/technique-content/comparison.ts
# Must return at least 2 (mean-plot formulas)
grep -c 'String.raw' src/lib/eda/technique-content/designed-experiments.ts
# Must return at least 2 (std-deviation-plot formulas)
grep -rn 'distplot\|vert=True\|normed=True\|plt\.acorr(\|random_state=' src/lib/eda/technique-content/comparison.ts src/lib/eda/technique-content/designed-experiments.ts
# Must return zero matches
  </verify>
  <done>All 6 techniques across comparison.ts and designed-experiments.ts have pythonCode. mean-plot has 2 formulas and std-deviation-plot has 2 formulas. Build passes. No deprecated APIs.</done>
</task>

<task type="auto">
  <name>Task 2: Add pythonCode to regression and multivariate techniques</name>
  <files>
src/lib/eda/technique-content/regression.ts
src/lib/eda/technique-content/multivariate.ts
  </files>
  <action>
Add `pythonCode` fields to 6 techniques across 2 files. NO formulas needed for any of these techniques. Place after existing content fields.

**regression.ts (3 techniques):**

*scatter-plot* (pythonCode only):
- Simple `plt.scatter()`. Generate bivariate data with positive correlation. ~12-15 lines.

*linear-plots* (pythonCode only):
- 4-panel display using `plt.subplots(2, 2)`: (1) scatter + fitted line, (2) residuals vs fitted, (3) residual histogram, (4) residual normal probability plot. Use `scipy.stats.linregress()` for fit and `scipy.stats.probplot()` for Q-Q panel. Generate linear relationship with noise. ~25-30 lines. Use `density=True` for histogram panel, NOT `normed=True`.

*6-plot* (pythonCode only):
- 6-panel diagnostic display using `plt.subplots(2, 3)` or `plt.subplots(3, 2)`: (1) scatter + regression line, (2) residual sequence plot, (3) residual lag plot, (4) residual histogram, (5) residual normal probability plot, (6) residual autocorrelation. Generate linear data with noise. Use `scipy.stats.linregress()`, `scipy.stats.probplot()`. For autocorrelation panel, use a simple bar chart of autocorrelation values computed with `np.correlate` or manual lag correlation (do NOT use `plt.acorr()`). ~30-35 lines. Histogram panel uses `density=True`.

**multivariate.ts (3 techniques):**

*contour-plot* (pythonCode only):
- Use `plt.contourf()` with `plt.colorbar()`. Generate 2D response surface data (e.g., bivariate normal density). ~15-18 lines.

*scatterplot-matrix* (pythonCode only):
- Use `sns.pairplot()` with a DataFrame constructed from numpy arrays. Import `pandas as pd` and `seaborn as sns`. Generate 4 correlated variables. ~15-20 lines. Per research recommendation: the 3-line DataFrame construction is justified.

*conditioning-plot* (pythonCode only):
- Manual faceted scatter: split conditioning variable into 3-4 intervals, plot Y vs X for each interval in a subplot grid. Use `plt.subplots(1, 3)` or `plt.subplots(1, 4)`. ~22-28 lines. No built-in coplot function -- manual implementation.

CRITICAL RULES:
- ALL Python examples MUST use `np.random.default_rng(42)`
- 6-plot histogram panel MUST use `density=True` NOT `normed=True`
- 6-plot autocorrelation panel MUST NOT use `plt.acorr()` -- compute manually or use `np.correlate`
- scatterplot-matrix: use `sns.pairplot()` with pandas DataFrame
- Do NOT add formulas to ANY of these 6 techniques (they have no NIST formulas)
  </action>
  <verify>
npx astro build 2>&1 | tail -5
# Must show zero errors
grep -c 'pythonCode' src/lib/eda/technique-content/regression.ts
# Must return 3
grep -c 'pythonCode' src/lib/eda/technique-content/multivariate.ts
# Must return 3
grep -rn 'distplot\|vert=True\|normed=True\|plt\.acorr(\|random_state=' src/lib/eda/technique-content/regression.ts src/lib/eda/technique-content/multivariate.ts
# Must return zero matches
# Verify NO formulas field added (these techniques have no NIST formulas)
grep -c 'formulas' src/lib/eda/technique-content/regression.ts
# Should return 0
grep -c 'formulas' src/lib/eda/technique-content/multivariate.ts
# Should return 0
  </verify>
  <done>All 6 techniques across regression.ts and multivariate.ts have pythonCode. No formulas added (correct -- no NIST formulas for these). Build passes. No deprecated APIs.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx astro build` passes with zero errors
2. Combined pythonCode count across 4 files = 12 (4 + 2 + 3 + 3)
3. `grep -rn 'distplot\|vert=True\|normed=True\|plt\.acorr(\|random_state=' src/lib/eda/technique-content/comparison.ts src/lib/eda/technique-content/designed-experiments.ts src/lib/eda/technique-content/regression.ts src/lib/eda/technique-content/multivariate.ts` returns zero matches
4. Only comparison.ts and designed-experiments.ts have `String.raw` entries (mean-plot and std-deviation-plot formulas)
5. regression.ts and multivariate.ts have NO formulas field
</verification>

<success_criteria>
- 12 techniques across 4 files have pythonCode fields with self-contained Python examples
- 2 techniques (mean-plot, std-deviation-plot) have KaTeX formula arrays
- 4 techniques (scatter-plot, linear-plots, 6-plot, contour-plot, scatterplot-matrix, conditioning-plot) have NO formulas field
- Zero deprecated Python API patterns found via grep
- astro build passes with zero errors
- Combined with Plans 01 and 02: all 29 techniques have pythonCode, all 12 formula techniques have formulas
</success_criteria>

<output>
After completion, create `.planning/phases/67-technical-depth/67-03-SUMMARY.md`
</output>
