---
phase: 45-editor-ui-and-scoring
plan: 03
type: execute
wave: 3
depends_on: ["45-02"]
files_modified:
  - src/components/tools/K8sResultsPanel.tsx
  - src/components/tools/K8sAnalyzer.tsx
  - src/pages/tools/k8s-analyzer/index.astro
  - src/pages/tools/index.astro
autonomous: true
requirements:
  - UI-06
  - UI-11
  - UI-12
  - UI-15
  - SHARE-01

must_haves:
  truths:
    - "K8sResultsPanel shows tabbed interface (Results | Graph) with score gauge, category breakdown, resource summary, violation list, PSS compliance, and share actions"
    - "K8sAnalyzer root component renders editor and results panels in responsive grid (stacked mobile, side-by-side desktop)"
    - "Astro page uses client:only='react' directive for the React island and includes proper SEO metadata"
    - "Tools index page lists K8s Analyzer alongside Dockerfile Analyzer and Compose Validator"
    - "User can paste K8s YAML, click Analyze, and see scored results with inline annotations, category breakdown, and violation list"
    - "Clicking a violation in the results panel navigates the editor to the corresponding line"
    - "Graph tab shows placeholder content directing users to run analysis first"
  artifacts:
    - path: "src/components/tools/K8sResultsPanel.tsx"
      provides: "Tabbed results panel with score, categories, violations, resources, PSS, and share"
      min_lines: 100
    - path: "src/components/tools/K8sAnalyzer.tsx"
      provides: "Root React island composing editor + results in responsive grid"
      exports: ["default"]
    - path: "src/pages/tools/k8s-analyzer/index.astro"
      provides: "Astro page at /tools/k8s-analyzer/ with client:only='react'"
      contains: "client:only"
    - path: "src/pages/tools/index.astro"
      provides: "Updated tools index with K8s Analyzer card"
      contains: "k8s-analyzer"
  key_links:
    - from: "src/components/tools/K8sAnalyzer.tsx"
      to: "src/components/tools/K8sEditorPanel.tsx"
      via: "default import for editor panel"
      pattern: "import.*K8sEditorPanel"
    - from: "src/components/tools/K8sAnalyzer.tsx"
      to: "src/components/tools/K8sResultsPanel.tsx"
      via: "default import for results panel"
      pattern: "import.*K8sResultsPanel"
    - from: "src/pages/tools/k8s-analyzer/index.astro"
      to: "src/components/tools/K8sAnalyzer.tsx"
      via: "client:only='react' React island mount"
      pattern: "client:only.*react"
    - from: "src/components/tools/K8sResultsPanel.tsx"
      to: "src/stores/k8sAnalyzerStore.ts"
      via: "useStore hooks for reactive state"
      pattern: "useStore.*k8sResult"
---

<objective>
Assemble the K8s Analyzer UI: create the tabbed results panel, root React island component, Astro page, and update the tools index. This wires together all components from Plans 01 and 02 into a working interactive tool at /tools/k8s-analyzer/.

Purpose: This is the final assembly step that connects the editor, analysis engine, scoring, and results display into a cohesive user-facing tool. After this plan, users can visit the page, paste K8s YAML, analyze it, see scores and violations, and share results.

Output: 3 new files + 1 updated file, completing the K8s Analyzer UI
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-editor-ui-and-scoring/45-01-SUMMARY.md
@.planning/phases/45-editor-ui-and-scoring/45-02-SUMMARY.md
@src/components/tools/ComposeResultsPanel.tsx
@src/components/tools/ComposeValidator.tsx
@src/pages/tools/compose-validator/index.astro
@src/pages/tools/index.astro
@src/components/tools/results/ScoreGauge.tsx
@src/lib/tools/dockerfile-analyzer/highlight-line.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create K8sResultsPanel and K8sAnalyzer root component</name>
  <files>
    src/components/tools/K8sResultsPanel.tsx
    src/components/tools/K8sAnalyzer.tsx
  </files>
  <action>
**K8sResultsPanel.tsx** — Fork `src/components/tools/ComposeResultsPanel.tsx` and adapt:

1. **Imports:** Replace all compose store imports with k8s: `k8sResult`, `k8sAnalyzing`, `k8sResultsStale`, `k8sEditorViewRef` from `../../stores/k8sAnalyzerStore`. Import K8s results components: `K8sCategoryBreakdown`, `K8sViolationList`, `K8sEmptyState`, `K8sShareActions`, `K8sResourceSummary`, `K8sPssCompliance` from `./k8s-results/`. Import `ScoreGauge` from `./results/ScoreGauge` (shared). Import `highlightAndScroll` from `../../lib/tools/dockerfile-analyzer/highlight-line` (shared).

2. **Tab type:** `type ResultTab = 'results' | 'graph'` (per UI-15, not 'violations' | 'graph')

3. **Tab bar:** Two tabs — "Results" and "Graph". Styled with border-b-2 active tab pattern matching Compose exactly.

4. **Results tab content flow (same conditional chain as Compose but with K8s additions):**
   - `analyzing` → "Analyzing..." pulse animation
   - `result === null` → "Click Analyze to validate your Kubernetes manifests"
   - `!result.parseSuccess` → "YAML parse error -- check your syntax" in red
   - `result.violations.length === 0` → K8sEmptyState + K8sShareActions (with stale banner if applicable)
   - else → Full results:
     a. Stale results banner (if stale)
     b. Score gauge + Category breakdown (same flex layout as Compose)
     c. **K8sResourceSummary** — `<K8sResourceSummary resourceSummary={result.resourceSummary} />` — this is NEW vs Compose, placed after score/categories and before violation count
     d. **K8sPssCompliance** — `<K8sPssCompliance pssCompliance={result.pssCompliance} />` — also NEW, placed after resource summary. NOTE: K8sAnalysisResult type needs pssCompliance field. Check if types.ts already has it — if not, the EditorPanel will need to include it in the k8sResult.set() call. The engine already returns pssCompliance in K8sEngineResult, so the EditorPanel should pass it through.
     e. Violation count summary (same format: "N issue(s) found (X errors, Y warnings, Z info)")
     f. K8sViolationList with onNavigate callback
     g. K8sShareActions

5. **Graph tab:** For Phase 45, show a placeholder. If `result === null`, show "Run analysis first to see the resource graph". If result exists, show "Resource relationship graph coming in Phase 46" styled as a muted centered message. Do NOT import or lazy-load any graph library — that's Phase 46.

6. **handleNavigate:** Same pattern as Compose — `k8sEditorViewRef.get()` then `highlightAndScroll(view, line)`.

7. **severitySummary helper:** Copy from Compose — same logic for counting errors/warnings/info.

**NOTE — pssCompliance in K8sAnalysisResult:** The `pssCompliance?: PssComplianceSummary` field was already added to `K8sAnalysisResult` in Plan 01 Task 1, and Plan 02's K8sEditorPanel already includes `pssCompliance: engineResult.pssCompliance` in the `k8sResult.set()` call. Simply access `result.pssCompliance` in the results panel.

**K8sAnalyzer.tsx** — Fork `src/components/tools/ComposeValidator.tsx` exactly:
- Import `K8sEditorPanel` (default import) and `K8sResultsPanel` (default import)
- Same responsive grid: `grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6`
- Same min-heights: editor `min-h-[350px] lg:min-h-[500px]`, results `min-h-[200px] lg:min-h-[500px]`
- Export as default function `K8sAnalyzer`
  </action>
  <verify>
Run `npx tsc --noEmit` — both files compile. Verify K8sResultsPanel uses 'results' | 'graph' tab type (not 'violations'). Verify K8sResultsPanel renders K8sResourceSummary and K8sPssCompliance in the results flow. Verify K8sAnalyzer imports both K8sEditorPanel and K8sResultsPanel and renders them in a responsive grid.
  </verify>
  <done>
K8sResultsPanel shows tabbed Results | Graph interface with full results flow: score gauge, category breakdown, resource summary, PSS compliance, violation list, and share actions. K8sAnalyzer root component composes editor + results in responsive grid layout. Both compile and reference only K8s stores/components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Astro page and update tools index</name>
  <files>
    src/pages/tools/k8s-analyzer/index.astro
    src/pages/tools/index.astro
  </files>
  <action>
**index.astro** — Fork `src/pages/tools/compose-validator/index.astro` and adapt:

1. Import `K8sAnalyzer` from `../../../components/tools/K8sAnalyzer`
2. Import `Layout` from `../../../layouts/Layout.astro`
3. Import `BreadcrumbJsonLd` from `../../../components/BreadcrumbJsonLd.astro`
4. Do NOT import K8sAnalyzerJsonLd — that's Phase 47 (SEO integration)
5. Layout props:
   - title: `"Kubernetes Manifest Analyzer | Patryk Golabek"`
   - description: `"Free Kubernetes manifest analyzer and best-practice linter by a Kubernetes architect. 67 rules across schema, security, reliability, best-practice, and cross-resource categories. 100% browser-based. Your code never leaves your device."`
   - ogImage: Skip for now (Phase 47 creates OG images)
6. Page content structure:
   - `<section>` with max-w-7xl centered container
   - `<h1>` "Kubernetes Manifest Analyzer"
   - `<p>` "Paste your Kubernetes YAML below and click Analyze. 100% client-side, your code never leaves your browser."
   - `<K8sAnalyzer client:only="react" />` — UI-12 requirement
   - `<aside>` with link placeholder: "Want to learn the rules in depth? Individual rule documentation coming soon." (Phase 47 creates rule pages and blog post)
7. BreadcrumbJsonLd: `[{ name: 'Home', url: 'https://patrykgolabek.dev/' }, { name: 'Tools', url: 'https://patrykgolabek.dev/tools/' }, { name: 'K8s Analyzer', url: 'https://patrykgolabek.dev/tools/k8s-analyzer/' }]`
8. Do NOT include the Claude Skill download sections or Hook sections — those are Phase 47 features

**tools/index.astro** — Add a K8s Analyzer card to the existing grid:
- Add a third card after the Docker Compose Validator card
- Same structure: `<a>` block with card-hover, icon SVG, h2, p.meta-mono, description p, and ul with feature tags
- Icon: Use a Kubernetes-themed SVG (helm wheel or shield icon). Use the heroicons shield-check icon (already used in similar context) or a simple k8s-themed icon:
  ```
  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5" />
  </svg>
  ```
- h2: "Kubernetes Manifest Analyzer"
- meta-mono: "Free Browser Tool"
- Description: "Analyze your Kubernetes manifests against 67 rules across schema, security, reliability, best-practice, and cross-resource categories. Multi-document YAML support with resource dependency analysis."
- Feature tags: "67-rule engine", "Scoring & grades", "PSS compliance", "Share links"
- Update the page description meta to include "Kubernetes manifest analysis" alongside existing tools
- href: `/tools/k8s-analyzer/`

**NOTE:** The `pssCompliance?: PssComplianceSummary` field was already added to `K8sAnalysisResult` in Plan 01 Task 1, and `pssCompliance: engineResult.pssCompliance` is already included in Plan 02's `k8sResult.set()` call. No types.ts changes needed in this plan.
  </action>
  <verify>
1. Run `npx tsc --noEmit` — all files compile
2. Run `npx astro check` if available — verify the Astro page is valid
3. Visit `/tools/k8s-analyzer/` in dev server — the page renders with the CodeMirror editor and results panel
4. Visit `/tools/` — K8s Analyzer card appears alongside Dockerfile and Compose tools
5. Paste sample K8s YAML, click Analyze — score, categories, violations, and resource summary display correctly
6. Click a violation — editor scrolls to the corresponding line
7. Cmd/Ctrl+Enter triggers analysis from the editor
8. K8sAnalysisResult type already includes optional pssCompliance field (added in Plan 01)
  </verify>
  <done>
Astro page at /tools/k8s-analyzer/ renders the K8s Analyzer React island via client:only="react". Tools index page shows all 3 tools. K8sAnalysisResult type includes pssCompliance for engine data passthrough. The complete K8s Analyzer UI is functional: paste YAML, analyze, see scores, click violations to navigate, share results.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. The Astro page at /tools/k8s-analyzer/ uses `client:only="react"` (not client:load or client:visible)
3. K8sResultsPanel tab type is 'results' | 'graph' (UI-15)
4. K8sResultsPanel renders K8sResourceSummary (UI-16) and K8sPssCompliance in the results flow
5. K8sAnalyzer uses `grid grid-cols-1 lg:grid-cols-2` for responsive layout (UI-11)
6. Tools index page has 3 tool cards (Dockerfile, Compose, K8s)
7. Breadcrumb JSON-LD is present with 3-level hierarchy
8. No references to compose or dockerfile stores in any K8s component
9. The complete flow works: paste YAML -> Analyze -> see score + categories + violations + resource summary
10. Click-to-navigate from violation list to editor line works via highlightAndScroll
</verification>

<success_criteria>
The K8s Analyzer is a fully functional interactive tool at /tools/k8s-analyzer/. Users can paste multi-document K8s YAML, click Analyze (or Cmd/Ctrl+Enter), and see a 0-100 score with letter grade, 5-category breakdown, resource summary, PSS compliance, violation list grouped by severity, and inline CodeMirror annotations. The tool is responsive (stacked mobile, side-by-side desktop), uses client:only="react", and appears on the tools index page.
</success_criteria>

<output>
After completion, create `.planning/phases/45-editor-ui-and-scoring/45-03-SUMMARY.md`
</output>
