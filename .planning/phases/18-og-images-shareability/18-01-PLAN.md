---
phase: 18-og-images-shareability
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/og-image.ts
  - src/pages/open-graph/beauty-index.png.ts
  - src/pages/open-graph/beauty-index/[slug].png.ts
  - src/pages/beauty-index/index.astro
  - src/pages/beauty-index/[slug].astro
autonomous: true

must_haves:
  truths:
    - "Sharing /beauty-index/ on social media shows a custom OG image with Beauty Index branding and dimension labels"
    - "Sharing any /beauty-index/[slug]/ page shows a custom OG image with that language's radar chart, name, score, and tier"
    - "Build succeeds with 26 new OG images (1 overview + 25 languages) generated at build time"
  artifacts:
    - path: "src/lib/og-image.ts"
      provides: "generateOverviewOgImage and generateLanguageOgImage functions"
      exports: ["generateOverviewOgImage", "generateLanguageOgImage"]
    - path: "src/pages/open-graph/beauty-index.png.ts"
      provides: "Overview OG image API route"
      exports: ["GET"]
    - path: "src/pages/open-graph/beauty-index/[slug].png.ts"
      provides: "Per-language OG image API routes (25 pages via getStaticPaths)"
      exports: ["getStaticPaths", "GET"]
  key_links:
    - from: "src/pages/open-graph/beauty-index/[slug].png.ts"
      to: "src/lib/og-image.ts"
      via: "import generateLanguageOgImage"
      pattern: "generateLanguageOgImage"
    - from: "src/pages/open-graph/beauty-index.png.ts"
      to: "src/lib/og-image.ts"
      via: "import generateOverviewOgImage"
      pattern: "generateOverviewOgImage"
    - from: "src/pages/beauty-index/index.astro"
      to: "/open-graph/beauty-index.png"
      via: "ogImage prop on Layout"
      pattern: "ogImage=.*beauty-index\\.png"
    - from: "src/pages/beauty-index/[slug].astro"
      to: "/open-graph/beauty-index/[slug].png"
      via: "ogImage prop on Layout"
      pattern: "ogImage=.*beauty-index/"
---

<objective>
Generate build-time OG images for the Beauty Index overview page and all 25 language detail pages, and wire them into page meta tags for social sharing.

Purpose: When someone shares a Beauty Index URL on Twitter, LinkedIn, or Discord, they see a branded preview card with either the "Beauty Index" title and dimension labels (overview) or a specific language's radar chart, score, and tier (detail page). This directly satisfies SHARE-01.

Output: Two new OG image generator functions in og-image.ts, two new API route files for static PNG generation, and ogImage prop wiring on both beauty-index pages.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-og-images-shareability/18-RESEARCH.md

Key source files:
@src/lib/og-image.ts
@src/lib/beauty-index/radar-math.ts
@src/lib/beauty-index/schema.ts
@src/lib/beauty-index/tiers.ts
@src/lib/beauty-index/dimensions.ts
@src/pages/open-graph/[...slug].png.ts
@src/pages/open-graph/default.png.ts
@src/pages/beauty-index/index.astro
@src/pages/beauty-index/[slug].astro
@src/components/SEOHead.astro
@src/layouts/Layout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Beauty Index OG image generators to og-image.ts</name>
  <files>src/lib/og-image.ts</files>
  <action>
Add two new exported async functions to `src/lib/og-image.ts`:

**1. `generateOverviewOgImage(): Promise<Buffer>`**
- Text-based branded layout at 1200x630
- Reuses the existing `loadFonts()` and font caching (interFont, spaceGroteskFont)
- Layout structure:
  - Top accent bar: 6px gradient (#c44b20 to #e8734a) — matches existing OG pattern
  - Centered title: "The Beauty Index" in Space Grotesk 64px, color #1a1a2e
  - Subtitle: "Ranking 25 programming languages across 6 aesthetic dimensions" in Inter 24px, color #555566
  - Six dimension pills in a flex row: Geometry, Elegance, Clarity, Happiness, Habitability, Integrity — each pill has #c44b20 text on rgba(196,75,32,0.1) background, 14px, rounded
  - Bottom branding: "PG" badge + "patrykgolabek.dev" text (same pattern as existing OG images, position absolute bottom 24px)
- Background: #faf8f5 (matches existing OG images)
- Uses plain object VNode tree (NOT JSX, NOT satori-html) — same pattern as existing `generateOgImage`
- Returns `sharp(Buffer.from(svg)).png().toBuffer()`

**2. `generateLanguageOgImage(language: Language): Promise<Buffer>`**
- Import `generateRadarSvgString` from `./beauty-index/radar-math`
- Import `getTierColor` from `./beauty-index/tiers`
- Import `DIMENSIONS` from `./beauty-index/dimensions`
- Import `totalScore, dimensionScores, type Language` from `./beauty-index/schema`
- Two-column layout at 1200x630:
  - Top accent bar (same as above)
  - Left column (700px): "The Beauty Index" label in 18px #c44b20, language name in Space Grotesk 56px #1a1a2e, score+tier row (score as "XX/60" in tier color 32px, tier name in white-on-tier-color pill 16px), character sketch truncated to 120 chars in 18px #555566
  - Right column (500px): Radar chart embedded as base64 data URI `<img>` tag
  - Bottom-left branding (same PG + patrykgolabek.dev pattern)
- Radar chart generation: Call `generateRadarSvgString(300, scores, tierColor, 0.35, labels)` where labels are `DIMENSIONS.map(d => d.symbol + ' ' + d.shortName)`. Note: use `\u0020` between symbol and shortName (just a space). Encode result as `data:image/svg+xml;base64,${Buffer.from(radarSvg).toString('base64')}`. Set width=360, height=360 on the img element (Satori needs explicit dimensions for data URI images).
- Tier color: `getTierColor(language.tier)` for polygon fill AND score text AND tier pill background
- Character sketch: Use existing `truncate()` function from og-image.ts (already defined there)
- Capitalize tier name: `language.tier.charAt(0).toUpperCase() + language.tier.slice(1)`

Both functions use the same Satori + Sharp pipeline already in place. Follow the exact same `as any` cast pattern for the VNode object when passing to `satori()`.
  </action>
  <verify>
Run `npx astro build 2>&1 | head -50` — build should not fail. The generators won't be called yet (no routes), but the module must parse and export correctly.

Also verify types: `npx tsc --noEmit 2>&1 | grep og-image` should produce no errors.
  </verify>
  <done>
`og-image.ts` exports `generateOverviewOgImage` and `generateLanguageOgImage` alongside the existing `generateOgImage`. Both functions compile without type errors and follow the established VNode + Satori + Sharp pattern.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create OG API routes and wire meta tags on Beauty Index pages</name>
  <files>
    src/pages/open-graph/beauty-index.png.ts
    src/pages/open-graph/beauty-index/[slug].png.ts
    src/pages/beauty-index/index.astro
    src/pages/beauty-index/[slug].astro
  </files>
  <action>
**A. Create `src/pages/open-graph/beauty-index.png.ts`** (overview OG image route):
- Import `APIRoute` from `astro`
- Import `generateOverviewOgImage` from `../../lib/og-image`
- Export `GET: APIRoute` that calls `generateOverviewOgImage()` and returns Response with Content-Type image/png, Cache-Control public max-age=31536000 immutable
- No getStaticPaths needed — single static route

**B. Create `src/pages/open-graph/beauty-index/[slug].png.ts`** (per-language OG image routes):
- Import `APIRoute`, `GetStaticPaths` from `astro`
- Import `getCollection` from `astro:content`
- Import `generateLanguageOgImage` from `../../../lib/og-image`
- Export `getStaticPaths`: load `getCollection('languages')`, map entries to `{ params: { slug: entry.data.id }, props: { language: entry.data } }`
- Export `GET: APIRoute`: call `generateLanguageOgImage(props.language)`, return Response with same headers
- Note: use `entry.data.id` for slug (not `entry.id`) — this matches the pattern established in 17-03 (file() loader slug pattern)

**C. Modify `src/pages/beauty-index/index.astro`**:
- In the frontmatter, add: `const ogImageURL = new URL('/open-graph/beauty-index.png', Astro.site).toString();`
- Update the Layout component to pass `ogImage={ogImageURL}`

**D. Modify `src/pages/beauty-index/[slug].astro`**:
- In the frontmatter (after `const { language, prev, next, rank } = Astro.props;`), add: `const ogImageURL = new URL(\`/open-graph/beauty-index/${language.id}.png\`, Astro.site).toString();`
- Update the Layout component to pass `ogImage={ogImageURL}`
  </action>
  <verify>
Run full build: `npx astro build 2>&1 | tail -30`
- Build should complete successfully
- Check OG images were generated:
  - `ls dist/open-graph/beauty-index.png` should exist
  - `ls dist/open-graph/beauty-index/ | head -5` should show .png files for languages
  - `ls dist/open-graph/beauty-index/ | wc -l` should be 25
- Check meta tags: `grep -c 'og:image' dist/beauty-index/index.html` should be >= 1
- Check meta tags: `grep 'og:image' dist/beauty-index/rust/index.html` should reference `/open-graph/beauty-index/rust.png`
  </verify>
  <done>
Build produces 26 OG PNG files (1 overview + 25 languages). Both beauty index pages include `og:image` meta tags pointing to their respective OG image URLs. The existing blog OG routes are unaffected (no route conflicts).
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` completes without errors
2. `dist/open-graph/beauty-index.png` exists and is a valid PNG (> 10KB)
3. `dist/open-graph/beauty-index/` contains exactly 25 PNG files (one per language)
4. `grep 'og:image' dist/beauty-index/index.html` contains `/open-graph/beauty-index.png`
5. `grep 'og:image' dist/beauty-index/rust/index.html` contains `/open-graph/beauty-index/rust.png`
6. Existing blog OG images still generate correctly: `ls dist/open-graph/blog/ | head -3`
7. `grep 'og:image' dist/blog/building-a-kubernetes-observability-stack/index.html` still references blog OG route
</verification>

<success_criteria>
- 26 Beauty Index OG PNG images generated at build time (1 overview + 25 languages)
- Overview OG image shows "The Beauty Index" title with dimension pills and PG branding
- Language OG images show language name, score, tier badge, character sketch, and radar chart
- og:image meta tags correctly wired on both page types
- No regression in existing blog OG images
</success_criteria>

<output>
After completion, create `.planning/phases/18-og-images-shareability/18-01-SUMMARY.md`
</output>
