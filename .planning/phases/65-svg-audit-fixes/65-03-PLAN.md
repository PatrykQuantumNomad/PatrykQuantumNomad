---
phase: 65-svg-audit-fixes
plan: 03
type: execute
wave: 2
depends_on: ["65-01", "65-02"]
requirements: [SVG-01, SVG-02, SVG-03, SVG-04]
files_modified:
  - .planning/phases/65-svg-audit-fixes/65-AUDIT.md
  - src/lib/eda/technique-renderer.ts
autonomous: true

must_haves:
  truths:
    - "A markdown audit checklist documents all 29 techniques with pass/fail for axes, shapes, labels, scales, reference lines, and data patterns"
    - "All 29 technique pages build without console errors"
    - "All HIGH and MEDIUM issues identified in 65-RESEARCH.md are marked FIXED in the audit"
    - "All 6 Tier B variant datasets produce visually distinct, statistically correct patterns validated against NIST descriptions"
  artifacts:
    - path: ".planning/phases/65-svg-audit-fixes/65-AUDIT.md"
      provides: "Complete audit checklist for all 29 SVG techniques"
      contains: "| 29 |"
  key_links:
    - from: ".planning/phases/65-svg-audit-fixes/65-AUDIT.md"
      to: "src/lib/eda/technique-renderer.ts"
      via: "Documents the rendering status of every slug in TECHNIQUE_RENDERERS"
      pattern: "PASS|FAIL"
---

<objective>
Build the comprehensive SVG audit checklist (SVG-01, SVG-02 requirements), run the full Astro build to verify all 29 pages render without errors, and document the final status of every technique.

Purpose: The audit checklist is a phase success criterion and the basis for declaring NIST parity. It also catches any remaining issues introduced by Plans 01 and 02.
Output: 65-AUDIT.md with pass/fail for every technique across all audit dimensions.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/65-svg-audit-fixes/65-RESEARCH.md
@.planning/phases/65-svg-audit-fixes/65-01-SUMMARY.md
@.planning/phases/65-svg-audit-fixes/65-02-SUMMARY.md
@src/lib/eda/technique-renderer.ts
@src/lib/eda/svg-generators/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full build and create audit checklist</name>
  <files>.planning/phases/65-svg-audit-fixes/65-AUDIT.md</files>
  <action>
1. **Run `npx astro build`** and capture:
   - Total build time
   - Number of pages generated
   - Any errors or warnings related to technique pages
   - Specifically look for errors mentioning technique slugs or SVG generator imports

2. **Verify all 29 technique routes exist** in build output:
   - The build output lists generated pages. Grep for `/eda/techniques/` routes.
   - Count must be 29 (one per technique slug).

3. **Create the audit checklist** at `.planning/phases/65-svg-audit-fixes/65-AUDIT.md`:

   Structure:
   ```markdown
   # Phase 65: SVG Audit Checklist

   **Audited:** {date}
   **Build status:** PASS / {N} pages generated in {time}
   **Auditor:** Claude (code review against NIST specifications)

   ## Methodology

   Each technique SVG was audited against its NIST e-Handbook source page for:
   - **Axes**: Both X and Y axes present with lines and tick marks
   - **Labels**: Axis labels match NIST conventions
   - **Grid**: Gridlines present for readability
   - **Shapes**: Visual elements match NIST (bars, stems, dots, lines, etc.)
   - **Ref Lines**: Reference lines (confidence bands, mean lines, diagonals) present where NIST shows them
   - **Scale**: Axis ranges appropriate for the data
   - **Data Pattern**: Generated dataset produces statistically correct visual pattern

   ## Legend
   - PASS: Matches NIST visual conventions
   - FIXED: Was incorrect, fixed in Phase 65
   - MINOR: Cosmetic difference, acceptable for web rendering
   - N/A: Dimension not applicable to this technique

   ## Audit Results

   | # | Technique | Slug | Renderer | Axes | Labels | Grid | Shapes | Ref Lines | Scale | Data Pattern | Status |
   |---|-----------|------|----------|------|--------|------|--------|-----------|-------|--------------|--------|
   | 1 | Histogram | histogram | direct | ... | ... | ... | ... | ... | ... | ... | PASS |
   | 2 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
   ...all 29 rows...

   ## Issues Fixed in Phase 65

   | # | Issue | Severity | Fix |
   |---|-------|----------|-----|
   | 1 | Bihistogram: stacked histograms -> back-to-back | HIGH | Switched to generateBihistogram |
   | 2 | Mean Plot: bar chart -> connected dots | HIGH | Switched to generateDoeMeanPlot |
   ...
   ```

4. **For each of the 29 techniques**, read the generator code path in technique-renderer.ts and evaluate:
   - Does it call the correct generator for its NIST section?
   - Are axis labels appropriate?
   - Does the data produce the expected visual pattern?
   - Are reference lines / confidence bands present where NIST shows them?

   Populate each cell with PASS, FIXED (was wrong, fixed in 65-01/65-02), MINOR (acceptable cosmetic difference), or N/A.

5. **Document all issues fixed** in the "Issues Fixed" section referencing the plan that fixed them.

6. **If any FAIL items are found** (issues not covered by plans 01/02), document them in a "Remaining Issues" section with severity and recommended fix. Do NOT attempt to fix them in this plan -- they would be gap closure candidates.

This task is primarily analysis and documentation. The only file created is the audit checklist. No code changes.
  </action>
  <verify>
- `npx astro build` completes with 0 errors
- `.planning/phases/65-svg-audit-fixes/65-AUDIT.md` exists and contains 29 rows in the audit table
- `grep -c "^|" .planning/phases/65-svg-audit-fixes/65-AUDIT.md` returns at least 31 (29 data rows + 2 header rows)
  </verify>
  <done>65-AUDIT.md exists with all 29 techniques documented. Build passes. All HIGH and MEDIUM issues from 65-RESEARCH.md are marked FIXED. No remaining FAIL items for issues within scope.</done>
</task>

<task type="auto">
  <name>Task 2: Fix any build errors or remaining issues discovered during audit</name>
  <files>src/lib/eda/technique-renderer.ts, src/lib/eda/svg-generators/*.ts</files>
  <action>
This is a contingency task. If Task 1's build or audit reveals issues:

1. **Build errors**: Fix import issues, type mismatches, or missing data in the files that changed in plans 01 and 02. Common issues:
   - Type mismatch when passing scatterData to generate6Plot (check that the function signature accepts `{x: number, y: number}[]`)
   - Missing imports in composite-plot.ts (may need linearRegression, generateScatterPlot)
   - Dead code from removed composition functions causing linter warnings

2. **Audit FAIL items**: If any technique has a clear, small fix (wrong axis label, missing title), fix it. Limit to changes that take <5 minutes each. Larger issues go in the audit's "Remaining Issues" section for gap closure.

3. **Update the audit checklist** to reflect any fixes made in this task.

If Task 1's build passes clean and audit shows no FAIL items, this task completes with "No additional fixes needed."
  </action>
  <verify>`npx astro build` completes with 0 errors after any fixes. Audit checklist is accurate.</verify>
  <done>All build errors resolved (if any). Audit checklist accurately reflects the final state of all 29 technique SVGs.</done>
</task>

<task type="auto">
  <name>Task 3: Validate and fix Tier B variant data patterns</name>
  <files>src/lib/eda/technique-renderer.ts</files>
  <action>
Validate all 6 Tier B techniques' variant datasets produce visually distinct, statistically correct patterns per NIST descriptions. This addresses SVG-04 (data pattern correctness) which requires fixing incorrect statistical patterns, not just auditing them.

**For each of the 6 Tier B techniques with variants**, read the variant data generation code in technique-renderer.ts and validate:

1. **Histogram variants (8 variants):**
   - `bimodal`: Two distinct peaks visible (verify mixture of two normals with separated means)
   - `right-skewed`: Asymmetric tail extending right (verify exponential or chi-squared distribution)
   - `heavy-tailed`: Wider spread than normal (verify Cauchy or t-distribution data)
   - `uniform`: Flat bars, no peak (verify uniform random data)
   - Remaining 4: Verify each produces a visually distinct pattern

2. **Scatter Plot variants (12 variants):**
   - `quadratic`: Parabolic shape (verify y = ax^2 + noise)
   - `clustered`: Distinct groups (verify cluster generation with separated centroids)
   - `heteroscedastic`: Fan-shaped spread (verify variance increases with x)
   - `no-correlation`: Random cloud (verify independent x, y)
   - Remaining 8: Verify each produces a visually distinct pattern

3. **Normal Probability Plot variants (4 variants):**
   - `right-skewed`: S-curve deviating at upper end
   - `heavy-tailed`: S-curve deviating at both ends
   - `light-tailed`: Reverse S-curve at both ends
   - `uniform`: Step-like deviation from diagonal

4. **Lag Plot variants (4 variants):**
   - `autoregressive`: Strong positive diagonal correlation (verify phi >= 0.8)
   - `seasonal`: Circular or periodic structure
   - `trend`: Cluster in one direction
   - `random`: Uniform cloud with no structure

5. **Autocorrelation Plot variants (4 variants):**
   - `ar1`: Exponential ACF decay (verify AR(1) coefficient)
   - `ma1`: Single spike at lag 1, then zero (verify MA(1) structure)
   - `seasonal`: Periodic ACF peaks (verify period matches seasonal component)
   - `white-noise`: All ACF values within confidence band

6. **Spectral Plot variants (3 variants):**
   - `single-frequency`: One dominant peak
   - `multiple-frequencies`: Two or more peaks
   - `white-noise`: Flat spectrum

**For each variant that FAILS validation** (data does not produce the expected visual pattern):
- Fix the data generation parameters (e.g., increase AR coefficient, adjust mixture separation, change seed)
- Document the fix in the audit checklist's "Data Pattern" column

**Update 65-AUDIT.md** with a "Tier B Variant Validation" section documenting each variant's pass/fail status and any fixes applied.
  </action>
  <verify>
- `npx astro build` completes with 0 errors after any variant data fixes
- 65-AUDIT.md contains a "Tier B Variant Validation" section with all 6 techniques and their variant pass/fail status
- `grep -c "Tier B" .planning/phases/65-svg-audit-fixes/65-AUDIT.md` returns at least 1
  </verify>
  <done>All 6 Tier B techniques' variant datasets validated. Any data pattern issues found are fixed (parameters adjusted). Audit checklist documents variant validation results. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `npx astro build` completes with 0 errors
2. 65-AUDIT.md documents all 29 techniques with per-dimension pass/fail
3. All HIGH and MEDIUM severity issues from 65-RESEARCH.md are marked FIXED in the audit
4. No technique page produces console errors during build
5. All 6 Tier B variant datasets validated with pass/fail documented in audit
6. Success criteria from phase roadmap are met:
   - SC1: Audit checklist exists with pass/fail (65-AUDIT.md)
   - SC2: Visual inaccuracies fixed (plans 01 + 02)
   - SC3: Data pattern issues fixed (plans 01 + 02 + Task 3 variant fixes)
   - SC4: All 29 pages render without errors (verified by build)
</verification>

<success_criteria>
- 65-AUDIT.md exists with all 29 technique rows
- Build passes with zero errors
- All HIGH and MEDIUM issues identified in 65-RESEARCH.md are marked FIXED
- All 6 Tier B variant datasets produce correct statistical patterns
- Phase 65 success criteria 1-4 are met
</success_criteria>

<output>
After completion, create `.planning/phases/65-svg-audit-fixes/65-03-SUMMARY.md`
</output>
