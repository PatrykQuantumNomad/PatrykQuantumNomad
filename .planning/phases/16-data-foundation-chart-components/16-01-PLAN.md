---
phase: 16-data-foundation-chart-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/beauty-index/schema.ts
  - src/lib/beauty-index/radar-math.ts
  - src/lib/beauty-index/tiers.ts
  - src/lib/beauty-index/dimensions.ts
  - src/data/beauty-index/languages.json
  - src/content.config.ts
  - src/styles/global.css
  - tailwind.config.mjs
  - src/layouts/Layout.astro
autonomous: true
requirements:
  - DATA-01
  - DATA-02
  - DATA-03
  - DATA-04

must_haves:
  truths:
    - "languages.json contains exactly 25 language entries, each with 6 integer dimension scores (1-10), a tier assignment, and a character sketch"
    - "Importing from astro:content with getCollection('languages') returns all 25 validated language entries at build time"
    - "The radar math utility produces correct cartesian coordinates from polar inputs with the first axis pointing upward (12 o'clock)"
    - "Greek symbols (Phi, Omega, Lambda, Psi, Gamma, Sigma) render correctly in the site's fonts via Noto Sans unicode-range fallback"
  artifacts:
    - path: "src/lib/beauty-index/schema.ts"
      provides: "Zod schema for language data + TypeScript types + totalScore/dimensionScores helpers"
      exports: ["languageSchema", "Language", "totalScore", "dimensionScores"]
    - path: "src/lib/beauty-index/radar-math.ts"
      provides: "Pure TypeScript polar-to-cartesian math for radar charts, usable in both Astro and Node/Satori contexts"
      exports: ["polarToCartesian", "radarPolygonPoints", "hexagonRingPoints", "generateRadarSvgString"]
    - path: "src/lib/beauty-index/tiers.ts"
      provides: "Tier boundaries, tier colors, dimension colors, lookup functions"
      exports: ["TIERS", "DIMENSION_COLORS", "getTierByScore", "getTierColor"]
    - path: "src/lib/beauty-index/dimensions.ts"
      provides: "Dimension metadata array with symbol, name, shortName, description"
      exports: ["DIMENSIONS", "Dimension"]
    - path: "src/data/beauty-index/languages.json"
      provides: "All 25 languages with scores, tiers, character sketches"
      min_lines: 300
    - path: "src/content.config.ts"
      provides: "Updated content config with languages collection using file() loader"
      contains: "file("
  key_links:
    - from: "src/content.config.ts"
      to: "src/data/beauty-index/languages.json"
      via: "file() loader reference"
      pattern: "file\\("
    - from: "src/lib/beauty-index/schema.ts"
      to: "src/content.config.ts"
      via: "languageSchema import for collection validation"
      pattern: "languageSchema"
    - from: "src/styles/global.css"
      to: "https://fonts.googleapis.com"
      via: "Noto Sans @font-face with unicode-range for Greek characters"
      pattern: "U\\+0370"
---

<objective>
Create the complete data foundation for the Beauty Index: language data schema with Zod validation, 25 language entries with scores and character sketches, pure TypeScript radar math utility, tier/dimension constants, Astro content collection integration, and Greek character font fallback.

Purpose: Every downstream Beauty Index component, page, and OG image depends on this data model and these utilities. Nothing visual can be built until types, data, and math exist.
Output: Validated data model, content collection, math utility, and font infrastructure.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-data-foundation-chart-components/16-CONTEXT.md
@.planning/phases/16-data-foundation-chart-components/16-RESEARCH.md
@src/content.config.ts
@src/styles/global.css
@tailwind.config.mjs
@src/layouts/Layout.astro
@src/lib/og-image.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Beauty Index schema, constants, and radar math utility</name>
  <files>
    src/lib/beauty-index/schema.ts
    src/lib/beauty-index/radar-math.ts
    src/lib/beauty-index/tiers.ts
    src/lib/beauty-index/dimensions.ts
  </files>
  <action>
Create four TypeScript modules in `src/lib/beauty-index/`:

**schema.ts** — Zod schema and TypeScript types:
- Import `z` from `astro/zod`
- `dimensionScoreSchema`: `z.number().int().min(1).max(10)`
- `tierSchema`: `z.enum(['beautiful', 'handsome', 'practical', 'workhorses'])`
- `languageSchema`: z.object with fields: `id` (string), `name` (string), `phi/omega/lambda/psi/gamma/sigma` (each dimensionScoreSchema), `tier` (tierSchema), `characterSketch` (string), `year` (number int optional), `paradigm` (string optional)
- Export `type Language = z.infer<typeof languageSchema>`
- Export `totalScore(lang: Language): number` — returns sum of all 6 dimension scores
- Export `dimensionScores(lang: Language): number[]` — returns array `[phi, omega, lambda, psi, gamma, sigma]` in canonical dimension order

**dimensions.ts** — Dimension metadata constants:
- Export `Dimension` interface with keys: `key` ('phi'|'omega'|'lambda'|'psi'|'gamma'|'sigma'), `symbol` (string), `name` (string), `shortName` (string), `description` (string)
- Export `DIMENSIONS: Dimension[]` array in canonical order:
  1. Phi (U+03A6) — Aesthetic Geometry / "Geometry" — "Visual cleanliness, grid-based order, proportional structure. How code looks on a screen."
  2. Omega (U+03A9) — Mathematical Elegance / "Elegance" — "Inevitability, unexpectedness, economy. Algorithms that feel straight from The Book."
  3. Lambda (U+039B) — Linguistic Clarity / "Clarity" — "Code that reads like well-written prose. Signal-to-noise ratio at the level of meaning."
  4. Psi (U+03A8) — Practitioner Happiness / "Happiness" — "The felt experience of writing and reading code. Flow states, community love, tooling pleasure."
  5. Gamma (U+0393) — Organic Habitability / "Habitability" — "Code as a place where programmers can live. Growth points, graceful aging, extensibility."
  6. Sigma (U+03A3) — Conceptual Integrity / "Integrity" — "Coherent design philosophy where features feel like natural consequences of a single idea."
- Use Unicode escape sequences for symbols (e.g., '\u03A6')

**tiers.ts** — Tier configuration and colors:
- Export `TierConfig` interface: `name`, `label`, `minScore`, `maxScore`, `color` (hex)
- Export `TIERS: TierConfig[]` with evenly distributed boundaries across 6-60:
  - Workhorses: 6-19, color `#8B8FA3` (muted slate)
  - Practical: 20-33, color `#5B8A72` (sage green)
  - Handsome: 34-46, color `#C47F17` (warm amber)
  - Beautiful: 47-60, color `#B84A1C` (rich burnt orange — aligned with site accent)
- Export `DIMENSION_COLORS: Record<string, string>`:
  - phi: `#4A90D9` (blue), omega: `#7B68EE` (purple), lambda: `#2AAA8A` (teal), psi: `#E8734A` (coral), gamma: `#8FBC5A` (green), sigma: `#D4A843` (gold)
- Export `getTierByScore(totalScore: number): TierConfig` — finds tier by score range, throws on invalid
- Export `getTierColor(tierName: string): string` — looks up tier color by name, throws on unknown

**radar-math.ts** — Pure TypeScript SVG math utility (ZERO framework dependencies — no Astro imports, no DOM APIs, no React):
- Export `polarToCartesian(cx, cy, angle, radius): { x: number; y: number }` — MUST subtract Math.PI/2 from angle so first axis points upward (12 o'clock position)
- Export `radarPolygonPoints(cx, cy, maxRadius, values: number[], maxValue: number): string` — generates SVG polygon points string for data values
- Export `hexagonRingPoints(cx, cy, radius, numSides: number): string` — generates polygon points for grid rings (concentric hexagons)
- Export `generateRadarSvgString(size, values, fillColor, fillOpacity, labels): string` — generates a COMPLETE standalone `<svg>` element as a string, including grid rings at intervals of 2 (scores 2,4,6,8,10), axis lines, data polygon, and axis labels. This function is for Satori embedding via base64 data URI. Use `sans-serif` as font-family for labels (will be rasterized to PNG for OG images). The SVG must include the xmlns attribute.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm all four files compile without errors. Verify no Astro or framework imports exist in radar-math.ts (it must be pure TypeScript).
  </verify>
  <done>
Four TypeScript modules exist in src/lib/beauty-index/ with correct exports, types, and logic. radar-math.ts has zero framework dependencies. All tier boundaries are evenly distributed across 6-60. All 6 dimensions have correct Greek symbols, names, and descriptions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create languages.json with 25 languages and wire content collection</name>
  <files>
    src/data/beauty-index/languages.json
    src/content.config.ts
  </files>
  <action>
**languages.json** — Create `src/data/beauty-index/languages.json` with an array of 25 language objects. Each object has: `id` (URL-safe slug), `name` (display name), `phi`, `omega`, `lambda`, `psi`, `gamma`, `sigma` (integer 1-10), `tier` (computed from total score against tier boundaries: 6-19 workhorses, 20-33 practical, 34-46 handsome, 47-60 beautiful), `characterSketch` (2-3 sentence personality description — opinionated and witty, NOT factual summaries), `year` (integer, year created), `paradigm` (string).

The 25 languages to include (with approximate scoring guidance — Claude should assign scores reflecting genuine aesthetic assessment across the 6 dimensions):

**Beautiful tier (total 47-60):** Haskell, Rust, Elixir, Kotlin, Swift
**Handsome tier (total 34-46):** Python, Ruby, TypeScript, Scala, Clojure, F#, OCaml
**Practical tier (total 20-33):** Go, C#, Dart, Julia, Lua, Zig
**Workhorses tier (total 6-19):** Java, JavaScript, C, C++, PHP, Perl, COBOL

Character sketches should be personality-driven. Examples of the tone:
- "The overprotective friend who's always right. Rust won't let you make mistakes, and you'll resent it until you realize every error it caught would have been a 3am production incident."
- "The beautifully dressed philosopher who can't find their car keys. Haskell writes the most elegant code in any language, then spends 45 minutes explaining why IO is actually a monad."

IMPORTANT: Every language's tier field MUST match its actual total score against the tier boundaries. Verify each entry: sum the 6 scores, determine tier from boundaries, set tier field accordingly.

**content.config.ts** — Update `src/content.config.ts`:
- Add `import { file } from 'astro/loaders';` alongside existing `glob` import
- Import `languageSchema` from `'./lib/beauty-index/schema'`
- Add `languages` collection: `defineCollection({ loader: file('src/data/beauty-index/languages.json'), schema: languageSchema })`
- Update exports: `export const collections = { blog, languages };`
- Keep the existing blog collection exactly as-is
  </action>
  <verify>
Run `npx astro build` and confirm it completes without schema validation errors. The build should validate all 25 language entries against the Zod schema. Also verify: count of entries is exactly 25, all tier assignments match score totals, all scores are integers 1-10, all ids are unique URL-safe slugs.
  </verify>
  <done>
languages.json contains exactly 25 validated language entries. Content collection loads successfully via file() loader. Build passes with zero validation errors. Each language has personality-driven character sketch, correct tier assignment matching its total score, and all required fields populated.
  </done>
</task>

<task type="auto">
  <name>Task 3: Set up Greek character font fallback</name>
  <files>
    src/styles/global.css
    tailwind.config.mjs
    src/layouts/Layout.astro
  </files>
  <action>
Neither DM Sans nor Bricolage Grotesque includes Greek characters. The 6 dimension symbols (Phi, Omega, Lambda, Psi, Gamma, Sigma) are brand-critical and must render correctly.

**Layout.astro** — Update the Google Fonts link to include Noto Sans with Greek subset:
- Add `&family=Noto+Sans:wght@400;700` to the existing Google Fonts URL in both the preload link and the noscript fallback link. The updated URL should be:
  `https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@700;800&family=DM+Sans:wght@400;500;700&family=Fira+Code:wght@400&family=Noto+Sans:wght@400;700&display=swap`
- Also update the Content-Security-Policy meta tag if needed — the existing CSP already allows `fonts.googleapis.com` and `fonts.gstatic.com`, so no change should be needed.

**global.css** — Add @font-face declarations for Greek unicode-range AFTER the existing font fallback metrics section:
```css
/* Greek Character Fallback — DM Sans and Bricolage Grotesque lack Greek glyphs */
/* Noto Sans loaded via Google Fonts, scoped to Greek block only via unicode-range */
@font-face {
  font-family: 'Greek Fallback';
  src: local('Noto Sans');
  unicode-range: U+0370-03FF;
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'Greek Fallback';
  src: local('Noto Sans');
  unicode-range: U+0370-03FF;
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}
```

Note: Using `local('Noto Sans')` references the font already loaded by the Google Fonts stylesheet. The `unicode-range` ensures this font only activates for Greek characters — all Latin text continues using DM Sans / Bricolage Grotesque as before.

**tailwind.config.mjs** — Add 'Greek Fallback' to both font-family stacks, placed after the primary font and its fallback but before the system defaults:
```javascript
sans: ['DM Sans', 'DM Sans Fallback', 'Greek Fallback', ...defaultTheme.fontFamily.sans],
heading: ['Bricolage Grotesque', 'Bricolage Grotesque Fallback', 'Greek Fallback', ...defaultTheme.fontFamily.sans],
```
  </action>
  <verify>
Run `npx astro build` to confirm the build still passes. Manually verify in the built CSS output that the @font-face declarations include `unicode-range: U+0370-03FF`. Verify the Google Fonts URL in Layout.astro includes `Noto+Sans`.
  </verify>
  <done>
Greek characters (U+0370-03FF) have a dedicated font fallback path via Noto Sans. The font is loaded via Google Fonts (no self-hosted files). unicode-range scoping ensures zero impact on Latin text rendering. Both sans and heading font stacks include the Greek Fallback.
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` completes without errors — validates all 25 language entries against Zod schema
2. `npx tsc --noEmit` passes — all TypeScript modules compile cleanly
3. radar-math.ts contains no imports from 'astro', 'react', or any framework — confirmed pure TypeScript
4. languages.json contains exactly 25 entries with unique ids
5. Each language's tier field matches its computed total score against tier boundaries
6. Google Fonts URL in Layout.astro includes Noto Sans
7. global.css includes @font-face with unicode-range U+0370-03FF
8. tailwind.config.mjs font stacks include 'Greek Fallback'
</verification>

<success_criteria>
- 25 language entries in languages.json pass Zod validation via Astro content collection
- All 4 TypeScript utility modules (schema, dimensions, tiers, radar-math) export correct types and functions
- radar-math.ts is framework-agnostic (importable in both Astro and Node/Satori contexts)
- Greek font fallback infrastructure is in place for all 6 dimension symbols
- Build passes cleanly with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-data-foundation-chart-components/16-01-SUMMARY.md`
</output>
