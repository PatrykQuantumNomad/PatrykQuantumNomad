---
phase: 16-data-foundation-chart-components
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/beauty-index/RadarChart.astro
  - src/components/beauty-index/RankingBarChart.astro
  - src/components/beauty-index/TierBadge.astro
  - src/components/beauty-index/ScoreBreakdown.astro
  - src/pages/beauty-index/test/radar.astro
  - src/pages/beauty-index/test/ranking.astro
autonomous: true
requirements:
  - CHART-01
  - CHART-02
  - CHART-03
  - CHART-04

must_haves:
  truths:
    - "A standalone Astro page at /beauty-index/test/radar/ renders a radar chart with 6 labeled axes, concentric hexagonal grid rings, and a filled polygon matching a language's scores — zero client-side JavaScript shipped"
    - "A standalone Astro page at /beauty-index/test/ranking/ renders a horizontal stacked bar chart showing all 25 languages sorted by total score with tier color coding and dimension segment colors — zero client-side JavaScript shipped"
    - "The radar chart polygon color matches the language's tier color and has semi-transparent fill"
    - "The tier badge component displays the correct tier label with the correct tier color"
    - "The score breakdown component shows all 6 dimension scores with their Greek symbols and names"
  artifacts:
    - path: "src/components/beauty-index/RadarChart.astro"
      provides: "Build-time SVG radar chart with 6 axes, grid rings, filled polygon, and axis labels"
      min_lines: 50
    - path: "src/components/beauty-index/RankingBarChart.astro"
      provides: "Build-time SVG horizontal stacked bar chart for all 25 languages sorted by total score"
      min_lines: 60
    - path: "src/components/beauty-index/TierBadge.astro"
      provides: "Color-coded tier badge with tier label"
      min_lines: 10
    - path: "src/components/beauty-index/ScoreBreakdown.astro"
      provides: "Individual dimension scores display with Greek symbols"
      min_lines: 20
    - path: "src/pages/beauty-index/test/radar.astro"
      provides: "Test page rendering radar charts for validation"
      min_lines: 15
    - path: "src/pages/beauty-index/test/ranking.astro"
      provides: "Test page rendering ranking bar chart for validation"
      min_lines: 15
  key_links:
    - from: "src/components/beauty-index/RadarChart.astro"
      to: "src/lib/beauty-index/radar-math.ts"
      via: "import for polarToCartesian, radarPolygonPoints, hexagonRingPoints"
      pattern: "import.*radar-math"
    - from: "src/components/beauty-index/RadarChart.astro"
      to: "src/lib/beauty-index/tiers.ts"
      via: "import getTierColor for polygon fill"
      pattern: "getTierColor"
    - from: "src/components/beauty-index/RadarChart.astro"
      to: "src/lib/beauty-index/dimensions.ts"
      via: "import DIMENSIONS for axis labels"
      pattern: "DIMENSIONS"
    - from: "src/components/beauty-index/RankingBarChart.astro"
      to: "src/lib/beauty-index/tiers.ts"
      via: "import TIERS and DIMENSION_COLORS for bar segments and tier dividers"
      pattern: "DIMENSION_COLORS"
    - from: "src/pages/beauty-index/test/radar.astro"
      to: "astro:content"
      via: "getCollection('languages') to load language data"
      pattern: "getCollection"
    - from: "src/pages/beauty-index/test/ranking.astro"
      to: "astro:content"
      via: "getCollection('languages') to load all languages for bar chart"
      pattern: "getCollection"
---

<objective>
Build all four Beauty Index chart components (radar chart, ranking bar chart, tier badge, score breakdown) as build-time SVG Astro components that ship zero client-side JavaScript. Create test pages to validate visual output.

Purpose: These components are the visual vocabulary of the Beauty Index — every downstream page (overview, language detail, OG images) reuses them. Building them as isolated components with test pages ensures correctness before page assembly.
Output: Four reusable Astro components and two validation test pages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-data-foundation-chart-components/16-CONTEXT.md
@.planning/phases/16-data-foundation-chart-components/16-RESEARCH.md
@.planning/phases/16-data-foundation-chart-components/16-01-SUMMARY.md
@src/styles/global.css
@src/layouts/Layout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RadarChart, TierBadge, and ScoreBreakdown components</name>
  <files>
    src/components/beauty-index/RadarChart.astro
    src/components/beauty-index/TierBadge.astro
    src/components/beauty-index/ScoreBreakdown.astro
  </files>
  <action>
Create three Astro components in `src/components/beauty-index/`:

**RadarChart.astro** — Build-time SVG radar chart component:
- Props: `language: Language` (from schema), `size?: number` (default 300)
- Imports: `polarToCartesian`, `radarPolygonPoints`, `hexagonRingPoints` from `../../lib/beauty-index/radar-math`; `DIMENSIONS` from `../../lib/beauty-index/dimensions`; `getTierColor` from `../../lib/beauty-index/tiers`; `type Language, dimensionScores` from `../../lib/beauty-index/schema`
- Compute: `cx = size / 2`, `cy = size / 2`, `maxRadius = size * 0.38` (leave room for labels)
- Extract scores using `dimensionScores(language)` to ensure canonical dimension order
- Grid rings: concentric hexagons at score intervals of 2 (values 2, 4, 6, 8, 10) — use `hexagonRingPoints(cx, cy, (level / 10) * maxRadius, 6)` for each level. Style: `fill="none" stroke="#e5ddd5" stroke-width="1"`
- Axis lines: 6 lines from center `(cx, cy)` to each vertex at maxRadius. Style: `stroke="#e5ddd5" stroke-width="1"`
- Data polygon: `radarPolygonPoints(cx, cy, maxRadius, scores, 10)`. Style: `fill={tierColor} fill-opacity="0.35" stroke={tierColor} stroke-width="2"` where tierColor = `getTierColor(language.tier)`
- Axis labels: for each dimension, place `<text>` at `labelRadius = maxRadius + 24` from center. Content: `{dim.symbol} {dim.shortName}` (e.g., "Phi Geometry"). Style: `text-anchor="middle" dominant-baseline="middle" class="text-xs fill-current text-text-secondary"` with `font-size="11"`
- Root `<svg>` must have: `width={size} height={size} viewBox="0 0 {size} {size}" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Radar chart for {language.name} showing scores across 6 dimensions"`
- ZERO client-side JavaScript — all computation happens in the Astro frontmatter

**TierBadge.astro** — Color-coded tier indicator:
- Props: `tier: string` (tier name), `size?: 'sm' | 'md' | 'lg'` (default 'md')
- Import: `getTierColor` from `../../lib/beauty-index/tiers`, `TIERS` from `../../lib/beauty-index/tiers`
- Look up tier config to get `label` and `color`
- Render: a `<span>` with inline `style` setting `background-color` to the tier color (with low opacity for background) and `color` to the tier color (full opacity for text). Add appropriate Tailwind classes for padding, rounded corners, font weight based on size prop.
- Size variants: sm = `text-xs px-2 py-0.5`, md = `text-sm px-3 py-1`, lg = `text-base px-4 py-1.5`

**ScoreBreakdown.astro** — Dimension scores display:
- Props: `language: Language`
- Import: `DIMENSIONS` from `../../lib/beauty-index/dimensions`, `DIMENSION_COLORS` from `../../lib/beauty-index/tiers`, `type Language` from `../../lib/beauty-index/schema`
- Render: a list/grid showing each of the 6 dimensions with:
  - The Greek symbol (styled in the dimension's color from DIMENSION_COLORS)
  - The dimension short name
  - The score value (1-10) with a visual bar indicator (a small horizontal bar whose width is proportional to score/10, filled with the dimension color)
- Use Tailwind classes for layout. Each dimension row: flex layout with symbol, name, score number, and proportional bar.
- Include a total score row at the bottom showing the sum with a label "Total" and the B = sum notation.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm all three components compile without TypeScript errors. Verify that no `<script>` tags exist in any component (zero client-side JS requirement). Verify RadarChart uses the correct imports from radar-math, dimensions, and tiers modules.
  </verify>
  <done>
Three Astro components exist in src/components/beauty-index/. RadarChart generates inline SVG with grid rings, axis lines, filled polygon, and labeled axes. TierBadge displays color-coded tier labels in 3 size variants. ScoreBreakdown shows all 6 dimension scores with visual bars and a total. Zero client-side JavaScript in any component.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create RankingBarChart component</name>
  <files>
    src/components/beauty-index/RankingBarChart.astro
  </files>
  <action>
Create `src/components/beauty-index/RankingBarChart.astro` — a build-time SVG horizontal stacked bar chart:

**Props:**
- `languages: Language[]` — array of all languages to display (component sorts internally)
- `width?: number` (default 800), `rowHeight?: number` (default 28), `labelWidth?: number` (default 120)

**Imports:**
- `type Language, totalScore, dimensionScores` from `../../lib/beauty-index/schema`
- `TIERS, DIMENSION_COLORS, getTierByScore` from `../../lib/beauty-index/tiers`
- `DIMENSIONS` from `../../lib/beauty-index/dimensions`

**Layout — Horizontal orientation per user decision:**
- Language names left-aligned (within `labelWidth`), stacked bars extend right
- Sort languages by total score descending
- Each bar is divided into 6 colored segments for the 6 dimensions
- Segment widths proportional to dimension score (each segment width = `(score / 60) * barMaxWidth` where barMaxWidth = width - labelWidth - some padding)
- Each dimension segment uses its distinct color from `DIMENSION_COLORS`
- Segment order within each bar follows canonical dimension order (Phi, Omega, Lambda, Psi, Gamma, Sigma)

**Tier dividers — Visual tier separation per user decision:**
- Insert horizontal line separators between tier groups (where the sorted list transitions from one tier to another)
- Add a tier label (e.g., "Beautiful", "Handsome") at the start of each tier group, styled as a subtle section header using the tier's color
- Use background bands with very subtle tier color tinting (e.g., `fill-opacity="0.05"`) behind each tier group

**Score label:** Show total score number at the right end of each bar

**Legend:** Include a legend at the top showing the 6 dimension colors with their short names (Phi Geometry, Omega Elegance, etc.)

**SVG structure:**
- Root `<svg>` with computed height based on number of languages + tier headers + legend. Include `role="img"` and `aria-label="Ranking chart showing all 25 languages sorted by total beauty score"`
- Use `<text>` for language names and score labels
- Use `<rect>` for bar segments
- Use `<line>` for tier dividers

**ZERO client-side JavaScript** — all sorting, layout computation, and SVG generation happens in Astro frontmatter.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm the component compiles. Verify no `<script>` tags exist. Verify the component imports from the correct utility modules (schema, tiers, dimensions).
  </verify>
  <done>
RankingBarChart.astro generates a complete SVG stacked horizontal bar chart with all 25 languages sorted by total score, 6 dimension-colored segments per bar, tier group dividers with labels, a color legend, and total score labels. Zero client-side JavaScript.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create test pages and validate Satori SVG compatibility</name>
  <files>
    src/pages/beauty-index/test/radar.astro
    src/pages/beauty-index/test/ranking.astro
  </files>
  <action>
Create two standalone test pages that validate chart components work correctly with real data from the content collection. These pages serve as visual validation during development and will be removed or made draft before launch.

**src/pages/beauty-index/test/radar.astro** — Radar chart test page:
- Import Layout from `../../../layouts/Layout.astro`
- Import `getCollection` from `astro:content`
- Import `RadarChart` from `../../../components/beauty-index/RadarChart.astro`
- Import `TierBadge` from `../../../components/beauty-index/TierBadge.astro`
- Import `ScoreBreakdown` from `../../../components/beauty-index/ScoreBreakdown.astro`
- Import `totalScore` from `../../../lib/beauty-index/schema`
- Load all languages: `const languages = await getCollection('languages');`
- Pick 4 representative languages (one from each tier) for display — e.g., filter to find one beautiful, one handsome, one practical, one workhorse
- Render each with: heading showing language name, `<RadarChart language={lang.data} />`, `<TierBadge tier={lang.data.tier} />`, `<ScoreBreakdown language={lang.data} />`, and the total score
- Page title: "Radar Chart Test — Beauty Index"
- Add a note at the top: "This is a development test page. It will not be included in the final site."

**src/pages/beauty-index/test/ranking.astro** — Ranking bar chart test page:
- Import Layout, `getCollection`, `RankingBarChart`
- Load all languages, extract `.data` from each entry
- Render `<RankingBarChart languages={allLanguageData} />`
- Page title: "Ranking Chart Test — Beauty Index"
- Add a note at the top: "This is a development test page."

**Satori SVG compatibility validation** — After creating the test pages, validate that `generateRadarSvgString` from radar-math.ts produces valid SVG by running a quick Node.js validation:
- Create a temporary validation by running the build (`npx astro build`). If the build succeeds and the test pages render, the content collection integration is working.
- Additionally, verify `generateRadarSvgString` produces a valid SVG string by checking the output starts with `<svg` and contains `</svg>`, has `xmlns="http://www.w3.org/2000/svg"`, and contains `<polygon` elements. This can be verified by importing the function in an Astro page frontmatter and logging the output during build.

NOTE: Do NOT add `generateRadarSvgString` validation to the test pages if it would add complexity. The critical validation is that `polarToCartesian` and the other math functions work correctly (proven by the radar chart rendering correctly on the test page). The `generateRadarSvgString` function specifically is for Phase 18 OG images — its correctness is validated by the fact that it uses the same math functions. A simple build-time assertion in the radar test page frontmatter (calling `generateRadarSvgString` and checking it returns a non-empty string containing `<svg`) is sufficient.
  </action>
  <verify>
Run `npx astro build` — the build must complete successfully, proving:
1. Content collection loads all 25 languages
2. Radar chart component renders SVG with data from content collection
3. Ranking bar chart component renders SVG with all 25 languages
4. TierBadge and ScoreBreakdown components render correctly
5. Zero client-side JavaScript is shipped (check built HTML for absence of `<script>` tags in the test page output)

Also verify: `generateRadarSvgString` produces valid SVG output (confirmed via build-time assertion in test page).
  </verify>
  <done>
Two test pages render at /beauty-index/test/radar/ and /beauty-index/test/ranking/. The radar test page shows 4 radar charts (one per tier) with tier badges and score breakdowns. The ranking test page shows the complete 25-language bar chart. Build passes. generateRadarSvgString produces valid SVG. Zero client-side JavaScript shipped on test pages.
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` completes with zero errors — all components render correctly with real data
2. Test page at /beauty-index/test/radar/ shows radar charts with visible grid rings, filled polygons, axis labels with Greek symbols
3. Test page at /beauty-index/test/ranking/ shows all 25 languages in a stacked horizontal bar chart sorted by score
4. No `<script>` tags in built HTML for test pages — zero client-side JavaScript
5. Radar chart polygon fill uses tier color with semi-transparent opacity
6. Bar chart shows 6 distinct dimension-colored segments per language bar
7. Bar chart has visual tier dividers separating the 4 tier groups
8. TierBadge shows correct tier label with correct color
9. ScoreBreakdown shows all 6 dimensions with proportional visual bars
10. generateRadarSvgString returns valid SVG string (for Phase 18 Satori compatibility)
</verification>

<success_criteria>
- All 4 chart components render build-time SVG with zero client-side JavaScript
- Radar chart: 6 axes, concentric hexagonal grid rings, filled polygon in tier color, symbol+shortName axis labels
- Bar chart: horizontal stacked bars, 25 languages sorted by score, dimension-colored segments, tier dividers
- Tier badge: color-coded with correct tier label
- Score breakdown: 6 dimension rows with Greek symbols, names, scores, visual bars, and total
- Test pages load data from content collection and render components correctly
- generateRadarSvgString produces valid standalone SVG for future Satori/OG use
</success_criteria>

<output>
After completion, create `.planning/phases/16-data-foundation-chart-components/16-02-SUMMARY.md`
</output>
