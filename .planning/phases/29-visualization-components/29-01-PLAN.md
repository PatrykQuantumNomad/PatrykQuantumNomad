---
phase: 29-visualization-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/db-compass/dimensions.ts
  - src/lib/db-compass/spectrum-math.ts
  - src/components/db-compass/ComplexitySpectrum.astro
  - src/components/db-compass/CompassRadarChart.astro
autonomous: true

must_haves:
  truths:
    - "The complexity spectrum SVG renders all 12 models positioned from simple (left) to complex (right) with readable abbreviated labels"
    - "Each model's 8-axis octagonal radar chart renders with colored dimension symbol labels and a data polygon reflecting its scores"
    - "DIMENSION_COLORS record exists with 8 visually distinct colors keyed by dimension"
  artifacts:
    - path: "src/lib/db-compass/dimensions.ts"
      provides: "DIMENSION_COLORS record with 8 hex colors"
      contains: "DIMENSION_COLORS"
    - path: "src/lib/db-compass/spectrum-math.ts"
      provides: "computeSpectrumPositions pure function for SVG positioning"
      exports: ["computeSpectrumPositions", "SpectrumPoint"]
    - path: "src/components/db-compass/ComplexitySpectrum.astro"
      provides: "Build-time SVG horizontal complexity spectrum"
      contains: "role=\"img\""
    - path: "src/components/db-compass/CompassRadarChart.astro"
      provides: "Build-time SVG 8-axis octagonal radar chart"
      contains: "role=\"img\""
  key_links:
    - from: "src/lib/db-compass/spectrum-math.ts"
      to: "src/components/db-compass/ComplexitySpectrum.astro"
      via: "computeSpectrumPositions import"
      pattern: "import.*computeSpectrumPositions.*spectrum-math"
    - from: "src/lib/beauty-index/radar-math.ts"
      to: "src/components/db-compass/CompassRadarChart.astro"
      via: "polarToCartesian, radarPolygonPoints, hexagonRingPoints imports"
      pattern: "import.*radar-math"
    - from: "src/lib/db-compass/dimensions.ts"
      to: "src/components/db-compass/CompassRadarChart.astro"
      via: "DIMENSIONS, DIMENSION_COLORS imports"
      pattern: "import.*DIMENSION_COLORS.*dimensions"
---

<objective>
Create the foundation utilities (DIMENSION_COLORS, spectrum-math.ts) and the two build-time SVG visualization components: ComplexitySpectrum (VIZ-01) and CompassRadarChart (VIZ-02).

Purpose: These SVG charts are the primary visual identity of Database Compass — the spectrum provides at-a-glance model positioning and the radar chart reveals each model's dimension profile. Both must render at build time with zero client-side JavaScript.

Output: 4 files — updated dimensions.ts with colors, new spectrum-math.ts, ComplexitySpectrum.astro, CompassRadarChart.astro
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-visualization-components/29-RESEARCH.md

@src/lib/db-compass/schema.ts
@src/lib/db-compass/dimensions.ts
@src/lib/beauty-index/radar-math.ts
@src/components/beauty-index/RadarChart.astro
@src/components/beauty-index/RankingBarChart.astro
@src/data/db-compass/models.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add DIMENSION_COLORS and create spectrum-math.ts</name>
  <files>
    src/lib/db-compass/dimensions.ts
    src/lib/db-compass/spectrum-math.ts
  </files>
  <action>
**1. Add DIMENSION_COLORS to dimensions.ts:**

Add a `DIMENSION_COLORS` record export to the bottom of `src/lib/db-compass/dimensions.ts`, keyed by `keyof Scores` (import the Scores type from `./schema`). Use 8 visually distinct hex colors that read well against the `#fffaf7` surface background and harmonize with the site's warm palette:

```typescript
/** Color palette for each dimension — consistent across radar charts, score bars, and tables */
export const DIMENSION_COLORS: Record<keyof Scores, string> = {
  scalability: '#4A90D9',           // Blue — growth/upward
  performance: '#E8734A',           // Coral — speed/energy
  reliability: '#2AAA8A',           // Teal — stability
  operationalSimplicity: '#8FBC5A', // Green — ease
  queryFlexibility: '#7B68EE',      // Purple — flexibility
  schemaFlexibility: '#D4A843',     // Gold — adaptability
  ecosystemMaturity: '#C44B20',     // Burnt orange — maturity
  learningCurve: '#9B59B6',        // Violet — education
};
```

The existing `Scores` import ensures compile-time sync — if a dimension is added/removed from the schema, DIMENSION_COLORS will error.

**2. Create spectrum-math.ts:**

Create `src/lib/db-compass/spectrum-math.ts` as a pure TypeScript utility (zero DOM, zero framework). Export:

- `SpectrumPoint` interface: `{ x: number; y: number; label: string; shortLabel: string; id: string; slug: string; complexityPosition: number }`
- `computeSpectrumPositions(width, models, padding?, baselineY?)` function that maps each model's `complexityPosition` (0-1) to pixel x-coordinates within a padded horizontal axis. Models are passed as an array of `{ id: string; name: string; slug: string; complexityPosition: number }`. Return `SpectrumPoint[]`.
- `detectClusters(points, threshold?)` function that groups points within a configurable threshold (default 0.08 of spectrum width) so the component can apply vertical staggering to avoid label overlap. Return array of index groups.

Use abbreviated labels for the shortLabel field — create a `MODEL_SHORT_LABELS` record mapping model id to 2-5 character abbreviation: KV, Doc, Mem, TS, Rel, Search, Col, Vec, NewSQL, Graph, Obj, Multi. The component will use shortLabel for display.

All functions must be pure (no side effects, no DOM) so they're usable in both Astro frontmatter and Satori OG image contexts.
  </action>
  <verify>
Run `npx astro check` and `npx tsc --noEmit` — no type errors in dimensions.ts or spectrum-math.ts. Verify DIMENSION_COLORS has exactly 8 keys matching the Scores type.
  </verify>
  <done>
DIMENSION_COLORS exported from dimensions.ts with 8 distinct hex colors keyed by Scores fields. spectrum-math.ts exports computeSpectrumPositions and detectClusters as pure functions with typed inputs and outputs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build ComplexitySpectrum and CompassRadarChart components</name>
  <files>
    src/components/db-compass/ComplexitySpectrum.astro
    src/components/db-compass/CompassRadarChart.astro
  </files>
  <action>
**1. ComplexitySpectrum.astro (VIZ-01):**

Create `src/components/db-compass/ComplexitySpectrum.astro` as a build-time SVG. Follow the RankingBarChart.astro pattern (build-time SVG with frontmatter math).

Props: `models: DbModel[]`, `width?: number` (default 800), `height?: number` (default 160).

In frontmatter:
- Import `computeSpectrumPositions`, `detectClusters` from spectrum-math.ts
- Import `DbModel` from schema.ts
- Sort models by `complexityPosition`
- Compute positions via `computeSpectrumPositions(width, models, 60, height / 2)`
- Detect clusters for stagger
- Assign alternating y-offsets for clustered models: labels above the baseline line for even-indexed models, below for odd-indexed (stagger pattern)

SVG rendering:
- Horizontal axis line from padding to width-padding at baselineY
- Endpoint labels: "Simple" at left, "Complex" at right
- A colored dot (circle r=6) per model at its x position on the baseline
- Abbreviated label (shortLabel from spectrum-math) positioned above or below the dot with `text-anchor="middle"`, font-size 10-11px
- Optional connecting line from dot to staggered label if offset > 20px
- `role="img"` and `aria-label` on the SVG root
- Each dot should link via `<a xlink:href="/tools/db-compass/{slug}/">` for future click navigation (wrapping the circle and label in an SVG `<a>` element)
- Use `viewBox` scaling with `class="w-full"` wrapper so the SVG fills its container responsively

Color: Use the site accent color `#c44b20` for dots, `#5a5a5a` for labels, `#e5ddd5` for the axis line (consistent with radar grid line color).

**2. CompassRadarChart.astro (VIZ-02):**

Create `src/components/db-compass/CompassRadarChart.astro` following `src/components/beauty-index/RadarChart.astro` closely but adapted for 8 axes.

Props: `model: DbModel`, `size?: number` (default 300).

Key differences from Beauty Index RadarChart:
- `numAxes = DIMENSIONS.length` (8, not hardcoded 6)
- Import from `../../lib/db-compass/dimensions` and `../../lib/db-compass/schema` (NOT beauty-index)
- Reuse `polarToCartesian`, `radarPolygonPoints`, `hexagonRingPoints` from `../../lib/beauty-index/radar-math` (the shared utility)
- `pad = 28` (vs 24 for Beauty Index — extra room for 8 labels)
- `maxRadius = size * 0.42` (vs 0.44 — slightly smaller to leave label room for 8 axes)
- `labelRadius = maxRadius + 22` (vs +20)
- Labels: use `dim.symbol` (Unicode character) as label text, colored with `DIMENSION_COLORS[dim.key]`
- Font: `font-family="'DM Sans', 'Noto Sans', sans-serif"` (Noto Sans for broader Unicode coverage of symbols like `\u2BD1` and `\u29C9`)
- Data polygon: use fixed accent color `#c44b20` with `fill-opacity="0.3"` and `stroke-width="2"` (no tier system — same color for all models)
- Grid rings: `hexagonRingPoints(cx, cy, ringRadius, numAxes)` — pass 8, not 6
- Concentric grid levels at 2, 4, 6, 8, 10 (same as Beauty Index)
- `role="img"` and `aria-label` on SVG root
- Wrap the SVG in a `<div class="w-full max-w-[300px]">` so it scales responsively via viewBox

Both components: zero client-side JavaScript, all math in Astro frontmatter.
  </action>
  <verify>
Run `npx astro check` — no type errors. Run `npx astro build` — build succeeds (components are defined but not yet used on any page, so build success confirms they don't break anything). Visually inspect by temporarily adding a test page or using Astro dev server with a scratch page that imports both components with real data from models.json.
  </verify>
  <done>
ComplexitySpectrum.astro renders all 12 models on a horizontal SVG axis with abbreviated labels and stagger-based collision avoidance. CompassRadarChart.astro renders an 8-axis octagonal radar chart with dimension-colored Unicode symbol labels and a data polygon reflecting scores. Both are build-time SVGs with zero client JavaScript and proper accessibility attributes.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors in any db-compass file
2. `npx astro build` succeeds
3. DIMENSION_COLORS has exactly 8 entries matching scoresSchema keys
4. spectrum-math.ts exports are pure functions (no DOM, no imports from Astro/React)
5. Both .astro components have `role="img"` and `aria-label` on their SVG root
6. CompassRadarChart uses `hexagonRingPoints(cx, cy, ringRadius, numAxes)` with numAxes derived from DIMENSIONS.length (not hardcoded)
7. ComplexitySpectrum uses shortLabel (abbreviated) for all label text, not full model names
</verification>

<success_criteria>
- DIMENSION_COLORS record exists with 8 typed, distinct hex colors
- spectrum-math.ts computes positions and detects clusters as pure functions
- ComplexitySpectrum renders 12 models on a horizontal axis with staggered short labels
- CompassRadarChart renders 8-axis octagonal chart with dimension-colored symbol labels
- Both SVG components have accessibility attributes and responsive viewBox scaling
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/29-visualization-components/29-01-SUMMARY.md`
</output>
