---
phase: 24-results-display-interaction
plan: 02
type: execute
wave: 2
depends_on:
  - 24-01
files_modified:
  - src/components/tools/results/ScoreGauge.tsx
  - src/components/tools/results/CategoryBreakdown.tsx
  - src/components/tools/results/ViolationList.tsx
  - src/components/tools/results/EmptyState.tsx
  - src/components/tools/ResultsPanel.tsx
autonomous: true
requirements:
  - RESULT-02
  - RESULT-03
  - RESULT-04
  - RESULT-05
  - RESULT-06

must_haves:
  truths:
    - "A circular SVG gauge displays the overall score (0-100) and letter grade with color-coded arc"
    - "Five horizontal bars show per-category sub-scores (Security, Efficiency, Maintainability, Reliability, Best Practice)"
    - "Violations are grouped by severity (errors first, then warnings, then info) with expandable details showing explanation and before/after fix"
    - "Clicking a violation line number scrolls the editor to that line and briefly highlights it"
    - "A clean Dockerfile (zero violations) shows a congratulatory empty state with checkmark icon and score gauge"
    - "After editing the Dockerfile post-analysis, the results panel dims with a Re-analyze banner"
  artifacts:
    - path: "src/components/tools/results/ScoreGauge.tsx"
      provides: "SVG circular gauge with stroke-dasharray animation"
      exports: ["ScoreGauge"]
      min_lines: 30
    - path: "src/components/tools/results/CategoryBreakdown.tsx"
      provides: "Five horizontal bar indicators for category scores"
      exports: ["CategoryBreakdown"]
      min_lines: 30
    - path: "src/components/tools/results/ViolationList.tsx"
      provides: "Severity-grouped violation list with details/summary expand/collapse and click-to-navigate"
      exports: ["ViolationList"]
      min_lines: 50
    - path: "src/components/tools/results/EmptyState.tsx"
      provides: "No-issues-found congratulatory message"
      exports: ["EmptyState"]
      min_lines: 15
    - path: "src/components/tools/ResultsPanel.tsx"
      provides: "Rewritten results panel composing all sub-components"
      contains: "ScoreGauge"
  key_links:
    - from: "src/components/tools/results/ViolationList.tsx"
      to: "src/lib/tools/dockerfile-analyzer/highlight-line.ts"
      via: "highlightAndScroll(view, lineNumber) on violation click"
      pattern: "highlightAndScroll"
    - from: "src/components/tools/results/ViolationList.tsx"
      to: "src/stores/dockerfileAnalyzerStore.ts"
      via: "editorViewRef.get() to access EditorView"
      pattern: "editorViewRef"
    - from: "src/components/tools/ResultsPanel.tsx"
      to: "src/stores/dockerfileAnalyzerStore.ts"
      via: "useStore(resultsStale) for dimming + useStore(analysisResult) for data"
      pattern: "resultsStale"
---

<objective>
Build the full results display UI: score gauge (RESULT-02), category breakdown (RESULT-03), violation list with expandable details (RESULT-04), click-to-navigate wiring (RESULT-05), empty state (RESULT-06), and stale results indicator.

Purpose: Transform the placeholder "Parse successful" results panel into a rich, interactive analysis dashboard that matches the site's Quantum Explorer aesthetic and provides actionable feedback.
Output: Four new sub-components in results/ directory + rewritten ResultsPanel.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-results-display-interaction/24-RESEARCH.md
@.planning/phases/24-results-display-interaction/24-01-SUMMARY.md
@src/components/tools/ResultsPanel.tsx
@src/components/tools/DockerfileAnalyzer.tsx
@src/stores/dockerfileAnalyzerStore.ts
@src/lib/tools/dockerfile-analyzer/types.ts
@src/lib/tools/dockerfile-analyzer/highlight-line.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScoreGauge, CategoryBreakdown, EmptyState, and ViolationList components</name>
  <files>
    src/components/tools/results/ScoreGauge.tsx
    src/components/tools/results/CategoryBreakdown.tsx
    src/components/tools/results/EmptyState.tsx
    src/components/tools/results/ViolationList.tsx
  </files>
  <action>
Create the `src/components/tools/results/` directory and four React components:

**ScoreGauge.tsx** -- SVG circular gauge with score and grade:
- Props: `{ score: number; grade: string; size?: number }` (default size 120).
- SVG circle gauge using `stroke-dasharray`/`stroke-dashoffset` technique.
- Background track circle: `stroke="rgba(255,255,255,0.1)"`, strokeWidth 8.
- Score arc circle: stroke color from `getGradeColor(grade)`, strokeLinecap="round", CSS transition on stroke-dashoffset (0.6s ease) for animation from 0 to score.
- Apply `className="transform -rotate-90"` on the SVG element to start arc at 12 o'clock.
- Text overlay positioned with relative container + absolute inner div showing score number (text-2xl font-bold font-heading) and grade (text-sm font-semibold, colored by grade).
- `getGradeColor` function: A-grades=#22c55e (green), B-grades=#84cc16 (lime), C-grades=#eab308 (yellow), D-grades=#f97316 (orange), F=#ef4444 (red).
- Export as named export: `export function ScoreGauge(...)`.

**CategoryBreakdown.tsx** -- Five horizontal bars:
- Props: `{ categories: CategoryScore[] }` (import CategoryScore from types).
- Constant maps for `CATEGORY_LABELS` (security->"Security", efficiency->"Efficiency", etc.) and `CATEGORY_COLORS` (security->"#ef4444", efficiency->"#3b82f6", maintainability->"#8b5cf6", reliability->"#f59e0b", "best-practice"->"#06b6d4").
- Render each category as a row: label (w-28 text-right truncate), bar track (flex-1 h-2.5 rounded-full bg-white/10), fill div (percentage width via inline style, colored by category, transition-all duration-500), and numeric score (w-8 text-right font-mono text-xs, Math.round).
- If categories array is empty, render nothing.
- Export as named export: `export function CategoryBreakdown(...)`.

**EmptyState.tsx** -- Congratulatory no-issues message:
- Props: `{ score: number; grade: string }`.
- Centered column layout with: green checkmark icon (w-16 h-16 rounded-full bg-green-500/20 with SVG check path), "No Issues Found" heading (text-lg font-heading font-semibold), encouraging subtext ("This Dockerfile follows best practices. Well done!"), and a ScoreGauge below showing the perfect score.
- Import ScoreGauge from `./ScoreGauge`.
- Export as named export: `export function EmptyState(...)`.

**ViolationList.tsx** -- Grouped violations with expand/collapse and click-to-navigate:
- Props: `{ violations: LintViolation[]; onNavigate: (line: number) => void }` (import LintViolation from types).
- `SeverityIcon` internal component: colored dot (w-2.5 h-2.5 rounded-full) -- error=#ef4444, warning=#f59e0b, info=#3b82f6. Use aria-label for accessibility.
- `groupBySeverity` function: group violations by severity, sort groups in order error->warning->info.
- Severity group headers: "Errors (N)", "Warnings (N)", "Info (N)" with colored left border.
- Each violation renders as a `<details>` element with `<summary>`:
  - Summary row: SeverityIcon, rule ID (font-mono text-xs), message (truncated), line number button (text-xs text-[var(--color-accent)] hover:underline, onClick calls onNavigate(violation.line) with e.stopPropagation()).
  - Add `list-none` class to summary to remove default disclosure triangle.
  - Add a custom chevron span that rotates on group-open: `group-open:rotate-90 transition-transform`.
  - Details body: explanation paragraph, then before/after code fix in a 2-column grid (red "Before:" label + pre block, green "After:" label + pre block). Only show fix code if `violation.fix.beforeCode` is truthy.
- Set `max-h-[400px] lg:max-h-none overflow-y-auto` on the violation list container to prevent mobile overflow (Pitfall 6 from research).
- Add `summary::-webkit-details-marker { display: none; }` via inline style or Tailwind's `[&_summary::-webkit-details-marker]:hidden` if supported, otherwise handle in the summary className.
- Export as named export: `export function ViolationList(...)`.
  </action>
  <verify>
1. Run `npx tsc --noEmit 2>&1 | grep -E "results/(Score|Category|Empty|Violation)" | head -20` -- no type errors.
2. Verify exports: `grep "export function" src/components/tools/results/*.tsx` should show 4 named exports.
3. Verify ViolationList imports highlightAndScroll or accepts onNavigate prop: `grep "onNavigate\|highlightAndScroll" src/components/tools/results/ViolationList.tsx`.
  </verify>
  <done>
Four sub-components exist in src/components/tools/results/: ScoreGauge (SVG circular gauge), CategoryBreakdown (5 horizontal bars), EmptyState (congratulatory message with gauge), ViolationList (severity-grouped expandable list with click-to-navigate callback). All type-check clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite ResultsPanel to compose sub-components with stale results handling</name>
  <files>
    src/components/tools/ResultsPanel.tsx
  </files>
  <action>
Rewrite `src/components/tools/ResultsPanel.tsx` to compose the four sub-components. Keep the existing "Results" heading and the analyzing/no-result states.

**Imports:**
- `useStore` from `@nanostores/react`
- `analysisResult`, `isAnalyzing`, `editorViewRef`, `resultsStale` from store
- `ScoreGauge` from `./results/ScoreGauge`
- `CategoryBreakdown` from `./results/CategoryBreakdown`
- `ViolationList` from `./results/ViolationList`
- `EmptyState` from `./results/EmptyState`
- `highlightAndScroll` from `../../lib/tools/dockerfile-analyzer/highlight-line`

**State:**
- `const result = useStore(analysisResult)`
- `const analyzing = useStore(isAnalyzing)`
- `const stale = useStore(resultsStale)`

**Navigate handler:**
```typescript
const handleNavigate = (line: number) => {
  const view = editorViewRef.get();
  if (!view) return;
  highlightAndScroll(view, line);
};
```

**Render logic (in order of priority):**

1. **Analyzing state** (unchanged): Show "Analyzing..." spinner/text.

2. **No result yet** (result === null): Show the existing "Click Analyze or press Cmd/Ctrl+Enter" placeholder. Keep current styling.

3. **Parse error** (result.parseSuccess === false): Show "Parse error -- check Dockerfile syntax" in red.

4. **Clean Dockerfile** (result.parseSuccess && result.violations.length === 0): Render `<EmptyState score={result.score.overall} grade={result.score.grade} />`.

5. **Has violations** (result.parseSuccess && result.violations.length > 0): Render in a scrollable flex column:
   - Stale results banner (if `stale` is true): A subtle amber/yellow-tinted div at the top with text "Results may be outdated" and a "Re-analyze to refresh" message. Use `text-amber-400 bg-amber-500/10 border border-amber-500/20 rounded px-3 py-2 text-xs mb-3`.
   - Score section: ScoreGauge and CategoryBreakdown side-by-side on desktop (flex row), stacked on mobile.
     - Layout: `flex flex-col sm:flex-row items-center sm:items-start gap-4 mb-4`
     - ScoreGauge on the left with `size={100}` (compact).
     - CategoryBreakdown filling the remaining space (`flex-1 w-full`).
   - Violation count summary: "N issue(s) found" in text-sm with severity breakdown (e.g., "3 errors, 5 warnings, 2 info").
   - ViolationList: `<ViolationList violations={result.violations} onNavigate={handleNavigate} />`

6. **Stale dimming:** Wrap the entire results content area (not the heading) in a div with `className={stale ? 'opacity-60 transition-opacity' : 'transition-opacity'}`.

**Keep the outer structure** consistent with the current ResultsPanel: `flex flex-col h-full` wrapper, "Results" heading at top, flex-1 content area with border/background.

The overall results area should have `overflow-y-auto` to handle long violation lists, particularly on the desktop side-by-side layout where the panel has a fixed height.
  </action>
  <verify>
1. Run `npx astro build 2>&1 | tail -20` -- build completes without errors.
2. Verify all sub-components are imported: `grep -E "import.*from.*results/" src/components/tools/ResultsPanel.tsx` should show 4 imports.
3. Verify click-to-navigate wired: `grep "highlightAndScroll" src/components/tools/ResultsPanel.tsx` should match.
4. Verify stale handling: `grep "resultsStale\|stale" src/components/tools/ResultsPanel.tsx` should match at least 2 times.
5. Verify the placeholder text for "Phase 23" is gone: `grep "Phase 23" src/components/tools/ResultsPanel.tsx` should NOT match.
  </verify>
  <done>
ResultsPanel rewritten with ScoreGauge, CategoryBreakdown, ViolationList, and EmptyState composition. Click-to-navigate wired via highlightAndScroll + editorViewRef nanostore. Stale results dimming with re-analyze banner. All five result states handled (analyzing, no result, parse error, clean, violations). Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npx astro build` completes without errors.
2. Open /tools/dockerfile-analyzer/ in browser, click Analyze with the sample Dockerfile -- see score gauge, category bars, and grouped violations.
3. Click a violation line number -- editor scrolls to that line and briefly highlights it in teal.
4. Replace Dockerfile content with `FROM alpine:latest` (a clean file), click Analyze -- see "No Issues Found" with checkmark and 100/A+ gauge.
5. After analyzing, edit the Dockerfile -- results panel dims with "Results may be outdated" banner.
6. Gutter markers show red/amber/blue severity colors matching the design.
</verification>

<success_criteria>
- ScoreGauge renders SVG circular gauge with score, grade, and color-coded arc
- CategoryBreakdown renders 5 horizontal bars with accurate per-category scores
- ViolationList groups violations by severity, supports expand/collapse, shows before/after fix code
- Click on violation line number scrolls editor to line and flashes highlight for 1.5s
- EmptyState shows when zero violations with congratulatory message and perfect score gauge
- Stale results dim with opacity and show re-analyze banner after editing
- Build passes without errors
- No "Phase 23" placeholder text remains in ResultsPanel
</success_criteria>

<output>
After completion, create `.planning/phases/24-results-display-interaction/24-02-SUMMARY.md`
</output>
