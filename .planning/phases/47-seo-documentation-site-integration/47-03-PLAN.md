---
phase: 47-seo-documentation-site-integration
plan: 03
type: execute
wave: 2
depends_on: ["47-01"]
files_modified:
  - src/pages/tools/k8s-analyzer/rules/[code].astro
autonomous: true

must_haves:
  truths:
    - "67 rule documentation pages are generated at /tools/k8s-analyzer/rules/[code]/ via getStaticPaths"
    - "Each rule page shows explanation, fix suggestion, before/after YAML code, related rules, severity/category badges"
    - "Security rules with PSS profile mappings display PSS Baseline or PSS Restricted badges"
    - "Applicable rules display CIS Benchmark section references"
    - "Each rule page has breadcrumb JSON-LD, FAQ JSON-LD, and SEO meta description"
    - "Each rule page footer links back to tool page and blog post"
  artifacts:
    - path: "src/pages/tools/k8s-analyzer/rules/[code].astro"
      provides: "67 dynamic rule documentation pages"
      contains: "getStaticPaths"
  key_links:
    - from: "src/pages/tools/k8s-analyzer/rules/[code].astro"
      to: "src/lib/tools/k8s-analyzer/rules/index.ts"
      via: "import allDocumentedK8sRules"
      pattern: "allDocumentedK8sRules"
    - from: "src/pages/tools/k8s-analyzer/rules/[code].astro"
      to: "src/lib/tools/k8s-analyzer/rules/related.ts"
      via: "import getRelatedK8sRules"
      pattern: "getRelatedK8sRules"
    - from: "src/pages/tools/k8s-analyzer/rules/[code].astro"
      to: "src/lib/tools/k8s-analyzer/pss-compliance.ts"
      via: "import PSS_BASELINE_RULES, PSS_RESTRICTED_RULES"
      pattern: "PSS_BASELINE_RULES"
    - from: "src/pages/tools/k8s-analyzer/rules/[code].astro"
      to: "src/lib/tools/k8s-analyzer/cis-benchmark.ts"
      via: "import CIS_BENCHMARK_REFS"
      pattern: "CIS_BENCHMARK_REFS"
---

<objective>
Create the dynamic rule documentation page template that generates 67 individual pages at build time via Astro's getStaticPaths, with PSS profile tags and CIS Benchmark references on applicable rules.

Purpose: This is the core SEO asset -- 67 individually indexed pages providing long-tail search coverage for Kubernetes best practices. Each page is a standalone resource that can rank for specific queries like "kubernetes privileged container fix".
Output: 67 rule documentation pages at /tools/k8s-analyzer/rules/[code]/
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/47-seo-documentation-site-integration/47-01-SUMMARY.md
@src/pages/tools/compose-validator/rules/[code].astro
@src/lib/tools/k8s-analyzer/rules/index.ts
@src/lib/tools/k8s-analyzer/pss-compliance.ts
@src/lib/tools/k8s-analyzer/cis-benchmark.ts
@src/lib/tools/k8s-analyzer/types.ts
@src/components/BreadcrumbJsonLd.astro
@src/components/FAQPageJsonLd.astro
@src/layouts/Layout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create [code].astro rule documentation page template</name>
  <files>
    src/pages/tools/k8s-analyzer/rules/[code].astro
  </files>
  <action>
Create `src/pages/tools/k8s-analyzer/rules/[code].astro` following the exact pattern of `src/pages/tools/compose-validator/rules/[code].astro` with K8s-specific additions for PSS profiles and CIS Benchmark references.

**Imports:**
```astro
---
import { Code as AstroCode } from 'astro:components';
import Layout from '../../../../layouts/Layout.astro';
import BreadcrumbJsonLd from '../../../../components/BreadcrumbJsonLd.astro';
import FAQPageJsonLd from '../../../../components/FAQPageJsonLd.astro';
import { allDocumentedK8sRules } from '../../../../lib/tools/k8s-analyzer/rules/index';
import { getRelatedK8sRules } from '../../../../lib/tools/k8s-analyzer/rules/related';
import { PSS_BASELINE_RULES, PSS_RESTRICTED_RULES } from '../../../../lib/tools/k8s-analyzer/pss-compliance';
import { CIS_BENCHMARK_REFS } from '../../../../lib/tools/k8s-analyzer/cis-benchmark';
import type { K8sSeverity, K8sCategory } from '../../../../lib/tools/k8s-analyzer/types';
import type { DocumentedK8sRule } from '../../../../lib/tools/k8s-analyzer/rules/index';
---
```

**getStaticPaths:**
```typescript
export function getStaticPaths() {
  return allDocumentedK8sRules.map((rule) => ({
    params: { code: rule.id.toLowerCase() },
    props: { rule },
  }));
}
```

**Variables:**
- `rule` from `Astro.props`
- `relatedRules = getRelatedK8sRules(rule.id)`
- `pssProfile`: Check `PSS_BASELINE_RULES.has(rule.id)` and `PSS_RESTRICTED_RULES.has(rule.id)` to determine PSS level
- `cisRef = CIS_BENCHMARK_REFS[rule.id]` for CIS Benchmark reference (may be undefined)
- `severityLabel` map: `{ error: 'Error', warning: 'Warning', info: 'Info' }`
- `categoryLabel` map: `{ schema: 'Schema', security: 'Security', reliability: 'Reliability', 'best-practice': 'Best Practice', 'cross-resource': 'Cross-Resource' }` -- note all 5 K8s categories must be covered
- `severityColor` map: same as compose-validator (error: red, warning: amber, info: blue)
- `pageTitle = \`${rule.id}: ${rule.title} | Kubernetes Manifest Analyzer\``
- `pageDesc` = truncated explanation (155 chars + ...)
- `pageUrl` with trailing slash

**Page sections (follow compose-validator layout exactly):**

1. **BreadcrumbJsonLd**: Home -> Tools -> K8s Analyzer -> {rule.id}
2. **FAQPageJsonLd**: Two items -- "What does K8s rule {id} mean?" + "How do I fix {id}?"
3. **Header**: h1 with rule.id + title, severity badge, category badge
4. **PSS Profile tags** (NEW, after header badges): If `PSS_BASELINE_RULES.has(rule.id)`, render a purple badge "PSS Baseline". If `PSS_RESTRICTED_RULES.has(rule.id)`, render a purple badge "PSS Restricted". Use `bg-purple-100 text-purple-700` for the badge.
5. **CIS Benchmark reference** (NEW, after PSS tags): If `cisRef` exists, render a gray info line: "CIS Kubernetes Benchmark v1.8, Section {section}: {title}". Use `text-sm text-[var(--color-text-secondary)]` styling.
6. **"Why This Matters"**: rule.explanation paragraph
7. **"How to Fix"**: fix.description + before/after code blocks using `<AstroCode code={...} lang="yaml" />`
8. **"Rule Details"**: Definition list with Rule Code, Severity, Category (same as compose-validator)
9. **"Related Rules"**: Same rendering as compose-validator, links to `/tools/k8s-analyzer/rules/{id.toLowerCase()}/`
10. **Footer**: Back-links to `/tools/k8s-analyzer/` ("Try the K8s Manifest Analyzer") and `/blog/kubernetes-manifest-best-practices/` ("Read the best practices guide")
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Run `npx astro build 2>&1 | grep "k8s-analyzer/rules"` to confirm 67 rule pages are generated. The build log should show the rules directory being generated.
  </verify>
  <done>67 rule documentation pages generated at /tools/k8s-analyzer/rules/[code]/ with explanation, fix code, PSS tags, CIS refs, related rules, breadcrumbs, FAQ JSON-LD, and bidirectional links.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npx astro build` generates 67 pages under tools/k8s-analyzer/rules/
3. PSS Baseline badge appears on KA-C001, KA-C006, KA-C007, KA-C008, KA-C009, KA-C010, KA-C013, KA-C014
4. PSS Restricted badge appears on KA-C002, KA-C003, KA-C004, KA-C005, KA-C011
5. CIS Benchmark references appear on applicable security and RBAC rules
6. Related rules section shows up to 5 same-category rules
7. Footer links to tool page and blog post
8. All category labels render correctly (no undefined/blank categories)
</verification>

<success_criteria>
All 67 rule documentation pages build successfully with complete content: explanation, fix suggestion, before/after YAML code, severity/category badges, PSS profile tags (where applicable), CIS Benchmark references (where applicable), related rules, breadcrumb navigation, FAQ structured data, and bidirectional links to the tool page and blog post.
</success_criteria>

<output>
After completion, create `.planning/phases/47-seo-documentation-site-integration/47-03-SUMMARY.md`
</output>
