# Milestone v1.7: Kubernetes Manifest Analyzer

**Status:** SHIPPED 2026-02-23
**Phases:** 41-47
**Total Plans:** 23

## Overview

Interactive browser-based Kubernetes manifest linter with multi-resource schema validation (19 K8s resource types), 67 rules across 5 categories (security, reliability, best practice, cross-resource, RBAC), CodeMirror 6 YAML editor, category-weighted scoring, interactive React Flow dependency graph, 67 rule documentation pages, companion blog post, and shareable results.

## Phases

### Phase 41: Foundation & Schema Infrastructure

**Goal**: Users can paste a multi-document K8s manifest and get accurate schema validation results for all 19 supported resource types
**Depends on**: Nothing (first phase of v1.7)
**Plans**: 4 plans

Plans:
- [x] 41-01-PLAN.md -- Types & schema compilation (compile K8s 1.31 validators, validate <200KB gzipped)
- [x] 41-02-PLAN.md -- GVK registry, multi-doc parser & diagnostic rules (KA-S001 through KA-S010)
- [x] 41-03-PLAN.md -- Resource registry & schema validator (ajv error mapping with line numbers)
- [x] 41-04-PLAN.md -- Async engine orchestrator & sample manifest (full pipeline integration)

**Details:**
Multi-document YAML parsing with source range preservation, GVK registry for 19 resource types, pre-compiled K8s 1.31 JSON Schema validators via ajv standalone (76KB gzipped), resource registry with kind/name/namespace/label indexing, 10 schema diagnostic rules (KA-S001 through KA-S010).

### Phase 42: Security Rules

**Goal**: Users see comprehensive pod and container security analysis covering PSS Baseline/Restricted profiles and CIS Benchmark controls
**Depends on**: Phase 41
**Plans**: 2 plans

Plans:
- [x] 42-01-PLAN.md -- Container helpers and all 20 security rules (KA-C001 through KA-C020)
- [x] 42-02-PLAN.md -- Engine integration, PSS compliance summary, and sample manifest update

**Details:**
20 security rules covering privileged containers, privilege escalation, root execution, host namespaces, dangerous capabilities, host paths, Docker socket, service account tokens, seccomp profiles. PSS Baseline/Restricted compliance summary.

### Phase 43: Reliability & Best Practice Rules

**Goal**: Users receive actionable reliability and best practice recommendations for production-readiness
**Depends on**: Phase 41
**Plans**: 3 plans

Plans:
- [x] 43-01-PLAN.md -- 12 reliability rules (KA-R001 through KA-R012) with category index
- [x] 43-02-PLAN.md -- 12 best practice rules (KA-B001 through KA-B012) with category index
- [x] 43-03-PLAN.md -- Master index integration and sample manifest update

**Details:**
12 reliability rules (probes, replicas, rolling update, image tags, selector matching, CronJob deadlines) and 12 best practice rules (resource requests/limits, labels, namespace, SSH ports, NodePort, probe ports, priorityClassName, duplicate env vars).

### Phase 44: Cross-Resource Validation & RBAC

**Goal**: Users see validation of references between resources and get warnings for dangling references and overly permissive RBAC
**Depends on**: Phase 41, Phase 42
**Plans**: 3 plans

Plans:
- [x] 44-01-PLAN.md -- 8 cross-resource validation rules (KA-X001 through KA-X008) with well-known resources whitelist
- [x] 44-02-PLAN.md -- 5 RBAC analysis rules (KA-A001 through KA-A005) with category index
- [x] 44-03-PLAN.md -- Master index integration and sample manifest update

**Details:**
8 cross-resource reference checks (Service selectors, Ingress backends, ConfigMap/Secret/PVC/SA references, NetworkPolicy selectors, HPA targets) with well-known resources whitelist. 5 RBAC analysis rules (wildcard permissions, cluster-admin, pod exec/attach, secret access, pod creation) scored under Security category.

### Phase 45: Editor UI & Scoring

**Goal**: Users interact with a polished browser-based tool with CodeMirror editor, scored results, and share controls
**Depends on**: Phase 42, Phase 43
**Plans**: 3 plans

Plans:
- [x] 45-01-PLAN.md -- Foundation utilities (scorer, store, URL state, badge, CodeMirror hook)
- [x] 45-02-PLAN.md -- Editor panel + results sub-components (8 React components)
- [x] 45-03-PLAN.md -- Assembly (results panel, root component, Astro page, tools index)

**Details:**
CodeMirror 6 YAML editor with dark theme, inline annotations (squiggly underlines + gutter markers), nanostore bridge for state management. Score gauge (SVG), category breakdown, violation list, resource summary, PSS compliance panel. Responsive layout (stacked mobile, side-by-side desktop). PNG badge export, lz-string URL state encoding, 3-tier share fallback.

### Phase 46: Resource Relationship Graph

**Goal**: Users can visualize dependency relationships between K8s resources as an interactive graph
**Depends on**: Phase 44
**Plans**: 2 plans

Plans:
- [x] 46-01-PLAN.md -- Graph data extractor + custom React Flow node/edge/skeleton/CSS components
- [x] 46-02-PLAN.md -- K8sResourceGraph assembly + K8sResultsPanel integration

**Details:**
Interactive React Flow dependency graph with dagre layout, color-coded nodes by resource kind category (workloads, services, config, storage, RBAC, scaling), dangling reference visualization with red dashed edges. Lazy-loaded via React.lazy() to maintain Lighthouse 90+.

### Phase 47: SEO, Documentation & Site Integration

**Goal**: K8s Manifest Analyzer fully integrated into site with 67 rule documentation pages, companion blog post, and all standard site integration touchpoints
**Depends on**: Phase 42, Phase 43, Phase 44
**Plans**: 6 plans

Plans:
- [x] 47-01-PLAN.md -- Rule data foundation (allDocumentedK8sRules 67 rules, related rules, CIS benchmark refs)
- [x] 47-02-PLAN.md -- OG image, JSON-LD, tool page SEO enhancements
- [x] 47-03-PLAN.md -- 67 dynamic rule documentation pages with PSS/CIS tags
- [x] 47-04-PLAN.md -- Homepage 3-card grid, LLMs.txt integration
- [x] 47-05-PLAN.md -- Companion blog post "Kubernetes Manifest Best Practices" with ~20 cross-links
- [x] 47-06-PLAN.md -- Build verification + UAT

**Details:**
67 per-rule SEO documentation pages at /tools/k8s-analyzer/rules/[code] with explanation, fix suggestion, before/after code, related rules, PSS/CIS tags. Companion blog post with 21 cross-links. OG image via Satori + Sharp, JSON-LD SoftwareApplication schema, breadcrumb navigation. Homepage 3-card grid callout, header navigation, tools page card, sitemap, LLMs.txt. Build verification: 857 total pages, Lighthouse compliance.

---

## Milestone Summary

**Key Decisions:**
- Async engine with dynamic schema imports (unlike sync compose-validator)
- Single compiled Ajv module for all 19 K8s schemas (shared definition dedup)
- Strip format fields from K8s schemas to avoid ajv-formats require() in standalone output
- 19 resource types including ClusterRoleBinding
- GVK flat array with find() over Map (19 entries makes linear scan negligible)
- Schema validator caches validators at module level (dynamic import only happens once)
- SEC-03/SEC-05 no-overlap: KA-C005 fires for explicit runAsUser:0, KA-C003 skips
- PSS Restricted inherits Baseline (zero Baseline AND zero Restricted violations required)
- totalRules = 10 + allK8sRules.length for extensibility
- All 5 RBAC rules use category: 'security' for SCORE-04 35% weight compliance
- Dual rule lookup (SCHEMA_RULE_METADATA + allK8sRules) in scorer
- resourceId format matches ResourceRegistry byNameIndex key: kind/namespace/name
- React Flow lazy-loaded via React.lazy() (222 KB separate chunk)
- SCHEMA_RULE_METADATA spread into allDocumentedK8sRules (compatible DocumentedK8sRule shape)
- 21 CIS Benchmark mappings across applicable rules

**Issues Resolved:**
- Schema bundle size validated at 76KB gzipped (well under 200KB limit)
- Buffer polyfill pattern from v1.4 not needed (no dockerfile-ast dependency)
- Phase 42/43 parallel execution enabled (no cross-dependencies)

**Issues Deferred:**
- Cross-resource false positives for partial manifests (accepted as inherent limitation)
- Dark mode strategy for charts (charts use light mode CSS custom properties only)

**Technical Debt Incurred:**
- Category colors/grade colors duplicated in badge-generator.ts (carried from v1.4)
- No shared getBlogPostUrl helper (URL resolution duplicated in 3 files)
- Social links hardcoded across component files

---

_For current project status, see .planning/ROADMAP.md_
