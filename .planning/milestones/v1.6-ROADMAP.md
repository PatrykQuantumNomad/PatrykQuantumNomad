# Milestone v1.6: Docker Compose Validator

**Status:** SHIPPED 2026-02-23
**Phases:** 33-40
**Total Plans:** 14

## Overview

Docker Compose Validator is an interactive browser-based Docker Compose validation tool at /tools/compose-validator/ that validates YAML files against the compose-spec JSON Schema and a custom semantic rule engine with 52 rules across 5 categories, displays category-weighted scores with letter grades, annotates violations inline in a CodeMirror 6 editor, and renders an interactive service dependency graph via React Flow. This is the fourth content pillar for the portfolio, following the Dockerfile Analyzer architecture pattern -- parallel namespace, pattern-mirrored, with YAML AST parsing (eemeli/yaml), Ajv schema validation, graphology cycle detection, and React Flow graph visualization as the novel additions. Companion blog post covers Docker Compose best practices and tool architecture.

## Phases

### Phase 33: YAML Parsing & Schema Validation Foundation
**Goal**: A YAML string can be parsed into an AST with source line numbers, variable interpolation is normalized, and the compose-spec JSON Schema validates structural correctness with human-readable error messages mapped to exact source lines
**Depends on**: Nothing (first phase of v1.6 -- builds on shipped v1.5)
**Requirements**: PARSE-01, PARSE-02, PARSE-03, PARSE-04, PARSE-05, PARSE-06, SCHEMA-01, SCHEMA-02, SCHEMA-03, SCHEMA-04, SCHEMA-05, SCHEMA-06, SCHEMA-07, SCHEMA-08
**Plans**: 2 plans

Plans:
- [x] 33-01-PLAN.md — Install yaml/ajv/ajv-formats, create types, interpolation normalizer, bundled compose-spec schema, and YAML 1.1 parser with LineCounter and AST helpers
- [x] 33-02-PLAN.md — Create ajv schema validator with error categorization, human-readable messages, and 8 schema rule metadata files (CV-S001 through CV-S008)

### Phase 34: Rule Engine, Rules & Scoring
**Goal**: All 44 custom analysis rules (15 semantic, 14 security, 12 best practice, 3 style) execute against a parsed Compose file, detect violations with line-accurate positions, and produce a category-weighted 0-100 score with letter grade
**Depends on**: Phase 33
**Requirements**: SEM-01 through SEM-15, SEC-01 through SEC-14, BP-01 through BP-12, STYLE-01 through STYLE-03, SCORE-01 through SCORE-04
**Plans**: 3 plans

Plans:
- [x] 34-01-PLAN.md — Shared utilities (port parser, graph builder with cycle detection) and 15 semantic rules (CV-M001 through CV-M015)
- [x] 34-02-PLAN.md — 14 security rules (CV-C001 through CV-C014) and 12 best practice rules (CV-B001 through CV-B012)
- [x] 34-03-PLAN.md — 3 style rules (CV-F001 through CV-F003), master rule registry, rule engine orchestrator, and category-weighted scoring engine

### Phase 35: CodeMirror YAML Editor & Nanostores
**Goal**: Users see a CodeMirror 6 editor with YAML syntax highlighting, a pre-loaded sample compose file, and can trigger analysis via button or keyboard shortcut -- with results flowing through nanostores to the results panel
**Depends on**: Phase 34
**Requirements**: EDIT-01 through EDIT-08
**Plans**: 2 plans

Plans:
- [x] 35-01-PLAN.md — Install @codemirror/lang-yaml, create nanostore atoms, sample compose file, and useCodeMirrorYaml hook with YAML lang + Mod-Enter shortcut
- [x] 35-02-PLAN.md — Create ComposeEditorPanel, ComposeResultsPanel, ComposeValidator React components and Astro page at /tools/compose-validator/

### Phase 36: Results Panel & Dependency Graph
**Goal**: Users see their validation results as inline editor annotations, a score gauge, category breakdown, severity-grouped violation list, and an interactive service dependency graph with cycle highlighting -- all in a tabbed results panel
**Depends on**: Phase 35
**Requirements**: RESULT-01 through RESULT-07, GRAPH-01 through GRAPH-07
**Plans**: 2 plans

Plans:
- [x] 36-01-PLAN.md — Tabbed results panel with ScoreGauge, ComposeCategoryBreakdown, ComposeViolationList, ComposeEmptyState, and click-to-navigate
- [x] 36-02-PLAN.md — React Flow dependency graph with dagre layout, custom service nodes, condition-labeled edges, cycle highlighting, and lazy loading

### Phase 37: Shareability & Badge Export
**Goal**: Users can download their score as a PNG badge for social sharing, share a URL that preserves their compose file content, and use native share/clipboard APIs
**Depends on**: Phase 36
**Requirements**: SHARE-01, SHARE-02, SHARE-03
**Plans**: 1 plan

Plans:
- [x] 37-01-PLAN.md — Badge generator, URL state encoding, ComposeShareActions with Web Share API, and editor URL decode on mount

### Phase 38: Rule Documentation Pages
**Goal**: Every rule has its own SEO-indexed documentation page at /tools/compose-validator/rules/[code] with expert explanation, fix suggestion, and before/after code examples
**Depends on**: Phase 34 (rule registry must exist)
**Requirements**: DOC-01, DOC-02, DOC-03, DOC-04
**Plans**: 1 plan

Plans:
- [x] 38-01-PLAN.md — Combined rule registry, related-rules utility, 52 dynamic route pages, and violation list rule ID links

### Phase 39: Tool Page & Site Integration
**Goal**: The Compose Validator is discoverable from every entry point -- header navigation, homepage callout, tools page, search engines (via JSON-LD and sitemap), and breadcrumb navigation
**Depends on**: Phase 36 (React island must exist), Phase 38 (rule pages must exist for cross-linking)
**Requirements**: SITE-01, SITE-02, SITE-03, SITE-04, SITE-05, SITE-06
**Plans**: 1 plan

Plans:
- [x] 39-01-PLAN.md — ComposeValidatorJsonLd component, tool page JSON-LD + breadcrumbs + aside, tools page card, homepage callout, and sitemap verification

### Phase 40: OG Images, Blog Post & Polish
**Goal**: The Compose Validator has a professional social preview image, a companion blog post provides editorial context and SEO value, and all pages pass Lighthouse and accessibility audits
**Depends on**: Phase 39 (pages must exist for OG routes and cross-linking)
**Requirements**: SITE-07, CONTENT-01, CONTENT-02
**Plans**: 2 plans

Plans:
- [x] 40-01-PLAN.md — OG image generator, API route, and ogImage prop wiring on tool page
- [x] 40-02-PLAN.md — Companion blog post and bidirectional cross-links between blog and tool page

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 33. YAML Parsing & Schema Validation Foundation | 2/2 | Complete | 2026-02-22 |
| 34. Rule Engine, Rules & Scoring | 3/3 | Complete | 2026-02-22 |
| 35. CodeMirror YAML Editor & Nanostores | 2/2 | Complete | 2026-02-22 |
| 36. Results Panel & Dependency Graph | 2/2 | Complete | 2026-02-22 |
| 37. Shareability & Badge Export | 1/1 | Complete | 2026-02-22 |
| 38. Rule Documentation Pages | 1/1 | Complete | 2026-02-23 |
| 39. Tool Page & Site Integration | 1/1 | Complete | 2026-02-23 |
| 40. OG Images, Blog Post & Polish | 2/2 | Complete | 2026-02-23 |

## Milestone Summary

**Key Decisions:**
- Used yaml 2.x with version: '1.1' mode for YAML merge key support critical to Docker Compose
- ajv singleton compiled at module level with strict:false, allErrors:true, verbose:true
- Schema rules use SchemaRuleMetadata interface (no check method) because ajv drives validation
- Port conflict detection uses numeric range intersection instead of set expansion for efficiency
- Reuse editor-theme.ts and highlight-line.ts from dockerfile-analyzer (no duplication)
- Used @xyflow/react 12.x and @dagrejs/dagre 2.x for dependency graph
- Cycle-safe dagre layout: remove cycle edges before layout, recombine after
- React Flow CSS imported inside lazy-loaded component (not globally) to keep initial bundle clean
- 3-tier share fallback: Web Share API > Clipboard API > prompt()
- #compose= hash prefix distinct from #dockerfile= to prevent cross-tool URL collision
- DocumentedRule interface unifies ComposeLintRule and SchemaRuleMetadata for 52-rule page generation
- Compose Validator OG image uses 44px title font to fit longer title

**Issues Resolved:**
- YAML 1.1 merge key config implemented with version: '1.1' and merge: true
- AST path resolver implemented for ajv error line mapping
- React Flow bundle lazy-loaded (222 KB separate chunk)
- ajv/dist/runtime/equal inlined to eliminate require() for browser compatibility
- Ajv schema pre-compiled for CSP compatibility
- Dependency graph edges made visible on light background

**Issues Deferred:**
- Dark mode strategy for charts (from v1.3)
- No shared getBlogPostUrl helper (URL resolution duplicated in 3 files)
- Social links hardcoded across 5 component files
- Category colors defined in 3 places

**Technical Debt Incurred:**
- No PromptGenerator in ComposeShareActions (compose rules differ from Dockerfile rules)
- Database Compass excluded from tools page per user's prior removal

---

_For current project status, see .planning/ROADMAP.md_
