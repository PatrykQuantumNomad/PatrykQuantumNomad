---
import type { Project, Category } from '../data/projects';

interface Props {
  project: Project;
}

const { project } = Astro.props;

// gridSize-driven span classes (LAYOUT-01)
// CRITICAL: Always use responsive prefix to prevent mobile overflow (Pitfall 1)
const spanClass = project.gridSize === 'large'
  ? 'sm:col-span-2 lg:col-span-2'
  : 'col-span-1';

// Padding varies by gridSize for visual hierarchy
const paddingClass = project.gridSize === 'large'
  ? 'p-6'
  : project.gridSize === 'medium'
    ? 'p-5'
    : 'p-4';

// Status badge styling
const statusStyles: Record<Project['status'], string> = {
  active: 'bg-emerald-500/10 text-emerald-700',
  experimental: 'bg-amber-500/10 text-amber-700',
  archived: 'bg-gray-500/10 text-gray-500',
};

// Category glow colors for hover effect (VIS-04)
const categoryMeta: Record<Category, { slug: string; glowColor: string }> = {
  'Kubert Kubernetes Platform': { slug: 'kubert',      glowColor: 'rgba(59, 130, 246, 0.3)' },
  'AI & Intelligent Agents':    { slug: 'ai-agents',   glowColor: 'rgba(139, 92, 246, 0.3)' },
  'Open Source Tools':           { slug: 'open-source', glowColor: 'rgba(16, 185, 129, 0.3)' },
};

// Status dot color indicators (VIS-02)
const statusDotStyles: Record<Project['status'], string> = {
  active: 'bg-emerald-500',
  experimental: 'bg-amber-500',
  archived: 'bg-gray-400',
};

const hasLiveUrl = !!project.liveUrl;
---

{hasLiveUrl ? (
  <div
    class:list={[
      'card-hover rounded-lg border border-[var(--color-border)] flex flex-col',
      paddingClass,
      spanClass,
    ]}
    style={`--category-glow: ${categoryMeta[project.category].glowColor}`}
    data-category={categoryMeta[project.category].slug}
    data-card-item
    data-tilt
  >
    <h3 class="font-heading font-bold text-lg">
      <a
        href={project.url}
        target="_blank"
        rel="noopener noreferrer"
        class="hover:text-[var(--color-accent)] transition-colors"
      >
        {project.name}
      </a>
    </h3>
    <div class="flex flex-wrap gap-2 mt-2">
      {project.technologies.map((tech) => (
        <span class="tech-pill text-xs px-2.5 py-0.5 rounded-full bg-[var(--color-surface-alt)] border border-[var(--color-border)] tracking-wide">
          {tech}
        </span>
      ))}
    </div>
    <p class="text-sm text-[var(--color-text-secondary)] mt-2 flex-1">
      {project.description}
    </p>
    <div class="flex items-center gap-3 mt-4 pt-3 border-t border-[var(--color-border)]">
      <div class="flex items-center gap-2 flex-wrap">
        <span class:list={['meta-mono px-2 py-0.5 rounded-full inline-flex items-center gap-1', statusStyles[project.status]]}>
          <span class:list={['w-1.5 h-1.5 rounded-full', statusDotStyles[project.status]]}></span>
          {project.status}
        </span>
        {project.liveUrl && (
          <span class="meta-mono px-2 py-0.5 rounded-full bg-sky-500/10 text-sky-600 dark:text-sky-400 inline-flex items-center gap-1">
            <span class="w-1.5 h-1.5 rounded-full bg-sky-500 animate-pulse"></span>
            Live
          </span>
        )}
      </div>
      <div class="flex items-center gap-2 ml-auto">
        <a
          href={project.url}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 text-sm font-medium px-3 py-1 rounded border border-[var(--color-border)] hover:border-[var(--color-accent)] hover:text-[var(--color-accent)] transition-colors"
          data-magnetic
        >
          <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          Source
        </a>
        <a
          href={project.liveUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 text-sm font-medium px-3 py-1 rounded border border-[var(--color-border)] hover:border-[var(--color-accent)] hover:text-[var(--color-accent)] transition-colors"
          data-magnetic
        >
          <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6" />
            <polyline points="15 3 21 3 21 9" />
            <line x1="10" y1="14" x2="21" y2="3" />
          </svg>
          Live Site
        </a>
      </div>
    </div>
  </div>
) : (
  <a
    href={project.url}
    target="_blank"
    rel="noopener noreferrer"
    class:list={[
      'group card-hover rounded-lg border border-[var(--color-border)] flex flex-col',
      paddingClass,
      spanClass,
    ]}
    style={`--category-glow: ${categoryMeta[project.category].glowColor}`}
    data-category={categoryMeta[project.category].slug}
    data-card-item
    data-tilt
  >
    <div class="flex items-start justify-between gap-2">
      <h3 class="font-heading font-bold text-lg group-hover:text-[var(--color-accent)] transition-colors">
        {project.name}
      </h3>
      <svg
        class="w-4 h-4 mt-1 shrink-0 text-[var(--color-text-secondary)] group-hover:text-[var(--color-accent)] transition-colors"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <path d="M7 17L17 7" />
        <path d="M7 7h10v10" />
      </svg>
    </div>
    <div class="flex flex-wrap gap-2 mt-2">
      {project.technologies.map((tech) => (
        <span class="tech-pill text-xs px-2.5 py-0.5 rounded-full bg-[var(--color-surface-alt)] border border-[var(--color-border)] tracking-wide">
          {tech}
        </span>
      ))}
    </div>
    <p class="text-sm text-[var(--color-text-secondary)] mt-2 flex-1">
      {project.description}
    </p>
    <div class="flex items-center gap-2 mt-3 pt-3 border-t border-[var(--color-border)]">
      <div class="flex items-center gap-2 flex-wrap">
        <span class:list={['meta-mono px-2 py-0.5 rounded-full inline-flex items-center gap-1', statusStyles[project.status]]}>
          <span class:list={['w-1.5 h-1.5 rounded-full', statusDotStyles[project.status]]}></span>
          {project.status}
        </span>
      </div>
    </div>
  </a>
)}
