---
interface Props {
  currentPage: number;
  lastPage: number;
  prevUrl: string | undefined;
  nextUrl: string | undefined;
  baseUrl?: string;
}

const {
  currentPage,
  lastPage,
  prevUrl,
  nextUrl,
  baseUrl = '/blog/',
} = Astro.props;

// Don't render if only one page
if (lastPage <= 1) return;

// Build page numbers with ellipsis logic
function getPageNumbers(current: number, last: number): (number | '...')[] {
  if (last <= 7) {
    return Array.from({ length: last }, (_, i) => i + 1);
  }

  const pages: (number | '...')[] = [1];

  if (current > 3) {
    pages.push('...');
  }

  const start = Math.max(2, current - 1);
  const end = Math.min(last - 1, current + 1);

  for (let i = start; i <= end; i++) {
    pages.push(i);
  }

  if (current < last - 2) {
    pages.push('...');
  }

  pages.push(last);

  return pages;
}

const pageNumbers = getPageNumbers(currentPage, lastPage);

function pageUrl(page: number): string {
  return page === 1 ? baseUrl : `${baseUrl}${page}/`;
}
---

<nav aria-label="Blog pagination" data-reveal class="flex items-center justify-center gap-2 mt-16 mb-8">
  {/* Previous link */}
  {prevUrl ? (
    <a
      href={prevUrl}
      class="meta-mono px-4 h-10 flex items-center justify-center rounded-lg bg-[var(--color-surface-alt)] text-[var(--color-text-secondary)] hover:bg-[var(--color-accent)]/10 hover:text-[var(--color-accent)] transition-colors"
    >
      &larr; Prev
    </a>
  ) : (
    <span class="meta-mono px-4 h-10 flex items-center justify-center rounded-lg bg-[var(--color-surface-alt)] text-[var(--color-text-secondary)] opacity-30 pointer-events-none">
      &larr; Prev
    </span>
  )}

  {/* Page numbers */}
  {pageNumbers.map((page) =>
    page === '...' ? (
      <span class="w-10 h-10 flex items-center justify-center text-[var(--color-text-secondary)] meta-mono">
        &hellip;
      </span>
    ) : page === currentPage ? (
      <span
        aria-current="page"
        class="meta-mono w-10 h-10 flex items-center justify-center rounded-lg bg-[var(--color-accent)] text-white"
      >
        {page}
      </span>
    ) : (
      <a
        href={pageUrl(page)}
        class="meta-mono w-10 h-10 flex items-center justify-center rounded-lg bg-[var(--color-surface-alt)] text-[var(--color-text-secondary)] hover:bg-[var(--color-accent)]/10 hover:text-[var(--color-accent)] transition-colors"
      >
        {page}
      </a>
    )
  )}

  {/* Next link */}
  {nextUrl ? (
    <a
      href={nextUrl}
      class="meta-mono px-4 h-10 flex items-center justify-center rounded-lg bg-[var(--color-surface-alt)] text-[var(--color-text-secondary)] hover:bg-[var(--color-accent)]/10 hover:text-[var(--color-accent)] transition-colors"
    >
      Next &rarr;
    </a>
  ) : (
    <span class="meta-mono px-4 h-10 flex items-center justify-center rounded-lg bg-[var(--color-surface-alt)] text-[var(--color-text-secondary)] opacity-30 pointer-events-none">
      Next &rarr;
    </span>
  )}
</nav>
