---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import ParticleCanvas from '../components/ParticleCanvas.astro';
import PersonJsonLd from '../components/PersonJsonLd.astro';
import { siteConfig } from '../data/site';

const posts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const latestPosts = posts
  .sort((a, b) => b.data.publishedDate.valueOf() - a.data.publishedDate.valueOf())
  .slice(0, 3);

const pageTitle = `${siteConfig.name} — ${siteConfig.roles[0]} & ${siteConfig.roles[2]}`;
const pageDescription = `Portfolio of ${siteConfig.name}, ${siteConfig.description}.`;
---

<Layout
  title={pageTitle}
  description={pageDescription}
>
  <!-- Hero Section -->
  <div class="relative" transition:persist="particle-hero">
    <ParticleCanvas />
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-28">
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-heading font-bold mb-4">
        {siteConfig.name}
      </h1>
      <p class="text-xl sm:text-2xl text-[var(--color-accent)] font-heading font-medium mb-6 min-h-[1.75rem] sm:min-h-[2rem]">
        <span id="typing-role" class="typing-cursor">{siteConfig.roles[0]}</span>
      </p>
      <p class="text-lg text-[var(--color-text-secondary)] max-w-2xl mb-8">
        {siteConfig.tagline}
      </p>
      <div class="flex flex-wrap gap-4">
        <a
          href="/projects/"
          class="inline-flex items-center px-6 py-3 rounded-lg bg-[var(--color-accent)] text-white font-medium hover:bg-[var(--color-accent-hover)] transition-colors"
        >
          View Projects
        </a>
        <a
          href="/blog/"
          class="inline-flex items-center px-6 py-3 rounded-lg border border-[var(--color-accent)] text-[var(--color-accent)] font-medium hover:bg-[var(--color-accent)]/10 transition-colors"
        >
          Read Blog
        </a>
      </div>
    </section>
  </div>

  <!-- Skills / What I Build Section -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16 reveal">
    <h2 class="text-2xl sm:text-3xl font-heading font-bold mb-8">What I Build</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

      <!-- Cloud-Native & Kubernetes -->
      <div class="p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
        <div class="mb-4 text-[var(--color-accent)]">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
          </svg>
        </div>
        <h3 class="text-lg font-heading font-bold mb-2">Cloud-Native & Kubernetes</h3>
        <p class="text-sm text-[var(--color-text-secondary)]">
          Designing and operating production Kubernetes clusters since pre-1.0. Service meshes, GitOps, observability stacks.
        </p>
      </div>

      <!-- AI/ML Systems -->
      <div class="p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
        <div class="mb-4 text-[var(--color-accent)]">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456z" />
          </svg>
        </div>
        <h3 class="text-lg font-heading font-bold mb-2">AI/ML Systems</h3>
        <p class="text-sm text-[var(--color-text-secondary)]">
          Building LLM agents, RAG pipelines, and intelligent automation with LangGraph, Langflow, and custom orchestration.
        </p>
      </div>

      <!-- Platform Engineering -->
      <div class="p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
        <div class="mb-4 text-[var(--color-accent)]">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17l-5.1-3.03a1.5 1.5 0 01-.55-2.05l3.03-5.1a1.5 1.5 0 012.05-.55l5.1 3.03a1.5 1.5 0 01.55 2.05l-3.03 5.1a1.5 1.5 0 01-2.05.55zM20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0l-3-3m3 3l3-3" />
          </svg>
        </div>
        <h3 class="text-lg font-heading font-bold mb-2">Platform Engineering</h3>
        <p class="text-sm text-[var(--color-text-secondary)]">
          Infrastructure as Code with Terraform and Terragrunt. CI/CD pipelines, DevSecOps, and developer experience.
        </p>
      </div>

      <!-- Full-Stack Development -->
      <div class="p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
        <div class="mb-4 text-[var(--color-accent)]">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
          </svg>
        </div>
        <h3 class="text-lg font-heading font-bold mb-2">Full-Stack Development</h3>
        <p class="text-sm text-[var(--color-text-secondary)]">
          Python, Java, TypeScript. React, Angular, Next.js. APIs, microservices, and data pipelines.
        </p>
      </div>

    </div>
  </section>

  <!-- Latest Blog Posts Section -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16 reveal">
    <h2 class="text-2xl sm:text-3xl font-heading font-bold mb-8">Latest Writing</h2>
    {latestPosts.length > 0 ? (
      <div class="space-y-6">
        {latestPosts.map((post) => {
          const isExternal = !!post.data.externalUrl;
          const href = isExternal ? post.data.externalUrl : `/blog/${post.id}/`;
          return (
            <article class="p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-surface-alt)]">
              <a
                href={href}
                class="text-lg font-heading font-bold text-[var(--color-text-primary)] hover:text-[var(--color-accent)] transition-colors"
                {...isExternal && { target: "_blank", rel: "noopener noreferrer" }}
              >
                {post.data.title}
              </a>
              <p class="text-sm text-[var(--color-text-secondary)] mt-1">
                <time datetime={post.data.publishedDate.toISOString()}>
                  {post.data.publishedDate.toLocaleDateString('en-CA', { year: 'numeric', month: 'long', day: 'numeric' })}
                </time>
                {post.data.source && (
                  <span class="text-xs px-2 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">
                    on {post.data.source}
                  </span>
                )}
                {isExternal && (
                  <svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4 text-[var(--color-text-secondary)] ml-1" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5zm7.25-.75a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0V6.31l-5.47 5.47a.75.75 0 01-1.06-1.06l5.47-5.47H12.25a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
                  </svg>
                )}
              </p>
              <p class="text-sm text-[var(--color-text-secondary)] mt-2">
                {post.data.description}
              </p>
            </article>
          );
        })}
      </div>
    ) : (
      <p class="text-[var(--color-text-secondary)]">No posts yet. Check back soon!</p>
    )}
    <div class="mt-8">
      <a
        href="/blog/"
        class="text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] font-medium transition-colors"
      >
        View all posts &rarr;
      </a>
    </div>
  </section>

  <!-- Contact CTA Section -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16 reveal">
    <h2 class="text-2xl sm:text-3xl font-heading font-bold mb-4">Interested in working together?</h2>
    <p class="text-[var(--color-text-secondary)] mb-8 max-w-2xl">
      Whether you need a cloud-native architect, want to collaborate on an open-source project, or just want to chat about Kubernetes and AI — I'd love to hear from you.
    </p>
    <div class="flex flex-wrap gap-4">
      <a
        href="mailto:pgolabek@gmail.com"
        class="inline-flex items-center px-6 py-3 rounded-lg bg-[var(--color-accent)] text-white font-medium hover:bg-[var(--color-accent-hover)] transition-colors"
      >
        Get in Touch
      </a>
      <a
        href="https://x.com/QuantumMentat"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center px-6 py-3 rounded-lg border border-[var(--color-accent)] text-[var(--color-accent)] font-medium hover:bg-[var(--color-accent)]/10 transition-colors"
      >
        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
        </svg>
        Follow on X
      </a>
    </div>
  </section>

  <PersonJsonLd />
</Layout>

<style>
  .typing-cursor::after {
    content: '|';
    animation: blink 0.8s step-end infinite;
    color: var(--color-accent);
  }
  @keyframes blink {
    50% { opacity: 0; }
  }
</style>

<script is:inline define:vars={{ roles: [...siteConfig.roles] }}>
  (function() {
    // Guard against double-initialization from ClientRouter re-execution
    if (window.__typingInterval) {
      clearInterval(window.__typingInterval);
    }
    let i = 0;
    const el = document.getElementById('typing-role');
    if (el) {
      window.__typingInterval = setInterval(function() {
        i = (i + 1) % roles.length;
        el.textContent = roles[i];
      }, 3000);
    }
  })();
</script>
