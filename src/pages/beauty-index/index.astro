---
/**
 * Beauty Index Overview Page — /beauty-index/
 * Main entry point for the Beauty Index. Assembles the ranking bar chart,
 * sortable scoring table, and tier-grouped radar thumbnail grid into a
 * single cohesive page.
 */
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import BreadcrumbJsonLd from '../../components/BreadcrumbJsonLd.astro';
import BeautyIndexJsonLd from '../../components/BeautyIndexJsonLd.astro';
import RankingBarChart from '../../components/beauty-index/RankingBarChart.astro';
import ScoringTable from '../../components/beauty-index/ScoringTable.astro';
import LanguageGrid from '../../components/beauty-index/LanguageGrid.astro';
import { totalScore } from '../../lib/beauty-index/schema';

const languages = await getCollection('languages');
const allData = languages.map((entry) => entry.data);
const sorted = [...allData].sort((a, b) => totalScore(b) - totalScore(a));

const ogImageURL = new URL('/open-graph/beauty-index.png', Astro.site).toString();
---

<Layout
  title="The Beauty Index | Patryk Golabek"
  description="Ranking 25 programming languages across 6 aesthetic dimensions. From Haskell's mathematical purity to COBOL's industrial grit — every language has a beauty score."
  ogImage={ogImageURL}
>
  <BreadcrumbJsonLd crumbs={[
    { name: "Home", url: "https://patrykgolabek.dev/" },
    { name: "Beauty Index", url: "https://patrykgolabek.dev/beauty-index/" },
  ]} />
  <BeautyIndexJsonLd languages={sorted} />

  {/* Hero Section */}
  <section class="text-center max-w-4xl mx-auto py-16 pb-12 px-4">
    <nav aria-label="Breadcrumb" class="text-sm text-[var(--color-text-secondary)] mb-4">
      <ol class="flex items-center gap-1 justify-center">
        <li><a href="/" class="hover:text-[var(--color-accent)] transition-colors">Home</a></li>
        <li aria-hidden="true" class="mx-1">/</li>
        <li aria-current="page">Beauty Index</li>
      </ol>
    </nav>
    <h1 class="text-4xl sm:text-5xl font-heading font-bold">
      The Beauty Index
    </h1>
    <p class="text-lg text-[var(--color-text-secondary)] mt-4 max-w-2xl mx-auto text-center">
      Ranking 25 programming languages across 6 aesthetic dimensions.
      Beauty is subjective; this index is deliberately opinionated.
    </p>
    <p class="text-sm text-[var(--color-text-secondary)] mt-3">
      <a href="/blog/the-beauty-index/" class="text-[var(--color-accent)] hover:underline">
        Read the methodology &rarr;
      </a>
    </p>
  </section>

  {/* Ranking Bar Chart Section */}
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl font-heading font-bold mb-6">Rankings</h2>
    <div class="overflow-x-auto" role="img" aria-label={`Bar chart ranking ${sorted.length} programming languages by total beauty score, from ${sorted[0].name} at ${totalScore(sorted[0])} to ${sorted[sorted.length - 1].name} at ${totalScore(sorted[sorted.length - 1])}`}>
      <RankingBarChart languages={sorted} />
    </div>
  </section>

  {/* Scoring Table Section */}
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-16">
    <h2 class="text-2xl font-heading font-bold mb-2">Score Breakdown</h2>
    <p class="text-sm text-[var(--color-text-secondary)] mb-6">
      Click any column header to sort
    </p>
    <ScoringTable languages={sorted} />
  </section>

  {/* Radar Grid Section */}
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-16 pb-16">
    <h2 class="text-2xl font-heading font-bold mb-6">Language Profiles</h2>
    <LanguageGrid languages={sorted} />
  </section>
</Layout>
